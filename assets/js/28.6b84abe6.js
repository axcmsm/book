(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{458:function(s,a,n){"use strict";n.r(a);var t=n(16),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"flume概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#flume概述"}},[s._v("#")]),s._v(" Flume概述")]),s._v(" "),n("p",[s._v("分布式海量"),n("strong",[s._v("日志")]),s._v("采集、聚合和传输、基于"),n("strong",[s._v("流式")]),s._v("架构")]),s._v(" "),n("p",[s._v("Flume 官网地址 "),n("a",{attrs:{href:"http://flume.apache.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://flume.apache.org/"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("文档 "),n("a",{attrs:{href:"http://flume.apache.org/FlumeUserGuide.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://flume.apache.org/FlumeUserGuide.html"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("strong",[s._v("核心角色agent")]),s._v(":(其本身是一个jvm进程)")]),s._v(" "),n("p",[n("strong",[s._v("核心组件")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("source")]),s._v(" ： (采集监控  推送事务给管道)")]),s._v(" "),n("li",[n("strong",[s._v("channel")]),s._v("：(管道缓冲 内存磁盘)")]),s._v(" "),n("li",[n("strong",[s._v("sink")]),s._v("： (拉取事务管道数据 封装下沉)")])]),s._v(" "),n("p",[n("strong",[s._v("运行机制：")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("flume本身是java程序 在需要采集数据机器上启动 -----\x3eagent进程")])]),s._v(" "),n("li",[n("p",[s._v("agent进程里面包含了：source  sink  channel")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("source 接收数据处理各种类型日志数据")]),s._v(" "),n("blockquote",[n("p",[s._v("例："),n("code",[s._v("avro、thrift、exec、jms、spooling directory、netcat、taildir、sequence generator、syslog、http、legacy。")])])])]),s._v(" "),n("li",[n("p",[s._v("Sink轮询 Channel 中的事件且批量地移除,写入存储")]),s._v(" "),n("blockquote",[n("p",[s._v("例：目的地")]),s._v(" "),n("p",[n("code",[s._v("hdfs、logger、avro、thrift、ipc、file、HBase、solr、自定义")])])])]),s._v(" "),n("li",[n("p",[s._v("Channel 是线程安全的,可同时进行处理读取操作。")]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("Memory Channel(内存) 和 File Channel(文件)")])])])])])]),s._v(" "),n("li",[n("p",[s._v("在flume中，数据被包装成event 真是的数据是放在event body中")]),s._v(" "),n("p",[n("strong",[s._v("event")]),s._v("是flume中最小的数据单元，由"),n("strong",[s._v("Header")]),s._v(" 和 "),n("strong",[s._v("Body")]),s._v(" 两部分组成。")])])]),s._v(" "),n("h2",{attrs:{id:"安装部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装部署"}},[s._v("#")]),s._v(" 安装部署")]),s._v(" "),n("p",[s._v("下载地址: "),n("a",{attrs:{href:"http://archive.apache.org/dist/flume/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://archive.apache.org/dist/flume/"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("strong",[s._v("安装步骤")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("上传源码包解压到指定目录")])]),s._v(" "),n("li",[n("p",[s._v("改名(可选)")])]),s._v(" "),n("li",[n("p",[s._v("将"),n("code",[s._v("lib")]),s._v("文件夹下的 "),n("code",[s._v("guava-11.0.2.jar")]),s._v(" 删除以兼容 "),n("code",[s._v("Hadoop 3.1.4")])])]),s._v(" "),n("li",[n("p",[s._v("修改"),n("code",[s._v("conf")]),s._v("下的"),n("code",[s._v("flume-env.sh")]),s._v("，在里面配置JAVA_HOME (可选)")]),s._v(" "),n("blockquote",[n("p",[s._v("如果配置了环境变量就再配置javahome了")])])])]),s._v(" "),n("p",[n("strong",[s._v("开发步骤")]),s._v("：")]),s._v(" "),n("p",[n("a",{attrs:{href:"http://flume.apache.org/FlumeUserGuide.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方手册"),n("OutboundLink")],1)]),s._v(" "),n("ul",[n("li",[s._v("创建一个目录编写"),n("strong",[s._v("配置文件")]),s._v(" "),n("code",[s._v("agent,source,channel,sink,bind")])]),s._v(" "),n("li",[s._v("启动agent去采集数据")]),s._v(" "),n("li",[s._v("测试")])]),s._v(" "),n("blockquote",[n("p",[s._v("netcat 轻量端口通信工具")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" yum install -y nc #下载\n netstat -nlp | grep 44444 #查看是否被占用\n nc -lk 44444`  开启服务端\n nc localhost 44444 开启客户端\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])]),s._v(" "),n("h2",{attrs:{id:"架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[s._v("#")]),s._v(" 架构")]),s._v(" "),n("p",[n("strong",[s._v("基础架构")]),s._v("：单个agent采集数据\n"),n("img",{attrs:{src:"https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210913212602.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("简单串联")]),s._v("：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210913225302.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("复制和多路复用")]),n("img",{attrs:{src:"https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210913225528.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("负载均衡和故障转移")]),s._v("：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210913225738.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("聚合")]),s._v("：实用")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210913225812.png",alt:""}})]),s._v(" "),n("ul",[n("li",[n("p",[s._v("flume的负载均衡")]),s._v(" "),n("ul",[n("li",[s._v("所谓的负载均衡 用于解决一个进程或者程序处理不了所有请求 多个进程一起处理的场景")]),s._v(" "),n("li",[s._v("同一个请求只能交给一个进行处理 避免数据重复")]),s._v(" "),n("li",[s._v("如何分配请求就涉及到了负载均衡的算法：轮询（round_robin）  随机（random）  权重")])])]),s._v(" "),n("li",[n("p",[s._v("flume串联跨网络传输数据")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("avro sink")])]),s._v(" "),n("li",[n("p",[s._v("avro source")]),s._v(" "),n("p",[s._v("使用上述两个组件指定绑定的端口ip 就可以满足数据跨网络的传递 通常用于flume串联架构中")])])])]),s._v(" "),n("li",[n("p",[s._v("flume串联启动")]),s._v(" "),n("p",[s._v("通常从远离数据源的那一级开始启动")])])]),s._v(" "),n("hr"),s._v(" "),n("ul",[n("li",[n("p",[s._v("flume failover")]),s._v(" "),n("ul",[n("li",[s._v("容错又称之为故障转移  容忍错误的发生。")]),s._v(" "),n("li",[s._v("通常用于解决单点故障 给容易出故障的地方设置备份")]),s._v(" "),n("li",[s._v("备份越多 容错能力越强  但是资源的浪费越严重")])])]),s._v(" "),n("li",[n("p",[s._v("静态拦截器")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("如果没有使用静态拦截器\nEvent: { headers:{} body:  36 Sun Jun  2 18:26 }\n\n使用静态拦截器之后 自己添加kv标识对\nEvent: { headers:{type=access} body:  36 Sun Jun  2 18:26 }\nEvent: { headers:{type=nginx} body:  36 Sun Jun  2 18:26 }\nEvent: { headers:{type=web} body:  36 Sun Jun  2 18:26 }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("后续在存放数据的时候可以使用flume的规则语法获取到拦截器添加的kv内容")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("%{type}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("模拟数据实时产生")])])]),s._v(" "),n("h2",{attrs:{id:"入门案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#入门案例"}},[s._v("#")]),s._v(" 入门案例")]),s._v(" "),n("p",[n("code",[s._v("Exec source")]),s._v(" 监听追加文件")]),s._v(" "),n("p",[n("code",[s._v("Spooldir Source")]),s._v(" 适合用于同步新文件")]),s._v(" "),n("p",[n("code",[s._v("Taildir Source")]),s._v(" 适合用于监听多个实时追加的文件")]),s._v(" "),n("p",[n("strong",[s._v("单个追加文件")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("source:  exec  ‘tail -F file’ \nsink:  hdfs sink\nchannel:可用filechannel 也可以用内存channel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#具体配置文件的编写\n# xxx_xxx_.conf\n# agent \na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n#source\na1.sources.r1.type = exec\na1.sources.r1.command = tail -F /root/logs/test.log a1.sources.r1.channels = c1\n\n# sink\na1.sinks.k1.type = hdfs\na1.sinks.k1.hdfs.path = /flume/tailout/%y-%m-%d/%H%M/\n#上传文件的前缀\na1.sinks.k1.hdfs.filePrefix = events-\n#是否按照时间滚动文件夹\na1.sinks.k1.hdfs.round = true\n#多少时间单位创建一个新的文件夹\na1.sinks.k1.hdfs.roundValue = 10\n#重新定义时间单位\na1.sinks.k1.hdfs.roundUnit = minute\n#多久生成一个新的文件\na1.sinks.k1.hdfs.rollInterval = 3\n#设置每个文件的滚动大小\na1.sinks.k1.hdfs.rollSize = 20\n#如果为0文件的滚动与 Event 数量无关\na1.sinks.k1.hdfs.rollCount = 5\n#积攒多少个 Event 才 flush 到 HDFS 一次\na1.sinks.k1.hdfs.batchSize = 1\n#是否使用本地时间戳\na1.sinks.k1.hdfs.useLocalTimeStamp = true\n#生成的文件类型，默认是Sequencefile，可用DataStream，为普通文本\n#设置文件类型，可支持压缩\na1.sinks.k1.hdfs.fileType = DataStream\n\n# channel \na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# 绑定bind sources+sinks到channels\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("p",[n("strong",[s._v("监控目录")]),s._v("：修改文件名也会促发,内容累加更新")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("source：spooldir\nsink: hdfs sink\nchannel:可用filechannel 也可以用内存channel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#具体配置文件的编写\n# agent\na1.sources = r1\na1.sinks = k1\na1.channels = c1\n\n# Describe/configure the source\n##注意：不能往监控目中重复丢同名文件\na1.sources.r1.type = spooldir\na1.sources.r1.spoolDir = /root/logs\na1.sources.r1.fileHeader = true\n\n# Describe the sink\na1.sinks.k1.type = hdfs\na1.sinks.k1.hdfs.path = /flume/events/%y-%m-%d/%H%M/a1.sinks.k1.hdfs.filePrefix = events-\na1.sinks.k1.hdfs.round = true\na1.sinks.k1.hdfs.roundValue = 10\na1.sinks.k1.hdfs.roundUnit = minute\na1.sinks.k1.hdfs.rollInterval = 3\na1.sinks.k1.hdfs.rollSize = 20\na1.sinks.k1.hdfs.rollCount = 5\na1.sinks.k1.hdfs.batchSize = 1\na1.sinks.k1.hdfs.useLocalTimeStamp = true\n#生成的文件类型，默认是Sequencefile，可用DataStream，为普通文本\na1.sinks.k1.hdfs.fileType = DataStream\n\n# Use a channel which buffers events in memory\na1.channels.c1.type = memory\na1.channels.c1.capacity = 1000\na1.channels.c1.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na1.sources.r1.channels = c1\na1.sinks.k1.channel = c1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])]),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),n("p",[s._v("对于所有与时间相关的转义序列,需要"),n("code",[s._v("hdfs.useLocalTimeStamp")]),s._v(" 设置为 true，否则Event Header中不存在以 "),n("code",[s._v("timestamp")]),s._v("的key,会自动添加"),n("code",[s._v("timestamp")])])]),s._v(" "),n("p",[n("strong",[s._v("目录实时追加文件")]),s._v("：只更新最新的，改名不会促发")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("source:Taildir Source\nsink: hdfs sink\nchannel:可用filechannel 也可以用内存channel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# agent\na3.sources = r3\na3.sinks = k3\na3.channels = c3\n# Describe/configure the source\na3.sources.r3.type = TAILDIR\na3.sources.r3.positionFile = /opt/module/flume/tail_dir.json\na3.sources.r3.filegroups = f1 f2\na3.sources.r3.filegroups.f1 = /opt/module/flume/files/.*file.*\na3.sources.r3.filegroups.f2 = /opt/module/flume/files2/.*log.*\n\n# Describe the sink\na3.sinks.k3.type = hdfs\na3.sinks.k3.hdfs.path = \nhdfs://hadoop102:9820/flume/upload2/%Y%m%d/%H\n#上传文件的前缀\na3.sinks.k3.hdfs.filePrefix = upload-\n#是否按照时间滚动文件夹\na3.sinks.k3.hdfs.round = true\n#多少时间单位创建一个新的文件夹\na3.sinks.k3.hdfs.roundValue = 1\n#重新定义时间单位\na3.sinks.k3.hdfs.roundUnit = hour\n#是否使用本地时间戳\na3.sinks.k3.hdfs.useLocalTimeStamp = true\n#积攒多少个 Event 才 flush 到 HDFS 一次\na3.sinks.k3.hdfs.batchSize = 100\n#设置文件类型，可支持压缩\na3.sinks.k3.hdfs.fileType = DataStream\n#多久生成一个新的文件\na3.sinks.k3.hdfs.rollInterval = 60\n#设置每个文件的滚动大小大概是 128M\na3.sinks.k3.hdfs.rollSize = 134217700\n#文件的滚动与 Event 数量无关\na3.sinks.k3.hdfs.rollCount = 0\n# Use a channel which buffers events in memory\na3.channels.c3.type = memory\na3.channels.c3.capacity = 1000\na3.channels.c3.transactionCapacity = 100\n\n# Bind the source and sink to the channel\na3.sources.r3.channels = c3\na3.sinks.k3.channel = c3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("blockquote",[n("p",[s._v("Taildir Source 维护了json 格式的 position File，其会定期的往 position File中更新每个文件读取到的最新的位置，因此能够实现断点续传")])]),s._v(" "),n("p",[n("strong",[s._v("启动命令")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("命令完整版   表示logger日志输出到console控制台\nbin/flume-ng agent --conf conf --conf-file conf/netcat-logger.conf --name a1 -Dflume.root.logger=INFO,console  \n\n简写\nbin/flume-ng agent -c （监控目录/文件) -f (配置文件路径) -n (agent名)  命令精简版\n\n--conf指定配置文件的目录\n--conf-file指定采集方案路径\n--name  agent进程名字 要跟采集方案中保持一致\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"事务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事务"}},[s._v("#")]),s._v(" 事务")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210913224143.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("Agent内部原理")]),s._v(":")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210913224255.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("重要组件")]),s._v(":")]),s._v(" "),n("ul",[n("li",[n("p",[n("strong",[s._v("ChannelSelector")]),s._v(":  是选出 Event 将要被发往哪个 Channel")]),s._v(" "),n("ul",[n("li",[s._v("ReplicatingSelector 会将同一个 Event 发往所有的 Channel")]),s._v(" "),n("li",[s._v("Multiplexing 根据相应的原则，将不同的 Event 发往不同的 Channel")])])]),s._v(" "),n("li",[n("p",[n("strong",[s._v("SinkProcessor")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("DefaultSinkProcessor ：单 个 的 Sink")])]),s._v(" "),n("li",[n("p",[s._v("sink组(Sink Group)")]),s._v(" "),n("ul",[n("li",[s._v("LoadBalancingSinkProcessor：负载均衡")])]),s._v(" "),n("blockquote",[n("p",[s._v("轮询（round_robin）  随机（random）  权重")])]),s._v(" "),n("ul",[n("li",[s._v("FailoverSinkProcessor: 故障转移")])])])])]),s._v(" "),n("li",[n("p",[s._v("flume串联跨网络传输数据")])])]),s._v(" "),n("h2",{attrs:{id:"开发案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开发案例"}},[s._v("#")]),s._v(" 开发案例")]),s._v(" "),n("p",[n("strong",[s._v("复制和多路复用")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#需求\n使用 Flume-1 监控文件变动，Flume-1 将变动内容\n传递给 Flume-2，Flume-2 负责存储到 HDFS。\n同时 Flume-1 将变动内容传递给 Flume-3，\nFlume-3 负责输出到 Local FileSystem。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("实现：💦💦")]),s._v(" "),n("p",[s._v("创建 group1 配置文件夹")]),s._v(" "),n("p",[s._v("创建  flume3 本地输出文件夹")]),s._v(" "),n("p",[s._v("配置 "),n("code",[s._v("flume-file-flume.conf 文件")])]),s._v(" "),n("p",[s._v("配置 1 个接收日志文件的"),n("code",[s._v("source")]),s._v(" 和两个 "),n("code",[s._v("channel")]),s._v("、两个 "),n("code",[s._v("sink")]),s._v("，分别输送给 "),n("code",[s._v("flume-flume hdfs 和 flume-flume-dir")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flume-file-flume.conf")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na1.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\na1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将数据流复制给所有 channel")]),s._v("\na1.sources.r1.selector.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" replicating\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\na1.sources.r1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\na1.sources.r1.command "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F /opt/module/hive/logs/hive.log\na1.sources.r1.shell "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /bin/bash -c\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sink 端的 avro 是一个数据发送者")]),s._v("\na1.sinks.k1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k1.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop102\na1.sinks.k1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\na1.sinks.k2.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k2.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop102\na1.sinks.k2.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4142")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the channel")]),s._v("\na1.channels.c1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\na1.channels.c2.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c2.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c2.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na1.sources.r1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1 c2\na1.sinks.k1.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k2.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flume-flume-hdfs.conf")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置上级 Flume 输出的 Source，输出是到 HDFS 的 Sink。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na2.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na2.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na2.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# source 端的 avro 是一个数据接收服务")]),s._v("\na2.sources.r1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na2.sources.r1.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop102\na2.sources.r1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na2.sinks.k1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs\na2.sinks.k1.hdfs.path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hdfs://hadoop102:9820/flume2/%Y%m%d/%H\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件的前缀")]),s._v("\na2.sinks.k1.hdfs.filePrefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" flume2- "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否按照时间滚动文件夹")]),s._v("\na2.sinks.k1.hdfs.round "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多少时间单位创建一个新的文件夹")]),s._v("\na2.sinks.k1.hdfs.roundValue "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新定义时间单位")]),s._v("\na2.sinks.k1.hdfs.roundUnit "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hour\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#是否使用本地时间戳")]),s._v("\na2.sinks.k1.hdfs.useLocalTimeStamp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#积攒多少个 Event 才 flush 到 HDFS 一次")]),s._v("\na2.sinks.k1.hdfs.batchSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置文件类型，可支持压缩")]),s._v("\na2.sinks.k1.hdfs.fileType "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataStream\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#多久生成一个新的文件")]),s._v("\na2.sinks.k1.hdfs.rollInterval "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置每个文件的滚动大小大概是 128M")]),s._v("\na2.sinks.k1.hdfs.rollSize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("134217700")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#文件的滚动与 Event 数量无关")]),s._v("\na2.sinks.k1.hdfs.rollCount "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the channel")]),s._v("\na2.channels.c1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na2.channels.c1.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na2.channels.c1.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na2.sources.r1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na2.sinks.k1.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# flume-flume-dir.conf\n# 配置上级 Flume 输出的 Source，输出是到本地目录的 Sink。\n# Name the components on this agent\na3.sources = r1\na3.sinks = k1\na3.channels = c2\n# Describe/configure the source\na3.sources.r1.type = avro\na3.sources.r1.bind = hadoop102\na3.sources.r1.port = 4142\n# Describe the sink\na3.sinks.k1.type = file_roll\na3.sinks.k1.sink.directory = /opt/module/data/flume3\n# Describe the channel\na3.channels.c2.type = memory\na3.channels.c2.capacity = 1000\na3.channels.c2.transactionCapacity = 100\n# Bind the source and sink to the channel\na3.sources.r1.channels = c2\na3.sinks.k1.channel = c2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("blockquote",[n("p",[n("strong",[s._v("提示")]),s._v("：输出的本地目录必须是已经存在的目录，如果该目录不存在，并不会创建新的目录。")])]),s._v(" "),n("p",[n("strong",[s._v("启动")]),s._v("：")]),s._v(" "),n("p",[s._v("分别启动对应的 flume 进程："),n("code",[s._v("flume-flume-dir，flume-flume-hdfs，flume-file-flume")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" bin/flume-ng agent --conf conf/ --name \na3 --conf-file job/group1/flume-flume-dir.conf\nbin/flume-ng agent --conf conf/ --name \na2 --conf-file job/group1/flume-flume-hdfs.conf\n bin/flume-ng agent --conf conf/ --name \na1 --conf-file job/group1/flume-file-flume.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("启动hive 查看日志输出")])]),s._v(" "),n("p",[n("strong",[s._v("负载均衡和故障转移")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 需求\n使用 Flume1 监控一个端口，其 sink 组中的 sink 分别对接 Flume2 和 Flume3，采用FailoverSinkProcessor，实现故障转移的功能。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("details",{staticClass:"custom-block details"},[n("summary",[s._v("实现： 🎪")]),s._v(" "),n("p",[s._v("创建 group2 文件夹")]),s._v(" "),n("p",[n("code",[s._v("创建 flume-netcat-flume.conf")])]),s._v(" "),n("p",[s._v("配置 1 个 netcat source 和 1 个 channel、1 个 sink group（2 个 sink），分别输送给"),n("code",[s._v("flume-flume-console1")]),s._v(" "),n("code",[s._v("flume-flume-console2")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim flume-netcat-flume.conf")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na1.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinkgroups "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" g1\na1.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\na1.sources.r1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na1.sources.r1.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" localhost\na1.sources.r1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置复制均衡")]),s._v("\na1.sinkgroups.g1.processor.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" failover\na1.sinkgroups.g1.processor.priority.k1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\na1.sinkgroups.g1.processor.priority.k2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\na1.sinkgroups.g1.processor.maxpenalty "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na1.sinks.k1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k1.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop102\na1.sinks.k1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\na1.sinks.k2.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k2.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop102\na1.sinks.k2.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4142")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the channel")]),s._v("\na1.channels.c1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 绑定给 俩个sinks")]),s._v("\na1.sources.r1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinkgroups.g1.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1 k2\na1.sinks.k1.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k2.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("建 flume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("console1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf 输出是到本地控制台\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop102\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the channel")]),s._v("\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("建 flume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("console2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf 本地控制台\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop102\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4142")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the channel")]),s._v("\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sources"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("r1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\na3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sinks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("k1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[n("strong",[s._v("启动")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(" bin/flume-ng agent --conf conf/ --name \na3 --conf-file job/group2/flume-flume-console2.conf -\nDflume.root.logger=INFO,console\n\n bin/flume-ng agent --conf conf/ --name \na2 --conf-file job/group2/flume-flume-console1.conf -\nDflume.root.logger=INFO,console\n\nbin/flume-ng agent --conf conf/ --name \na1 --conf-file job/group2/flume-netcat-flume.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("使用 netcat 工具向本机的 44444 端口发送内容")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("nc localhost 44444\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("查看")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("jps -ml 查看 Flume 进程\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 flume2 \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("查看3")])]),s._v(" "),n("p",[n("strong",[s._v("聚合")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("需求：\nhadoop102 上的 Flume-1 监控文件/opt/module/group.log，\nhadoop103 上的 Flume-2 监控某一个端口的数据流，\nFlume-1 与 Flume-2 将数据发送给 hadoop104上的 Flume-3，\nFlume-3 将最终数据打印到控制台\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210913231814.png",alt:""}})]),s._v(" "),n("p",[s._v("步骤：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("分发Flume "),n("code",[s._v("xsync flume")])])]),s._v(" "),n("li",[n("p",[s._v("同时创建一个group3 文件夹 存放本次任务配置文件")])]),s._v(" "),n("li",[n("p",[s._v("创建"),n("code",[s._v("flume1-logger-flume.conf")])]),s._v(" "),n("blockquote",[n("p",[s._v("配置 Source 用于监控 hive.log 文件，配置 Sink 输出数据到下一级 Flume,在 hadoop102 上编辑配置文件")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na1.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\na1.sources.r1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v("\na1.sources.r1.command "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -F /opt/module/group.log\na1.sources.r1.shell "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /bin/bash -c\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na1.sinks.k1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na1.sinks.k1.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop104\na1.sinks.k1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the channel")]),s._v("\na1.channels.c1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na1.sources.r1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("创建 "),n("code",[s._v("flume2-netcat-flume.conf")])]),s._v(" "),n("blockquote",[n("p",[s._v("配置 Source 监控端口 44444 数据流，配置 Sink 数据到下一级 Flume,在 hadoop103 上编辑配置文件")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na2.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na2.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na2.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\na2.sources.r1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" netcat\na2.sources.r1.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop103\na2.sources.r1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na2.sinks.k1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na2.sinks.k1.hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop104\na2.sinks.k1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a channel which buffers events in memory")]),s._v("\na2.channels.c1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na2.channels.c1.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na2.channels.c1.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na2.sources.r1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na2.sinks.k1.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("创建 "),n("code",[s._v("flume3-flume-logger.conf")])]),s._v(" "),n("blockquote",[n("p",[s._v("配置 source 用于接收 flume1 与 flume2 发送过来的数据流，最终合并后 sink 到控制台")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na3.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na3.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na3.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\na3.sources.r1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" avro\na3.sources.r1.bind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hadoop104\na3.sources.r1.port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4141")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na3.sinks.k1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the channel")]),s._v("\na3.channels.c1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na3.channels.c1.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na3.channels.c1.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na3.sources.r1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na3.sinks.k1.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("执行配置文件")])])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("bin/flume-ng agent --conf conf/ --name \na3 --conf-file job/group3/flume3-flume-logger.conf -\nDflume.root.logger"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INFO,console\n\n bin/flume-ng agent --conf conf/ --name \na2 --conf-file job/group3/flume1-logger-flume.conf\n\nbin/flume-ng agent --conf conf/ --name \na1 --conf-file job/group3/flume2-netcat-flume.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("在 hadoop103 上向/opt/module 目录下的 group.log 追加内容")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" group.log\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("在 hadoop102 上向 44444 端口发送数据")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v(" telnet hadoop102 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("44444")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"自定义组件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义组件"}},[s._v("#")]),s._v(" 自定义组件")]),s._v(" "),n("p",[n("strong",[s._v("自定义")]),s._v(" "),n("strong",[s._v("Interceptor")]),s._v(" "),n("strong",[s._v("拦截器")])]),s._v(" "),n("p",[s._v("例：根据 event 中 Header 的某个 key 的值，将不同的 event 发送到不同的 Channel")]),s._v(" "),n("p",[s._v("实现步骤：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("导入依赖")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("<dependency>\n <groupId>org.apache.flume</groupId>\n <artifactId>flume-ng-core</artifactId>\n <version>1.9.0</version>\n</dependency>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("定义 "),n("code",[s._v("CustomInterceptor·")]),s._v("类并实现 Interceptor 接口")])]),s._v(" "),n("li",[n("p",[s._v("类中定义变量，这些变量是需要到Flume 的配置文件中进行配置使用")])]),s._v(" "),n("li",[n("p",[s._v("添加有参构造方法对变量进行处理")])]),s._v(" "),n("li",[n("p",[s._v("写具体的要处理的逻辑 intercept()方法")])]),s._v(" "),n("li",[n("p",[s._v("接口中定义了一个内部接口 Builder，在 configure 方法中进行一些参数配置，例：在 flume 的 conf 中没配置一些参数时的默认值，通过builder 方法返回CustomInterceptor类的对象")])]),s._v(" "),n("li",[n("p",[s._v("定义一个静态类，类中封装 MD5 加密方法...")])]),s._v(" "),n("li",[n("p",[s._v("打成jar包扔到lib中")])])]),s._v(" "),n("p",[s._v("例：")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Interceptor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TypeInterceptor")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Interceptor")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//声明一个存放事件的集合")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" addHeaderEvents"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//初始化存放事件的集合")]),s._v("\n addHeaderEvents "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//单个事件拦截")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("intercept")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1.获取事件中的头信息")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" headers "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHeaders")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.获取事件中的 body 信息")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" body "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('//3.根据 body 中是否有"atguigu"来决定添加怎样的头信息')]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("contains")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"atguigu"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4.添加头信息")]),s._v("\n headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"first"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4.添加头信息")]),s._v("\n headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"second"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//批量事件拦截")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("intercept")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" events"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//1.清空集合")]),s._v("\n addHeaderEvents"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("clear")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//2.遍历 events")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" events"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//3.给每一个事件添加头信息")]),s._v("\n addHeaderEvents"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("intercept")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//4.返回结果")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" addHeaderEvents"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Builder")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Interceptor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Builder")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Interceptor")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TypeInterceptor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br")])]),n("p",[s._v("编辑 flume 配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("a1.sources.r1.interceptors = i1\na1.sources.r1.interceptors.i1.type = \ncom.atguigu.flume.interceptor.CustomInterceptor$Builder\na1.sources.r1.selector.type = multiplexing\na1.sources.r1.selector.header = type\na1.sources.r1.selector.mapping.first = c1\na1.sources.r1.selector.mapping.second = c2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("strong",[s._v("自定义")]),s._v(" "),n("strong",[s._v("Source")])]),s._v(" "),n("p",[s._v("需要继承"),n("code",[s._v("AbstractSource")]),s._v(" 类并实现"),n("code",[s._v("Configurable")]),s._v(" 和 "),n("code",[s._v("PollableSource")]),s._v(" 接口")]),s._v(" "),n("p",[s._v("实现相应方法:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("getBackOffSleepIncrement() //暂不用 步长\ngetMaxBackOffSleepInterval() //暂不用 最长时间\nconfigure(Context context) //初始化 context 读取配置文件\nprocess()//获取数据封装成 event 并写入 channel，这个方法将被循环调用 例如：读取 MySQL 数据或者其他文件系统。\nstop() //关闭相关的资源\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("具体实现")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventDeliveryException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PollableSource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimpleEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("source"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySource")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSource")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PollableSource")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//定义配置文件将来要读取的字段")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" delay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" field"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//初始化配置信息")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n delay "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLong")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delay"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n field "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"field"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("process")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventDeliveryException")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建事件头信息")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" hearderMap "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建事件")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimpleEvent")]),s._v(" event "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SimpleEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//循环封装事件")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//给事件设置头信息")]),s._v("\n event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHeaders")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("hearderMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//给事件设置内容")]),s._v("\n event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setBody")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("field "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBytes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//将事件写入 channel")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getChannelProcessor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("processEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("printStackTrace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BACKOFF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("READY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBackOffSleepIncrement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getMaxBackOffSleepInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br")])]),n("p",[s._v("配置文件：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name the components on this agent")]),s._v("\na1.sources "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" r1\na1.sinks "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" k1\na1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe/configure the source")]),s._v("\na1.sources.r1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 包路径\na1.sources.r1.delay "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#a1.sources.r1.field = atguigu")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Describe the sink")]),s._v("\na1.sinks.k1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" logger\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use a channel which buffers events in memory")]),s._v("\na1.channels.c1.type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory\na1.channels.c1.capacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\na1.channels.c1.transactionCapacity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Bind the source and sink to the channel")]),s._v("\na1.sources.r1.channels "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\na1.sinks.k1.channel "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[n("strong",[s._v("自定义")]),s._v(" "),n("strong",[s._v("Sink")]),s._v(":")]),s._v(" "),n("p",[s._v("需要继承 AbstractSink 类并实现 Configurable 接口")]),s._v(" "),n("p",[s._v("实现相应方法:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("configure(Context context)//初始化context读取配置文件\nprocess()//从Channel读取获取数据event这个方法将被循环调用。\n使用场景：读取 Channel 数据写入 MySQL 或者其他文件系统。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("例:")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("flume"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sink"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slf4j"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("slf4j"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoggerFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySink")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSink")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configurable")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建 Logger 对象")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Logger")]),s._v(" LOG "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LoggerFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLogger")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractSink")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" suffix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("process")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventDeliveryException")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//声明返回值状态信息")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),s._v(" status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//获取当前 Sink 绑定的 Channel")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Channel")]),s._v(" ch "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getChannel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//获取事务")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Transaction")]),s._v(" txn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getTransaction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//声明事件")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Event")]),s._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//开启事务")]),s._v("\n txn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("begin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//读取 Channel 中的事件，直到读取到事件结束循环")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n event "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("take")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//处理事件（打印）")]),s._v("\n LOG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBody")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" \nsuffix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//事务提交")]),s._v("\n txn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n status "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("READY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("catch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//遇到异常，事务回滚")]),s._v("\n txn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rollback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n status "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Status")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BACKOFF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//关闭事务")]),s._v("\n txn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("configure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),s._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//读取配置文件内容，有默认值")]),s._v("\n prefix "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prefix"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello:"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//读取配置文件内容，无默认值")]),s._v("\n suffix "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"suffix"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);