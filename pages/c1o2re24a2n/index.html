<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>spark-core笔记 | 🦏</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="web前端技术博客,简洁至上,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="个人技术博客,后端,大数据,技术文档,学习,js,vue,python,css3,java,javaEE,SpringBoot,Spring,Hadoop,html5,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.546f0649.css" as="style"><link rel="preload" href="/assets/js/app.e7d9515b.js" as="script"><link rel="preload" href="/assets/js/2.125ae6e8.js" as="script"><link rel="preload" href="/assets/js/41.6647cff7.js" as="script"><link rel="prefetch" href="/assets/js/10.95c2d7b0.js"><link rel="prefetch" href="/assets/js/100.b4e10546.js"><link rel="prefetch" href="/assets/js/101.d6d23fe2.js"><link rel="prefetch" href="/assets/js/102.b368fb26.js"><link rel="prefetch" href="/assets/js/103.b87bfabc.js"><link rel="prefetch" href="/assets/js/104.3d0ae07d.js"><link rel="prefetch" href="/assets/js/105.e9f9588c.js"><link rel="prefetch" href="/assets/js/106.76130cbc.js"><link rel="prefetch" href="/assets/js/107.11dd35ba.js"><link rel="prefetch" href="/assets/js/108.de8bb9b7.js"><link rel="prefetch" href="/assets/js/109.e26f138c.js"><link rel="prefetch" href="/assets/js/11.5682c637.js"><link rel="prefetch" href="/assets/js/110.2c9036b9.js"><link rel="prefetch" href="/assets/js/111.d91b7424.js"><link rel="prefetch" href="/assets/js/112.0edf9093.js"><link rel="prefetch" href="/assets/js/113.dbc0bf4d.js"><link rel="prefetch" href="/assets/js/114.439ad4ee.js"><link rel="prefetch" href="/assets/js/115.0cff9cd8.js"><link rel="prefetch" href="/assets/js/116.fd44dc61.js"><link rel="prefetch" href="/assets/js/117.e893d264.js"><link rel="prefetch" href="/assets/js/118.ec4b3d32.js"><link rel="prefetch" href="/assets/js/119.ea5c3eba.js"><link rel="prefetch" href="/assets/js/12.5a51d307.js"><link rel="prefetch" href="/assets/js/120.9aaee23f.js"><link rel="prefetch" href="/assets/js/121.4fc7842c.js"><link rel="prefetch" href="/assets/js/122.2b8f75d1.js"><link rel="prefetch" href="/assets/js/123.78dbfead.js"><link rel="prefetch" href="/assets/js/124.84b6382a.js"><link rel="prefetch" href="/assets/js/125.c2a2a818.js"><link rel="prefetch" href="/assets/js/126.83ea2963.js"><link rel="prefetch" href="/assets/js/127.dffd5eae.js"><link rel="prefetch" href="/assets/js/128.bb0a0738.js"><link rel="prefetch" href="/assets/js/129.45a56702.js"><link rel="prefetch" href="/assets/js/13.d1b5b29f.js"><link rel="prefetch" href="/assets/js/130.7fee331a.js"><link rel="prefetch" href="/assets/js/131.6aaa557b.js"><link rel="prefetch" href="/assets/js/132.9526e280.js"><link rel="prefetch" href="/assets/js/133.610c1c84.js"><link rel="prefetch" href="/assets/js/134.1dcf27f7.js"><link rel="prefetch" href="/assets/js/14.83de980a.js"><link rel="prefetch" href="/assets/js/15.0fa06ae1.js"><link rel="prefetch" href="/assets/js/16.d1d3c9c1.js"><link rel="prefetch" href="/assets/js/17.c9772d78.js"><link rel="prefetch" href="/assets/js/18.7cbf0ef4.js"><link rel="prefetch" href="/assets/js/19.66ee7cfc.js"><link rel="prefetch" href="/assets/js/20.8fbb5432.js"><link rel="prefetch" href="/assets/js/21.74a586bf.js"><link rel="prefetch" href="/assets/js/22.f85a2ced.js"><link rel="prefetch" href="/assets/js/23.a65163b5.js"><link rel="prefetch" href="/assets/js/24.5c2898c6.js"><link rel="prefetch" href="/assets/js/25.929f22ff.js"><link rel="prefetch" href="/assets/js/26.20d74c65.js"><link rel="prefetch" href="/assets/js/27.e790af79.js"><link rel="prefetch" href="/assets/js/28.6b84abe6.js"><link rel="prefetch" href="/assets/js/29.acc0fc34.js"><link rel="prefetch" href="/assets/js/3.dd3750e6.js"><link rel="prefetch" href="/assets/js/30.fadb6cbd.js"><link rel="prefetch" href="/assets/js/31.386f82c2.js"><link rel="prefetch" href="/assets/js/32.e934f71c.js"><link rel="prefetch" href="/assets/js/33.684ac64c.js"><link rel="prefetch" href="/assets/js/34.38f8fd76.js"><link rel="prefetch" href="/assets/js/35.3fe27233.js"><link rel="prefetch" href="/assets/js/36.993695b7.js"><link rel="prefetch" href="/assets/js/37.d735018c.js"><link rel="prefetch" href="/assets/js/38.0d23a384.js"><link rel="prefetch" href="/assets/js/39.808de65c.js"><link rel="prefetch" href="/assets/js/4.4a137b18.js"><link rel="prefetch" href="/assets/js/40.2fc7d5f7.js"><link rel="prefetch" href="/assets/js/42.f4d93aa6.js"><link rel="prefetch" href="/assets/js/43.a5d40107.js"><link rel="prefetch" href="/assets/js/44.3ae864d3.js"><link rel="prefetch" href="/assets/js/45.c66f1afe.js"><link rel="prefetch" href="/assets/js/46.750f2be2.js"><link rel="prefetch" href="/assets/js/47.1722c1b9.js"><link rel="prefetch" href="/assets/js/48.7c8df7cc.js"><link rel="prefetch" href="/assets/js/49.f9b58d70.js"><link rel="prefetch" href="/assets/js/5.51ca929a.js"><link rel="prefetch" href="/assets/js/50.fad73ad9.js"><link rel="prefetch" href="/assets/js/51.b88c6213.js"><link rel="prefetch" href="/assets/js/52.21244293.js"><link rel="prefetch" href="/assets/js/53.1c2189f3.js"><link rel="prefetch" href="/assets/js/54.95ba12bc.js"><link rel="prefetch" href="/assets/js/55.d8f79989.js"><link rel="prefetch" href="/assets/js/56.63c36b2d.js"><link rel="prefetch" href="/assets/js/57.270857ec.js"><link rel="prefetch" href="/assets/js/58.156073cc.js"><link rel="prefetch" href="/assets/js/59.5a300643.js"><link rel="prefetch" href="/assets/js/6.2dccf462.js"><link rel="prefetch" href="/assets/js/60.92f4ce87.js"><link rel="prefetch" href="/assets/js/61.0f312cea.js"><link rel="prefetch" href="/assets/js/62.0c55901b.js"><link rel="prefetch" href="/assets/js/63.613b1add.js"><link rel="prefetch" href="/assets/js/64.1e5070b6.js"><link rel="prefetch" href="/assets/js/65.dc215238.js"><link rel="prefetch" href="/assets/js/66.4a1319e4.js"><link rel="prefetch" href="/assets/js/67.841428fe.js"><link rel="prefetch" href="/assets/js/68.7380e054.js"><link rel="prefetch" href="/assets/js/69.0a503182.js"><link rel="prefetch" href="/assets/js/7.1096b6fa.js"><link rel="prefetch" href="/assets/js/70.09f4c416.js"><link rel="prefetch" href="/assets/js/71.a279d635.js"><link rel="prefetch" href="/assets/js/72.057aa49f.js"><link rel="prefetch" href="/assets/js/73.767f542c.js"><link rel="prefetch" href="/assets/js/74.3eb6f7e5.js"><link rel="prefetch" href="/assets/js/75.50ecd31e.js"><link rel="prefetch" href="/assets/js/76.602f67fb.js"><link rel="prefetch" href="/assets/js/77.3b5a8e7d.js"><link rel="prefetch" href="/assets/js/78.40c6990e.js"><link rel="prefetch" href="/assets/js/79.ecb155e0.js"><link rel="prefetch" href="/assets/js/8.4b82b135.js"><link rel="prefetch" href="/assets/js/80.d7279b34.js"><link rel="prefetch" href="/assets/js/81.f58f78af.js"><link rel="prefetch" href="/assets/js/82.8399bcab.js"><link rel="prefetch" href="/assets/js/83.67c3c861.js"><link rel="prefetch" href="/assets/js/84.5a8f7c4b.js"><link rel="prefetch" href="/assets/js/85.c6f0af81.js"><link rel="prefetch" href="/assets/js/86.f9f3d0b8.js"><link rel="prefetch" href="/assets/js/87.fec83ae4.js"><link rel="prefetch" href="/assets/js/88.ca11e236.js"><link rel="prefetch" href="/assets/js/89.ae243724.js"><link rel="prefetch" href="/assets/js/9.b8d3ed93.js"><link rel="prefetch" href="/assets/js/90.c242e238.js"><link rel="prefetch" href="/assets/js/91.ad0080a6.js"><link rel="prefetch" href="/assets/js/92.a435d70c.js"><link rel="prefetch" href="/assets/js/93.3232bfbf.js"><link rel="prefetch" href="/assets/js/94.6101d03c.js"><link rel="prefetch" href="/assets/js/95.8c95af7a.js"><link rel="prefetch" href="/assets/js/96.a582908e.js"><link rel="prefetch" href="/assets/js/97.1b560b4f.js"><link rel="prefetch" href="/assets/js/98.a686266f.js"><link rel="prefetch" href="/assets/js/99.e03a81a9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.546f0649.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.ico" alt="🦏" class="logo"> <span class="site-name can-hide">🦏</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Big数据" class="dropdown-title"><a href="/BigData/" class="link-title">Big数据</a> <span class="title" style="display:none;">Big数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>大数据路线</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">开发路线</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linux导图</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">《Linux》</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">《Hadoop》</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">《生态圈组件》</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">《消息队列》</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">《spark》</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" class="nav-link">《flink》</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">技术栈🎈</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⛳🖥" class="dropdown-title"><a href="/technology/" class="link-title">⛳🖥</a> <span class="title" style="display:none;">⛳🖥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">计算机必备</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">数学基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">本站关联</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/zzx.jpg"> <div class="blogger-info"><h3>Axcmsm🐼</h3> <span>纵有疾风起，人生不言弃🐅</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Big数据" class="dropdown-title"><a href="/BigData/" class="link-title">Big数据</a> <span class="title" style="display:none;">Big数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>大数据路线</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">开发路线</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linux导图</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">《Linux》</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">《Hadoop》</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">《生态圈组件》</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">《消息队列》</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">《spark》</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" class="nav-link">《flink》</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">技术栈🎈</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⛳🖥" class="dropdown-title"><a href="/technology/" class="link-title">⛳🖥</a> <span class="title" style="display:none;">⛳🖥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">计算机必备</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">数学基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">本站关联</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>路线or导图</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>学习笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>《linux》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>《Hadoop》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>《zookeeper》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>《hive》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>《生态圈组件》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>《消息队列》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>《spark》</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ska2ab24a2n/" class="sidebar-link">scala笔记</a></li><li><a href="/pages/c1o2re24a2n/" aria-current="page" class="active sidebar-link">spark-core笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#spark-概述" class="sidebar-link">Spark 概述</a></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#快速上手" class="sidebar-link">快速上手</a></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#运行环境-部署" class="sidebar-link">运行环境 部署</a></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#运行架构" class="sidebar-link">运行架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#核心概念" class="sidebar-link">核心概念</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#核心编程⛳" class="sidebar-link">核心编程⛳</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#rdd基础编程" class="sidebar-link">RDD基础编程</a></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#rdd转换算子" class="sidebar-link">RDD转换算子</a></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#rdd行动算子" class="sidebar-link">RDD行动算子</a></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#rdd-序列化" class="sidebar-link">RDD 序列化</a></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#rdd的持久化" class="sidebar-link">RDD的持久化</a></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#累加器" class="sidebar-link">累加器</a></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#广播变量" class="sidebar-link">广播变量</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/c1o2re24a2n/#工程化架构" class="sidebar-link">工程化架构</a></li></ul></li><li><a href="/pages/s2q3lab24a2n/" class="sidebar-link">spark-SQL笔记</a></li><li><a href="/pages/St4r2e1a41m2i3ng/" class="sidebar-link">spark-Streaming笔记</a></li><li><a href="/pages/St4r2y1ou2g/" class="sidebar-link">spark优化</a></li><li><a href="/pages/St4rnei2he1ng/" class="sidebar-link">spark内核源码</a></li><li><a href="/pages/spa123ra12sd2/" class="sidebar-link">浅尝spark✨</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>《flink》</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>《数据可视化》</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安装</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/BigData" title="大数据-目录页" data-v-1cd794fe>大数据</a></li> <li data-v-1cd794fe><a href="/BigData/#学习笔记" title="大数据#学习笔记" data-v-1cd794fe>学习笔记</a></li> <li data-v-1cd794fe><a href="/BigData/#《spark》" title="大数据#《spark》" data-v-1cd794fe>《spark》</a></li></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/axcmsm" target="_blank" title="作者" class="beLink" data-v-1cd794fe>Wei Ye</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-10-01</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="/img/bj1.jpg">
          spark-core笔记
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="spark-概述"><a href="#spark-概述" class="header-anchor">#</a> <strong>Spark</strong> <strong>概述</strong></h2> <p>基于内存的快速,通用可扩展的分析计算引擎，基于scala开发。</p> <p><strong>核心模块</strong>：</p> <ul><li>spark core ： 是基础和最<strong>核心</strong>功能 (其他都是此基础上开发)</li> <li>spark sql  ： 用sql<strong>操作</strong>查询数据</li> <li>spark streaming ： <strong>流式</strong>处理模块</li> <li>spark MLib ： <strong>机器学习</strong>模块(难度高 需要数学基础)</li> <li>spark GraphX： <strong>图形挖掘</strong>模块(难度高 需要数学基础)</li></ul> <p><strong>spark和hadoop的对比</strong>：</p> <blockquote><p>Spark 和Hadoop 的根本差异是多个作业之间的数据通信问题 : Spark 多个作业之间数据</p> <p>通信是基于内存，而 Hadoop 是基于磁盘。</p> <p>spark只有在<strong>shuffle</strong>时才会<strong>落盘</strong>。</p></blockquote> <h2 id="快速上手"><a href="#快速上手" class="header-anchor">#</a> <strong>快速上手</strong></h2> <ol><li><p><strong>创建</strong> <strong>Maven</strong></p></li> <li><p><strong>增加</strong> <strong>Scala</strong> <strong>插件</strong> （注意选择对应的版本）</p></li> <li><p><strong>增加依赖关系</strong></p></li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-core_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>log4j.properties</code></p> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">log4j.rootCategory</span><span class="token punctuation">=</span><span class="token attr-value">ERROR, console</span>
<span class="token attr-name">log4j.appender.console</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.ConsoleAppender</span>
<span class="token attr-name">log4j.appender.console.target</span><span class="token punctuation">=</span><span class="token attr-value">System.err</span>
<span class="token attr-name">log4j.appender.console.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span>
<span class="token attr-name">log4j.appender.console.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">%d{yy/MM/dd </span>
<span class="token attr-name">HH</span><span class="token punctuation">:</span><span class="token attr-value">mm:ss} %p %c{1}: %m%n</span>
<span class="token comment"># Set the default spark-shell log level to ERROR. When running the spark-shell,</span>
the
<span class="token comment"># log level for this class is used to overwrite the root logger's log level, so</span>
that
<span class="token comment"># the user can have different defaults for the shell and regular Spark apps.</span>
<span class="token attr-name">log4j.logger.org.apache.spark.repl.Main</span><span class="token punctuation">=</span><span class="token attr-value">ERROR</span>
<span class="token comment"># Settings to quiet third party logs that are too verbose</span>
<span class="token attr-name">log4j.logger.org.spark_project.jetty</span><span class="token punctuation">=</span><span class="token attr-value">ERROR</span>
<span class="token attr-name">log4j.logger.org.spark_project.jetty.util.component.AbstractLifeCycle</span><span class="token punctuation">=</span><span class="token attr-value">ERROR</span>
<span class="token attr-name">log4j.logger.org.apache.spark.repl.SparkIMain$exprTyper</span><span class="token punctuation">=</span><span class="token attr-value">ERROR</span>
<span class="token attr-name">log4j.logger.org.apache.spark.repl.SparkILoop$SparkILoopInterpreter</span><span class="token punctuation">=</span><span class="token attr-value">ERROR</span>
<span class="token attr-name">log4j.logger.org.apache.parquet</span><span class="token punctuation">=</span><span class="token attr-value">ERROR</span>
<span class="token attr-name">log4j.logger.parquet</span><span class="token punctuation">=</span><span class="token attr-value">ERROR</span>
<span class="token comment"># SPARK-9183: Settings to avoid annoying messages when looking up nonexistent</span>
<span class="token attr-name">UDFs</span> <span class="token attr-value">in SparkSQL with Hive support</span>
<span class="token attr-name">log4j.logger.org.apache.hadoop.hive.metastore.RetryingHMSHandler</span><span class="token punctuation">=</span><span class="token attr-value">FATAL</span>
<span class="token attr-name">log4j.logger.org.apache.hadoop.hive.ql.exec.FunctionRegistry</span><span class="token punctuation">=</span><span class="token attr-value">ERROR</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ol start="4"><li><p><strong>WordCount</strong>测试</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">// 创建 Spark 运行配置对象</span>
<span class="token keyword">val</span> sparkConf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;WordCount&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 创建 Spark 上下文环境对象（连接对象）</span>
<span class="token keyword">val</span> sc <span class="token operator">:</span> SparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>sparkConf<span class="token punctuation">)</span>
<span class="token comment">// 读取文件数据</span>
<span class="token keyword">val</span> fileRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;input/word.txt&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 将文件中的数据进行分词</span>
<span class="token keyword">val</span> wordRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> fileRDD<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span> _<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token comment">// 转换数据结构 word =&gt; (word, 1)</span>
<span class="token keyword">val</span> word2OneRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordRDD<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 将转换结构后的数据按照相同的单词进行分组聚合</span>
<span class="token keyword">val</span> word2CountRDD<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> word2OneRDD<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span>
<span class="token comment">// 将数据聚合结果采集到内存中</span>
<span class="token keyword">val</span> word2Count<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> word2CountRDD<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 打印结果</span>
word2Count<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
<span class="token comment">//关闭 Spark 连接</span>
sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ol> <h2 id="运行环境-部署"><a href="#运行环境-部署" class="header-anchor">#</a> <strong>运行环境</strong> 部署</h2> <ul><li><p><strong>local模块</strong>：测试    1节点</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>. 上传解压到指定目录
<span class="token number">2</span>. bin/spark-shell <span class="token comment">#直接启动即可</span>
UI 访问端口 http://虚拟机地址:4040
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><strong>Standalone</strong> <strong>模式</strong> :  <strong>独立</strong>部署  主从架构模式   3节点</p></li></ul> <blockquote><p>拥有一个master和三个workey，自己调度资源自己执行程序</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>. 解压文件到指定目录
<span class="token number">2</span>. 修改节点配置文件
	<span class="token builtin class-name">cd</span> conf
	<span class="token function">mv</span> slaves.template slaves  <span class="token comment">#将模板文件修改成自己的</span>
	<span class="token comment">#添加修改主机节点</span>
	hadoop111
	hadoop112
	hadoop113
<span class="token number">3</span>. 修改执行配置文件
	<span class="token function">mv</span> spark-env.sh.template spark-env.sh <span class="token comment">#将模板文件改名</span>
	<span class="token comment">#添加 JAVA_HOME 环境变量和集群对应的 master 节点</span>
	<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/module/jdk1.8.0_144
	<span class="token assign-left variable">SPARK_MASTER_HOST</span><span class="token operator">=</span>hadoop111
	<span class="token assign-left variable">SPARK_MASTER_PORT</span><span class="token operator">=</span><span class="token number">7077</span> <span class="token comment">#内部通信端口类似8020</span>
<span class="token number">4</span>. 分发修改好的压缩目录	
	xsync spark-standalone
<span class="token number">5</span>. 启动or关闭
	sbin/start-all.sh <span class="token comment">#启动</span>
UI访问端口：Web UI 界面: http://hadoop111:8080	
<span class="token number">6</span>. 配置历史服务
	<span class="token function">mv</span> spark-defaults.conf.template spark-defaults.conf 
	<span class="token comment">#配置日志存储路径</span>
	spark.eventLog.enabled <span class="token boolean">true</span> <span class="token comment">#开启</span>
	spark.eventLog.dir hdfs://hadoop111:8020/directory <span class="token comment">#此目录需要在hdfs上提前创建</span>
	<span class="token comment">#修改 spark-env.sh 文件, 添加日志配置</span>
    <span class="token builtin class-name">export</span> <span class="token assign-left variable">SPARK_HISTORY_OPTS</span><span class="token operator">=</span><span class="token string">&quot;
	-Dspark.history.ui.port=18080 #日志的WEB UI访问端口
	-Dspark.history.fs.logDirectory=hdfs://hadoop111:8020/directory #存储路径
	-Dspark.history.retainedApplications=30&quot;</span> <span class="token comment">#保存的历史个数</span>
	<span class="token comment">#分发配置文件</span>
	xsync conf
	<span class="token comment">#重启集群和历史服务</span>
	sbin/start-all.sh
	sbin/start-history-server.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ul><li><p><strong>配置高可用（HA）</strong>:防止单点故障  一般采用zk设置</p> <blockquote><p>2台配置master 3台zk 3台worker</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 停止集群
2. 启动zk集群
3. 修改 spark-env.sh 文件
	#注释
	#SPARK_MASTER_HOST=hadoop111
	#SPARK_MASTER_PORT=7077
	添加如下内容:
	#Master 监控页面默认访问端口为 8080，但是可能会和 Zookeeper 冲突，
	#所以改成 8989，也可以自定义，访问 UI 监控页面时请注意
	SPARK_MASTER_WEBUI_PORT=8989
	export SPARK_DAEMON_JAVA_OPTS=&quot;
	-Dspark.deploy.recoveryMode=ZOOKEEPER 
	-Dspark.deploy.zookeeper.url=hadoop111,hadoop112,hadoop113
	-Dspark.deploy.zookeeper.dir=/spark&quot;
4. 分发配置文件
	xsync conf/
5. 启动集群
	sbin/start-all.sh
6. 启动备用master (部署master的机器上)
	sbin/start-master.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p><strong>Yarn</strong> <strong>模式</strong> ：常用模式👩🏾   1节点</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>. 解压文件到指定目录
<span class="token number">2</span>. 修改hadoop中的yarn-site.xml配置文件
	<span class="token operator">&lt;</span><span class="token operator">!</span>--是否启动一个线程检查每个任务正使用的物理内存量，如果任务超出分配值，则直接将其杀掉，默认是 <span class="token boolean">true</span> --<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
 		<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
		 <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>--是否启动一个线程检查每个任务正使用的虚拟内存量，如果任务超出分配值，则直接将其杀掉，默认是 <span class="token boolean">true</span> --<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>
		 <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>
 			<span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>

<span class="token number">3</span>.  修改 conf/spark-env.sh 添加 JAVA_HOME 和 YARN_CONF_DIR 配置
	<span class="token function">mv</span> spark-env.sh.template spark-env.sh <span class="token comment">#改名</span>
	<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/module/jdk1.8.0_144
	<span class="token assign-left variable">YARN_CONF_DIR</span><span class="token operator">=</span>/opt/module/hadoop/etc/hadoop
<span class="token number">4</span>. 启动 HDFS 以及 YARN 集群
	<span class="token comment">#看 http://hadoop112:8088 页面，点击 History，查看历史页面</span>
<span class="token number">5</span>. 配置历史服务器
	<span class="token function">mv</span> spark-defaults.conf.template spark-defaults.conf <span class="token comment">#改名</span>
	<span class="token comment">#配置日志存储路径</span>
	spark.eventLog.enabled <span class="token boolean">true</span>
	spark.eventLog.dir hdfs://linux1:8020/directory <span class="token comment">#目录需存在</span>
	<span class="token comment">#修改 spark-env.sh 文件,日志配置</span>
	<span class="token builtin class-name">export</span> <span class="token assign-left variable">SPARK_HISTORY_OPTS</span><span class="token operator">=</span><span class="token string">&quot;
	-Dspark.history.ui.port=18080 
	-Dspark.history.fs.logDirectory=hdfs://hadoop111:8020/directory 
	-Dspark.history.retainedApplications=30&quot;</span>
	<span class="token comment">#修改 spark-defaults.conf</span>
	spark.yarn.historyServer.address<span class="token operator">=</span>hadoop111:18080
	spark.history.ui.port<span class="token operator">=</span><span class="token number">18080</span>	
<span class="token number">6</span>. 启动历史服务
	sbin/start-history-server.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div></li> <li><p><strong>K8S &amp; Mesos</strong> <strong>模式</strong></p> <blockquote><p>Mesos 是 Apache 下的开源分布式资源管理框架,国外很多人在使用。</p> <p>K8S容器管理工具：部署教程：<a href="https://spark.apache.org/docs/latest/running-on-kubernetes.html" target="_blank" rel="noopener noreferrer">https://spark.apache.org/docs/latest/running-on-kubernetes.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li> <li><p><strong>Windows</strong> <strong>模式</strong>：测试模式 可以不用启动虚拟机</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>. 解压到指定文件 （无中文无空格）
<span class="token number">2</span>. 启动本地环境
	执行解压缩文件路径下 bin 目录中的 spark-shell.cmd 文件，启动 Spark 本地环境
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <p><strong>程序的提交</strong>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>bin/spark-submit \
--class org.apache.spark.examples.SparkPi \
--master yarn \
--deploy-mode cluster \
./examples/jars/spark-examples_2.12-3.0.0.jar \
10
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>解释</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span><span class="token punctuation">)</span> --class 表示要执行程序的主类，此处可以更换为咱们自己写的应用程序
<span class="token number">2</span><span class="token punctuation">)</span> --master local<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> 部署模式，默认为本地模式，数字表示分配的虚拟 CPU 核数量
   --master spark://linux1:7077 独立部署模式，连接到 Spark 集群
   --master Yarn	
<span class="token number">3</span><span class="token punctuation">)</span> spark-examples_2.12-3.0.0.jar 运行的应用类所在的 jar 包，实际使用时，可以设定为咱
们自己打的 jar 包
<span class="token number">4</span><span class="token punctuation">)</span> 数字 <span class="token number">10</span> 表示程序的入口参数，用于设定当前应用的任务数量
其他
--num-executors 配置 Executor 的数量
--driver-memory 配置 Driver 内存（影响不大）
--executor-memory 1G 指定每个 executor 可用内存为 1G
--total-executor-cores <span class="token number">2</span> 指定所有executor使用的cpu核数为 <span class="token number">2</span> 个
--executor-cores 指定每个executor使用的cpu核数
application-arguments 传给 main<span class="token punctuation">(</span><span class="token punctuation">)</span>方法的参数
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>补充</strong>：生产环境 Spark submit 脚本配置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>bin/spark-submit <span class="token punctuation">\</span>
--class com.atguigu.spark.WordCount <span class="token punctuation">\</span>
--master yarn<span class="token punctuation">\</span>
--deploy-mode cluster<span class="token punctuation">\</span>
--num-executors <span class="token number">80</span> <span class="token punctuation">\</span>
--driver-memory 6g <span class="token punctuation">\</span>
--executor-memory 6g <span class="token punctuation">\</span>
--executor-cores <span class="token number">3</span> <span class="token punctuation">\</span>
--queue root.default <span class="token punctuation">\</span>
--conf spark.yarn.executor.memoryOverhead<span class="token operator">=</span><span class="token number">2048</span> <span class="token punctuation">\</span>
--conf spark.core.connection.ack.wait.timeout<span class="token operator">=</span><span class="token number">300</span> <span class="token punctuation">\</span>
/usr/local/spark/spark.jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>参数配置参考值：</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>➢ <span class="token operator">--</span>num<span class="token operator">-</span>executors：<span class="token number">50</span><span class="token operator">~</span><span class="token number">100</span>
➢ <span class="token operator">--</span>driver<span class="token operator">-</span>memory：<span class="token number">1</span>G<span class="token operator">~</span><span class="token number">5</span>G
➢ <span class="token operator">--</span>executor<span class="token operator">-</span>memory：<span class="token number">6</span>G<span class="token operator">~</span><span class="token number">10</span>G
➢ <span class="token operator">--</span>executor<span class="token operator">-</span>cores：<span class="token number">3</span> ➢ <span class="token operator">--</span>master：实际生产环境一定使用
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>总结端口号：</p> <p>➢ Spark 查看当前 Spark-shell 运行任务情况端口号：4040（计算）</p> <p>➢ Spark Master 内部通信服务端口号：7077</p> <p>➢ Standalone 模式下，Spark Master Web 端口号：8080（资源）</p> <p>➢ Spark 历史服务器端口号：18080</p> <p>➢ Hadoop YARN 任务运行情况查看端口号：8088</p></blockquote> <h2 id="运行架构"><a href="#运行架构" class="header-anchor">#</a> <strong>运行架构</strong></h2> <p>主从架构</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211002162318.png" alt=""></p> <p><strong>Dirver</strong>: 调度节点</p> <ul><li>将用户程序转换成作业</li> <li>在Executor之间调度任务task</li> <li>跟踪执行情况</li> <li>通过UI展示运行情况</li></ul> <p><strong>Executor</strong>：计算节点</p> <ul><li>负责执行具体任务Task，并将其返回给Driver</li> <li>为了提高性能也会对数据进行一些缓存RDD</li></ul> <p><strong>独立部署组件</strong>：Master&amp;Worker：跟资源相关 （相当于yarn的老大和小弟）</p> <p><strong>ApplicationMaster</strong>: 提供：计算和资源交互</p> <h3 id="核心概念"><a href="#核心概念" class="header-anchor">#</a> 核心概念</h3> <p><strong>Executor&amp;Core</strong></p> <blockquote><p>Executor是运行在worker(工作节点)上的一个jvm进程。专门用于计算的节点，提交需要指定节点个数和计算对应的资源 （Executor的内存大小和CPU核(Core) 的数量</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>配置参数
	名称   				说明
--num-executors 	配置 Executor 的数量
--executor-memory 配置每个 Executor 的内存大小
--executor-cores 配置每个 Executor 的虚拟 CPU core 数量
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>并行度</strong> Parallelism  :整个集群并行执行任务的数量。(占用的核core)</p> <p><strong>有向无环图</strong> DAG : 任务的调度，其内部是有向无环图</p> <p><strong>提交流程</strong>：</p> <p>这里主要yarn的提交流程</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211002162838.png" alt=""></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 任务提交	
2. Driver运行(申请支援) -&gt; 向集群管理者 注册任务 -&gt; 管理者 启动Executor后进行反向注册给(告诉)Driver
3. 条件满足-&gt; 执行Main函数 (执行计算代码)
4. 懒执行-&gt;执行到action算子
5. 触发job-&gt; stage划分
6. 创建TaskSet 任务 -&gt; 发送给 已经启动的Executor 进行执行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>yarn部署方式分俩种: <strong>Client</strong>(集群之外) 和<strong>Cluster</strong>() ：<strong>Driver</strong>程序的运行节点不同</p></blockquote> <p><strong>Yarn Client</strong> <strong>模式</strong>：在客户端执行，一般用于测试环境</p> <p><strong>Yarn Cluster</strong> <strong>模式</strong> ：启动在 Yarn 集群资源中执行，一般用于生产环境</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>. 在 YARN Cluster 模式下，任务提交后会和 ResourceManager 通讯申请启动
ApplicationMaster

<span class="token number">2</span>. 随后 ResourceManager 分配 container，在合适的 NodeManager 
上启动 ApplicationMaster，此时的 ApplicationMaster 就是 Driver

<span class="token number">3</span>. Driver 启动后向 ResourceManager 申请 Executor 内存，ResourceManager 接到
ApplicationMaster 的资源申请后会分配 container，然后在合适的 NodeManager 上启动
Executor 进程

<span class="token number">4</span>. Executor 进程启动后会向 Driver 反向注册，Executor 全部注册完成后 Driver 开始执行
main 函数

<span class="token number">5</span>. 之后执行到 Action 算子时，触发一个 Job，并根据宽依赖开始划分 stage，每个 stage 生
成对应的 TaskSet，之后将 task 分发到各个 Executor 上执行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="核心编程⛳"><a href="#核心编程⛳" class="header-anchor">#</a> <strong>核心编程</strong>⛳</h2> <p>为了实现高并发和高吞吐,封装了三大数据结构：</p> <ul><li>RDD :弹性分布式数据集</li> <li>累加器 ：分布式共享只写变量</li> <li>广播变量 ：分布式共享只读变量</li></ul> <p><strong>RDD</strong>：数据基本的<strong>处理模型</strong>,最小的计算单元</p> <blockquote><p>会把RDD里面的内容(读取数据or逻辑切分 <strong>分区概念</strong>)分解成一个一个task发送给Executor执行节点</p> <p>实际上一个RDD里面的逻辑是很简单的,所以一个复杂的任务是多个RDD串联起来,然后再分解成task发送执行节点,进行并行处理。</p> <p>是一个抽象，弹性、不可变、可分区、里面可并行计算的集合</p> <p><strong>弹性</strong>:</p> <ul><li>内存：(内存磁盘自动切换)、</li> <li>容错：(数据丢失可自动恢复)</li> <li>计算：(计算出错可重试)</li> <li>分片：(按需重新分片)</li></ul> <p><strong>抽象</strong>：是一个抽象类,可按需子类添加扩展</p> <p><strong>数据集</strong>：封装了计算逻辑、不保存数据</p> <p><strong>分布式</strong>：数据存储集群不同节点上</p> <p><strong>不可变</strong>：封装了计算逻辑，是不可改变的，需要改变只能产生新RDD</p> <p><strong>可分区、并行计算</strong></p></blockquote> <p>扩展：</p> <p>RDD处理的数据的方式类型于IO流,也有<strong>装饰者设计模式</strong></p> <p>前面处理数据flatmap、reduceBykey...是构建处理数据的方式(功能扩展一步套一步)，不会真正处理数据，当执行到<strong>collect()时才真正开始处理数据</strong>,但rdd不保存数据，io会临时保存一小部分数据。</p> <p><strong>核心属性</strong></p> <ul><li><strong>分区列表</strong>：RDD数据结构中存在分区列表，用于执行任务时并行计算。</li> <li><strong>分区计算函数</strong>：使用分区计算函数对每一个分区进行计算  (因为逻辑已经封装好了)</li> <li><strong>RDD之间的依赖关系</strong>：rdd是计算模型的封装，有时也需要多个计算模型进行组合。</li> <li><strong>分区器</strong>:（可选）当数据为 KV 类型数据时，可以通过设定分区器自定义数据的分区</li> <li><strong>首选位置</strong>: 选择不同的节点位置(<strong>数据的位置)<strong>进行计算</strong>(因为移动数据不如移动计算)</strong></li></ul> <p><strong>执行原理</strong>:</p> <p>RDD是数据处理是核心模型。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#工作原理</span>
<span class="token number">1</span>. 启动yarn集群环境 <span class="token builtin class-name">:</span> RM -<span class="token operator">&gt;</span> NM
<span class="token number">2</span>. spark通过申请资源调度节点Driver和计算节点Executor 
	Dirver 在RM中 而Executor在NM中
<span class="token number">3</span>. 根据需求将计算逻辑根据分区划分成不同的任务  将任务放置在 任务池 当中 Driver调度 
<span class="token number">4</span>. 调度的节点将任务根据计算节点状态<span class="token punctuation">(</span>首选位置<span class="token punctuation">)</span>发送到对应的位置上进行计算
<span class="token comment"># RDD整个流程主要是讲逻辑进行封装,以及生成Task发送给Executor</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="rdd基础编程"><a href="#rdd基础编程" class="header-anchor">#</a> RDD基础编程</h3> <p><strong>RDD</strong> <strong>创建</strong></p> <ul><li><p>内存创建 (常用) :``makeRDD(seq or list) 底层调用了`parallelize方法</p> <blockquote><p>默认是并行度分区数(当前环境运行最大核数),第二个参数指定</p></blockquote></li> <li><p>外部存储文件创建 (常用)</p> <blockquote><p><code>textFile(&quot;datas/1*.txt&quot;)按行读取</code> 返回字符串  默认是俩个分区 math.min(核数,2)  第二个参数指定</p> <p><code>wholeTextFiles 按文件读取</code>：返回元组(路径,内容)</p></blockquote></li> <li><p>其他的RDD创建</p></li> <li><p>直接创建(new)</p></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>    <span class="token comment">//local[*] [*]表示利用当前电脑的CPU核数模拟线程执行 *表示当前线最大使用核数</span>
    <span class="token comment">//local 不写默认是单核线程执行</span>
    <span class="token keyword">val</span> sparkConf<span class="token operator">=</span><span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;RDDtest&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>sparkConf<span class="token punctuation">)</span>
    <span class="token comment">//从内存中创建 来自集合</span>
    <span class="token comment">//val  seq=Seq[Int](1,3,4,2)</span>
<span class="token comment">//    val rdd = sc.makeRDD(seq)//底层调用parallelize</span>
    <span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>
      List<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token comment">//分区数 默认是并行度分区数(当前环境运行最大核数)</span>
    <span class="token punctuation">)</span>
    rdd<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span><span class="token comment">//讲数据保存成分区文件</span>
    <span class="token comment">//读取文件 项目根路径  目录 也可以使用通配符 还可以指定 hdfs路径</span>
<span class="token comment">//    sc.wholeTextFiles(&quot;wenj&quot;) 按行读取</span>
<span class="token comment">//    val rdd = sc.textFile(&quot;datas/1*.txt&quot;)//当前环境根路径为基准。可以写绝对or相对</span>
    <span class="token comment">//hdfs://主机名:8020/文件目录路径</span>
    <span class="token comment">//并行parallelize   需要跟核数</span>
    rdd<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>分区的设置</strong></p> <ul><li>makeRDD：默认是读取配置的参数如果没有，默认是并行度分区数(当前环境运行最大核数),</li> <li>textfile：默认是读取配置的参数如果没有,就是默认是俩个分区 math.min(核数,2)</li></ul> <blockquote><p>第二个参数指定分区数量</p></blockquote> <p><strong>分区的划分</strong>:</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code># 核心源码
<span class="token keyword">def</span> positions<span class="token punctuation">(</span>length<span class="token operator">:</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> numSlices<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> Iterator<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token punctuation">(</span><span class="token number">0</span> until numSlices<span class="token punctuation">)</span><span class="token punctuation">.</span>iterator<span class="token punctuation">.</span>map <span class="token punctuation">{</span> i <span class="token keyword">=&gt;</span>
 <span class="token keyword">val</span> start <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">*</span> length<span class="token punctuation">)</span> <span class="token operator">/</span> numSlices<span class="token punctuation">)</span><span class="token punctuation">.</span>toInt
 <span class="token keyword">val</span> end <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> length<span class="token punctuation">)</span> <span class="token operator">/</span> numSlices<span class="token punctuation">)</span><span class="token punctuation">.</span>toInt
 <span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>分区的内容划分</strong>：</p> <p>以行为单位,进行读取,读取时以偏移量为单位</p> <p>数据分区根据偏移量范围进行计算，偏移量不会被重复读取。</p> <p><strong>分区考证</strong>：</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">//local[*] [*]表示利用当前电脑的CPU核数模拟线程执行 *表示当前线最大使用核数</span>
    <span class="token comment">//local 不写默认是单核线程执行</span>
    <span class="token keyword">val</span> sparkConf<span class="token operator">=</span><span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;RDDtest&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>sparkConf<span class="token punctuation">)</span>
    <span class="token comment">//14byte/2=7byte</span>
    <span class="token comment">//能整除 俩分区</span>
      <span class="token comment">/*
      默认加回车换行
      1234567@@ =&gt; 01245678         偏移量
      89@@      =&gt; 910 11 12
      0         =&gt; 13
      预估范围 里的值
      [0,7] =&gt; 0124567
      [7,14] =&gt;890
       */</span>
    <span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;datas/word.txt&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
    rdd<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">&quot;output&quot;</span><span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>算子</strong>：RDD对象方法</p> <ul><li>转换算子：功能的补充和封装 例: flatmap.map</li> <li>行动算子：触发作业执行和任务调度 例：collect</li></ul> <blockquote><p>把这些<strong>方法</strong>将其称为RDD<strong>算子</strong>  Operator(操作)</p></blockquote> <h3 id="rdd转换算子"><a href="#rdd转换算子" class="header-anchor">#</a> RDD转换算子</h3> <p>数据处理方式：整体上分为 Value 类型、双 Value 类型和 Key-Value类型</p> <p><strong>Value</strong> <strong>类型</strong></p> <ul><li><p><strong>map</strong> ：将处理的数据逐条进行映射转换  (分区内)</p> <blockquote><p>不同分区无序      同分区内执行有序(一个一个)</p></blockquote></li> <li><p><strong>mapPartitions</strong>： <strong>以分区为单位</strong>发送到计算节点进行处理   (批处理操作)</p> <blockquote><p>把分区内的数据全部都拿到再进行操作, 里面是迭代器</p> <p>会将整个分区的数据加载到内存中,进行引用，处理完也不会被释放，存在被引用</p> <p>内存较小数据较大会导致内存溢出</p></blockquote></li> <li><p><strong>mapPartitionsWithIndex</strong>: 分区索引</p> <blockquote><p>可指定索引按需返回的分区, <code>Nil.iterator 空迭代器</code></p></blockquote></li> <li><p><strong>flatMap</strong>: 扁平映射 List =&gt; Int ..</p> <blockquote><p>返回一个可迭代的集合</p></blockquote></li> <li><p><strong>glom</strong> ： 数据转换成内存数组  int =&gt; LIst</p> <blockquote><p>一个分区一个数组  分区不变转换的数据也不变</p></blockquote></li> <li><p><strong>groupBy</strong>: 分区个数不变，对指定规则进行分组，数据会被重新组合(<strong>shuffle</strong>)</p> <blockquote><p>对相同的key放置同一个组中</p> <p>分区和分组没有必然关系，分区里面的数据会改变(打乱洗牌)</p></blockquote></li> <li><p><strong>filter</strong> :过滤</p> <blockquote><p>过滤后分区不变，可能分区内的数据不均衡，会发生<strong>数据倾斜</strong></p></blockquote></li> <li><p><strong>sample</strong> :抽取数据</p> <blockquote><p>有重复的概念</p> <p>基准值概念：概率</p> <p>三个参数:</p> <ul><li>是否放回去</li> <li>不放回表示：每条数据抽取的概率(分数) ，放回：表示每条数据抽取的可能次数（整数）</li> <li>随机算法的种子(不传递表示当前系统时间,随机)</li></ul></blockquote></li> <li><p><strong>distinct</strong>：去重</p> <blockquote><p>原理采用 map转换成(值,null)然后reduceBykey()根据值进行聚合然后map取出值。</p></blockquote></li> <li><p><strong>coalesce</strong> ：缩减分区</p> <blockquote><p>过滤后的数据比较小,但是分区数不变,执行需要俩个Executor执行。</p> <p>而coalesce可以把他们合并成一个分区再交给一个Executor执行（提高执行效率）</p> <p>默认不会将数据打乱重新组合，可能会出现<strong>数据倾斜</strong>。可以进行shuffle</p> <p>第一个参数分区个数,第二个是否开启shuffle</p> <p>也可以扩大分区前提是开启shuffle</p></blockquote></li> <li><p><strong>repartition</strong>: 扩大分区</p> <blockquote><p>底层调用了coalesce 且开启shuffle</p></blockquote></li> <li><p><strong>sortBy</strong>: 排序</p> <blockquote><p>底层有shuffle,第二个<strong>参数指定排序方式</strong>ture升序(默认)</p></blockquote></li></ul> <p><strong>双Value类型</strong>：</p> <ul><li><p>intersection :交集</p></li> <li><p>union：并集</p></li> <li><p>subtracr：差集</p></li> <li><p>zip: 拉链  （对应位置结合成一个元组）<strong>数据类型可以不一致</strong></p> <blockquote><p>注意：分区数量要一致，每个分区元素数量要一致。</p></blockquote></li></ul> <p><strong>Key-Value类型</strong>：</p> <ul><li><p><strong>partitionBy</strong> :按照指定规则重新进行分区</p> <blockquote><p>默认分区器是：HashPartitioner</p> <p>可以自定义分区器：实现排序规则</p></blockquote></li> <li><p><strong>reduceBykey</strong>: 按照相同key对value进行聚合</p> <blockquote><p>(v1,v2) 俩两聚合 如果key为一个就不会参与计算直接返回</p> <p><strong>有分组有聚合</strong> 在落盘之前会进行<strong>预聚合</strong>(分区内)减少落盘数据量提高IO性能</p></blockquote></li> <li><p><strong>groupBykey</strong>：相同key的数据分在一个组中形成对偶元组</p> <blockquote><p>（kev,iter(value)）</p> <p>存在shuffle(必须要落盘才处理,否则会存在内存溢出)，所以shuffle操作性能非常低</p> <p>有分组和<strong>没聚合</strong>(聚合通过别的方式)</p></blockquote></li> <li><p><strong>aggregatebykey</strong> :分区聚合</p> <blockquote><p>制定<strong>不同的规则</strong>进行分区计算和分区之间计算</p> <p>存在函数柯里化：俩个参数列表</p> <p>第一个参数是初始值：传递给分区内进行计算的第一个初始值</p> <p>第二个参数列表：传递分区内计算规则，传递分区间计算规则</p> <p><strong>当分区内和分区间相同</strong>可以用 <strong>forldBykey</strong> 进行简化</p></blockquote></li> <li><p><strong>mapValues</strong> ：key保持不变 对value对象转换</p></li> <li><p><strong>combineBykey</strong> : (相同的key进行操作)(分区内)(分区间)</p></li> <li><p><strong>sortByKey</strong>:根据key进行排序</p> <blockquote><p>K 必须实现 Ordered 接口(特质)</p> <p>返回一个按照 key 进行排序的</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> dataRDD1 <span class="token operator">=</span> sparkContext<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>List<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> sortRDD1<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataRDD1<span class="token punctuation">.</span>sortByKey<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> #正序
<span class="token keyword">val</span> sortRDD1<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataRDD1<span class="token punctuation">.</span>sortByKey<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>#倒序
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></blockquote></li> <li><p><strong>join</strong>：连接  相同key的数据连接在一起 类似内连接  笛卡尔积 shuffle 数据倍增长..</p></li> <li><p><strong>leftOuterJoin</strong> :左连接   主/从</p></li> <li><p><strong>rightOuterJoin</strong> : 右连接   主/从</p></li> <li><p><strong>cogroup</strong>：conect+group 相同的key放在一个组中，然后连接在一起</p></li></ul> <p>案例</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token number">1516609143867</span> <span class="token number">6</span> <span class="token number">7</span> <span class="token number">64</span> <span class="token number">16</span>
时间  省份 城市 用户 广告
需求：统计出每个省份每个广告被点击数量的Top3
   <span class="token keyword">val</span> sparkConf<span class="token operator">=</span><span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;Operstor&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>sparkConf<span class="token punctuation">)</span>
    <span class="token comment">//map</span>
    <span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;datas/agent.log&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> values<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> rdd<span class="token punctuation">.</span>map<span class="token punctuation">(</span>s <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">val</span> arr <span class="token operator">=</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">(</span><span class="token punctuation">(</span>arr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arr<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//((a,b),c)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span> <span class="token comment">// ((a,b),iter[C])</span>
      <span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>prv<span class="token punctuation">,</span> ad<span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>prv<span class="token punctuation">,</span> <span class="token punctuation">(</span>ad<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token comment">//(a,(b,iter[C]))</span>
      <span class="token punctuation">.</span>groupByKey<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//对a分组</span>
      <span class="token punctuation">.</span>mapValues<span class="token punctuation">(</span>kv <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> list <span class="token operator">=</span> kv<span class="token punctuation">.</span>toList<span class="token comment">// 转换成列表才能调用方法</span>
        <span class="token keyword">val</span> tuples <span class="token operator">=</span> list<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">(</span>Ordering<span class="token punctuation">.</span><span class="token builtin">Int</span><span class="token punctuation">.</span>reverse<span class="token punctuation">)</span> <span class="token comment">//排序反转</span>
        tuples<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">//取出前3</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
    values<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="rdd行动算子"><a href="#rdd行动算子" class="header-anchor">#</a> RDD行动算子</h3> <p>触发作业的执行的方法</p> <blockquote><p>底层调用了runjob方法</p> <p>最后通过邮箱无环图运行runjob里面有个submitjob提交任务</p> <p><code>最后创建了 new ActiveJob</code></p></blockquote> <ul><li><p>reduce  : 俩俩聚合</p> <blockquote><p>聚集 RDD 中的所有元素，先聚合分区内数据，再聚合分区间数据</p></blockquote></li> <li><p>collect ：采集</p> <blockquote><p>将不同分区的数据按照分区顺序进行采集到Dirver端内存中进行处理，形成<strong>数组</strong></p></blockquote></li> <li><p>count ：数据的个数</p></li> <li><p>first：第一个</p></li> <li><p>take：取n个数据</p></li> <li><p>takeOrdered：排序取n个</p></li> <li><p>aggregate：不需要考虑数据的类型</p> <blockquote><p>初始值会参与分区内分区间计算</p></blockquote></li> <li><p>flod：分区内和分区间相同</p></li> <li><p>countBykey：统计key出现次数</p></li> <li><p>countByValue：统计value出现的次数</p></li> <li><p>save 相关</p> <blockquote><p>saveAsTestFile:文本格式</p> <p>saveObjectFile: 对象格式</p> <p>saveSerquenceFile:要求数据格式是k-v类型</p></blockquote></li> <li><p>foreacch：<strong>分布式</strong>遍历RDD每一个元素。executor端</p> <blockquote><p>RDD的方法和scala集合的方法不一样，集合对象的方法都是在同一个节点的内存中完成的</p> <p>算子是在executor端执行的</p></blockquote></li></ul> <h3 id="rdd-序列化"><a href="#rdd-序列化" class="header-anchor">#</a> <strong>RDD</strong> <strong>序列化</strong></h3> <p><strong>闭包检查</strong>：算子以外的代码都是在 Driver 端执行, 算子里面的代码都是在 Executor端执行</p> <p><strong>Kryo 序列化框架</strong>：java的序列化框架比较重,而Kryo 是serializable的10倍，suffl内部有些就开始使用了</p> <p><strong>依赖关系</strong>：俩个RDD之间的关系 ：<code>dependencies 查看依赖关系</code></p> <ul><li><p><strong>血缘关系</strong>：多个连续的RDD依赖关系。：<code>toDebugString 血缘关系</code></p> <blockquote><p>为了提高RDD的容错性，需要保存RDD之前的关系，防止遇到错误,可根据血缘关系来进行恢复数据</p> <p>每个RDD都会保存依赖关系。</p></blockquote></li> <li><p><strong>宽窄依赖</strong>：</p> <blockquote><p>oneTOone(窄)依赖：新的RDD一个分区依赖于旧的RDD<strong>一个</strong>分区</p> <p>shuffle(宽)依赖：新的RDD一个分区依赖于旧的RDD<strong>多个</strong>分区  task增多 且<strong>分阶段</strong></p> <p>存在shuffle依赖时,阶段会自动增加一个，阶段数量=shuffle依赖数+1</p></blockquote></li></ul> <p><strong>rdd任务划分</strong>：</p> <ul><li>application：初始化一个sparkcontext即生成一个application</li> <li>job ：一个action算子会生成一个job</li> <li>stage ：等于宽依赖的个数加1</li> <li>task：一个stage阶段中最后一个rdd分区个数就是task个数</li></ul> <blockquote><p>app-&gt;job-&gt;stage-&gt;task 每一层都是1对n的关系</p></blockquote> <h3 id="rdd的持久化"><a href="#rdd的持久化" class="header-anchor">#</a> RDD的持久化</h3> <blockquote><p>默认rdd对象可以重用,数据无法重用，所以为了优化此问题，我们可以将操作的数据持久化，</p> <p>方便下一次操作时使用，不用从头读取。</p></blockquote> <p><strong>持久化:</strong></p> <ul><li><code>cache</code> :临时存储到内存中 可能不安全</li> <li><code>perslist</code> :临时存储在磁盘 可设置存储级别，数据安全、执行IO 性能较低</li></ul> <blockquote><p>可重用，在行动算子时才执行，但是<strong>作业执行完</strong>临时文件都会被<strong>删除</strong></p> <p>会在血缘关系添加一个新的依赖。</p></blockquote> <p><strong>检查点</strong>：<code>checkpoint</code> 需要落盘 需要指定路径   保存的文件作业<strong>执行完文件不会删除</strong></p> <blockquote><p>长久保存到文件中，安全，一般<strong>独立执行一个作业</strong>。性能低，为了提高性能</p> <p>一般情况下需要和<strong>cache联合使用</strong>，所以先开启cache再开启checkpoint。</p> <p>执行过程中会切断血缘关系。重新建立新的血缘关系。等同于改变了数据源。</p></blockquote> <p><strong>分区器</strong>：目前支持 Hash(默认) 分区和 Range 分区</p> <ul><li><strong>Hash</strong>：对于给定的 key，计算其 hashCode,并除以分区个数取余</li> <li><strong>Range</strong> ：将一定范围内的数据映射到一个分区中，尽量保证每个分区数据均匀，而且分区间有序</li></ul> <p><strong>自定义分区器</strong>：</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//参考 new HashPartitioner() 进行改造</span>
 <span class="token comment">/**
   * 自定义分区器
   */</span>
  <span class="token keyword">class</span> MyPartitioner<span class="token punctuation">(</span>partitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> Partitioner<span class="token punctuation">{</span>
    <span class="token comment">//分区数</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> partitions
    <span class="token comment">//分区索引 从0开始 根据key值返回数据所在的索引</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> getPartition<span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">Any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">//模式匹配 根if else 一样</span>
      key <span class="token keyword">match</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;nba&quot;</span><span class="token keyword">=&gt;</span><span class="token number">0</span>
        <span class="token keyword">case</span> <span class="token string">&quot;cba&quot;</span><span class="token keyword">=&gt;</span><span class="token number">1</span>
        <span class="token keyword">case</span> _<span class="token keyword">=&gt;</span><span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//使用</span>
    <span class="token keyword">val</span> pardd<span class="token operator">=</span> rdd<span class="token punctuation">.</span>partitionBy<span class="token punctuation">(</span><span class="token keyword">new</span> MyPartitioner<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//传入个数</span>
    pardd<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">&quot;output1&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>rdd文件读取和保存</strong></p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>#保存
save<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
#读取
textFile
objectFile
sequenceFile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="累加器"><a href="#累加器" class="header-anchor">#</a> 累加器</h3> <p>共享只写变量。</p> <p>acc：让spark知道Dirver的数据传给executor计算完的结果要<strong>返回</strong>给Dirver,然后将返回的结果进行累加合并</p> <p><strong>默认简单聚合</strong>：<code>longaccumulator double....</code>  可以起个名字  add方法将数值加入累加器中 value获取值</p> <blockquote><p>少加：转换算子调用累加器  没有行动算子 不会执行</p> <p>多加：出现多个行动算子，每个行动算子都会执行到这个转换转换算子</p> <p>一般情况下累加器会放在一个行动算子中。</p></blockquote> <p><strong>自定义累加器</strong>：</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">// 参考 longAccumulator 实现  #可以避免shuffle</span>
<span class="token comment">/** *
   * 自定义数据累加器
   * 继承AccumulatorV2 指定泛型
   * 累加器输入类型
   * 累加器返回类型
   */</span>
  <span class="token keyword">class</span> MyAccumulator <span class="token keyword">extends</span> AccumulatorV2<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> mutable<span class="token punctuation">.</span>Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> wcMap<span class="token operator">=</span>mutable<span class="token punctuation">.</span>Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//判断是否为初始状态</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> isZero<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span>wcMap<span class="token punctuation">.</span>isEmpty

    <span class="token comment">//复制一个新的累加器</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> AccumulatorV2<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> mutable<span class="token punctuation">.</span>Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> MyAccumulator

    <span class="token comment">//重置累加器</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> reset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> wcMap<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">//获取输入</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> add<span class="token punctuation">(</span>v<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword">val</span> newCut<span class="token operator">=</span>wcMap<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>v<span class="token punctuation">,</span><span class="token number">0l</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
      wcMap<span class="token punctuation">.</span>update<span class="token punctuation">(</span>v<span class="token punctuation">,</span>newCut<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//Dirver合并多个累加器</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> merge<span class="token punctuation">(</span>other<span class="token operator">:</span> AccumulatorV2<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> mutable<span class="token punctuation">.</span>Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token keyword">val</span> map1<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>wcMap
      <span class="token keyword">val</span> map2<span class="token operator">=</span>other<span class="token punctuation">.</span>value
      map2<span class="token punctuation">.</span>foreach<span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token punctuation">(</span>work<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token keyword">=&gt;</span><span class="token punctuation">{</span>
       <span class="token keyword">val</span> newCount<span class="token operator">=</span>map1<span class="token punctuation">.</span>getOrElse<span class="token punctuation">(</span>work<span class="token punctuation">,</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">+</span>count
          <span class="token comment">//更新</span>
          map1<span class="token punctuation">.</span>update<span class="token punctuation">(</span>work<span class="token punctuation">,</span>newCount<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//输出</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> value<span class="token operator">:</span> mutable<span class="token punctuation">.</span>Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">]</span> <span class="token operator">=</span>  wcMap
  <span class="token punctuation">}</span>

<span class="token comment">//创建累加器对象</span>
    <span class="token keyword">val</span> wcAcc <span class="token operator">=</span> <span class="token keyword">new</span> MyAccumulator
    <span class="token comment">//注册累加器</span>
    sc<span class="token punctuation">.</span>register<span class="token punctuation">(</span>wcAcc<span class="token punctuation">,</span> <span class="token string">&quot;wordCountAcc&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="广播变量"><a href="#广播变量" class="header-anchor">#</a> 广播变量</h3> <p>闭包数据是以task为单位进行发送的，每个任务都包含闭包数据，可能导致executor中有大量重复数据。</p> <p>executor是一个jvm进程 所以在启动时会自动分配到内存。可以把数据加载到这个内存中提供给每个task使用</p> <p>这就是广播变量，但是<strong>广播变量不能更改</strong>。</p> <p>是<strong>分布式共享的只读变量</strong> <code>broadcast(数据)</code></p> <h2 id="工程化架构"><a href="#工程化架构" class="header-anchor">#</a> 工程化架构</h2> <p>例如：MVC : model view Controller</p> <ul><li>业务：逻辑</li> <li>数据：封装</li></ul> <p><strong>三层架构</strong>: Controller(控制 调度) server(服务层 逻辑) dao(持久层 操作文件)</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>目录结构：
入口<span class="token operator">-&gt;</span>conterller<span class="token operator">-&gt;</span>server<span class="token operator">-&gt;</span>dao
#里面可以放置对应属性
<span class="token number">1.</span> conterller #控制层 例<span class="token operator">:</span>创建方法调度服务层方法
<span class="token number">2.</span> server	#服务层   例：创建方法提供给控制层调用<span class="token punctuation">,</span>写逻辑代码<span class="token punctuation">,</span>真正调用数据调用持久层方法	
<span class="token number">3.</span> dao		#持久层   例：创建操作数据方法提供给逻辑<span class="token punctuation">(</span>服务<span class="token punctuation">)</span>层调用 例<span class="token operator">:</span>读取文件等等<span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">4.</span> application #入口类 继承APP即可运行 例：可以调用common里的方法<span class="token punctuation">(</span>传入参数<span class="token punctuation">,</span>逻辑<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token number">5.</span> common #共同类 共通性 抽取类 
例：特质类，方法：把环境放里头初始化关闭的创建同一对象的代码等等<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> 那些执行的方法都可以放进来，
然后调用时，用<span class="token keyword">with</span>混入实现即可，类似接口
<span class="token number">6.</span> util #工具类
<span class="token number">7.</span> bean #实体类 例：ThreadLocal类封装方法用来存储线程数据
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p><strong>ThreadLocal</strong>可以对<strong>线程</strong>的内存进行控制，存储数据,</p> <p>set(存储数据）</p> <p>get获取数据</p> <p>remove删除数据</p> <p>解释：获取当前线程，存储到map的线程容器中。</p></blockquote></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=spark" title="标签">#spark</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/03/22, 21:16:55</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/ska2ab24a2n/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">scala笔记</div></a> <a href="/pages/s2q3lab24a2n/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">spark-SQL笔记</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/ska2ab24a2n/" class="prev">scala笔记</a></span> <span class="next"><a href="/pages/s2q3lab24a2n/">spark-SQL笔记</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f53939/"><div>Spring6</div></a> <span>06-18</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ba69ad/"><div>若依二开</div></a> <span>06-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/998714/"><div>MongoDB</div></a> <span>06-16</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=2461475139&amp;site=qq&amp;menu=yes" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/axcmsm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=6757658477" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>axcmsm | 转载注明出处 </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.e7d9515b.js" defer></script><script src="/assets/js/2.125ae6e8.js" defer></script><script src="/assets/js/41.6647cff7.js" defer></script>
  </body>
</html>