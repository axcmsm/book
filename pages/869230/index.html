<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å•†åŸé¡¹ç›®_é«˜çº§ç¯‡ | ğŸ¦</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="webå‰ç«¯æŠ€æœ¯åšå®¢,ç®€æ´è‡³ä¸Š,ä¸“æ³¨webå‰ç«¯å­¦ä¹ ä¸æ€»ç»“ã€‚JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,githubç­‰æŠ€æœ¯æ–‡ç« ã€‚">
    <meta name="keywords" content="ä¸ªäººæŠ€æœ¯åšå®¢,åç«¯,å¤§æ•°æ®,æŠ€æœ¯æ–‡æ¡£,å­¦ä¹ ,js,vue,python,css3,java,javaEE,SpringBoot,Spring,Hadoop,html5,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.546f0649.css" as="style"><link rel="preload" href="/assets/js/app.e7d9515b.js" as="script"><link rel="preload" href="/assets/js/2.125ae6e8.js" as="script"><link rel="preload" href="/assets/js/105.e9f9588c.js" as="script"><link rel="prefetch" href="/assets/js/10.95c2d7b0.js"><link rel="prefetch" href="/assets/js/100.b4e10546.js"><link rel="prefetch" href="/assets/js/101.d6d23fe2.js"><link rel="prefetch" href="/assets/js/102.b368fb26.js"><link rel="prefetch" href="/assets/js/103.b87bfabc.js"><link rel="prefetch" href="/assets/js/104.3d0ae07d.js"><link rel="prefetch" href="/assets/js/106.76130cbc.js"><link rel="prefetch" href="/assets/js/107.11dd35ba.js"><link rel="prefetch" href="/assets/js/108.de8bb9b7.js"><link rel="prefetch" href="/assets/js/109.e26f138c.js"><link rel="prefetch" href="/assets/js/11.5682c637.js"><link rel="prefetch" href="/assets/js/110.2c9036b9.js"><link rel="prefetch" href="/assets/js/111.d91b7424.js"><link rel="prefetch" href="/assets/js/112.0edf9093.js"><link rel="prefetch" href="/assets/js/113.dbc0bf4d.js"><link rel="prefetch" href="/assets/js/114.439ad4ee.js"><link rel="prefetch" href="/assets/js/115.0cff9cd8.js"><link rel="prefetch" href="/assets/js/116.fd44dc61.js"><link rel="prefetch" href="/assets/js/117.e893d264.js"><link rel="prefetch" href="/assets/js/118.ec4b3d32.js"><link rel="prefetch" href="/assets/js/119.ea5c3eba.js"><link rel="prefetch" href="/assets/js/12.5a51d307.js"><link rel="prefetch" href="/assets/js/120.9aaee23f.js"><link rel="prefetch" href="/assets/js/121.4fc7842c.js"><link rel="prefetch" href="/assets/js/122.2b8f75d1.js"><link rel="prefetch" href="/assets/js/123.78dbfead.js"><link rel="prefetch" href="/assets/js/124.84b6382a.js"><link rel="prefetch" href="/assets/js/125.c2a2a818.js"><link rel="prefetch" href="/assets/js/126.83ea2963.js"><link rel="prefetch" href="/assets/js/127.dffd5eae.js"><link rel="prefetch" href="/assets/js/128.bb0a0738.js"><link rel="prefetch" href="/assets/js/129.45a56702.js"><link rel="prefetch" href="/assets/js/13.d1b5b29f.js"><link rel="prefetch" href="/assets/js/130.7fee331a.js"><link rel="prefetch" href="/assets/js/131.6aaa557b.js"><link rel="prefetch" href="/assets/js/132.9526e280.js"><link rel="prefetch" href="/assets/js/133.610c1c84.js"><link rel="prefetch" href="/assets/js/134.1dcf27f7.js"><link rel="prefetch" href="/assets/js/14.83de980a.js"><link rel="prefetch" href="/assets/js/15.0fa06ae1.js"><link rel="prefetch" href="/assets/js/16.d1d3c9c1.js"><link rel="prefetch" href="/assets/js/17.c9772d78.js"><link rel="prefetch" href="/assets/js/18.7cbf0ef4.js"><link rel="prefetch" href="/assets/js/19.66ee7cfc.js"><link rel="prefetch" href="/assets/js/20.8fbb5432.js"><link rel="prefetch" href="/assets/js/21.74a586bf.js"><link rel="prefetch" href="/assets/js/22.f85a2ced.js"><link rel="prefetch" href="/assets/js/23.a65163b5.js"><link rel="prefetch" href="/assets/js/24.5c2898c6.js"><link rel="prefetch" href="/assets/js/25.929f22ff.js"><link rel="prefetch" href="/assets/js/26.20d74c65.js"><link rel="prefetch" href="/assets/js/27.e790af79.js"><link rel="prefetch" href="/assets/js/28.6b84abe6.js"><link rel="prefetch" href="/assets/js/29.acc0fc34.js"><link rel="prefetch" href="/assets/js/3.dd3750e6.js"><link rel="prefetch" href="/assets/js/30.fadb6cbd.js"><link rel="prefetch" href="/assets/js/31.386f82c2.js"><link rel="prefetch" href="/assets/js/32.e934f71c.js"><link rel="prefetch" href="/assets/js/33.684ac64c.js"><link rel="prefetch" href="/assets/js/34.38f8fd76.js"><link rel="prefetch" href="/assets/js/35.3fe27233.js"><link rel="prefetch" href="/assets/js/36.993695b7.js"><link rel="prefetch" href="/assets/js/37.d735018c.js"><link rel="prefetch" href="/assets/js/38.0d23a384.js"><link rel="prefetch" href="/assets/js/39.808de65c.js"><link rel="prefetch" href="/assets/js/4.4a137b18.js"><link rel="prefetch" href="/assets/js/40.2fc7d5f7.js"><link rel="prefetch" href="/assets/js/41.6647cff7.js"><link rel="prefetch" href="/assets/js/42.f4d93aa6.js"><link rel="prefetch" href="/assets/js/43.a5d40107.js"><link rel="prefetch" href="/assets/js/44.3ae864d3.js"><link rel="prefetch" href="/assets/js/45.c66f1afe.js"><link rel="prefetch" href="/assets/js/46.750f2be2.js"><link rel="prefetch" href="/assets/js/47.1722c1b9.js"><link rel="prefetch" href="/assets/js/48.7c8df7cc.js"><link rel="prefetch" href="/assets/js/49.f9b58d70.js"><link rel="prefetch" href="/assets/js/5.51ca929a.js"><link rel="prefetch" href="/assets/js/50.fad73ad9.js"><link rel="prefetch" href="/assets/js/51.b88c6213.js"><link rel="prefetch" href="/assets/js/52.21244293.js"><link rel="prefetch" href="/assets/js/53.1c2189f3.js"><link rel="prefetch" href="/assets/js/54.95ba12bc.js"><link rel="prefetch" href="/assets/js/55.d8f79989.js"><link rel="prefetch" href="/assets/js/56.63c36b2d.js"><link rel="prefetch" href="/assets/js/57.270857ec.js"><link rel="prefetch" href="/assets/js/58.156073cc.js"><link rel="prefetch" href="/assets/js/59.5a300643.js"><link rel="prefetch" href="/assets/js/6.2dccf462.js"><link rel="prefetch" href="/assets/js/60.92f4ce87.js"><link rel="prefetch" href="/assets/js/61.0f312cea.js"><link rel="prefetch" href="/assets/js/62.0c55901b.js"><link rel="prefetch" href="/assets/js/63.613b1add.js"><link rel="prefetch" href="/assets/js/64.1e5070b6.js"><link rel="prefetch" href="/assets/js/65.dc215238.js"><link rel="prefetch" href="/assets/js/66.4a1319e4.js"><link rel="prefetch" href="/assets/js/67.841428fe.js"><link rel="prefetch" href="/assets/js/68.7380e054.js"><link rel="prefetch" href="/assets/js/69.0a503182.js"><link rel="prefetch" href="/assets/js/7.1096b6fa.js"><link rel="prefetch" href="/assets/js/70.09f4c416.js"><link rel="prefetch" href="/assets/js/71.a279d635.js"><link rel="prefetch" href="/assets/js/72.057aa49f.js"><link rel="prefetch" href="/assets/js/73.767f542c.js"><link rel="prefetch" href="/assets/js/74.3eb6f7e5.js"><link rel="prefetch" href="/assets/js/75.50ecd31e.js"><link rel="prefetch" href="/assets/js/76.602f67fb.js"><link rel="prefetch" href="/assets/js/77.3b5a8e7d.js"><link rel="prefetch" href="/assets/js/78.40c6990e.js"><link rel="prefetch" href="/assets/js/79.ecb155e0.js"><link rel="prefetch" href="/assets/js/8.4b82b135.js"><link rel="prefetch" href="/assets/js/80.d7279b34.js"><link rel="prefetch" href="/assets/js/81.f58f78af.js"><link rel="prefetch" href="/assets/js/82.8399bcab.js"><link rel="prefetch" href="/assets/js/83.67c3c861.js"><link rel="prefetch" href="/assets/js/84.5a8f7c4b.js"><link rel="prefetch" href="/assets/js/85.c6f0af81.js"><link rel="prefetch" href="/assets/js/86.f9f3d0b8.js"><link rel="prefetch" href="/assets/js/87.fec83ae4.js"><link rel="prefetch" href="/assets/js/88.ca11e236.js"><link rel="prefetch" href="/assets/js/89.ae243724.js"><link rel="prefetch" href="/assets/js/9.b8d3ed93.js"><link rel="prefetch" href="/assets/js/90.c242e238.js"><link rel="prefetch" href="/assets/js/91.ad0080a6.js"><link rel="prefetch" href="/assets/js/92.a435d70c.js"><link rel="prefetch" href="/assets/js/93.3232bfbf.js"><link rel="prefetch" href="/assets/js/94.6101d03c.js"><link rel="prefetch" href="/assets/js/95.8c95af7a.js"><link rel="prefetch" href="/assets/js/96.a582908e.js"><link rel="prefetch" href="/assets/js/97.1b560b4f.js"><link rel="prefetch" href="/assets/js/98.a686266f.js"><link rel="prefetch" href="/assets/js/99.e03a81a9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.546f0649.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.ico" alt="ğŸ¦" class="logo"> <span class="site-name can-hide">ğŸ¦</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bigæ•°æ®" class="dropdown-title"><a href="/BigData/" class="link-title">Bigæ•°æ®</a> <span class="title" style="display:none;">Bigæ•°æ®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>å¤§æ•°æ®è·¯çº¿</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">å¼€å‘è·¯çº¿</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linuxå¯¼å›¾</a></li></ul></li><li class="dropdown-item"><h4>å­¦ä¹ ç¬”è®°</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">ã€ŠLinuxã€‹</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">ã€ŠHadoopã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">ã€Šç”Ÿæ€åœˆç»„ä»¶ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">ã€Šæ¶ˆæ¯é˜Ÿåˆ—ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">ã€Šsparkã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" class="nav-link">ã€Šflinkã€‹</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">æŠ€æœ¯æ ˆğŸˆ</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â›³ğŸ–¥" class="dropdown-title"><a href="/technology/" class="link-title">â›³ğŸ–¥</a> <span class="title" style="display:none;">â›³ğŸ–¥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">è®¡ç®—æœºå¿…å¤‡</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">æ•°å­¦åŸºç¡€</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">å­¦ä¹ </a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">æŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">æŠ€æœ¯æ–‡æ¡£</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHubæŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">æœ¬ç«™å…³è”</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">æ”¶è—</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/zzx.jpg"> <div class="blogger-info"><h3>AxcmsmğŸ¼</h3> <span>çºµæœ‰ç–¾é£èµ·ï¼Œäººç”Ÿä¸è¨€å¼ƒğŸ…</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bigæ•°æ®" class="dropdown-title"><a href="/BigData/" class="link-title">Bigæ•°æ®</a> <span class="title" style="display:none;">Bigæ•°æ®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>å¤§æ•°æ®è·¯çº¿</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">å¼€å‘è·¯çº¿</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linuxå¯¼å›¾</a></li></ul></li><li class="dropdown-item"><h4>å­¦ä¹ ç¬”è®°</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">ã€ŠLinuxã€‹</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">ã€ŠHadoopã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">ã€Šç”Ÿæ€åœˆç»„ä»¶ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">ã€Šæ¶ˆæ¯é˜Ÿåˆ—ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">ã€Šsparkã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" class="nav-link">ã€Šflinkã€‹</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">æŠ€æœ¯æ ˆğŸˆ</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â›³ğŸ–¥" class="dropdown-title"><a href="/technology/" class="link-title">â›³ğŸ–¥</a> <span class="title" style="display:none;">â›³ğŸ–¥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">è®¡ç®—æœºå¿…å¤‡</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">æ•°å­¦åŸºç¡€</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">å­¦ä¹ </a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">æŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">æŠ€æœ¯æ–‡æ¡£</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHubæŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">æœ¬ç«™å…³è”</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">æ”¶è—</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JAVA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/338272/" class="sidebar-link">å•†åŸé¡¹ç›®_åŸºç¡€ç¯‡</a></li><li><a href="/pages/869230/" aria-current="page" class="active sidebar-link">å•†åŸé¡¹ç›®_é«˜çº§ç¯‡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/869230/#å•†åŸé¡¹ç›®-é«˜çº§ç¯‡" class="sidebar-link">å•†åŸé¡¹ç›®_é«˜çº§ç¯‡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/869230/#ç¯å¢ƒå®‰è£…" class="sidebar-link">ç¯å¢ƒå®‰è£…</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#å•†å“ä¸Šæ¶åŠŸèƒ½" class="sidebar-link">å•†å“ä¸Šæ¶åŠŸèƒ½</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#æ€§èƒ½å‹æµ‹" class="sidebar-link">æ€§èƒ½å‹æµ‹</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#ç¼“å­˜ä¸åˆ†å¸ƒå¼é”" class="sidebar-link">ç¼“å­˜ä¸åˆ†å¸ƒå¼é”</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#æ£€ç´¢æœåŠ¡å¼€å‘" class="sidebar-link">æ£€ç´¢æœåŠ¡å¼€å‘</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#å¼‚æ­¥-çº¿ç¨‹æ± " class="sidebar-link">å¼‚æ­¥&amp;çº¿ç¨‹æ± </a></li><li class="sidebar-sub-header"><a href="/pages/869230/#å•†å“è¯¦æƒ…" class="sidebar-link">å•†å“è¯¦æƒ…</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#è®¤è¯æœåŠ¡" class="sidebar-link">è®¤è¯æœåŠ¡</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#è´­ç‰©è½¦" class="sidebar-link">è´­ç‰©è½¦</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#æ¶ˆæ¯é˜Ÿåˆ—" class="sidebar-link">æ¶ˆæ¯é˜Ÿåˆ—</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#è®¢å•æœåŠ¡" class="sidebar-link">è®¢å•æœåŠ¡</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#äº‹åŠ¡" class="sidebar-link">äº‹åŠ¡</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#ç§’æ€æœåŠ¡" class="sidebar-link">ç§’æ€æœåŠ¡</a></li><li class="sidebar-sub-header"><a href="/pages/869230/#è‡ªåŠ¨åŒ–ç›‘æ§" class="sidebar-link">è‡ªåŠ¨åŒ–ç›‘æ§</a></li></ul></li></ul></li><li><a href="/pages/994b31/" class="sidebar-link">å•†åŸé¡¹ç›®_è¿ç»´ç¯‡</a></li><li><a href="/pages/8df937/" class="sidebar-link">Dockerå…¥é—¨ğŸ‘</a></li><li><a href="/pages/55c6c0/" class="sidebar-link">å†…ç½‘ç©¿é€</a></li><li><a href="/pages/ca8614/" class="sidebar-link">ElasticSearchä½¿ç”¨</a></li><li><a href="/pages/a40f9d/" class="sidebar-link">spring DataåŸºæœ¬æ“ä½œ</a></li><li><a href="/pages/3cdc51/" class="sidebar-link">JAVAå·¥å…·ç±»</a></li><li><a href="/pages/3534a6/" class="sidebar-link">MybatisPlusä½¿ç”¨</a></li><li><a href="/pages/377cfd/" class="sidebar-link">Springå…¥é—¨</a></li><li><a href="/pages/13efac/" class="sidebar-link">SpringBooté…ç½®å¤šæ•°æ®æº</a></li><li><a href="/pages/546e04/" class="sidebar-link">è®¾è®¡æ¨¡å¼</a></li><li><a href="/pages/998714/" class="sidebar-link">MongoDB</a></li><li><a href="/pages/ba69ad/" class="sidebar-link">è‹¥ä¾äºŒå¼€</a></li><li><a href="/pages/f53939/" class="sidebar-link">Spring6</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ—¥å¸¸æ“ä½œ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- æ­£æ–¹å½¢ -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/TechnologyStack" title="æŠ€æœ¯æ ˆ-ç›®å½•é¡µ" data-v-1cd794fe>æŠ€æœ¯æ ˆ</a></li> <li data-v-1cd794fe><a href="/TechnologyStack/#JAVA" title="æŠ€æœ¯æ ˆ#JAVA" data-v-1cd794fe>JAVA</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/axcmsm" target="_blank" title="ä½œè€…" class="beLink" data-v-1cd794fe>axcmsm</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2022-06-30</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="/img/bj3.jpg">
          å•†åŸé¡¹ç›®_é«˜çº§ç¯‡
        </h1> <div class="page-slot page-slot-top"><!-- å›ºå®š100% * 90pxå¯æ˜¾ç¤ºï¼Œmax-height:90pxæœªè§æ˜¾ç¤º-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="å•†åŸé¡¹ç›®-é«˜çº§ç¯‡"><a href="#å•†åŸé¡¹ç›®-é«˜çº§ç¯‡" class="header-anchor">#</a> å•†åŸé¡¹ç›®_é«˜çº§ç¯‡</h2> <h3 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="header-anchor">#</a> ç¯å¢ƒå®‰è£…</h3> <h4 id="å…¨æ–‡æ£€ç´¢es"><a href="#å…¨æ–‡æ£€ç´¢es" class="header-anchor">#</a> å…¨æ–‡æ£€ç´¢Es</h4> <blockquote><p>å…¨æ–‡æ£€ç´¢ã€æ—¥å¿—å­˜å‚¨ELK</p></blockquote> <p><strong>å®‰è£…es</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#1. æ‹‰å–é•œåƒ</span>
docker pull elasticsearch:7.4.2 <span class="token comment">#å­˜å‚¨å’Œæ£€ç´¢æ•°æ®</span>
docker pull kibana:7.17.2 <span class="token comment">#å¯è§†åŒ–æ£€ç´¢æ•°æ®</span>
<span class="token comment">#2. å‡†å¤‡å·¥ä½œ</span>
<span class="token function">mkdir</span> -p /mydata/elasticsearch/config
<span class="token function">mkdir</span> -p /mydata/elasticsearch/data
<span class="token builtin class-name">echo</span> <span class="token string">&quot;http.host: 0.0.0.0&quot;</span> <span class="token operator">&gt;&gt;</span> /mydata/elasticsearch/config/elasticsearch.yml
<span class="token function">chmod</span> -R <span class="token number">777</span> /mydata/elasticsearch/
<span class="token comment">#3. å¯åŠ¨å®¹å™¨</span>
<span class="token comment">#eså®¹å™¨</span>
docker run --name elasticsearch7162 -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300  -e <span class="token string">&quot;discovery.type=single-node&quot;</span> -e <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms64m -Xmx512m&quot;</span> -v /mydata/elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml -v /mydata/elasticsearch/data:/usr/share/elasticsearch/data -v /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins -d elasticsearch:7.16.2
<span class="token comment">#kibanaå®¹å™¨</span>
docker run --name kibana -e <span class="token assign-left variable">ELASTICSEARCH_URL</span><span class="token operator">=</span>http://192.168.67.210:9200 -p <span class="token number">5601</span>:5601 -d kibana:7.17.2
<span class="token comment">#å®‰è£…IKåˆ†è¯å™¨</span>
docker <span class="token builtin class-name">exec</span> -it estest /bin/bash
./bin/elasticsearch-plugin <span class="token function">install</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.16.2/elasticsearch-analysis-ik-7.16.2.zip
<span class="token comment">#é‡å¯</span>
docker restart es7162
<span class="token comment">#æŸ¥çœ‹ä¾èµ–</span>
./bin/elasticsearch-plugin list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><blockquote><p>ä¸‹è½½ikåˆ†è¯å™¨ï¼š<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases?page=1" target="_blank" rel="noopener noreferrer">githubåœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬</p> <p>ä¸Šä¼ è§£å‹</p> <p>é…ç½®å¤–éƒ¨è§£è€¦åˆ†è¯å™¨é…åˆnginx</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>vim /mydata/elasticsearch/plugins/ik/config/IKAnalyzer.cfg.xml
#æ·»åŠ è¿œç¨‹nginxæŒ‚è½½çš„é…ç½®æ–‡ä»¶
<span class="token comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸ --&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remote_ext_dict<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>http://192.168.67.210/es/fenci.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>é‡å¯eså³å¯</p></blockquote> <h4 id="åå‘ä»£ç†nginx"><a href="#åå‘ä»£ç†nginx" class="header-anchor">#</a> <strong>åå‘ä»£ç†Nginx</strong></h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#è®¾ç½®éœ€è¦æŒ‚è½½çš„é…ç½®æ–‡ä»¶</span>
<span class="token function">mkdir</span> -p /mydata/nginx
docker run -p <span class="token number">80</span>:80 --name nginx -d nginx:1.10
docker container <span class="token function">cp</span> nginx:/etc/nginx /mydata/nginx
ä¿®æ”¹æ–‡ä»¶å <span class="token function">mv</span> /mydata/nginx/nginx  /mydata/nginx/conf 
docker stop nginx
docker <span class="token function">rm</span> nginx
<span class="token comment">#å¯åŠ¨æŒ‚è½½é…ç½®æ–‡ä»¶</span>
docker run -p <span class="token number">80</span>:80 --name nginx  -v /mydata/nginx/html:/usr/share/nginx/html -v /mydata/nginx/logs:/var/log/nginx -v /mydata/nginx/conf:/etc/nginx/ -d nginx:1.10
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>ç›¸å…³é…ç½®</strong>ï¼š</p> <ul><li><p>åŒ¹é…è§„åˆ™</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token number">1</span>ï¼‰æœ€ä½çº§åˆ«åŒ¹é…è§„åˆ™ï¼š
location / <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello Nginxï¼&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">2</span>ï¼‰æœ€é«˜çº§åˆ«åŒ¹é…è§„åˆ™ï¼š
location /user <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello user.hmtl&quot;</span>
<span class="token punctuation">}</span>
<span class="token number">3</span>ï¼‰å…¶å®ƒçº§åˆ«åŒ¹é…è§„åˆ™ï¼š
location ^~ /user <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello user.hmtl&quot;</span>
<span class="token punctuation">}</span>
location ~^ /user <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello user.hmtl&quot;</span>
<span class="token punctuation">}</span>
location ~ ^/<span class="token punctuation">[</span>a-z<span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello user.hmtl&quot;</span>
<span class="token punctuation">}</span>
location ~ ^/<span class="token punctuation">\</span>a <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello user.hmtl&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li><p>åå‘ä»£ç†</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>ocation /user <span class="token punctuation">{</span>
    proxy_pass http://ip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
location /order/ <span class="token punctuation">{</span>
    proxy_pass http://ip/<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
è®¿é—®ç»“æœï¼š
http://ip/user/xx<span class="token punctuation">..</span>.
http://ip/xx<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>è´Ÿè½½å‡è¡¡</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>upstream order <span class="token punctuation">{</span>
    server <span class="token number">192.168</span>.5.18:8080 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    server <span class="token number">192.168</span>.5.18:8081 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
server<span class="token punctuation">{</span>
    location /order/ <span class="token punctuation">{</span>
        proxy_pass http://order/<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
æ³¨ï¼šweight<span class="token operator">=</span><span class="token number">1</span>ï¼Œé…ç½®çš„ä¸ºæƒé‡ï¼Œå€¼è¶Šé«˜æƒé‡è¶Šé«˜
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>é…ç½®æ–‡ä»¶ä»‹ç» <code>nginx.conf</code></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å…¨å±€å—ï¼š é…ç½®è¥é”€nginxå…¨å±€æŒ‡ä»¤ï¼Œå¦‚ç”¨æˆ·ç»„ã€nginxè¿›ç¨‹ã€pidå­˜æ”¾è·¯å¾„ã€æ—¥å¿—ã€é…ç½®æ–‡ä»¶ç­‰
eventså—ï¼šé…ç½®å½±å“nginxæœåŠ¡å™¨æˆ–ä¸ç”¨æˆ·ç½‘ç»œè¿æ¥
httpå—ï¼šåµŒå¥—å¤šä¸ªserverï¼šé…ç½®ä»£ç†ã€ç¼“å­˜ã€è‡ªå®šä¹‰ç­‰
	- httpå— å¦‚upstreamï¼›é”™è¯¯é¡µé¢ã€è¿æ¥è¶…æ—¶ç­‰
	- serverå— é…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ã€ä¸€ä¸ªhttpå¯ä»¥æœ‰ä¸ªserver.
	   -localtion
	   -localtion
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p><strong>include /etc/nginx/conf.d/*.conf;</strong>  å°†é…ç½®æ–‡ä»¶è¿›æ‹†åˆ†</p></blockquote></li></ul> <h3 id="å•†å“ä¸Šæ¶åŠŸèƒ½"><a href="#å•†å“ä¸Šæ¶åŠŸèƒ½" class="header-anchor">#</a> å•†å“ä¸Šæ¶åŠŸèƒ½</h3> <p><strong>å°è£…æŸ¥è¯¢æ•°æ®ä¿å­˜åˆ°ESä¸­ã€ä¿®æ”¹å•†å“çŠ¶æ€ä¸ºä¸Šæ¶</strong></p> <p><strong>åŠ¨é™åˆ†ç¦»</strong>ï¼šnginx-&gt;ç½‘å…³-&gt;å¾®æœåŠ¡</p> <blockquote><p>æ¯ä¸ªå¾®æœåŠ¡éƒ½å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ã€è¿è¡Œã€å‡çº§ã€ç‹¬ç«‹è‡ªæ²»ã€æŠ€æœ¯ã€æ¶æ„ã€ä¸šåŠ¡</p> <p>ä½¿ç”¨ <a href="https://www.thymeleaf.org/documentation.html" target="_blank" rel="noopener noreferrer">thymeleaf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> è¿›è¡Œå¼€å‘</p> <ol><li><p>å…³é—­ç¼“å­˜ã€å¼€å‘å¯çœ‹è§å®æ—¶æ•ˆæœ</p></li> <li><p>é™æ€èµ„æºæ”¾ç½®åœ¨staticæ–‡ä»¶ä¸‹ã€å¯æ ¹æ®è·¯å¾„ç›´æ¥è®¿é—®</p></li> <li><p>é¡µé¢æ”¾åœ¨templatesä¸‹ã€ç›´æ¥è®¿é—®ã€springbootè®¿é—®é¡¹ç›®æ—¶é»˜è®¤ä¼šæ‰¾index</p></li> <li><p>é¡µé¢ä¿®æ”¹ä¸é‡å¯æœåŠ¡å™¨å®æ—¶æ›´æ–°\å¦‚æœæ˜¯ä»£ç é…ç½®è¿˜æ˜¯æ¨èé‡å¯æœåŠ¡å™¨</p> <ol><li>å¯¼å…¥dev-tools</li></ol></li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--        çƒ­æ›´æ–°--&gt;</span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language- extra-class"><pre><code>  2. å½“é¡µé¢ä¿®æ”¹æ—¶æŒ‰ä¸‹Ctrl+F9 ç¼–è¯‘ä¸€ä¸‹å°±å¯ä»¥äº† æˆ–åªå¯¹å½“å‰é¡µé¢é‡æ–°ç¼–è¯‘Ctrl+shift+f9
</code></pre></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--        thymeleaf--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-thymeleaf<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>å¯¼å…¥è¯­æ³•&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
è¯­æ³•æ ‡ç­¾ï¼š ${å–å€¼}
th:text=&quot;${category.name}&quot; æ–‡æœ¬å–å€¼
th:each=&quot;category : ${categorys}&quot;  å¾ªç¯éå†
th:attr=&quot;ctg-data=${category.catId}&quot; è®¾ç½®è‡ªå®šä¹‰å±æ€§
th:text=${#numbers.formatDecimal(item.price,1,2)}//æ•´æ•°ä½æœ€å°ä¸º1ä½ï¼Œä¿å­˜ä¿©ä½å°æ•°
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></blockquote> <p><strong>esæ˜ å°„</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>PUT gulimall_product
<span class="token punctuation">{</span>
    <span class="token property">&quot;mappings&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;properties&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;attrs&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;nested&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token property">&quot;attrId&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
              <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;long&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;attrName&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
              <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;keyword&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;attrValue&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
              <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;keyword&quot;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;brandId&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;long&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;brandImg&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;brandName&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;catalogId&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;long&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;catalogName&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;hasStock&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;boolean&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;hotScore&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;long&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;saleCount&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;long&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;skuId&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;long&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;skuImg&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;skuPrice&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;keyword&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;skuTitle&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;analyzer&quot;</span><span class="token operator">:</span><span class="token string">&quot;ik_smart&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;spuId&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;long&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><h3 id="æ€§èƒ½å‹æµ‹"><a href="#æ€§èƒ½å‹æµ‹" class="header-anchor">#</a> æ€§èƒ½å‹æµ‹</h3> <h4 id="å‹åŠ›æµ‹è¯•"><a href="#å‹åŠ›æµ‹è¯•" class="header-anchor">#</a> å‹åŠ›æµ‹è¯•</h4> <blockquote><p>é—®é¢˜ï¼šå†…å­˜æ³„æ¼ã€å¹¶å‘ä¸åŒæ­¥</p></blockquote> <p><strong>æ€§èƒ½æŒ‡æ ‡</strong>ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å“åº”æ—¶é—´
HPS:æ¯ç§’ç‚¹å‡»æ¬¡æ•°    è¡¨ç¤ºå¯¹æœåŠ¡å™¨å•å‡»è¯·æ±‚
TPS:ç³»ç»Ÿæ¯ç§’å¤„ç†äº¤æ˜“æ•°  è¡¡é‡æ•´ä¸ªä¸šåŠ¡æµç¨‹
OPS:ç³»ç»Ÿæ¯ç§’å¤„ç†æŸ¥è¯¢æ¬¡æ•°  è¡¡é‡æ¥å£æŸ¥è¯¢æ¬¡æ•°
	HPSã€TPSã€OPSæ˜¯è¡¡é‡ç³»ç»Ÿå¤„ç†èƒ½åŠ›é‡è¦æŒ‡æ ‡ã€è¶Šå¤§è¶Šå¥½
	ç»éªŒï¼š
		é‡‘èï¼š1000TPS~50000Tps ä¸åŒ…æ‹¬äº’è”ç½‘åŒ–çš„æ´»åŠ¨
		ä¿é™©ï¼š100TPS~100000Tps ä¸åŒ…æ‹¬äº’è”ç½‘åŒ–çš„æ´»åŠ¨
		åˆ¶é€ ï¼š10Tps~5000Tps
		äº’è”ç½‘ç”µå­å•†åŠ¡ï¼š10000Tps ~ 1000000Tps
		äº’è”ç½‘ä¸­å‹ç½‘ç«™ï¼š1000Tps ~ 50000Tps
		äº’è”ç½‘å°å‹ç½‘ç«™ï¼š500Tps ~ 10000Tps
æœ€å¤§å“åº”æ—¶é—´
æœ€å°‘å“åº”æ—¶é—´
90%å“åº”æ—¶é—´
ä»å¤–éƒ¨çœ‹ï¼Œä¸»è¦å…³æ³¨ï¼šååé‡ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="jmeterå®‰è£…ä½¿ç”¨"><a href="#jmeterå®‰è£…ä½¿ç”¨" class="header-anchor">#</a> JMeterå®‰è£…ä½¿ç”¨</h4> <p>ä¸‹è½½: <a href="https://jmeter.apache.org" target="_blank" rel="noopener noreferrer">https://jmeter.apache.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="æ€§èƒ½ç›‘æ§"><a href="#æ€§èƒ½ç›‘æ§" class="header-anchor">#</a> æ€§èƒ½ç›‘æ§</h4> <p><strong>jconsole\jvisualvm(å‡çº§ç‰ˆ)</strong>:å¯ç”¨äºç›‘æ§æœ¬åœ°å’Œè¿œç¨‹åº”ç”¨ã€‚</p> <blockquote><p>ä¸­é—´ä»¶è¶Šå¤šã€æ€§èƒ½æŸå¤±è¶Šå¤§ã€å¤§å¤šéƒ½æ˜¯æŸå¤±åœ¨ç½‘ç»œäº¤äº’ä¸­</p></blockquote> <p><strong>è°ƒä¼˜</strong>ï¼š</p> <ul><li><strong>ä¸šåŠ¡</strong>ï¼šè°ƒæ•´æ€§èƒ½å‚æ•°
<ul><li>Db(Mysqlè°ƒä¼˜ï¼šå…³é—­æ—¥å¿—ã€ç»™å­—æ®µæ·»åŠ ç´¢å¼•ç­‰ã€ä¸€æ¬¡æŸ¥è¯¢å¤šæ¬¡å¤„ç†</li> <li>æ¨¡æ¿æ¸²æŸ“(å¼€å¯ç¼“å­˜)</li> <li>é™æ€èµ„æº(åŠ¨é™åˆ†ç¦»)ï¼šnginxåˆ¤æ–­æ˜¯å¦æ˜¯staticè·¯å¾„è·³è½¬åˆ°é™æ€è·¯å¾„ä¸­</li></ul></li></ul> <h3 id="ç¼“å­˜ä¸åˆ†å¸ƒå¼é”"><a href="#ç¼“å­˜ä¸åˆ†å¸ƒå¼é”" class="header-anchor">#</a> ç¼“å­˜ä¸åˆ†å¸ƒå¼é”</h3> <blockquote><p>é‚£äº›æ•°æ®é€‚åˆæ”¾å…¥ç¼“å­˜ï¼š</p> <ul><li>åŠæ—¶æ€§ã€æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜</li> <li>è®¿é—®é‡å¤§ä¸”æ›´æ–°é¢‘ç‡ä¸é«˜çš„æ•°æ®ï¼ˆè¯»å¤šã€å†™å°‘ï¼‰</li></ul></blockquote> <p><strong>ç¼“å­˜</strong>ï¼š</p> <ul><li><p>æœ¬åœ°ç¼“å­˜ Map =&gt; å•ä½“åº”ç”¨ ï¼ˆæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼‰</p></li> <li><p>ç¼“å­˜ä¸­é—´ä»¶ï¼šRedis</p> <ol><li><p>æ·»åŠ ä¾èµ–</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--        redis--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>é…ç½®ä¸»æœº+ç«¯å£å·</p></li> <li><p>ä½¿ç”¨springbootè‡ªåŠ¨é…ç½®çš„å¥½çš„æ¨¡æ¿<strong>StringRedisTemplate</strong>æ¥æ“ä½œredis</p></li></ol></li></ul> <p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šäº§ç”Ÿå †å¤–å†…å­˜æº¢å‡º</p> <blockquote><p>springboot2.x é»˜è®¤ä½¿ç”¨lettcuceä½œä¸ºæ“ä½œRedisçš„å®¢æˆ·ç«¯ã€ä½¿ç”¨nettyè¿›è¡Œç½‘ç»œé€šä¿¡</p> <p>lettcuceçš„bugå¯¼è‡´nettyå‡ºç°å †å¤–å†…å­˜æº¢å‡ºã€å‡ºç°çš„åŸå› æ˜¯å †å¤–å†…å­˜æ²¡æœ‰è¢«åŠæ—¶é‡Šæ”¾</p> <p>å¦‚æœnettyæ²¡æœ‰æŒ‡å®šå †å¤–å†…å­˜é»˜è®¤ä½¿ç”¨-Xmx300mã€å¯ä»¥é€šè¿‡-Dio.netty.maxDirectMemoryè¿›è¡Œè®¾ç½®</p> <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šTODO å¾…è¡¥å……</p> <ol><li>å‡çº§lettuceå®¢æˆ·ç«¯</li> <li>åˆ‡æ¢Jediså®¢æˆ·ç«¯  (ç‰ˆæœ¬æ¯”è¾ƒè€ã€ååé‡ä¸é«˜ï¼Œç¨³å®š)</li></ol></blockquote> <p><strong>é—®é¢˜</strong>ï¼šé«˜å¹¶å‘ç›´æ¥è½åº“</p> <ul><li><p>ç¼“å­˜ç©¿é€ï¼šæŸ¥è¯¢æ²¡æœ‰çš„å€¼ï¼Œé«˜å¹¶å‘ç›´æ¥è½åº“ =&gt; <strong>ç©ºç»“æœè¿›è¡Œç¼“å­˜</strong>ã€åŠ å…¥çŸ­æš‚è¿‡æœŸæ—¶é—´</p></li> <li><p>ç¼“å­˜é›ªå´©ï¼šç¼“å­˜å€¼å¤§é¢ç§¯åŒæ—¶å¤±æ•ˆï¼Œé«˜å¹¶å‘ç›´æ¥è½åº“ =&gt; <strong>å¤±æ•ˆæ—¶é—´</strong></p></li> <li><p>ç¼“å­˜å‡»ç©¿ï¼šé«˜é¢‘è®¿é—®çš„keyæ•°æ®å¤±æ•ˆï¼Œé«˜å¹¶å‘ç›´æ¥è½åº“ =&gt; <strong>åŠ é”</strong>ã€å¤§é‡å¹¶å‘è®©ä¸€ä¸ªäººå»æŸ¥ã€å…¶ä»–äººç­‰å¾…ã€‚</p> <ul><li><p>æœ¬åœ°é”ï¼šé”ä½å½“å‰è¿›ç¨‹ã€æ¯ä¸ªå¾®æœåŠ¡éƒ½æ˜¯ä¸€ä¸ªå•ä¾‹</p></li> <li><p>åˆ†å¸ƒå¼é”</p> <ul><li><div class="language- line-numbers-mode"><pre class="language-text"><code>åŠ é”ï¼šSetExè®¾ç½®è¿‡æœŸæ—¶é—´
è§£é”ï¼šLuaè„šæœ¬
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>å…¶ä»–åˆ†å¸ƒå¼é”æ¡†æ¶ <strong>Redisson</strong></p></li></ul></li></ul></li></ul> <h4 id="redisson"><a href="#redisson" class="header-anchor">#</a> Redisson</h4> <blockquote><p>æ“ä½œredisçš„å®¢æˆ·ç«¯ã€ä¸”æä¾›<strong>åˆ†å¸ƒå¼é”</strong>ç­‰ã€å¹¶ä¸”æä¾›äº†å…¶ä»–æ›´å¼ºå¤§çš„ç‰¹æ€§</p></blockquote> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.12.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * æ‰€æœ‰å¯¹Redissonçš„ä½¿ç”¨éƒ½æ˜¯ç»è¿‡RedissonClientå¯¹è±¡
     * @return
     * @throws IOException
     */</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>destroyMethod <span class="token operator">=</span> <span class="token string">&quot;shutdown&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redisson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{</span>
        <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*config.useClusterServers()
                .addNodeAddress(&quot;&quot;);*/</span>
        <span class="token comment">//å•èŠ‚ç‚¹æ¨¡å¼</span>
        <span class="token comment">//redis://   rediss://</span>
        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;redis:// master:6379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>å¯é‡å¤é”</strong>ï¼šé¿å…æ­»é”é—®é¢˜</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">;</span>
 		<span class="token comment">//åº•å±‚å®ç°JUCçš„lock æ–¹ä¾¿ä¸Šæ‰‹</span>
    <span class="token class-name">RLock</span> lock <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åå­—ç›¸åŒå°±æ˜¯åŒä¸€æŠŠé”</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å µå¡å¼ åŠ é” //é»˜è®¤30ç§’</span>
            <span class="token comment">//1/3çš„internalLockLeaseTime ç§’æ—¶é—´åï¼šé”è‡ªåŠ¨ç»­æœŸã€æ— éœ€æ‹…å¿ƒé”è‡ªåŠ¨è¿‡æœŸè¢«åˆ æ‰</span>
            <span class="token comment">//ä¸šåŠ¡å¤„ç†å®Œæ¯•ï¼ŒåŠæ—¶ä¸è§£é”ï¼Œä¹Ÿä¼š30ç§’åè‡ªåŠ¨è§£é”ã€ä¸ä¼šå‡ºç°æ­»é”</span>

    <span class="token comment">//1. å¦‚æœè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°±ä¸ä¼šè‡ªåŠ¨ç»­æœŸ    </span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è§£é”</span>

æœ€ä½³å®æˆ˜ï¼š
     æ‰‹åŠ¨è®¾ç½®è¿‡æœŸæ—¶é—´ <span class="token operator">:</span>lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
     æ‰‹åŠ¨è§£é”ï¼Œçœæ‰æ•´ä¸ªç»­æœŸçš„æ“ä½œ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>å…¬å¹³é”ã€è¯»å†™é”ã€é—­é”ã€ä¿¡å·é‡</p></blockquote> <p><strong>ç¼“å­˜æ•°æ®ä¸€è‡´æ€§</strong>ï¼š</p> <ul><li>åŒå†™æ¨¡å¼ï¼šä¿®æ”¹æ•°æ®åº“æ•°æ®ã€åŒæ—¶ä¿®æ”¹ç¼“å­˜æ•°æ®</li> <li>å¤±æ•ˆæ¨¡å¼ï¼šä¿®æ”¹æ•°æ®åº“æ•°æ®ã€åˆ æ‰ç¼“å­˜æ•°æ®</li></ul> <blockquote><p><strong>ä¼šäº§ç”Ÿè„æ•°æ®çš„é£é™©</strong>ï¼šä½†ä¼šä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>å®æ—¶æ€§ã€ä¸€è‡´æ€§è¦æ±‚é«˜çš„ï¼šåˆ°æ•°æ®åº“æŸ¥
æ•°æ®ä¸€è‡´æ€§ï¼šç¼“å­˜æ•°æ®+è¿‡æœŸæ—¶é—´ã€æˆ–åŠ è¯»å†™é”ä¿è¯æ•°æ®ä¸€è‡´æ€§
æˆ–ç”¨ä¸­é—´ä»¶CanalåŒæ­¥æ•°æ®åº“æ•°æ®
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="spring-cache"><a href="#spring-cache" class="header-anchor">#</a> spring Cache</h4> <blockquote><p>æ¥å£<code>CacheManager</code>ã€<code>Cache</code>æ¥ç»Ÿä¸€ä¸åŒçš„ç¼“å­˜æŠ€æœ¯</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Cacheable  å°†æ•°æ®ä¿å­˜åˆ°ç¼“å­˜
@CacheEvict å°†æ•°æ®ä»ç¼“å­˜ä¸­åˆ é™¤
@CachePut   ä¸å½±å“æ–¹æ³•æ‰§è¡Œæ›´æ–°ç¼“å­˜
@Caching    ç»„åˆä»¥ä¸Šå¤šæ“ä½œ
@CacheConfig åœ¨ç±»çº§åˆ«å…±äº«ç¼“å­˜çš„ç›¸åŒé…ç½®
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>æ•´åˆ</strong>ï¼šcache+redisä½œä¸ºç¼“å­˜</p> <ol><li><p>å¯¼å…¥ä¾èµ–</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--        æ•´åˆ spring cache--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--        redis é»˜è®¤é‡‡ç”¨lettuceå®¢æˆ·ç«¯--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>ç¼–å†™é…ç½®</p> <p>åˆ†æä¸€æ³¢ç¼“å­˜çš„è‡ªåŠ¨é…ç½®<code>CacheAutoConfiguration.class</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span> å¯¼å…¥ä¸åŒç±»å‹çš„<span class="token class-name">CacheConfigurations</span><span class="token punctuation">.</span><span class="token function">getConfigurationClass</span><span class="token punctuation">(</span>types<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>çš„é…ç½®
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CacheConfigurationImportSelector</span> <span class="token keyword">implements</span> <span class="token class-name">ImportSelector</span> <span class="token punctuation">{</span>
        <span class="token class-name">CacheConfigurationImportSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> importingClassMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">CacheType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> types <span class="token operator">=</span> <span class="token class-name">CacheType</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> imports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>types<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> types<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                imports<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">CacheConfigurations</span><span class="token punctuation">.</span><span class="token function">getConfigurationClass</span><span class="token punctuation">(</span>types<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> imports<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token number">2.</span> å…·ä½“ç±»å‹ <span class="token operator">=</span><span class="token operator">&gt;</span>  <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CacheType</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mappings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnumMap</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>GENERIC<span class="token punctuation">,</span> <span class="token class-name">GenericCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>EHCACHE<span class="token punctuation">,</span> <span class="token class-name">EhCacheCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>HAZELCAST<span class="token punctuation">,</span> <span class="token class-name">HazelcastCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>INFINISPAN<span class="token punctuation">,</span> <span class="token class-name">InfinispanCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>JCACHE<span class="token punctuation">,</span> <span class="token class-name">JCacheCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>COUCHBASE<span class="token punctuation">,</span> <span class="token class-name">CouchbaseCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>REDIS<span class="token punctuation">,</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>CAFFEINE<span class="token punctuation">,</span> <span class="token class-name">CaffeineCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>SIMPLE<span class="token punctuation">,</span> <span class="token class-name">SimpleCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CacheType</span><span class="token punctuation">.</span>NONE<span class="token punctuation">,</span> <span class="token class-name">NoOpCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        MAPPINGS <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableMap</span><span class="token punctuation">(</span>mappings<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token number">3.</span> æŸ¥çœ‹ <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span>
    å·²è‡ªåŠ¨é…å¥½äº†ç¼“å­˜ç®¡ç†å™¨
     <span class="token annotation punctuation">@Bean</span>
       <span class="token class-name">RedisCacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®Redisåšä¸ºç¼“å­˜</span>
<span class="token attr-name">spring.cache.type</span><span class="token punctuation">=</span><span class="token attr-value">redis</span>
<span class="token comment">#spring.cache.redis.time-to-live=360000 è®¾ç½®è¿‡æœŸæ—¶é—´ æ¯«ç§’ä¸ºå•ä½</span>
<span class="token comment">#ç¼“å­˜å‰ç¼€ é»˜è®¤ä½¿ç”¨åˆ†åŒºä½œä¸ºå‰ç¼€</span>
<span class="token comment">#spring.cache.redis.key-prefix=CACHE_</span>
<span class="token comment">#å¼€å¯å‰ç¼€</span>
<span class="token comment">#spring.cache.redis.use-key-prefix=true</span>
<span class="token comment">#æ˜¯å¦ç¼“å­˜ç©ºå€¼ é˜²æ­¢ç¼“å­˜ç©¿é€</span>
<span class="token attr-name">spring.cache.redis.cache-null-values</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>å¼€å¯ç¼“å­˜åŠŸèƒ½ <code>@EnableCaching</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * é…ç½®ç¼“å­˜
 */</span>

<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">CacheProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCacheConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">RedisCacheConfiguration</span> <span class="token function">redisCacheConfiguration</span><span class="token punctuation">(</span><span class="token class-name">CacheProperties</span> properties<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä¿®æ”¹åºåˆ—åŒ–è§„åˆ™ string\JSON</span>
        config<span class="token operator">=</span>config<span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token operator">=</span>config<span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è®¾ç½®é»˜è®¤é…ç½®</span>
        <span class="token class-name">CacheProperties<span class="token punctuation">.</span>Redis</span> redisProperties <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getTimeToLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getTimeToLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">prefixKeysWith</span><span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>redisProperties<span class="token punctuation">.</span><span class="token function">isCacheNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>redisProperties<span class="token punctuation">.</span><span class="token function">isUseKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">disableKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> config<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div></li> <li><p><strong>ä¸è¶³</strong>ï¼š</p> <ul><li><p>è¯»æ¨¡å¼</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- ç¼“å­˜ç©¿é€ï¼šspring.cache.redis.cache-null-values=true
- ç¼“å­˜å‡»ç©¿ï¼šåŠ é”ï¼šé»˜è®¤ä¸åŠ é”ã€åŠ ä¸Šå±æ€§sync=&gt;true åŠ æœ¬åœ°é”
- ç¼“å­˜é›ªå´©ï¼šæŒ‡å®šè¿‡æœŸæ—¶é—´å°±è¡Œ spring.cache.redis.time-to-live=360000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>å†™æ¨¡å¼ï¼šæ•°æ®ä¸€è‡´æ€§é—®é¢˜</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>è¯»å†™åŠ é”
å¼•å…¥canalã€æ„ŸçŸ¥mysqlæ›´æ–°ç¼“å­˜
è¯»å¤šå†™å¤šï¼Œç›´æ¥æŸ¥è¯¢æ•°æ®åº“
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <blockquote><p>å¸¸è§„æ•°æ®ï¼ˆè¯»å¤šå†™å°‘çš„ï¼ŒåŠæ—¶æ€§è¦æ±‚ä¸é«˜çš„å®Œæ•´å¯ä»¥ä½¿ç”¨ï¼‰</p></blockquote></li></ol> <h3 id="æ£€ç´¢æœåŠ¡å¼€å‘"><a href="#æ£€ç´¢æœåŠ¡å¼€å‘" class="header-anchor">#</a> æ£€ç´¢æœåŠ¡å¼€å‘</h3> <blockquote><p><strong>es</strong></p></blockquote> <p>é…ç½®</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallElasticSearchConfig</span> <span class="token punctuation">{</span>


    <span class="token comment">//å•ä¾‹æ¨¡å¼  é…ç½®esè®¾ç½®é¡¹</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">RequestOptions</span> COMMON_OPTIONS<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        <span class="token class-name">RequestOptions<span class="token punctuation">.</span>Builder</span> builder <span class="token operator">=</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">.</span><span class="token function">toBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        builder.addHeader(&quot;Authorization&quot;,&quot;Bearer&quot;,TOKEN);</span>
<span class="token comment">//        builder.setHttpAsyncResponseConsumerFactory(</span>
<span class="token comment">//                new HttpAsyncResponseConsumerFactory.HeapBufferedResponseConsumerFactory(30*1024*1024*1024)</span>
<span class="token comment">//        );</span>
        COMMON_OPTIONS<span class="token operator">=</span>builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//é…ç½®é«˜é˜¶å®¢æˆ·ç«¯</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestHighLevelClient</span> <span class="token function">esRestClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">RestHighLevelClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>
                <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;master&quot;</span><span class="token punctuation">,</span> <span class="token number">9200</span><span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> client<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">//esè¿›è¡Œæ£€æŸ¥</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SearchResult</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token class-name">SearchParam</span> searchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchResult</span> result<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">//1. è®¾ç½®æ£€ç´¢æ¡ä»¶</span>
        <span class="token class-name">SearchRequest</span> request <span class="token operator">=</span> <span class="token function">buildSearchRequest</span><span class="token punctuation">(</span>searchParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//2. è¿›è¡Œæœç´¢</span>
            <span class="token class-name">SearchResponse</span> search <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">GulimallElasticSearchConfig</span><span class="token punctuation">.</span>COMMON_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//3. å°è£…å“åº”æ•°æ®</span>
            result<span class="token operator">=</span><span class="token function">buildSearchResult</span><span class="token punctuation">(</span>search<span class="token punctuation">,</span>searchParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å°è£…æŸ¥è¯¢ç»“æœ
     * @param search
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">SearchResult</span> <span class="token function">buildSearchResult</span><span class="token punctuation">(</span><span class="token class-name">SearchResponse</span> search<span class="token punctuation">,</span><span class="token class-name">SearchParam</span> searchParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchResult</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> search<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//1.è®¾ç½®å•†å“ä¿¡æ¯</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuEsModel</span><span class="token punctuation">&gt;</span></span> skuEsModels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">&amp;&amp;</span>hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> hits<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> sourceAsString <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SkuEsModel</span> esModel <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>sourceAsString<span class="token punctuation">,</span> <span class="token class-name">SkuEsModel</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//åˆ¤æ–­æ˜¯å¦æœ‰é«˜äº®</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>searchParam<span class="token punctuation">.</span><span class="token function">getKeyword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">//è®¾ç½®é«˜äº® æ ‡é¢˜</span>
                    <span class="token class-name">HighlightField</span> skuTitle <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getHighlightFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;skuTitle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">String</span> <span class="token class-name">HighlightTitle</span> <span class="token operator">=</span> skuTitle<span class="token punctuation">.</span><span class="token function">getFragments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    esModel<span class="token punctuation">.</span><span class="token function">setSkuTitle</span><span class="token punctuation">(</span><span class="token class-name">HighlightTitle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                skuEsModels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>esModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        result<span class="token punctuation">.</span><span class="token function">setProducts</span><span class="token punctuation">(</span>skuEsModels<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2.è®¾ç½®å“ç‰Œä¿¡æ¯</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResult<span class="token punctuation">.</span>BrandVo</span><span class="token punctuation">&gt;</span></span> brandVos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ParsedLongTerms</span> brand_agg <span class="token operator">=</span> search<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brand_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket <span class="token operator">:</span> brand_agg<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">SearchResult<span class="token punctuation">.</span>BrandVo</span> brandVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult<span class="token punctuation">.</span>BrandVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//1. å¾—åˆ°å“ç‰Œçš„id</span>
            <span class="token keyword">long</span> brandId <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//3. å¾—åˆ°å“ç‰Œå›¾ç‰‡</span>
            <span class="token class-name">String</span> brand_img <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Terms</span><span class="token punctuation">)</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brand_img_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//2. å¾—åˆ°å“ç‰Œçš„åå­—</span>
<span class="token comment">//            String brand_name = ((Terms) bucket.getAggregations().get(&quot;brand_name_agg&quot;)).getBuckets().get(0).getKeyAsString();</span>
            <span class="token class-name">String</span> brand_name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Terms</span><span class="token punctuation">)</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;brand_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            brandVo<span class="token punctuation">.</span><span class="token function">setBrandId</span><span class="token punctuation">(</span>brandId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            brandVo<span class="token punctuation">.</span><span class="token function">setBrandName</span><span class="token punctuation">(</span>brand_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            brandVo<span class="token punctuation">.</span><span class="token function">setBrandImg</span><span class="token punctuation">(</span>brand_img<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ·»åŠ åˆ°é›†åˆ</span>
            brandVos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>brandVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        result<span class="token punctuation">.</span><span class="token function">setBrands</span><span class="token punctuation">(</span>brandVos<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3.è®¾ç½®åˆ†ç±»ä¿¡æ¯</span>
        <span class="token class-name">ParsedLongTerms</span> catalog_agg <span class="token operator">=</span> search<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span><span class="token punctuation">&gt;</span></span> buckets <span class="token operator">=</span> catalog_agg<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResult<span class="token punctuation">.</span>CatalogVo</span><span class="token punctuation">&gt;</span></span> catalogVos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket <span class="token operator">:</span> buckets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">SearchResult<span class="token punctuation">.</span>CatalogVo</span> catalogVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult<span class="token punctuation">.</span>CatalogVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> keyAsString <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            catalogVo<span class="token punctuation">.</span><span class="token function">setCatalogId</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>keyAsString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å¾—åˆ°åˆ†ç±»åçš„å­èšåˆ</span>
            <span class="token class-name">Terms</span> catalog_name_agg <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> catalogName <span class="token operator">=</span> catalog_name_agg<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            catalogVo<span class="token punctuation">.</span><span class="token function">setCatalogName</span><span class="token punctuation">(</span>catalogName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            catalogVos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>catalogVo<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ·»åŠ åˆ°åˆ†ç±»é›†åˆä¸­</span>
        <span class="token punctuation">}</span>
        result<span class="token punctuation">.</span><span class="token function">setCatalogs</span><span class="token punctuation">(</span>catalogVos<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//4. è®¾ç½®å±æ€§ä¿¡æ¯</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SearchResult<span class="token punctuation">.</span>AttrVo</span><span class="token punctuation">&gt;</span></span> attrVos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ParsedNested</span> attr_agg <span class="token operator">=</span> search<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;attr_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ParsedLongTerms</span> attr_id_agg <span class="token operator">=</span> attr_agg<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Terms<span class="token punctuation">.</span>Bucket</span> bucket <span class="token operator">:</span> attr_id_agg<span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">SearchResult<span class="token punctuation">.</span>AttrVo</span> attrVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchResult<span class="token punctuation">.</span>AttrVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> attrId <span class="token operator">=</span> bucket<span class="token punctuation">.</span><span class="token function">getKeyAsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> attr_name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Terms</span><span class="token punctuation">)</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> attr_value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Terms</span><span class="token punctuation">)</span> bucket<span class="token punctuation">.</span><span class="token function">getAggregations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;attr_value_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBuckets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> keyAsString <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getKeyAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> keyAsString<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            attrVo<span class="token punctuation">.</span><span class="token function">setAttrId</span><span class="token punctuation">(</span>attrId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            attrVo<span class="token punctuation">.</span><span class="token function">setAttrName</span><span class="token punctuation">(</span>attr_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            attrVo<span class="token punctuation">.</span><span class="token function">setAttrValue</span><span class="token punctuation">(</span>attr_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            attrVos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>attrVo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        result<span class="token punctuation">.</span><span class="token function">setAttrs</span><span class="token punctuation">(</span>attrVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//5.è®¾ç½®åˆ†é¡µä¿¡æ¯-é¡µç -æ€»è®°å½•-é¡µç </span>
        <span class="token keyword">long</span> total <span class="token operator">=</span> hits<span class="token punctuation">.</span><span class="token function">getTotalHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">int</span> totalPages<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>total<span class="token operator">%</span><span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE<span class="token operator">==</span><span class="token number">0</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>total<span class="token operator">/</span><span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE<span class="token operator">:</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>total<span class="token operator">/</span><span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setTotalPages</span><span class="token punctuation">(</span>totalPages<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setTotal</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">setPageNum</span><span class="token punctuation">(</span>searchParam<span class="token punctuation">.</span><span class="token function">getPageNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> pageNavs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalPages<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pageNavs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        result<span class="token punctuation">.</span><span class="token function">setPageNavs</span><span class="token punctuation">(</span>pageNavs<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * æ„å»ºæ£€ç´¢è¯·æ±‚
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">SearchRequest</span> <span class="token function">buildSearchRequest</span><span class="token punctuation">(</span><span class="token class-name">SearchParam</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SearchSourceBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ„å»ºDSLè¯­å¥</span>

        <span class="token comment">/**
         * æ¨¡ç³ŠåŒ¹é… è¿‡æ»¤(å±æ€§ã€åˆ†ç±»ã€å“ç‰Œã€ä»·æ ¼åŒºé—´ã€åº“å­˜ï¼‰
         */</span>

        <span class="token comment">//bool ç»„åˆå¤šä¸ªquery</span>
        <span class="token class-name">BoolQueryBuilder</span> boolQueryBuilder <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//1. æ¨¡ç³Šå“ç‰Œ must</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getKeyword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//æ¨¡ç³ŠåŒ¹é…match</span>
            boolQueryBuilder<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">matchQuery</span><span class="token punctuation">(</span><span class="token string">&quot;skuTitle&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">.</span><span class="token function">getKeyword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
         <span class="token comment">// è¿‡æ»¤ filter</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getCatalog3Id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//è¿‡æ»¤å‡ºä¸‰çº§åˆ†ç±»Id</span>
                <span class="token comment">//ç²¾ç¡®åŒ¹é…term</span>
                boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;catalogId&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">.</span><span class="token function">getCatalog3Id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">&amp;&amp;</span>param<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//è¿‡æ»¤å‡ºå“ç‰Œid</span>
                <span class="token comment">//ç²¾ç¡®åŒ¹é…term æ‰€æœ‰å“ç‰Œid</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Long</span> aLong <span class="token operator">:</span> param<span class="token punctuation">.</span><span class="token function">getBrandId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">,</span>aLong<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>


                <span class="token comment">//ç²¾ç¡®åŒ¹é…term  //è¿‡æ»¤å‡ºæ˜¯å¦æ‹¥æœ‰åº“å­˜</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getHasStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;hasStock&quot;</span><span class="token punctuation">,</span>param<span class="token punctuation">.</span><span class="token function">getHasStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token comment">//æŒ‰ç…§ä»·æ ¼åŒºé—´è¿›è¡ŒæŸ¥è¯¢</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getSkuPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//è¿‡æ»¤å‡ºå“ç‰Œid</span>
            <span class="token comment">//èŒƒå›´æŸ¥è¯¢ range</span>
            <span class="token class-name">RangeQueryBuilder</span> rangeQuery <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">rangeQuery</span><span class="token punctuation">(</span><span class="token string">&quot;skuPrice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">getSkuPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//çº¦å®š 1_500/_500/500_</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                rangeQuery<span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>length<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getSkuPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    rangeQuery<span class="token punctuation">.</span><span class="token function">lte</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getSkuPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    rangeQuery<span class="token punctuation">.</span><span class="token function">gte</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>rangeQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">if</span> <span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">&amp;&amp;</span>param<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//è¿‡æ»¤å‡ºå±æ€§</span>
            <span class="token comment">//çº¦å®š attrs=1_5å¯¸:8å¯¸&amp;attrs=2_16G:8G</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> attr <span class="token operator">:</span> param<span class="token punctuation">.</span><span class="token function">getAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">BoolQueryBuilder</span> nestedboolQuery <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">boolQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> attr<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> attrId<span class="token operator">=</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> attrValues <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                nestedboolQuery<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrId&quot;</span><span class="token punctuation">,</span>attrId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>attrValues<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> attrValue <span class="token operator">:</span> attrValues<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        nestedboolQuery<span class="token punctuation">.</span><span class="token function">must</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrValue&quot;</span><span class="token punctuation">,</span>attrValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//åµŒå…¥å¼æŸ¥è¯¢ æ¯ä¸€ä¸ªå¿…é¡»éƒ½ç”Ÿæˆä¸€ä¸ª</span>
                <span class="token class-name">NestedQueryBuilder</span> nestedQuery <span class="token operator">=</span> <span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">nestedQuery</span><span class="token punctuation">(</span><span class="token string">&quot;attrs&quot;</span><span class="token punctuation">,</span> nestedboolQuery<span class="token punctuation">,</span> <span class="token class-name">ScoreMode<span class="token punctuation">.</span>None</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¸å‚ä¸è¯„åˆ†</span>
                boolQueryBuilder<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>nestedQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        builder<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>boolQueryBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°è£…æŸ¥è¯¢æ¡ä»¶</span>

        <span class="token comment">/**
         * æ’åºã€åˆ†é¡µã€é«˜äº®ã€
         */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//æ’åº</span>
            <span class="token class-name">String</span> sort <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//çº¦å®š sort=hosScore_asc/desc</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> s <span class="token operator">=</span> sort<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SortOrder</span> sorder<span class="token operator">=</span>s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">&quot;asc&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token class-name">SortOrder</span><span class="token punctuation">.</span>ASC<span class="token operator">:</span><span class="token class-name">SortOrder</span><span class="token punctuation">.</span>DESC<span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>sorder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//åˆ†é¡µ</span>
        builder<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getPageNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_PAGESIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é«˜äº® æ¨¡ç³ŠæŸ¥è¯¢æ‰æ˜¾ç¤ºé«˜äº®</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">getKeyword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">HighlightBuilder</span> hbuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HighlightBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            hbuilder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;skuTitle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            hbuilder<span class="token punctuation">.</span><span class="token function">preTags</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;b style='color:red'&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            hbuilder<span class="token punctuation">.</span><span class="token function">postTags</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;/b&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">highlighter</span><span class="token punctuation">(</span>hbuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/**
         * èšåˆåˆ†æ  å“ç‰Œã€åˆ†ç±»ã€å±æ€§
         */</span>

        <span class="token comment">//å“ç‰Œ</span>
        <span class="token class-name">TermsAggregationBuilder</span> brand_agg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        brand_agg<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;brandId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å“ç‰Œèšåˆ</span>
        brand_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;brandName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å­èšåˆæŸ¥å‡ºåç§°</span>
        brand_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;brand_img_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;brandImg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å­èšåˆæŸ¥å‡ºå›¾ç‰‡</span>
        builder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>brand_agg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ†ç±»</span>
        <span class="token class-name">TermsAggregationBuilder</span> catalog_agg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        catalog_agg<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;catalogId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        catalog_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;catalog_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;catalogName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>catalog_agg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å±æ€§</span>
        <span class="token class-name">NestedAggregationBuilder</span> nested <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">nested</span><span class="token punctuation">(</span><span class="token string">&quot;attr_agg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;attrs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TermsAggregationBuilder</span> attr_id_agg <span class="token operator">=</span> <span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;attr_id_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        attr_id_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;attr_name_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        attr_id_agg<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span><span class="token class-name">AggregationBuilders</span><span class="token punctuation">.</span><span class="token function">terms</span><span class="token punctuation">(</span><span class="token string">&quot;attr_value_agg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">&quot;attrs.attrValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nested<span class="token punctuation">.</span><span class="token function">subAggregation</span><span class="token punctuation">(</span>attr_id_agg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">aggregation</span><span class="token punctuation">(</span>nested<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SearchRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">EsConstant</span><span class="token punctuation">.</span>PRODUCT_INDEX<span class="token punctuation">}</span><span class="token punctuation">,</span> builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> request<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br></div></div><h3 id="å¼‚æ­¥-çº¿ç¨‹æ± "><a href="#å¼‚æ­¥-çº¿ç¨‹æ± " class="header-anchor">#</a> å¼‚æ­¥&amp;çº¿ç¨‹æ± </h3> <h4 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="header-anchor">#</a> <strong>çº¿ç¨‹</strong></h4> <p><strong>åˆå§‹åŒ–çº¿ç¨‹</strong>ï¼š</p> <ol><li>ç»§æ‰¿Thred</li> <li>å®ç°Runableæ¥å£</li> <li>å®ç°Callableæ¥å£+FutureTask ï¼ˆå¯ä»¥æ‹¿åˆ°è¿”å›ç»“æœã€å¯ä»¥å¤„ç†å¼‚å¸¸ï¼‰</li> <li><strong>çº¿ç¨‹æ± </strong></li></ol> <blockquote><p>12ä¸èƒ½å¾—åˆ°è¿”å›å€¼ï¼Œ123éƒ½ä¸èƒ½æ§åˆ¶èµ„æºã€4å¯æ§åˆ¶èµ„æºã€æ€§èƒ½ç¨³å®šã€‚</p></blockquote> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token comment">/*
         * ä¸ƒå¤§å‚æ•°ï¼š
         * corePoolSize:[5] æ ¸å¿ƒçº¿ç¨‹æ•°[ä¸€ç›´å­˜åœ¨(é™¤éè®¾ç½®äº† allowCoreThreadTimeOut)]ï¼›çº¿ç¨‹æ± ï¼Œåˆ›å»ºå¥½åå›å‡†å¤‡å°±ç»ªçš„çº¿ç¨‹æ•°é‡ã€ç­‰å¾…æ¥å—å¼‚æ­¥ä»»åŠ¡å»æ‰§è¡Œ
         * maximumPoolSize:æœ€å¤§çº¿ç¨‹æ•°é‡ ï¼ˆæ§åˆ¶èµ„æºï¼‰
         * keepAliveTime ï¼šå­˜æ´»æ—¶é—´
         * unit ï¼šå•ä½æ—¶é—´
         * workQueue ï¼š å µå¡é˜Ÿåˆ—ï¼ˆå­˜å‚¨ä»»åŠ¡ï¼‰
         * threadFactory ï¼šçº¿ç¨‹åˆ›å»ºå·¥å‚
         * handlerï¼šå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼ŒæŒ‰ç…§æŒ‡å®šæ‹’ç»ç­–ç•¥æ‰§è¡Œä»»åŠ¡
         */</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*
         * å·¥ä½œæµç¨‹ï¼š
         *  1. çº¿ç¨‹æ± åˆ›å»ºï¼Œå‡†å¤‡å¥½coreæ•°é‡çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œå‡†å¤‡æ¥å—ä»»åŠ¡
         *  2. æ–°çš„ä»»åŠ¡è¿›æ¥ï¼Œç”¨coreå‡†å¤‡å¥½çš„ç©ºé—²çº¿ç¨‹æ‰§è¡Œ
         *  3. å µå¡é˜Ÿåˆ—æ»¡äº†ã€å°±ç›´æ¥å¼€å¯æ–°çº¿ç¨‹æ‰§è¡Œï¼Œæœ€å¤§åªèƒ½å¼€åˆ°maxæŒ‡å®šæ•°é‡
         *  4. å¦‚æœçº¿ç¨‹å¼€åˆ°maxçš„æ•°é‡ã€æ–°ä»»åŠ¡è¿›æ¥ï¼Œå°±ä¼šä½¿ç”¨rejectæŒ‡å®šæ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†
         *  5. æ‰€æœ‰çš„çº¿ç¨‹åˆ›é€ éƒ½æœ‰æŒ‡å®šçš„factoryåˆ›å»ºã€‚
         */</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="å¼‚æ­¥ç¼–æ’completablefuture"><a href="#å¼‚æ­¥ç¼–æ’completablefuture" class="header-anchor">#</a> å¼‚æ­¥ç¼–æ’CompletableFuture</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//å¼‚æ­¥ç¼–æ’</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">/*System.out.println(&quot;å¼€å§‹ï¼&quot;);
            CompletableFuture.runAsync(()-&gt;{ //æ— è¿”å›å€¼
            System.out.println(&quot;å½“å‰çº¿ç¨‹æ± :&quot;+Thread.currentThread().getId());
            int i=10/2;
            System.out.println(&quot;ç»“æœï¼š&quot;+i);
            },executor);*/</span>

        <span class="token comment">/*CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; {//æœ‰è¿”å›å€¼
            System.out.println(&quot;å½“å‰çº¿ç¨‹æ± :&quot; + Thread.currentThread().getId());
            int i = 10 / 2;
            System.out.println(&quot;ç»“æœï¼š&quot; + i);
            return i;
        }, executor);
        Integer integer = future.get();
        System.out.println(integer);*/</span>

        <span class="token comment">//æˆåŠŸå›è°ƒ æ„ŸçŸ¥ whenComplete+exceptionally</span>
        <span class="token comment">/*CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; {//æœ‰è¿”å›å€¼
            System.out.println(&quot;å½“å‰çº¿ç¨‹æ± :&quot; + Thread.currentThread().getId());
            int i = 10 / 2;
            System.out.println(&quot;ç»“æœï¼š&quot; + i);
            return i;
        }, executor).whenComplete((res,error)-&gt;{
            System.out.println(&quot;å›è°ƒ:&quot;+res);
        }).exceptionally(error-&gt;{
            return -1;//è¿”å›é»˜è®¤å€¼
        });*/</span>

        <span class="token comment">//æˆåŠŸå›è°ƒå¤„ç†</span>
        <span class="token comment">/*CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; {//æœ‰è¿”å›å€¼
            System.out.println(&quot;å½“å‰çº¿ç¨‹æ± :&quot; + Thread.currentThread().getId());
            int i = 10 / 2;
            System.out.println(&quot;ç»“æœï¼š&quot; + i);
            return i;
        }, executor).handle((res,error)-&gt;{
            if (res!=null){
                return res;
            }
            return 0;//é»˜è®¤è¿”å›å€¼
        });*/</span>

        <span class="token comment">//çº¿ç¨‹ä¸²è¡ŒåŒ– thenRunAsyncã€thenAcceptAsyncã€thenApplyAsync</span>
         <span class="token comment">/*CompletableFuture.supplyAsync(() -&gt; {//æœ‰è¿”å›å€¼
            System.out.println(&quot;å½“å‰çº¿ç¨‹:&quot; + Thread.currentThread().getId());
            int i = 10 / 2;
            System.out.println(&quot;ç»“æœï¼š&quot; + i);
            return i;
        }, executor).thenApplyAsync((res)-&gt;{
            return res;
         },executor);*/</span>

        <span class="token comment">//ä»»åŠ¡ç»„åˆ   ä¿©ä¸ªï¼šå®Œæˆä¸€ä¸ªã€éƒ½è¦å®Œæˆ</span>
        <span class="token comment">// runAfterEitherAsync ä¸æ„ŸçŸ¥ç»“æœï¼Œè‡ªå·±æ²¡æœ‰è¿”å›å€¼</span>
        <span class="token comment">// acceptEitherAsync:æ„ŸçŸ¥ç»“æœï¼Œè‡ªå·±æ²¡æœ‰è¿”å›å€¼</span>
        <span class="token comment">// applyToEitherAsyncï¼šæ„ŸçŸ¥ç»“æœï¼Œæ²¡æœ‰è¿”å›å€¼</span>

        <span class="token comment">//å¤šä»»åŠ¡ç»„åˆ</span>
        <span class="token comment">//allOf éƒ½åšå®Œ ï¼šgetç­‰å¾…</span>
        <span class="token comment">//anyOf åªæœ‰ä¸€ä¸ªæˆåŠŸï¼šgetè·å–æˆåŠŸé‚£ä¸ªçš„æ•°æ®</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç»“æŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h3 id="å•†å“è¯¦æƒ…"><a href="#å•†å“è¯¦æƒ…" class="header-anchor">#</a> å•†å“è¯¦æƒ…</h3> <ul><li><p>æ§åˆ¶å±‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * å±•ç¤ºå½“å‰çš„skuè¯¦æƒ…
     * @param skuId
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{skuId}.html&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">skuItem</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;skuId&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> skuId<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//æŸ¥è¯¢skuè¯¦æƒ…</span>
        <span class="token class-name">SkuItemVo</span> result<span class="token operator">=</span>skuInfoService<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>ä¸šåŠ¡å±‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
     * CompletableFuture å¼‚æ­¥ç¼–æ’
     * @param skuId
     * @return
     * @throws ExecutionException
     * @throws InterruptedException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SkuItemVo</span> <span class="token function">item</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">SkuItemVo</span> skuItemVo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SkuItemVo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//çº¿ç¨‹æ± å¼‚æ­¥ç¼–æ’</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuInfoEntity</span><span class="token punctuation">&gt;</span></span> infoFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//1. skuåŸºæœ¬ä¿¡æ¯ pms_sku_info</span>
            <span class="token class-name">SkuInfoEntity</span> info <span class="token operator">=</span> <span class="token function">getById</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuItemVo<span class="token punctuation">.</span><span class="token function">setInfo</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> info<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> saleAttrFuture <span class="token operator">=</span> infoFuture<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//3. è·å–spuçš„é”€å”®å±æ€§ç»„åˆ</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuItemSaleAttrsVo</span><span class="token punctuation">&gt;</span></span> skuItemSaleAttrsVos <span class="token operator">=</span> skuSaleAttrValueService<span class="token punctuation">.</span><span class="token function">getSaleAttrsBySpuId</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuItemVo<span class="token punctuation">.</span><span class="token function">setSaleAttr</span><span class="token punctuation">(</span>skuItemSaleAttrsVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> descFuture <span class="token operator">=</span> infoFuture<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//4. è·å–spuçš„ä»‹ç»</span>
            <span class="token class-name">SpuInfoDescEntity</span> spuInfoDescEntity <span class="token operator">=</span> spuInfoDescService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ ¹æ®spuidæŸ¥è¯¢è¯¦æƒ…</span>
            skuItemVo<span class="token punctuation">.</span><span class="token function">setDesp</span><span class="token punctuation">(</span>spuInfoDescEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> baseAttrFuture <span class="token operator">=</span> infoFuture<span class="token punctuation">.</span><span class="token function">thenAcceptAsync</span><span class="token punctuation">(</span>res <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//5. è·å–å½“å‰spuè§„æ ¼å‚æ•°</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SpuItemAttrGroupVo</span><span class="token punctuation">&gt;</span></span> attrGroupVos <span class="token operator">=</span> attrGroupService<span class="token punctuation">.</span><span class="token function">getAttrGroupWithAttrsBySpuId</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">getSpuId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span><span class="token function">getCatalogId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuItemVo<span class="token punctuation">.</span><span class="token function">setGroupAttrs</span><span class="token punctuation">(</span>attrGroupVos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>



        <span class="token comment">//2. skuçš„å›¾ç‰‡ä¿¡æ¯ pms_sku_images ç”±äºè·Ÿä¸Šé¢çº¿ç¨‹æ²¡æœ‰å…³ç³»åˆå¼€å¯ä¸€ä¸ªçº¿ç¨‹ ä¹Ÿæ²¡æœ‰è¿”å›ç»“æœ</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> imageFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SkuImagesEntity</span><span class="token punctuation">&gt;</span></span> imagesEntities <span class="token operator">=</span> skuImagesService<span class="token punctuation">.</span><span class="token function">getImagesBySkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            skuItemVo<span class="token punctuation">.</span><span class="token function">setImages</span><span class="token punctuation">(</span>imagesEntities<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//ç­‰å¾…æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡éƒ½å®Œæˆåç»“æŸï¼</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span>saleAttrFuture<span class="token punctuation">,</span>descFuture<span class="token punctuation">,</span>baseAttrFuture<span class="token punctuation">,</span>imageFuture<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> skuItemVo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div></li> <li><p>çº¿ç¨‹æ± é…ç½®</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * é…ç½®æ–‡ä»¶
 */</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;gulimall.thread&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolConfigProperties</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> coreSize<span class="token punctuation">;</span><span class="token comment">//æ ¸å¿ƒçº¿ç¨‹å¤§å°</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> <span class="token class-name">MaxSize</span><span class="token punctuation">;</span><span class="token comment">//æœ€å¤§å¤§å°</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> keepAliveTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * ä¸šåŠ¡çº¿ç¨‹æ± 
 */</span>
<span class="token comment">//@EnableConfigurationProperties(ThreadPoolConfigProperties.class) //æ”¾å…¥å®¹å™¨ï¼šComponent ä¸­å°± å°±ä¸éœ€è¦æ·»åŠ  è¯¥æ³¨è§£</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//é…ç½®çº¿ç¨‹æ± </span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span> <span class="token function">threadPoolExecutor</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolConfigProperties</span> pool<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span>   <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>pool<span class="token punctuation">.</span><span class="token function">getCoreSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              pool<span class="token punctuation">.</span><span class="token function">getMaxSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pool<span class="token punctuation">.</span><span class="token function">getKeepAliveTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li></ul> <h3 id="è®¤è¯æœåŠ¡"><a href="#è®¤è¯æœåŠ¡" class="header-anchor">#</a> è®¤è¯æœåŠ¡</h3> <p>ç¤¾äº¤ç™»å½•ã€å•ç‚¹ç™»å½•</p> <p><strong>æ•´åˆé˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡</strong>ï¼šå¾…æ•´ç†...</p> <h4 id="æ³¨å†ŒæœåŠ¡"><a href="#æ³¨å†ŒæœåŠ¡" class="header-anchor">#</a> æ³¨å†ŒæœåŠ¡</h4> <blockquote><ol><li>æ ¡éªŒçŸ­ä¿¡éªŒè¯ç æ¶ˆæ¯æˆåŠŸåè¿œç¨‹è°ƒç”¨ä¼šå‘˜æœåŠ¡è¿›è¡Œæ³¨å†Œ</li> <li>åˆ¤æ–­æ‰‹æœºå·ã€ç”¨æˆ·åæ˜¯å¦å”¯ä¸€ã€æŠ›å‡ºå¼‚å¸¸ã€æ•è·</li> <li>å¯†ç åŠ å¯†æœºåˆ¶
<ol><li>md5ç›åŠ å¯†ï¼ˆéœ€è¦æ·»åŠ ç›å­—æ®µï¼‰</li> <li><code>new BCryptPasswordEncoder() å¯†ç åŠ å¯†å™¨</code> <strong>æ¨è</strong></li></ol></li></ol></blockquote> <h4 id="ç™»å½•åŠŸèƒ½"><a href="#ç™»å½•åŠŸèƒ½" class="header-anchor">#</a> ç™»å½•åŠŸèƒ½</h4> <ol><li><strong>æ™®é€šç™»å½•</strong>ï¼šè®¤è¯æœåŠ¡=&gt;è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼šæŸ¥è¯¢ç”¨æˆ·åŠ å¯†æ¯”å¯¹å¯†ç </li> <li><strong>ç¤¾äº¤ç™»å½•</strong>:   QAuth2.0
<ol><li>åƒç”³è¯·ç”¨æˆ·æ±‚è¯=&gt;ç”¨æˆ·æˆæƒï¼ˆç¤¾äº¤è´¦å·çš„ä»¥åå¯†ç ï¼‰</li> <li>ä½¿ç”¨æˆæƒï¼Œè¿›è¡Œè®¤è¯=&gt;è®¤è¯é€šè¿‡è¿”å›è®¿é—®ä»¤ç‰Œ</li> <li>ä½¿ç”¨è®¿é—®ä»¤ç‰Œ=&gt;è·å–å¼€æ”¾çš„ä¿æŠ¤ä¿¡æ¯</li> <li>è®¤è¯ä»¤ç‰Œï¼Œè¿”å›å—ä¿æŠ¤ä¿¡æ¯ã€‚</li></ol></li> <li><strong>å•ç‚¹ç™»å½•</strong>ï¼š<strong>è§£å†³å¤šåŸŸåã€å¤šç³»ç»Ÿ</strong>ï¼šä¸€å¤„ç™»å½•ã€å¤„å¤„ç™»å½•</li></ol> <p><strong>åˆ†å¸ƒå¼Session</strong>ï¼š<strong>ç»Ÿä¸€å­˜å‚¨</strong>ã€<strong>å•ä¸ªåŸŸå</strong></p> <ul><li><p>SpringSession =&gt; redis</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--        è®¾ç½®session--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.session<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-session-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--        redisé…ç½®--&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">spring.session.store-type</span><span class="token punctuation">=</span><span class="token attr-value">redis</span>
<span class="token attr-name">server.servlet.session.timeout</span><span class="token punctuation">=</span><span class="token attr-value">30m</span>

<span class="token comment">#reids é…ç½®</span>
<span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">master</span>
<span class="token attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token attr-value">6379</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableRedisHttpSession</span><span class="token comment">//æ•´åˆredisä½œä¸ºsessionç®¡ç†</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>ä½œç”¨åŸŸ+jsonå­˜å‚¨</p></li></ul> <p><strong>springsessionåŸç†</strong>; è£…é¥°è€…æ¨¡å¼</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. @EnableRedisHttpSessionå¯¼å…¥äº†RedisHttpSessionConfiguration.class
	sessionRepository=&gt;RedisIndexedSessionRepository @Bean æ ‡æ³¨äº†Redisæ“ä½œsessionæ“ä½œå¢åˆ æ”¹æŸ¥
	ç»§æ‰¿äº†SpringHttpSessionConfiguration 
	SessionRepositoryFilter @Bean å­˜å‚¨è¿‡æ»¤å™¨
	 1. åˆ›å»ºçš„æ—¶å€™ã€è‡ªåŠ¨å†²å®¹å™¨ä¸­è·å–sessionRepository
	 2. åŸç”Ÿçš„requestã€responseéƒ½è¢«åŒ…è£…äº† wrappedRequest.getSession()=&gt;SessionRepository
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="å•ç‚¹ç™»å½•"><a href="#å•ç‚¹ç™»å½•" class="header-anchor">#</a> å•ç‚¹ç™»å½•</h4> <p><strong>å¾…å®ç°</strong></p> <p><strong>è®¤è¯æµç¨‹</strong>ï¼š</p> <ul><li>ä¸­å¤®è®¤è¯æœåŠ¡å™¨ï¼š</li> <li>å…¶ä»–ç³»ç»Ÿï¼ˆcookieã€tokenï¼‰</li></ul> <h3 id="è´­ç‰©è½¦"><a href="#è´­ç‰©è½¦" class="header-anchor">#</a> è´­ç‰©è½¦</h3> <p><strong>ç”¨æˆ·/åœ¨çº¿è´­ç‰©è½¦</strong></p> <ul><li>æ”¾å…¥æ•°æ®åº“ã€mongodbã€<strong>reids</strong>ï¼ˆç™»å½•åã€‚è®²ç¦»çº¿è´­ç‰©è½¦æ•°æ®åˆå¹¶è¿‡æ¥ï¼Œå¹¶æ¸…ç©ºç¦»çº¿è´­ç‰©è½¦ï¼‰</li></ul> <p><strong>æ¸¸å®¢/ç¦»çº¿è´­ç‰©è½¦</strong></p> <ul><li>æ”¾å…¥localstorageã€cookieã€webSQLã€<strong>redis</strong>ï¼ˆæµè§ˆå™¨å³ä½¿å…³é—­ã€ä¸‹æ¬¡è®¿é—®ä»ç„¶æ˜¾ç¤ºï¼‰</li></ul> <p><strong>åŠŸèƒ½åˆ†æ</strong>ï¼šå­˜å‚¨hashç±»å‹ <strong>Map&lt;String ç”¨æˆ·,Map&lt;String å•†å“id,cartinfo å•†å“è¯¦æƒ…&gt;&gt;</strong></p> <ol><li>ç»“ç®—ä¸‹å•</li> <li>æŸ¥è¯¢è‡ªå·±è´­ç‰©è½¦</li> <li>åœ¨è´­ç‰©è½¦ä¸­ä¿®æ”¹è´­ä¹°å•†å“æ•°é‡</li> <li>åˆ é™¤è´­ç‰©è½¦å•†å“</li> <li>å±•ç¤ºå•†å“ä¼˜æƒ ä¿¡æ¯</li> <li>æç¤ºå•†å“ä»·æ ¼å˜åŒ–</li></ol> <p><strong>å…·ä½“å®ç°</strong>ï¼š</p> <ol><li><p>æ‹¦æˆªå™¨åˆ¤æ–­ç”¨æˆ·èº«æ˜¯å¦ç™»å½•</p></li> <li><p>Threadlocal-åŒä¸€ä¸ªçº¿ç¨‹å…±äº«æ•°æ®ï¼šMap&lt;String,Object&gt; threadLocal</p> <blockquote><p>ä¾‹ï¼šæ‹¦æˆªå™¨=&gt;controller=&gt;service=&gt;dao</p></blockquote></li></ol> <h3 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="header-anchor">#</a> æ¶ˆæ¯é˜Ÿåˆ—</h3> <p>å¼‚æ­¥å¤„ç†ã€åº”ç”¨è§£è€¦ã€æµé‡æ§åˆ¶ã€‚</p> <p>**RabbitMQ **:æ˜¯AMQPçš„å¼€æºå®ç°</p> <ul><li>æ¶ˆæ¯ä»£ç†</li> <li>ç›®çš„åœ°
<ul><li>é˜Ÿåˆ—ï¼šç‚¹å¯¹ç‚¹æ¶ˆæ¯é€šä¿¡ (å¯å¤šæœ‰å¤šä¸ªæ¥æ”¶è€…ï¼Œæœ€ç»ˆæ¶ˆæ¯åªèƒ½ç”±ä¸€ä¸ªäººæ”¶åˆ°)</li> <li>ä¸»é¢˜ï¼šå‘å¸ƒ/è®¢é˜…  æ¶ˆæ¯é€šä¿¡ ï¼ˆå¹¿æ’­ï¼‰</li></ul></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>springæ”¯æŒ  JMS(JAVA API) AMQP(è§„èŒƒåè®®ã€å…¼å®¹jms)
	@EnableJms\@EnableRabbitå¼€å¯æ”¯æŒ
	@JmsListener(jms)\@RabbitListener(AMQP) æ³¨è§£åœ¨æ–¹æ³•ä¸Šç›‘å¬æ¶ˆæ¯ä»£ç†å‘å¸ƒçš„æ¶ˆæ¯
springbootè‡ªåŠ¨é…ç½®ï¼š jmsAutoConfigurationã€RabbitAutoConfiguration
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>RQæ¦‚å¿µ</strong>ï¼š</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>publisherç”Ÿäº§è€…å‘æ¶ˆæ¯messageåˆ°Brokeræ¶ˆæ¯ä»£ç†é‡Œé¢çš„exchangeäº¤æ¢æœºï¼Œäº¤æ¢æœºè·Ÿæ¯ä¸€ä¸ªé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œäº¤æ¢æœºæ ¹æ®æ¶ˆæ¯çš„è·¯ç”±é”®æŠŠæ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„é˜Ÿåˆ—å½“ä¸­ã€‚
ä¸€ä¸ªå®¢æˆ·ç«¯è·ŸBrokerå»ºç«‹ä¸€æ¡è¿æ¥ï¼Œåœ¨è¿æ¥é‡Œé¢æœ‰å¾ˆå¤šä¿¡é“Channel,æ¶ˆæ¯çš„å†…å®¹é€šè¿‡ä¿¡é“ä¼ è¾“ã€‚
messageåŒ…å«å¤´å’Œä½“ï¼ˆä½“æ˜¯æ¶ˆæ¯ã€å¤´æ˜¯æºå¸¦çš„äº¤äº’ä¿¡æ¯ï¼Œä¾‹ï¼šroute-keyï¼šè·¯ç”±é”®
exchangeäº¤æ¢æœºç±»å‹ï¼š
  1. direct ç‚¹å¯¹ç‚¹ï¼ˆå®Œå…¨åŒ¹é…è·¯ç”±é”®ï¼‰
  2. tanout å¹¿æ’­æ¨¡å¼ï¼Œç»‘å®šçš„é˜Ÿåˆ—éƒ½æ”¶åˆ°(ä¸åŒºåˆ†è·¯ç”±é”®)
  3. topic  å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆå¯æ¨¡ç³ŠåŒ¹é…è·¯ç”±é”®ï¼‰
  4. headers ç‚¹å¯¹ç‚¹ æ€§èƒ½ä½ä¸‹ åŸºæœ¬ä¸ç”¨

è™šæ‹Ÿä¸»æœºVhost
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="dockerå®‰è£…rq"><a href="#dockerå®‰è£…rq" class="header-anchor">#</a> <strong>dockerå®‰è£…RQ</strong></h4> <div class="language-xshell line-numbers-mode"><pre class="language-text"><code>docker run -d --name rabbitmq -p 5671:5671 -p 5672:5672 -p 4369:4369 -p 25672:25672 -p 15671:15671 -p 15672:15672 rabbitmq:3-management
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>è§£é‡Šï¼š
4369,25672 Erlangå‘ç°&amp;é›†ç¾¤ç«¯å£
5672ï¼Œ5671 AMQPç«¯å£
15672 webç®¡ç†åå°ç«¯å£ é»˜è®¤ï¼šè´¦å·å¯†ç ï¼šguest
61613ï¼Œ61614 STOMPåè®®ç«¯å£
1883ï¼Œ8883 MQTTåè®®ç«¯å£
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>å¯æ·»åŠ è‡ªå¯å‘½ä»¤ï¼š<code>docker update rabbitmq --restart=always</code></p></blockquote> <h4 id="springbootæ•´åˆrabbitmq"><a href="#springbootæ•´åˆrabbitmq" class="header-anchor">#</a> Springbootæ•´åˆRabbitMQ</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--        RMQ--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">spring.rabbitmq.host</span><span class="token punctuation">=</span><span class="token attr-value">master</span>
<span class="token attr-name">spring.rabbitmq.port</span><span class="token punctuation">=</span><span class="token attr-value">5672</span>
<span class="token attr-name">spring.rabbitmq.virtual-host</span><span class="token punctuation">=</span><span class="token attr-value">/</span>
<span class="token comment">#ç”¨æˆ·å¯†ç  ä½¿ç”¨é»˜è®¤å³å¯</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>ä½¿ç”¨ RabbitMQ
1. å¯¼å…¥amqpåœºæ™¯ï¼ŒRabbitAutoConfigurationå°±ä¼šè‡ªåŠ¨ç”Ÿæ•ˆ
2. ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®äº†
	RabbitTemplateã€AmapAdminã€CachingConnectionFactoryã€RabbitMessagingTemplate
3. å¼€å¯äº† @EnableRabbit
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>	<span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">AmqpAdmin</span> amqpAdmin<span class="token punctuation">;</span> 
	<span class="token comment">/**
     * åˆ›å»ºExchangeã€Queueã€ ç»‘å®šå…³ç³»
     *  ä½¿ç”¨ AmqpAdminæµ‹è¯•ä½¿ç”¨
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token class-name">AmqpAdminTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DirectExchange</span> directExchange <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token string">&quot;hello-java-exchange&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åç§°,æ˜¯å¦æŒä¹…åŒ–ï¼Œæ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼šè¿˜å¯ä»¥ä¼ å…¥å‚æ•°ç­‰</span>
        amqpAdmin<span class="token punctuation">.</span><span class="token function">declareExchange</span><span class="token punctuation">(</span>directExchange<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºäº¤æ¢æœº</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœºã€{}ã€‘åˆ›å»ºå®Œæˆï¼&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello-java-exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Queue</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;hello-java-queue&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åç§°ï¼Œæ˜¯å¦æŒä¹…åŒ–ï¼Œæ˜¯å¦æ’ä»–ï¼Œè‡ªåŠ¨åˆ é™¤ï¼Œå‚æ•°</span>
        amqpAdmin<span class="token punctuation">.</span><span class="token function">declareQueue</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºé˜Ÿåˆ—</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;queueã€{}ã€‘åˆ›å»ºå®Œæˆï¼&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello-java-queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç›®çš„åœ°ï¼ˆé˜Ÿåˆ—ï¼‰,ç›®çš„åœ°ç±»å‹,äº¤æ¢æœº,è·¯ç”±å»ºï¼Œå‚æ•°</span>
        <span class="token class-name">Binding</span> binding <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><span class="token string">&quot;hello-java-queue&quot;</span><span class="token punctuation">,</span>
                <span class="token class-name">Binding<span class="token punctuation">.</span>DestinationType</span><span class="token punctuation">.</span>QUEUE<span class="token punctuation">,</span><span class="token string">&quot;hello-java-exchange&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;hello.java&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        amqpAdmin<span class="token punctuation">.</span><span class="token function">declareBinding</span><span class="token punctuation">(</span>binding<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºé˜Ÿåˆ—</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;bindingã€{}ã€‘åˆ›å»ºå®Œæˆï¼&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello-java-binding&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>#å¯é…ç½®è½¬åŒ–æ¶ˆæ¯ç­–ç•¥ json
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRabbitConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * é…ç½®è½¬åŒ–æ¶ˆæ¯ç­–ç•¥   å¯¹è±¡è½¬æˆjson
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">MessageConverter</span> <span class="token function">messageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
    <span class="token comment">/**
     * å‘é€æ¶ˆæ¯
     *  ä½¿ç”¨ rabbitTemplate
     */</span>
      <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">sendTestMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg<span class="token operator">=</span><span class="token string">&quot;å•Šå®æ‰“å®æ‰“ç®—&quot;</span><span class="token punctuation">;</span><span class="token comment">//ä»»æ„ç±»å‹ å¦‚æœæ˜¯å¯¹è±¡è¦å®ç°åºåˆ—åŒ–ã€ä¹Ÿå¯ä»¥è½¬æˆjsonè¿›è¡Œå‘é€</span>
        <span class="token comment">//ç¬¬å››ä¸ªå‚æ•°ï¼š new CorrelationData(UUID.randomUUID().toString())</span>
        <span class="token comment">//å¯è®¾ç½®ID ç¡®è®¤å›è°ƒä¼šæ”¶åˆ°è¿™ä¸ªid.</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;hello-java-exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello.java&quot;</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘é€å®Œæˆï¼ã€{}ã€‘&quot;</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//ç›‘å¬æ¶ˆæ¯ </span>
	<span class="token comment">// ä½¿ç”¨@RabbitListener å¯æ ‡æ³¨åœ¨ç±»å’Œæ–¹æ³•ä¸Š ï¼ˆç›‘å¬é‚£äº›é˜Ÿåˆ—å³å¯ï¼‰</span>
    <span class="token comment">// ä½¿ç”¨@RabbitHadndler æ ‡æ³¨æ–¹æ³•ä¸Š æ ¹æ®æ¥æ”¶å‚æ•°çš„ç±»å‹æ¥æ”¶ä¸åŒçš„æ•°æ® ï¼ˆé‡è½½åŒºåˆ†ä¸åŒçš„æ¶ˆæ¯ï¼‰</span>
 
   <span class="token comment">/**
     * å‚æ•°ç±»å‹
     *   å‚æ•°1ï¼ŒMessageåŸç”Ÿæ¶ˆæ¯ä½“  æ¶ˆæ¯å¤´+æ¶ˆæ¯ä½“
     *   å‚æ•°2ï¼šTï¼ˆObject) å‘é€æ—¶ä½¿ç”¨ä»€ä¹ˆç±»å‹å‘é€ï¼Œæ¥æ”¶ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥ç±»å‹æ¥æ”¶
     *   å‚æ•°3ï¼šchannel channel å½“å¤©ä¼ è¾“æ•°æ®é€šé“
     *
     * @param message
     */</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;hello-java-queue&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//@RabbitHandler æ ¹æ®å‚æ•°ç±»å‹è‡ªåŠ¨åˆ¤æ–­æ¥æ”¶æ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">revieveMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å†…å®¹</span>
        <span class="token class-name">MessageProperties</span> properties <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å±æ€§ æ¶ˆæ¯å¤´</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span><span class="token operator">+</span>message<span class="token operator">+</span><span class="token string">&quot;==ã€‹å†…å®¹ï¼š&quot;</span><span class="token operator">+</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="æ¶ˆæ¯ç¡®è®¤æœºåˆ¶"><a href="#æ¶ˆæ¯ç¡®è®¤æœºåˆ¶" class="header-anchor">#</a> <strong>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong></h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>RabbitMqæ¶ˆæ¯ç¡®è®¤æœºåˆ¶-å¯é æŠµè¾¾
	ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€å¯ä½¿ç”¨äº‹åŠ¡æ¶ˆæ¯ã€æ€§èƒ½ä¼šä¸‹é™åˆ°250å€ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨
å¯ä½¿ç”¨æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼š
    ç”Ÿäº§è€…ï¼špublisher 
    	confirmCallback ç¡®è®¤æ¨¡å¼
    	returnCallback æœªæŠ•é€’åˆ°queue é€€å›æ¨¡å¼
    æ¶ˆè´¹è€…ï¼šconsumer
    	ack æœºåˆ¶
    
    æµç¨‹ï¼š
		 p =&gt;ï¼ˆBroker:exchange -&gt; queue) =&gt; c
  	p-&gt;b:confirmCallback  e-&gt;q:returnCallback    q-&gt;c:ack
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># å¼€å¯ å‘é€ç«¯åˆ°brokerçš„ç¡®è®¤</span>
<span class="token attr-name">spring.rabbitmq.publisher-confirm-type</span><span class="token punctuation">=</span><span class="token attr-value">correlated</span>
<span class="token comment">#spring.rabbitmq.publisher-confirms=true</span>
<span class="token comment"># å¼€å¯ äº¤æ¢æœºåˆ°é˜Ÿåˆ—çš„ç¡®è®¤</span>
<span class="token attr-name">spring.rabbitmq.publisher-returns</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token comment"># åªè¦æŠµè¾¾é˜Ÿåˆ—å°±å¼‚æ­¥è§¦å‘å›è°ƒreturnconfirms</span>
<span class="token attr-name">spring.rabbitmq.template.mandatory</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token comment"># æ‰‹åŠ¨ackç¡®è®¤æœºåˆ¶</span>
<span class="token attr-name">spring.rabbitmq.listener.simple.acknowledge-mode</span><span class="token punctuation">=</span><span class="token attr-value">manual</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRabbitConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span><span class="token comment">//æ³¨å…¥è¿›è¡Œå®šåˆ¶åŒ–æ“ä½œ</span>

    <span class="token comment">/**
     * ä½¿ç”¨Jsonåºåˆ—åŒ–æœºåˆ¶,è¿›è¡Œæ¶ˆæ¯è½¬æ¢
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">MessageConverter</span> <span class="token function">messageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å®šåˆ¶åŒ–RabbitTemplate
     *  1. Broker æœåŠ¡æ”¶åˆ°å›è°ƒ
     *  2. äº¤æ¢æœºæ¶ˆæ¯æŠµè¾¾é˜Ÿåˆ— å¤±è´¥å›è°ƒ
     *  3. æœåŠ¡ç«¯ç¡®è®¤å›è°ƒ
     *      é»˜è®¤ï¼šè‡ªåŠ¨ç¡®è®¤ï¼Œæ¶ˆè´¹è‡ªåŠ¨ç§»é™¤æ¶ˆæ¯   é—®é¢˜ï¼šä¼šå‘é€æ¶ˆæ¯ä¸¢å¤±
     *     æ‰‹åŠ¨ç¡®è®¤ï¼š
     *           åœ¨ç›‘å¬æ¶ˆæ¯æ—¶ï¼Œå¤„ç†å®Œæ¶ˆæ¯å
     *           channel.basicAck(deliveryTag,false);ç­¾æ”¶
     *           channel.basicNack(deliveryTag,false,true);æ‹’ç­¾ï¼›ä¸šåŠ¡å¤±è´¥ï¼Œæ‹’ç­¾
     *
     *
     */</span>
    <span class="token annotation punctuation">@PostConstruct</span>  <span class="token comment">//è¯¥æ³¨è§£æ ‡æ³¨MyRabbitConfigå¯¹è±¡åˆ›å»ºå®Œåæ‰§è¡Œè¯¥æ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initRabbitTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//è®¾ç½®æ¶ˆæ¯æŠµè¾¾Brokerç¡®è®¤å›è°ƒ</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/**
             * åªè¦æ¶ˆæ¯æŠµè¾¾æœåŠ¡å™¨ å°±ä¼šæ˜¾ç¤ºtrue ç”Ÿäº§è€…ç¡®è®¤å›è°ƒ
             * @param correlationData  å½“å‰æ¶ˆæ¯çš„å”¯ä¸€å…³è”æ•°æ®
             * @param ack  æ¶ˆæ¯æ˜¯å¦æˆåŠŸè¢«æ”¶åˆ°
             * @param error å¤±è´¥çš„åŸå› 
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//correlationData æ¶ˆæ¯å”¯ä¸€Id</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç¡®è®¤å›è°ƒï¼šã€&quot;</span><span class="token operator">+</span>correlationData<span class="token operator">+</span><span class="token string">&quot;ã€‘===&gt;ackã€&quot;</span><span class="token operator">+</span>ack<span class="token operator">+</span><span class="token string">&quot;ã€‘ ==ã€‹ error=ã€‹ã€&quot;</span><span class="token operator">+</span>error<span class="token operator">+</span><span class="token string">&quot;ã€‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è®¾ç½®äº¤æ¢æœºæŠµè¾¾é˜Ÿåˆ— =&gt; æŠ•é€’æˆåŠŸä¸ä¼šè§¦å‘</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/**
             * åªè¦æ¶ˆæ¯æ²¡æœ‰æŠ•é€’ç»™æŒ‡å®šé˜Ÿåˆ—ï¼Œå°±è§¦å‘è¿™ä¸ªå¤±è´¥çš„å›è°ƒ
             * @param message  æŠ•é€’å¤±è´¥æ¶ˆæ¯
             * @param replyCode å›å¤çŠ¶æ€ç 
             * @param replyText å›å¤æ–‡æœ¬å†…å®¹
             * @param exchange äº¤æ¢æœº
             * @param rk  è·¯ç”±é”®
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> rk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Fail messageã€&quot;</span><span class="token operator">+</span>message<span class="token operator">+</span><span class="token string">&quot;ã€‘==&gt;replyCode=&gt;ã€&quot;</span><span class="token operator">+</span>replyCode<span class="token operator">+</span><span class="token string">&quot;ã€‘==&gt;exchange==&gt;ã€&quot;</span><span class="token operator">+</span>exchange<span class="token operator">+</span><span class="token string">&quot;ã€‘=rk=ã€‹ã€&quot;</span><span class="token operator">+</span>rk<span class="token operator">+</span><span class="token string">&quot;ã€‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recieveMessage1</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Cart</span> cart<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span>  <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å¤„ç†å®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> deliveryTag <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//éæ‰¹é‡ç­¾æ”¶æ¨¡å¼</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>deliveryTag<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰‹åŠ¨ç¡®è®¤å›å¤</span>
            <span class="token comment">//ä¸ç­¾æ”¶æ¨¡å¼ //idã€æ˜¯å¦æ‰¹é‡ã€ æ˜¯å¦é‡æ–°æ”¾å›é˜Ÿåˆ—ä¸­ï¼šå¦åˆ™è¢«ä¸¢å¼ƒ</span>
            channel<span class="token punctuation">.</span><span class="token function">basicNack</span><span class="token punctuation">(</span>deliveryTag<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//ç½‘ç»œä¸­æ–­</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="å»¶è¿Ÿé˜Ÿåˆ—-å®šæ—¶ä»»åŠ¡"><a href="#å»¶è¿Ÿé˜Ÿåˆ—-å®šæ—¶ä»»åŠ¡" class="header-anchor">#</a> å»¶è¿Ÿé˜Ÿåˆ—ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰</h4> <p><strong>åœºæ™¯</strong>ï¼š ä¸ºä»˜æ¬¾è®¢å•ï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´åã€ç³»ç»Ÿå›è‡ªåŠ¨å–æ¶ˆè®¢å•å¹¶ä¸”é‡Šæ”¾å æœ‰çš„ç‰©å“</p> <ul><li>spring çš„scheduleå®šæ—¶ä»»åŠ¡è½®è¯¢æ•°æ®åº“ï¼ˆæ¶ˆè€—ç³»ç»Ÿå†…å­˜ã€å¢åŠ æ•°æ®åº“å‹åŠ›ã€å­˜åœ¨è¾ƒå¤§æ—¶é—´å·®ï¼‰</li> <li><strong>æ¶ˆæ¯TTL(å­˜æ´»æ—¶é—´</strong>):åªè¦åœ¨æŒ‡å®šçš„æ—¶é—´æ²¡æœ‰è¢«æ¶ˆè´¹çš„æ•°æ®</li> <li><strong>æ­»ä¿¡Exchange</strong>:æ­»ä¿¡è·¯ç”±
<ol><li>æ‹’æ”¶ã€ä¸¢å¼ƒ</li> <li>TTLçš„å­˜æ´»æ—¶é—´åˆ°äº†ã€æ¶ˆæ¯è¿‡æœŸäº†</li> <li>é˜Ÿåˆ—çš„é•¿åº¦æ»¡äº†ã€æ’åœ¨å‰é¢çš„æ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒæˆ–è€…æ‰”åˆ°æ­»ä¿¡è·¯ç”±ä¸Š</li></ol></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * MQè‡ªåŠ¨åˆ›å»ºé…ç½®
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMQConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;order.release.order.queue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">listener</span><span class="token punctuation">(</span><span class="token class-name">OrderEntity</span> orderEntity<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¶åˆ°è¿‡æœŸçš„è®¢å•æ¶ˆæ¯,å…³é—­è®¢å•&quot;</span><span class="token operator">+</span>orderEntity<span class="token punctuation">.</span><span class="token function">getOrderSn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//@Bean å¦‚æœRabbitMqä¸­æ²¡æœ‰ä¼šè‡ªåŠ¨åˆ›å»º</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">orderDelayQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order-event-exchange&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-routing-key&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order.release.order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-message-ttl&quot;</span><span class="token punctuation">,</span><span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¸€åˆ†é’Ÿ</span>
        <span class="token comment">//æŒä¹…ã€ä¸æ’ä»–ã€ä¸è‡ªåŠ¨åˆ é™¤</span>
        <span class="token class-name">Queue</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;order.delay.queue&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> queue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">orderReleaseOrderQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//æŒä¹…ã€ä¸æ’ä»–ã€ä¸è‡ªåŠ¨åˆ é™¤</span>
        <span class="token class-name">Queue</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">&quot;order.release.order.queue&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> queue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Exchange</span> <span class="token function">orderEventExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//æŒä¹…ä¸»é¢˜äº¤æ¢æœº</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TopicExchange</span><span class="token punctuation">(</span><span class="token string">&quot;order-event-exchangs&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">orderCreateOrderBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><span class="token string">&quot;order.delay.queue&quot;</span><span class="token punctuation">,</span><span class="token class-name">Binding<span class="token punctuation">.</span>DestinationType</span><span class="token punctuation">.</span>QUEUE<span class="token punctuation">,</span>
                <span class="token string">&quot;order-event-exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order.create.order&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">orderReleaseOrderBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Binding</span><span class="token punctuation">(</span><span class="token string">&quot;order.release.order.queue&quot;</span><span class="token punctuation">,</span><span class="token class-name">Binding<span class="token punctuation">.</span>DestinationType</span><span class="token punctuation">.</span>QUEUE<span class="token punctuation">,</span>
                <span class="token string">&quot;order-event-exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order.release.order&quot;</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//æµ‹è¯•åˆ›å»ºè®¢å•   </span>
<span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/test/createOrder&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">createOrderTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">OrderEntity</span> orderEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        orderEntity<span class="token punctuation">.</span><span class="token function">setOrderSn</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å‘é€æ¶ˆæ¯</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;order-event-exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;order.create.order&quot;</span><span class="token punctuation">,</span>orderEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="è®¢å•æœåŠ¡"><a href="#è®¢å•æœåŠ¡" class="header-anchor">#</a> è®¢å•æœåŠ¡</h3> <p><strong>è®¢å•æ„æˆ</strong>ï¼šè®¢å•ç”Ÿæˆ=&gt;è®¢å•æ”¯ä»˜=&gt;å–å®¶å‘è´§=&gt;ç¡®è®¤æ”¶è´§=&gt;äº¤æ˜“æˆåŠŸã€‚ï¼ˆå®é™…ç•¥æœ‰ä¸åŒï¼‰</p> <blockquote><p>ä¸‰æµï¼šä¿¡æ¯æµã€èµ„é‡‘æµã€ç‰©æµï¼šè®¢å•ç³»ç»Ÿä½œä¸ºä¸­æ¢å°†ä¸‰è€…æœ‰æœºçš„é›†åˆèµ·æ¥ã€‚</p> <p>æ•…ä¼šæŸ¥è¯¢å¾ˆå¤šæ¶ˆæ¯ï¼šç”¨æˆ·ä¿¡æ¯ã€è®¢å•ä¿¡æ¯ã€å•†å“ä¿¡æ¯ã€ä¿ƒé”€ä¿¡æ¯ã€æ”¯ä»˜ä¿¡æ¯ã€ç‰©æµæµé‡</p></blockquote> <p><strong>è®¢å•çŠ¶æ€</strong>ï¼š</p> <blockquote><p>å¾…ä»˜æ¬¾ï¼ˆé”å®šåº“å­˜ï¼‰ã€å·²ä»˜æ¬¾/å¾…å‘è´§ï¼ˆä»“åº“ï¼‰ã€å¾…æ”¶è´§/å·²æ”¶è´§ï¼ˆç‰©æµçŠ¶æ€ï¼‰</p> <p>å·²å®Œæˆï¼ˆå”®åçŠ¶æ€ï¼‰ã€å·²å–æ¶ˆã€å”®åä¸­</p></blockquote> <p><strong>Feignè¿œç¨‹è°ƒç”¨ä¸¢å¤±è¯·æ±‚å¤´é—®é¢˜</strong>ï¼šæ„å»ºfeignæ‹¦æˆªå™¨æ·»åŠ ä¸Šè¯·æ±‚å¤´ä¿¡æ¯</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token comment">//è¯·æ±‚æ–¹æ³•éœ€è¦åŠ ä¸Š HttpServletRequest request è¯¥å‚æ•°</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFeignConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;requestInterceptor&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RequestInterceptor</span> <span class="token function">requestInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RequestInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">RequestTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//ä½¿ç”¨ ä¸Šä¸‹æ–‡ç¯å¢ƒä¿æŒå™¨ è·å–è¯·æ±‚å±æ€§ RequestContextHolderæ‹¿åˆ°åˆšè¿›æ¥çš„è¯·æ±‚æ•°æ®</span>
                <span class="token class-name">ServletRequestAttributes</span> attributes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServletRequestAttributes</span><span class="token punctuation">)</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>attributes<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> attributes<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è€è¯·æ±‚ï¼Œæ–°è¯·æ±‚</span>
                    <span class="token comment">//åŒæ­¥è¯·æ±‚å¤´ä¸­çš„æ•°æ®ï¼ŒCookie</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token class-name">String</span> cookie <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Cookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        template<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Cookie&quot;</span><span class="token punctuation">,</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>Feignå¼‚æ­¥ä¸¢å¤±ä¸Šä¸‹æ–‡é—®é¢˜</strong>ï¼š æ‹·è´ä¸€ä»½ä¸»çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>ä¾‹ï¼š

        <span class="token comment">//ä½¿ç”¨äº†å¼‚æ­¥ç¼–æ’ï¼Œç»™æ¯ä¸ªçº¿ç¨‹å…ˆè®¾ç½®ä¸€ä¸‹ä¸Šä¸‹æ–‡çš„ç¯å¢ƒä¿¡æ¯</span>
        <span class="token class-name">RequestAttributes</span> requestAttributes <span class="token operator">=</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä¸»çº¿ç¨‹</span>

        <span class="token comment">//ä½¿ç”¨å¼‚æ­¥ç¼–æ’</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> addressTask <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//å…±äº«ä¸»çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ</span>
            <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">setRequestAttributes</span><span class="token punctuation">(</span>requestAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MemberAddressVo</span><span class="token punctuation">&gt;</span></span> getaddr <span class="token operator">=</span> memberFeignService<span class="token punctuation">.</span><span class="token function">getaddr</span><span class="token punctuation">(</span>memberResVo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            orderConfirmVo<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>getaddr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ°å€</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>å¹‚ç­‰æ€§å¤„ç†</strong>ï¼šé˜²é‡ä»¤ç‰Œ</p> <blockquote><p>é˜²æ­¢å¤šæ¬¡ç‚¹å‡»ã€é¡µé¢é€€å›å†æ¬¡æäº¤ã€ feigné‡è¯•æœºåˆ¶ã€å…¶ä»–ä¸šåŠ¡</p></blockquote> <ul><li>tokenæœºåˆ¶ï¼šè·å–ã€å¯¹æ¯”ã€åˆ é™¤ä»¤ç‰Œï¼ˆåŸå­æ€§ï¼‰redis luaè„šæœ¬</li> <li>å„ç§é”æœºåˆ¶ï¼šï¼ˆæ‚²è§‚é”ã€ä¹è§‚é”|æ•°æ®åº“ï¼‰\ï¼ˆåˆ†å¸ƒå¼é”|ä¸šåŠ¡å±‚ï¼‰</li> <li>å„ç§å”¯ä¸€æœºåˆ¶</li> <li>é˜²æ­¢é‡è¡¨</li> <li>å…¨å±€è¯·æ±‚å”¯ä¸€Id</li></ul> <p><strong>åº“å­˜è§£é”</strong>:</p> <ul><li>ä¸‹å•æˆåŠŸ,è®¢å•è¿‡æœŸæ²¡æœ‰æ”¯ä»˜è¢«ç³»ç»Ÿè‡ªåŠ¨å–æ¶ˆ,è¢«ç”¨æˆ·æ‰‹åŠ¨å–æ¶ˆ,éƒ½éœ€è§£é”åº“å­˜</li> <li>ä¸‹å•è®¢å•æˆåŠŸ,åº“å­˜é”å®šæˆåŠŸ,æ¥ä¸‹æ¥çš„ä¸šåŠ¡è°ƒç”¨å¤±è´¥,å¯¼è‡´è®¢å•å›æ»š,è§£é”åº“å­˜</li></ul> <h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="header-anchor">#</a> äº‹åŠ¡</h3> <h4 id="æœ¬åœ°äº‹åŠ¡"><a href="#æœ¬åœ°äº‹åŠ¡" class="header-anchor">#</a> <strong>æœ¬åœ°äº‹åŠ¡</strong></h4> <p><strong>æ€§è´¨</strong>ï¼šACIDï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰</p> <p><strong>ä½¿ç”¨</strong>ï¼š<code>@Transactional</code>ï¼ˆisolationéš”ç¦»çº§åˆ«ã€propagationä¼ æ’­è¡Œä¸ºï¼‰</p> <p><strong>æœ¬åœ°äº‹åŠ¡å¤±æ•ˆé—®é¢˜</strong>ï¼šåŒä¸€ä¸ªå¯¹è±¡å†…äº‹åŠ¡æ–¹æ³•äº’è°ƒé»˜è®¤å¤±æ•ˆï¼ŒåŸå› ç»•è¿‡äº†ä»£ç†å¯¹è±¡ã€‚ï¼ˆäº‹åŠ¡ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥æ§åˆ¶çš„ï¼‰</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ä»£ç†å¯¹è±¡æ¥è°ƒç”¨äº‹åŠ¡æ–¹æ³• ï¼ˆé»˜è®¤æ˜¯ä½¿ç”¨JDKæŒ‰ç…§æ¥å£åŠ¨æ€ä»£ç†ï¼‰
1. å¼•å…¥aop-starteræ¨¡å—:spring-boot-starter-aop;å¼•å…¥äº†aspectj
2. å¼€å¯åŠ¨æ€ä»£ç†åŠŸèƒ½@EnableAspectJAutoProxyï¼ˆexposeProxy=true)ï¼ˆå¥½å¤„ï¼šä¸éœ€è¦æ¥å£ä¹Ÿèƒ½åˆ›å»ºåŠ¨æ€ä»£ç†ï¼‰
	ï¼ˆexposeProxy=true)ï¼šå¯¹å¤–æš´éœ²ä»£ç†å¯¹è±¡
3. æœ¬ç±»äº’è°ƒç”¨ä»£ç†å¯¹è±¡è°ƒå³å¯
	AopContext.currentProxy() //è°ƒç”¨å³å¯
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡" class="header-anchor">#</a> åˆ†å¸ƒå¼äº‹åŠ¡</h4> <p><strong>CAPå®šç†</strong>ï¼šä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆè¿™ä¸‰ä¸ªåŸç”Ÿæœ€å¤šåªèƒ½åŒæ—¶å®ç°ä¿©ä¸ªï¼Œä¸å¯ä¸‰è€…å…¼é¡¾ï¼‰CP\AP</p> <p><strong>BASEç†è®º</strong>ï¼šåŸºæœ¬å¯ç”¨ã€è½¯çŠ¶æ€ã€æœ€ç»ˆä¸€è‡´æ€§ï¼ˆå¼ºã€å¼±ã€æœ€ç»ˆï¼‰</p> <p><strong>æ–¹æ¡ˆï¼š</strong></p> <ul><li>2PCæ¨¡å¼ï¼šå¼ºä¸€è‡´æ€§ï¼ˆAT è‡ªåŠ¨ï¼‰ä¸é€‚åˆé«˜å¹¶å‘(<strong>åå°</strong>)</li> <li>æŸ”æ€§äº‹åŠ¡-TCCäº‹åŠ¡è¡¥å¿å‹æ–¹æ¡ˆï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰æ‰‹åŠ¨</li> <li>æŸ”æ€§äº‹åŠ¡-æœ€å¤§åŠªåŠ›é€šçŸ¥å‹æ–¹æ¡ˆï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰æ¶ˆæ¯é˜Ÿåˆ—  ï¼ˆé«˜å¹¶å‘ï¼‰</li> <li>æŸ”æ€§äº‹åŠ¡-å¯é æ¶ˆæ¯+æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼ˆå¼‚æ­¥ç¡®ä¿å‹ï¼‰æ¶ˆæ¯é˜Ÿåˆ—   (<strong>é«˜å¹¶å‘</strong>)</li></ul> <p><strong><a href="https://seata.io/zh-cn/" target="_blank" rel="noopener noreferrer">Seata<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong>ï¼šå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</p> <ul><li><p>TC-äº‹åŠ¡åè°ƒè€…</p></li> <li><p>TM-äº‹åŠ¡ç®¡ç†è€…</p></li> <li><p>RM-èµ„æºç®¡ç†è€…</p></li> <li><p>ä½¿ç”¨ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. ç»™æ¯ä¸ªå¾®æœåŠ¡åˆ›å»ºå›æ»šæ—¥å¿—è¡¨
2. å®‰è£…äº‹åŠ¡åè°ƒçš„æœåŠ¡å™¨seata-server è§£å‹å¹¶å¯åŠ¨ æ³¨æ„å¯¹åº”ç‰ˆæœ¬
	 registry.conf å¯é…ç½®æ³¨å†Œä¸­å¿ƒï¼šæ–¹å¼å’Œåœ°å€
	 flie.conf æ˜¯é…ç½®seataçš„é…ç½®ï¼šä¹Ÿå¯ä»¥æ¬å®¶åˆ°nacos
3. å¯¼å…¥ä¾èµ–
	spring-cloud-starter-alibaba-seata :=&gt;seata-all-0.7.1
4. å°†ä¿©ä¸ªé…ç½®æ–‡ä»¶æ”¾ç½®åœ¨resourcesä¸­
	file.conf ä¸­ éœ€è¦é…ç½®service
		vgroup_mapping.æœåŠ¡å-fescar-service-group=&quot;defalut&quot;
5. æ•´åˆåˆ†å¸ƒå¼äº‹åŠ¡çš„æœåŠ¡ éƒ½éœ€è¦é…ç½®ï¼Œä½¿ç”¨seataä½œä¸ºä»£ç†æ•°æ®æº
6ã€ç»™åˆ†å¸ƒå¼å¤§äº‹åŠ¡çš„å…¥å£æ·»åŠ å…¨å±€äº‹åŠ¡ @GlobalTransactional
7. ç»™è¿œç¨‹è°ƒç”¨çš„å°äº‹åŠ¡ç”¨æœ¬åœ°äº‹åŠ¡ @Transactional
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//é…ç½®ä»£ç†æ•°æ®æº</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySeataConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">DataSourceProperties</span> dataSourceProperties<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProperties</span> properties<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">HikariDataSource</span> build <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">initializeDataSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token class-name">HikariDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            build<span class="token punctuation">.</span><span class="token function">setPoolName</span><span class="token punctuation">(</span>properties<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span>  <span class="token keyword">new</span> <span class="token class-name">DataSourceProxy</span><span class="token punctuation">(</span>build<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul> <h3 id="ç§’æ€æœåŠ¡"><a href="#ç§’æ€æœåŠ¡" class="header-anchor">#</a> ç§’æ€æœåŠ¡</h3> <h3 id="è‡ªåŠ¨åŒ–ç›‘æ§"><a href="#è‡ªåŠ¨åŒ–ç›‘æ§" class="header-anchor">#</a> è‡ªåŠ¨åŒ–ç›‘æ§</h3> <p><strong>Sentinel</strong>:é™æµ\ç†”æ–­\é™çº§</p> <ul><li>è‡ªå®šä¹‰å—ä¿æŠ¤èµ„æº</li> <li>ç½‘å…³æµæ§</li> <li>è‡ªå®šä¹‰ç½‘ç»œæµæ§è¿”å›</li></ul> <p><strong>Sleuth</strong>:é“¾è·¯è¿½è¸ª  (zipkin)å¯è§†åŒ–è§‚å¯Ÿ</p></div></div> <div class="page-slot page-slot-bottom"><!-- æ¨ªå‘è‡ªé€‚åº” -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2023/03/22, 21:16:55</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/338272/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">å•†åŸé¡¹ç›®_åŸºç¡€ç¯‡</div></a> <a href="/pages/994b31/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">å•†åŸé¡¹ç›®_è¿ç»´ç¯‡</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/338272/" class="prev">å•†åŸé¡¹ç›®_åŸºç¡€ç¯‡</a></span> <span class="next"><a href="/pages/994b31/">å•†åŸé¡¹ç›®_è¿ç»´ç¯‡</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f53939/"><div>Spring6</div></a> <span>06-18</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ba69ad/"><div>è‹¥ä¾äºŒå¼€</div></a> <span>06-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/998714/"><div>MongoDB</div></a> <span>06-16</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=2461475139&amp;site=qq&amp;menu=yes" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/axcmsm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=6757658477" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2021-2023
    <span>axcmsm | è½¬è½½æ³¨æ˜å‡ºå¤„ </span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">Ã—</i> <div><!-- å›ºå®š160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.e7d9515b.js" defer></script><script src="/assets/js/2.125ae6e8.js" defer></script><script src="/assets/js/105.e9f9588c.js" defer></script>
  </body>
</html>