<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB | 🦏</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="web前端技术博客,简洁至上,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="个人技术博客,后端,大数据,技术文档,学习,js,vue,python,css3,java,javaEE,SpringBoot,Spring,Hadoop,html5,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.546f0649.css" as="style"><link rel="preload" href="/assets/js/app.e7d9515b.js" as="script"><link rel="preload" href="/assets/js/2.125ae6e8.js" as="script"><link rel="preload" href="/assets/js/116.fd44dc61.js" as="script"><link rel="prefetch" href="/assets/js/10.95c2d7b0.js"><link rel="prefetch" href="/assets/js/100.b4e10546.js"><link rel="prefetch" href="/assets/js/101.d6d23fe2.js"><link rel="prefetch" href="/assets/js/102.b368fb26.js"><link rel="prefetch" href="/assets/js/103.b87bfabc.js"><link rel="prefetch" href="/assets/js/104.3d0ae07d.js"><link rel="prefetch" href="/assets/js/105.e9f9588c.js"><link rel="prefetch" href="/assets/js/106.76130cbc.js"><link rel="prefetch" href="/assets/js/107.11dd35ba.js"><link rel="prefetch" href="/assets/js/108.de8bb9b7.js"><link rel="prefetch" href="/assets/js/109.e26f138c.js"><link rel="prefetch" href="/assets/js/11.5682c637.js"><link rel="prefetch" href="/assets/js/110.2c9036b9.js"><link rel="prefetch" href="/assets/js/111.d91b7424.js"><link rel="prefetch" href="/assets/js/112.0edf9093.js"><link rel="prefetch" href="/assets/js/113.dbc0bf4d.js"><link rel="prefetch" href="/assets/js/114.439ad4ee.js"><link rel="prefetch" href="/assets/js/115.0cff9cd8.js"><link rel="prefetch" href="/assets/js/117.e893d264.js"><link rel="prefetch" href="/assets/js/118.ec4b3d32.js"><link rel="prefetch" href="/assets/js/119.ea5c3eba.js"><link rel="prefetch" href="/assets/js/12.5a51d307.js"><link rel="prefetch" href="/assets/js/120.9aaee23f.js"><link rel="prefetch" href="/assets/js/121.4fc7842c.js"><link rel="prefetch" href="/assets/js/122.2b8f75d1.js"><link rel="prefetch" href="/assets/js/123.78dbfead.js"><link rel="prefetch" href="/assets/js/124.84b6382a.js"><link rel="prefetch" href="/assets/js/125.c2a2a818.js"><link rel="prefetch" href="/assets/js/126.83ea2963.js"><link rel="prefetch" href="/assets/js/127.dffd5eae.js"><link rel="prefetch" href="/assets/js/128.bb0a0738.js"><link rel="prefetch" href="/assets/js/129.45a56702.js"><link rel="prefetch" href="/assets/js/13.d1b5b29f.js"><link rel="prefetch" href="/assets/js/130.7fee331a.js"><link rel="prefetch" href="/assets/js/131.6aaa557b.js"><link rel="prefetch" href="/assets/js/132.9526e280.js"><link rel="prefetch" href="/assets/js/133.610c1c84.js"><link rel="prefetch" href="/assets/js/134.1dcf27f7.js"><link rel="prefetch" href="/assets/js/14.83de980a.js"><link rel="prefetch" href="/assets/js/15.0fa06ae1.js"><link rel="prefetch" href="/assets/js/16.d1d3c9c1.js"><link rel="prefetch" href="/assets/js/17.c9772d78.js"><link rel="prefetch" href="/assets/js/18.7cbf0ef4.js"><link rel="prefetch" href="/assets/js/19.66ee7cfc.js"><link rel="prefetch" href="/assets/js/20.8fbb5432.js"><link rel="prefetch" href="/assets/js/21.74a586bf.js"><link rel="prefetch" href="/assets/js/22.f85a2ced.js"><link rel="prefetch" href="/assets/js/23.a65163b5.js"><link rel="prefetch" href="/assets/js/24.5c2898c6.js"><link rel="prefetch" href="/assets/js/25.929f22ff.js"><link rel="prefetch" href="/assets/js/26.20d74c65.js"><link rel="prefetch" href="/assets/js/27.e790af79.js"><link rel="prefetch" href="/assets/js/28.6b84abe6.js"><link rel="prefetch" href="/assets/js/29.acc0fc34.js"><link rel="prefetch" href="/assets/js/3.dd3750e6.js"><link rel="prefetch" href="/assets/js/30.fadb6cbd.js"><link rel="prefetch" href="/assets/js/31.386f82c2.js"><link rel="prefetch" href="/assets/js/32.e934f71c.js"><link rel="prefetch" href="/assets/js/33.684ac64c.js"><link rel="prefetch" href="/assets/js/34.38f8fd76.js"><link rel="prefetch" href="/assets/js/35.3fe27233.js"><link rel="prefetch" href="/assets/js/36.993695b7.js"><link rel="prefetch" href="/assets/js/37.d735018c.js"><link rel="prefetch" href="/assets/js/38.0d23a384.js"><link rel="prefetch" href="/assets/js/39.808de65c.js"><link rel="prefetch" href="/assets/js/4.4a137b18.js"><link rel="prefetch" href="/assets/js/40.2fc7d5f7.js"><link rel="prefetch" href="/assets/js/41.6647cff7.js"><link rel="prefetch" href="/assets/js/42.f4d93aa6.js"><link rel="prefetch" href="/assets/js/43.a5d40107.js"><link rel="prefetch" href="/assets/js/44.3ae864d3.js"><link rel="prefetch" href="/assets/js/45.c66f1afe.js"><link rel="prefetch" href="/assets/js/46.750f2be2.js"><link rel="prefetch" href="/assets/js/47.1722c1b9.js"><link rel="prefetch" href="/assets/js/48.7c8df7cc.js"><link rel="prefetch" href="/assets/js/49.f9b58d70.js"><link rel="prefetch" href="/assets/js/5.51ca929a.js"><link rel="prefetch" href="/assets/js/50.fad73ad9.js"><link rel="prefetch" href="/assets/js/51.b88c6213.js"><link rel="prefetch" href="/assets/js/52.21244293.js"><link rel="prefetch" href="/assets/js/53.1c2189f3.js"><link rel="prefetch" href="/assets/js/54.95ba12bc.js"><link rel="prefetch" href="/assets/js/55.d8f79989.js"><link rel="prefetch" href="/assets/js/56.63c36b2d.js"><link rel="prefetch" href="/assets/js/57.270857ec.js"><link rel="prefetch" href="/assets/js/58.156073cc.js"><link rel="prefetch" href="/assets/js/59.5a300643.js"><link rel="prefetch" href="/assets/js/6.2dccf462.js"><link rel="prefetch" href="/assets/js/60.92f4ce87.js"><link rel="prefetch" href="/assets/js/61.0f312cea.js"><link rel="prefetch" href="/assets/js/62.0c55901b.js"><link rel="prefetch" href="/assets/js/63.613b1add.js"><link rel="prefetch" href="/assets/js/64.1e5070b6.js"><link rel="prefetch" href="/assets/js/65.dc215238.js"><link rel="prefetch" href="/assets/js/66.4a1319e4.js"><link rel="prefetch" href="/assets/js/67.841428fe.js"><link rel="prefetch" href="/assets/js/68.7380e054.js"><link rel="prefetch" href="/assets/js/69.0a503182.js"><link rel="prefetch" href="/assets/js/7.1096b6fa.js"><link rel="prefetch" href="/assets/js/70.09f4c416.js"><link rel="prefetch" href="/assets/js/71.a279d635.js"><link rel="prefetch" href="/assets/js/72.057aa49f.js"><link rel="prefetch" href="/assets/js/73.767f542c.js"><link rel="prefetch" href="/assets/js/74.3eb6f7e5.js"><link rel="prefetch" href="/assets/js/75.50ecd31e.js"><link rel="prefetch" href="/assets/js/76.602f67fb.js"><link rel="prefetch" href="/assets/js/77.3b5a8e7d.js"><link rel="prefetch" href="/assets/js/78.40c6990e.js"><link rel="prefetch" href="/assets/js/79.ecb155e0.js"><link rel="prefetch" href="/assets/js/8.4b82b135.js"><link rel="prefetch" href="/assets/js/80.d7279b34.js"><link rel="prefetch" href="/assets/js/81.f58f78af.js"><link rel="prefetch" href="/assets/js/82.8399bcab.js"><link rel="prefetch" href="/assets/js/83.67c3c861.js"><link rel="prefetch" href="/assets/js/84.5a8f7c4b.js"><link rel="prefetch" href="/assets/js/85.c6f0af81.js"><link rel="prefetch" href="/assets/js/86.f9f3d0b8.js"><link rel="prefetch" href="/assets/js/87.fec83ae4.js"><link rel="prefetch" href="/assets/js/88.ca11e236.js"><link rel="prefetch" href="/assets/js/89.ae243724.js"><link rel="prefetch" href="/assets/js/9.b8d3ed93.js"><link rel="prefetch" href="/assets/js/90.c242e238.js"><link rel="prefetch" href="/assets/js/91.ad0080a6.js"><link rel="prefetch" href="/assets/js/92.a435d70c.js"><link rel="prefetch" href="/assets/js/93.3232bfbf.js"><link rel="prefetch" href="/assets/js/94.6101d03c.js"><link rel="prefetch" href="/assets/js/95.8c95af7a.js"><link rel="prefetch" href="/assets/js/96.a582908e.js"><link rel="prefetch" href="/assets/js/97.1b560b4f.js"><link rel="prefetch" href="/assets/js/98.a686266f.js"><link rel="prefetch" href="/assets/js/99.e03a81a9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.546f0649.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.ico" alt="🦏" class="logo"> <span class="site-name can-hide">🦏</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Big数据" class="dropdown-title"><a href="/BigData/" class="link-title">Big数据</a> <span class="title" style="display:none;">Big数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>大数据路线</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">开发路线</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linux导图</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">《Linux》</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">《Hadoop》</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">《生态圈组件》</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">《消息队列》</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">《spark》</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" class="nav-link">《flink》</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">技术栈🎈</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⛳🖥" class="dropdown-title"><a href="/technology/" class="link-title">⛳🖥</a> <span class="title" style="display:none;">⛳🖥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">计算机必备</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">数学基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">本站关联</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/zzx.jpg"> <div class="blogger-info"><h3>Axcmsm🐼</h3> <span>纵有疾风起，人生不言弃🐅</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Big数据" class="dropdown-title"><a href="/BigData/" class="link-title">Big数据</a> <span class="title" style="display:none;">Big数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>大数据路线</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">开发路线</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linux导图</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">《Linux》</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">《Hadoop》</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">《生态圈组件》</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">《消息队列》</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">《spark》</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" class="nav-link">《flink》</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">技术栈🎈</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="⛳🖥" class="dropdown-title"><a href="/technology/" class="link-title">⛳🖥</a> <span class="title" style="display:none;">⛳🖥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">计算机必备</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">数学基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">本站关联</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JAVA</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/338272/" class="sidebar-link">商城项目_基础篇</a></li><li><a href="/pages/869230/" class="sidebar-link">商城项目_高级篇</a></li><li><a href="/pages/994b31/" class="sidebar-link">商城项目_运维篇</a></li><li><a href="/pages/8df937/" class="sidebar-link">Docker入门🐑</a></li><li><a href="/pages/55c6c0/" class="sidebar-link">内网穿透</a></li><li><a href="/pages/ca8614/" class="sidebar-link">ElasticSearch使用</a></li><li><a href="/pages/a40f9d/" class="sidebar-link">spring Data基本操作</a></li><li><a href="/pages/3cdc51/" class="sidebar-link">JAVA工具类</a></li><li><a href="/pages/3534a6/" class="sidebar-link">MybatisPlus使用</a></li><li><a href="/pages/377cfd/" class="sidebar-link">Spring入门</a></li><li><a href="/pages/13efac/" class="sidebar-link">SpringBoot配置多数据源</a></li><li><a href="/pages/546e04/" class="sidebar-link">设计模式</a></li><li><a href="/pages/998714/" aria-current="page" class="active sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/998714/#一、mongodb" class="sidebar-link">一、MongoDB</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#二、概念" class="sidebar-link">二、概念</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#三、部署" class="sidebar-link">三、部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/998714/#window部署" class="sidebar-link">Window部署</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#linux部署" class="sidebar-link">Linux部署</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#docker部署" class="sidebar-link">docker部署</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#远程连接" class="sidebar-link">远程连接</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/998714/#四、基本操作" class="sidebar-link">四、基本操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/998714/#库操作" class="sidebar-link">库操作</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#集合操作" class="sidebar-link">集合操作</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#文档操作" class="sidebar-link">文档操作</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#文档查询" class="sidebar-link">文档查询</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#常用命令小结" class="sidebar-link">常用命令小结</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/998714/#五、索引" class="sidebar-link">五、索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/998714/#类型" class="sidebar-link">类型</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#管理" class="sidebar-link">管理</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#使用" class="sidebar-link">使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/998714/#六、springboot整合" class="sidebar-link">六、SpringBoot整合</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#七、集群" class="sidebar-link">七、集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/998714/#副本集群" class="sidebar-link">副本集群</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#分片集群" class="sidebar-link">分片集群</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/998714/#八、安全认证" class="sidebar-link">八、安全认证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/998714/#单实例环境" class="sidebar-link">单实例环境</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#副本环境" class="sidebar-link">副本环境</a></li><li class="sidebar-sub-header"><a href="/pages/998714/#分片环境" class="sidebar-link">分片环境</a></li></ul></li></ul></li><li><a href="/pages/ba69ad/" class="sidebar-link">若依二开</a></li><li><a href="/pages/f53939/" class="sidebar-link">Spring6</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>日常操作</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/TechnologyStack" title="技术栈-目录页" data-v-1cd794fe>技术栈</a></li> <li data-v-1cd794fe><a href="/TechnologyStack/#JAVA" title="技术栈#JAVA" data-v-1cd794fe>JAVA</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/axcmsm" target="_blank" title="作者" class="beLink" data-v-1cd794fe>axcmsm</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2023-06-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="/img/bj3.jpg">
          MongoDB
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="一、mongodb"><a href="#一、mongodb" class="header-anchor">#</a> 一、MongoDB</h2> <p><strong>官网</strong>：<a href="https://www.mongodb.com" target="_blank" rel="noopener noreferrer">https://www.mongodb.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>简介</strong>：NoSQL数据库，开源、高性能、无模式的文档型数据库。</p> <p><strong>特点</strong>：<strong>高性能</strong>、<strong>高可用性</strong>、<strong>高扩展性</strong>、<strong>丰富的查询支持等</strong></p> <p><strong>场景</strong>：</p> <blockquote><p>解决高并发读写、高效存储与访问、高可用和扩展性等三高问题而出现的。</p> <p>具体场景有：社交、游戏、物流、文章、物联网、视频直播等场景。</p> <p>共同的特点：</p> <ul><li>数据量大</li> <li>写入操作频繁（读写都频繁）</li> <li>价值较低的数据，对事务要求不高</li></ul></blockquote> <h2 id="二、概念"><a href="#二、概念" class="header-anchor">#</a> 二、概念</h2> <blockquote><p>库(database)、集合/表(collection)、文档/行(document)、字段/域(fifield)、索引(index)、主键(_id)、嵌入式文档(替代join查询)</p></blockquote> <p>MongoDB的最小存储单位就是文档(document)对象。文档(document)对象对应于关系型数据库的行。数据在MongoDB中以BSON（Binary-JSON）文档的格式存储在磁盘上。BSON（Binary Serialized Document Format）是一种类json的一种二进制形式的存储格式，简称Binary JSON。BSON和JSON一样，支持内嵌的文档对象和数组对象，但是BSON有JSON没有的一些数据类型，如Date和BinData类型。</p> <p>BSON采用了类似于 C 语言结构体的名称、对表示方法，支持内嵌的文档对象和数组对象，具有轻量性、可遍历性、高效性的三个特点，可以有效描述非结构化数据和结构化数据。这种格式的优点是灵活性高，但它的缺点是空间利用率不是很理想。Bson中，除了基本的JSON类型：string,integer,boolean,double,null,array和object，mongo还使用了特殊的数据类型。这些类型包括date,object id,binary data,regular expression 和code。每一个驱动都以特定语言的方式实现了这些类型，查看你的驱动的文档来获取详细信息。</p> <p><strong>BSON数据类型参考列表</strong>：</p> <table><thead><tr><th><strong>数据类型</strong></th> <th><strong>描述</strong></th> <th><strong>举例</strong></th></tr></thead> <tbody><tr><td>字符串</td> <td>UTF-8字符串都可表示为字符串类型的数据</td> <td>{&quot;x&quot; : &quot;foobar&quot;}</td></tr> <tr><td>对象id</td> <td>对象id是文档的12字节的唯一 ID</td> <td>{&quot;X&quot; :ObjectId() }</td></tr> <tr><td>布尔值</td> <td>真或者假：true或者false</td> <td>{&quot;x&quot;:true}+</td></tr> <tr><td>数组</td> <td>值的集合或者列表可以表示成数组</td> <td>{&quot;x&quot; ： [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]}</td></tr> <tr><td>32位整数</td> <td>类型不可用。JavaScript仅支持64位浮点数，所以32位整数会被</td> <td>shell是不支持该类型的，shell中默认会转换成64</td></tr> <tr><td>64位整数</td> <td>不支持这个类型。shell会使用一个特殊的内嵌文档来显示64位</td> <td>shell是不支持该类型的，shell中默认会转换成64</td></tr> <tr><td>64位浮点数</td> <td>shell中的数字就是这一种类型</td> <td>{&quot;x&quot;：3.14159，&quot;y&quot;：3}</td></tr> <tr><td>null</td> <td>表示空值或者未定义的对象</td> <td>{&quot;x&quot;:null}</td></tr> <tr><td>undefifined</td> <td>文档中也可以使用未定义类型</td> <td>{&quot;x&quot;:undefifined}</td></tr> <tr><td>符号</td> <td>shell不支持，shell会将数据库中的符号类型的数据自动转换成</td> <td></td></tr> <tr><td>正则表达式</td> <td>文档中可以包含正则表达式，采用JavaScript的正则表达式语法</td> <td>{&quot;x&quot; ： /foobar/i}</td></tr> <tr><td>代码</td> <td>文档中还可以包含JavaScript代码</td> <td>{&quot;x&quot; ： function() { /* …… */ }}</td></tr> <tr><td>二进制数据</td> <td>二进制数据可以由任意字节的串组成，不过shell中无法使用</td> <td></td></tr> <tr><td>最大/最小值</td> <td>BSON包括一个特殊类型，表示可能的最大值。shell中没有这个</td> <td></td></tr></tbody></table> <p><strong>提示</strong>：shell默认使用64位浮点型数值。{“x”：3.14}或{“x”：3}。对于整型值，可以使用NumberInt（4字节符号整数）或NumberLong（8字节符号整数），{“x”:NumberInt(“3”)}{“x”:NumberLong(“3”)}</p> <h2 id="三、部署"><a href="#三、部署" class="header-anchor">#</a> 三、部署</h2> <h3 id="window部署"><a href="#window部署" class="header-anchor">#</a> Window部署</h3> <p><strong>第一步</strong>：下载安装包</p> <p>MongoDB 提供了可用于 32 位和 64 位系统的预编译二进制包，你可以从MongoDB官网下载安装，MongoDB 预编译二进制包下载地址：</p> <p><a href="https://www.mongodb.com/try/download/enterprise" target="_blank" rel="noopener noreferrer">MongoDB Enterprise Server Download | MongoDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>提示：</p> <p>版本的选择：MongoDB的版本命名规范如：x.y.z；</p> <p>y为奇数时表示当前版本为开发版，如：1.5.2、4.1.13；</p> <p>y为偶数时表示当前版本为稳定版，如：1.6.3、4.0.10；</p> <p>z是修正版本号，数字越大越好。</p> <p>详情：http://docs.mongodb.org/manual/release-notes/#release-version-numbers</p> <p><strong>第二步</strong>：解压安装启动</p> <p>将压缩包解压到一个目录中。</p> <p>在解压目录中，手动建立一个目录用于存放数据文件，如 data/db</p> <p>方式1：命令行参数方式启动服务</p> <p>在 bin 目录中打开命令行提示符，输入如下命令：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>mongod --dbpath<span class="token operator">=</span><span class="token punctuation">..</span><span class="token punctuation">\</span>data<span class="token punctuation">\</span>db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们在启动信息中可以看到，mongoDB的默认端口是27017，如果我们想改变默认的启动端口，可以通过--port来指定端口。</p> <p>为了方便我们每次启动，可以将安装目录的bin目录设置到环境变量的path中， bin 目录下是一些常用命令，比如 mongod 启动服务用的，</p> <p>mongo 客户端连接服务用的。</p> <p>方式2：配置文件方式启动服务</p> <p>在解压目录中新建 config 文件夹，该文件夹中新建配置文件 mongod.conf ，内如参考如下：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>storage:
	<span class="token comment">#The directory where the mongod instance stores its data.Default Value is &quot;\data\db&quot; on Windows.</span>
	dbPath: D:<span class="token punctuation">\</span>02_Server<span class="token punctuation">\</span>DBServer<span class="token punctuation">\</span>mongodb-win32-x86_64-2008plus-ssl-4.0.1<span class="token punctuation">\</span>data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>详细配置项内容可以参考官方文档：https://docs.mongodb.com/manual/reference/confifiguration-options/</p> <p>【注意】</p> <p>1）配置文件中如果使用双引号，比如路径地址，自动会将双引号的内容转义。如果不转义，则会报错：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>error-parsing-yaml-config-file-yaml-cpp-error-at-line-3-column-15-unknown-escape-character-d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>解决：</p> <p>a. 对 \ 换成 / 或 \</p> <p>b. 如果路径中没有空格，则无需加引号。</p> <p>2）配置文件中不能以Tab分割字段</p> <p>解决：</p> <p>将其转换成空格。</p> <p>启动方式:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>mongod -f <span class="token punctuation">..</span>/config/mongod.conf
或
mongod --config <span class="token punctuation">..</span>/config/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>更多参数配置：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#The path of the log file to which mongod or mongos should send all diagnostic logging information</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;D:/02_Server/DBServer/mongodb-win32-x86_64-2008plus-ssl-4.0.1/log/mongod.log&quot;</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
		<span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#The directory where the mongod instance stores its data.Default Value is &quot;/data/db&quot;.</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;D:/02_Server/DBServer/mongodb-win32-x86_64-2008plus-ssl-4.0.1/data&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#bindIp: 127.0.0.1</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
<span class="token key atrule">setParameter</span><span class="token punctuation">:</span>
    <span class="token key atrule">enableLocalhostAuthBypass</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="linux部署"><a href="#linux部署" class="header-anchor">#</a> Linux部署</h3> <ol><li><p>解压改名</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#解压</span>
<span class="token function">tar</span> -zxvf mongodb-linux-x86_64-4.0.10.tgz
<span class="token comment">#改名</span>
<span class="token function">mv</span> mongodb-linux-x86_64-4.0.10 mongodb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>新建目录，存储数据和日志：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#数据存储目录</span>
<span class="token function">mkdir</span> -p /mongodb/single/data/db
<span class="token comment">#日志存储目录</span>
<span class="token function">mkdir</span> -p /mongodb/single/log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>新建并修改配置文件</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vi</span> /mongodb/single/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token comment"># #The path of the log file to which mongod or mongos should send all diagnostic logging information</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/single/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token comment">##The directory where the mongod instance stores its data.Default Value is &quot;/data/db&quot;.</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/single/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定的IP，默认是localhost</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.64.2
    <span class="token comment">#bindIp</span>
    <span class="token comment">#绑定的端口，默认是27017</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li> <li><p>配置环境变量(可选)</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#MONGO_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MONGO_HOME</span><span class="token operator">=</span>/opt/module/mongodb
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$MONGO_HOME</span>/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>启动MongoDB服务</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>mongod -f /mongodb/single/mongod.conf 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># ps -ef |grep mongod</span>
root       <span class="token number">5808</span>      <span class="token number">1</span>  <span class="token number">2</span> <span class="token number">23</span>:04 ?        00:00:00 mongod -f /mongodb/single/mongod.conf
root       <span class="token number">5860</span>   <span class="token number">5721</span>  <span class="token number">0</span> <span class="token number">23</span>:04 pts/0    00:00:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto mongod
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>分别使用mongo命令和navicat工具来连接测试。</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#查看防火墙状态</span>
systemctl status firewalld
<span class="token comment">#临时关闭防火墙</span>
systemctl stop firewalld
<span class="token comment">#开机禁止启动防火墙</span>
systemctl disable firewalld
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>停止关闭服务</p> <ul><li><p>快速关闭方法（快速，简单，数据可能会出错）</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#通过进程编号关闭节点</span>
<span class="token function">kill</span> -2 <span class="token number">5808</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>如果一旦是因为数据损坏，则需要进行如下操作（了解）：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 删除lock文件</span>
<span class="token function">rm</span> -f /mongodb/single/data/db/*.lock
<span class="token comment"># 修复数据</span>
/usr/local/mongdb/bin/mongod --repair --dbpath<span class="token operator">=</span>/mongodb/single/data/db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></blockquote></li> <li><p>标准的关闭方法（数据不容易出错，但麻烦）：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>//客户端登录服务，注意，这里通过localhost登录，如果需要远程登录，必须先登录认证才行。
mongo --port <span class="token number">27017</span>
//<span class="token comment">#切换到admin库</span>
use admin
//关闭服务
db.shutdownServer<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li></ol> <h3 id="docker部署"><a href="#docker部署" class="header-anchor">#</a> docker部署</h3> <ol><li><p>拉取镜像</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker pull mongo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>启动容器</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker run --name mymongo -d -p <span class="token number">27017</span>:27017 mongo:latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>docker <span class="token function">ps</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>测试</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 进入容器</span>
docker <span class="token builtin class-name">exec</span> -it mymongo /bin/bash
<span class="token comment"># 进入客户端</span>
mongo
<span class="token comment"># 查看数据库</span>
show dbs<span class="token punctuation">;</span>
<span class="token comment"># 退出</span>
<span class="token builtin class-name">exit</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol> <h3 id="远程连接"><a href="#远程连接" class="header-anchor">#</a> 远程连接</h3> <ul><li><p>在命令提示符输入以下shell命令即可完成登陆</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>mongo
或
mongo --host<span class="token operator">=</span><span class="token number">127.0</span>.0.1 --port<span class="token operator">=</span><span class="token number">27017</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>查看已经有的数据库</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token operator">&gt;</span>show databases
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>退出mongodb</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">exit</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>更多参数可以通过帮助查看：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>mongo --help
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p><strong>提示</strong>：MongoDB javascript shell是一个基于javascript的解释器，故是支持js程序的。</p> <h2 id="四、基本操作"><a href="#四、基本操作" class="header-anchor">#</a> 四、基本操作</h2> <h3 id="库操作"><a href="#库操作" class="header-anchor">#</a> <strong>库操作</strong></h3> <ul><li><p><strong>选择与创建</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 选择和创建数据库的语法格式：</span>
<span class="token keyword">use</span> 数据库名称

<span class="token comment"># 如果数据库不存在则自动创建，例如，以下语句创建 spitdb 数据库：</span>
<span class="token keyword">use</span> articledb

<span class="token comment"># 查看有权限查看的所有的数据库命令</span>
<span class="token keyword">show</span> dbs
或
<span class="token keyword">show</span> <span class="token keyword">databases</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p><strong>注意:</strong> 在 MongoDB 中，集合只有在内容插入后才会创建! 就是说，创建集合(数据表)后要再插入一个文档(记录)，集合才会真正创建。</p></blockquote></li> <li><p><strong>查看当前库</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>db
<span class="token comment"># MongoDB 中默认的数据库为 test，如果你没有选择数据库，集合将存放在 test 数据库中。</span>

admin： 从权限的角度来看，这是<span class="token string">&quot;root&quot;</span>数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特
定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。
local: 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合
config: 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><strong>数据库的删除</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># MongoDB 删除数据库的语法格式如下：</span>
db<span class="token punctuation">.</span>dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 提示：主要用来删除已经持久化的数据库</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <h3 id="集合操作"><a href="#集合操作" class="header-anchor">#</a> 集合操作</h3> <ul><li><p><strong>创建与查看</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 基本语法格式： 的显式创建</span>
db<span class="token punctuation">.</span>createCollection<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token comment"># 例：创建一个名为 mycollection 的普通集合。</span>
db<span class="token punctuation">.</span>createCollection<span class="token punctuation">(</span><span class="token string">&quot;mycollection&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># 查看表</span>
<span class="token keyword">show</span> collections
或
<span class="token keyword">show</span> <span class="token keyword">tables</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><strong>删除</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 集合删除语法格式如下：</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token keyword">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
或
db<span class="token punctuation">.</span>集合<span class="token punctuation">.</span><span class="token keyword">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 如果成功删除选定集合，则 drop() 方法返回 true，否则返回 false。</span>
<span class="token comment"># 例如：要删除mycollection集合</span>
db<span class="token punctuation">.</span>mycollection<span class="token punctuation">.</span><span class="token keyword">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <h3 id="文档操作"><a href="#文档操作" class="header-anchor">#</a> 文档操作</h3> <blockquote><p>文档（document）的数据结构和 JSON 基本一样。所有存储在集合中的数据都是 BSON 格式。</p></blockquote> <h4 id="单个文档插入"><a href="#单个文档插入" class="header-anchor">#</a> 单个文档插入</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 格式</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>
<span class="token operator">&lt;</span>document <span class="token operator">or</span> array <span class="token keyword">of</span> documents<span class="token operator">&gt;</span><span class="token punctuation">,</span>
{
writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span><span class="token punctuation">,</span>
ordered: <span class="token operator">&lt;</span><span class="token keyword">boolean</span><span class="token operator">&gt;</span>
}
<span class="token punctuation">)</span>
<span class="token comment"># 示例</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>{<span class="token string">&quot;articleid&quot;</span>:<span class="token string">&quot;100000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span>:<span class="token string">&quot;今天天气真好，阳光明
媚&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userid&quot;</span>:<span class="token string">&quot;1001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;nickname&quot;</span>:<span class="token string">&quot;Rose&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;createdatetime&quot;</span>:new <span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;likenum&quot;</span>:NumberInt<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;state&quot;</span>:<span class="token boolean">null</span>}<span class="token punctuation">)</span>

<span class="token comment"># 提示：</span>
<span class="token number">1</span>）<span class="token keyword">comment</span>集合如果不存在，则会隐式创建
<span class="token number">2</span>）mongo中的数字，默认情况下是<span class="token keyword">double</span>类型，如果要存整型，必须使用函数NumberInt<span class="token punctuation">(</span>整型数字<span class="token punctuation">)</span>，否则取出来就有问题了。
<span class="token number">3</span>）插入当前日期使用 new <span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">4</span>）插入的数据没有指定 _id ，会自动生成主键值
<span class="token number">5</span>）如果某字段没值，可以赋值为<span class="token boolean">null</span>，或不写该字段。

<span class="token comment"># 返回值 插入成功</span>
WriteResult<span class="token punctuation">(</span>{ <span class="token string">&quot;nInserted&quot;</span> : <span class="token number">1</span> }<span class="token punctuation">)</span>

<span class="token comment"># 注意：(文档键命名规范)</span>
<span class="token number">1.</span> 文档中的键<span class="token operator">/</span>值对是有序的。
<span class="token number">2.</span> 文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档<span class="token punctuation">)</span>。
<span class="token number">3.</span> MongoDB区分类型和大小写。
<span class="token number">4.</span> MongoDB的文档不能有重复的键。
<span class="token number">5.</span> 文档的键是字符串。除了少数例外情况，键可以使用任意UTF<span class="token operator">-</span><span class="token number">8</span>字符。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="批量插入"><a href="#批量插入" class="header-anchor">#</a> 批量插入</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 语法：</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>insertMany<span class="token punctuation">(</span>
<span class="token punctuation">[</span> <span class="token operator">&lt;</span>document <span class="token number">1</span><span class="token operator">&gt;</span> <span class="token punctuation">,</span> <span class="token operator">&lt;</span>document <span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
{
writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span><span class="token punctuation">,</span>
ordered: <span class="token operator">&lt;</span><span class="token keyword">boolean</span><span class="token operator">&gt;</span>
}
<span class="token punctuation">)</span>

<span class="token comment"># 案例：</span>
try {
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>insertMany<span class="token punctuation">(</span><span class="token punctuation">[</span>
{<span class="token string">&quot;_id&quot;</span>:<span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;articleid&quot;</span>:<span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span>:<span class="token string">&quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我
他。&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userid&quot;</span>:<span class="token string">&quot;1002&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;nickname&quot;</span>:<span class="token string">&quot;相忘于江湖&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;createdatetime&quot;</span>:new <span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token string">&quot;2019-08-
05T22:08:15.522Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;likenum&quot;</span>:NumberInt<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;state&quot;</span>:<span class="token string">&quot;1&quot;</span>}<span class="token punctuation">,</span>
{<span class="token string">&quot;_id&quot;</span>:<span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;articleid&quot;</span>:<span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span>:<span class="token string">&quot;我夏天空腹喝凉开水，冬天喝温开水&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userid&quot;</span>:<span class="token string">&quot;1005&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;nickname&quot;</span>:<span class="token string">&quot;伊人憔
悴&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;createdatetime&quot;</span>:new <span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token string">&quot;2019-08-05T23:58:51.485Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;likenum&quot;</span>:NumberInt<span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;state&quot;</span>:<span class="token string">&quot;1&quot;</span>}<span class="token punctuation">,</span>
{<span class="token string">&quot;_id&quot;</span>:<span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;articleid&quot;</span>:<span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span>:<span class="token string">&quot;我一直喝凉开水，冬天夏天都喝。&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userid&quot;</span>:<span class="token string">&quot;1004&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;nickname&quot;</span>:<span class="token string">&quot;杰克船
长&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;createdatetime&quot;</span>:new <span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token string">&quot;2019-08-06T01:05:06.321Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;likenum&quot;</span>:NumberInt<span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;state&quot;</span>:<span class="token string">&quot;1&quot;</span>}<span class="token punctuation">,</span>
{<span class="token string">&quot;_id&quot;</span>:<span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;articleid&quot;</span>:<span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span>:<span class="token string">&quot;专家说不能空腹吃饭，影响健康。&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userid&quot;</span>:<span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;nickname&quot;</span>:<span class="token string">&quot;凯
撒&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;createdatetime&quot;</span>:new <span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token string">&quot;2019-08-06T08:18:35.288Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;likenum&quot;</span>:NumberInt<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;state&quot;</span>:<span class="token string">&quot;1&quot;</span>}<span class="token punctuation">,</span>
{<span class="token string">&quot;_id&quot;</span>:<span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;articleid&quot;</span>:<span class="token string">&quot;100001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span>:<span class="token string">&quot;研究表明，刚烧开的水千万不能喝，因为烫
嘴。&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;userid&quot;</span>:<span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;nickname&quot;</span>:<span class="token string">&quot;凯撒&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;createdatetime&quot;</span>:new <span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token string">&quot;2019-08-
06T11:01:02.521Z&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;likenum&quot;</span>:NumberInt<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;state&quot;</span>:<span class="token string">&quot;1&quot;</span>}
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
} catch <span class="token punctuation">(</span>e<span class="token punctuation">)</span> {
<span class="token keyword">print</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
}
<span class="token comment"># 提示：</span>
插入时指定了 _id ，则主键就是该值。
如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉。
因为批量插入由于数据较多容易出现失败，因此，可以使用try catch进行异常捕捉处理，测试的时候可以不处理。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="文档更新"><a href="#文档更新" class="header-anchor">#</a> 文档更新</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 更新文档的语法：</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token keyword">update</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token comment">//或</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>
<span class="token operator">&lt;</span>query<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token operator">&lt;</span><span class="token keyword">update</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
{
upsert: <span class="token operator">&lt;</span><span class="token keyword">boolean</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
multi: <span class="token operator">&lt;</span><span class="token keyword">boolean</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span><span class="token punctuation">,</span>
collation: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span><span class="token punctuation">,</span>
arrayFilters: <span class="token punctuation">[</span> <span class="token operator">&lt;</span>filterdocument1<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
hint: <span class="token operator">&lt;</span>document<span class="token operator">|</span>string<span class="token operator">&gt;</span> <span class="token comment">// Available starting in MongoDB 4.2</span>
}
<span class="token punctuation">)</span>
<span class="token comment"># 提示：主要关注前四个参数即可.</span>
<span class="token comment"># 案例1(覆盖的修改)：如果我们想修改_id为1的记录，点赞量为1001，输入以下语句：</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>{_id:<span class="token string">&quot;1&quot;</span>}<span class="token punctuation">,</span>{likenum:NumberInt<span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span>}<span class="token punctuation">)</span>

<span class="token comment"># 案例2(局部修改)：为了解决这个问题，我们需要使用修改器$set来实现，命令如下：</span>
<span class="token comment"># 我们想修改_id为2的记录，浏览量为889，输入以下语句：</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>{_id:<span class="token string">&quot;2&quot;</span>}<span class="token punctuation">,</span>{$<span class="token keyword">set</span>:{likenum:NumberInt<span class="token punctuation">(</span><span class="token number">889</span><span class="token punctuation">)</span>}}<span class="token punctuation">)</span>

<span class="token comment"># 案例3(批量的修改)：更新所有用户为 1003 的用户的昵称为 凯撒大帝</span>
<span class="token comment"># 默认只修改第一条数据</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>{userid:<span class="token string">&quot;1003&quot;</span>}<span class="token punctuation">,</span>{$<span class="token keyword">set</span>:{nickname:<span class="token string">&quot;凯撒2&quot;</span>}}<span class="token punctuation">)</span>
<span class="token comment"># 修改所有符合条件的数据</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>{userid:<span class="token string">&quot;1003&quot;</span>}<span class="token punctuation">,</span>{$<span class="token keyword">set</span>:{nickname:<span class="token string">&quot;凯撒大帝&quot;</span>}}<span class="token punctuation">,</span>{multi:<span class="token boolean">true</span>}<span class="token punctuation">)</span>


<span class="token comment"># 案例4(列值增长的修改)：如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用 $inc 运算符来实现。</span>
<span class="token comment"># 需求：对3号数据的点赞数，每次递增1</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>{_id:<span class="token string">&quot;3&quot;</span>}<span class="token punctuation">,</span>{$inc:{likenum:NumberInt<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>}}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="删除文档"><a href="#删除文档" class="header-anchor">#</a> <strong>删除文档</strong></h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 删除文档的语法结构：</span>
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>条件<span class="token punctuation">)</span>
<span class="token comment"># 以下语句可以将数据全部删除，请慎用</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>{}<span class="token punctuation">)</span>
<span class="token comment"># 如果删除_id=1的记录，输入以下语句</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>{_id:<span class="token string">&quot;1&quot;</span>}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="文档查询"><a href="#文档查询" class="header-anchor">#</a> 文档查询</h3> <h4 id="基本查询"><a href="#基本查询" class="header-anchor">#</a> 基本查询</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 查询数据的语法格式如下：</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token operator">&lt;</span>query<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>projection<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 【示例】</span>
<span class="token number">1.</span> 查询所有
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span>
或
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{}<span class="token punctuation">)</span>

<span class="token number">2.</span> 条件查询所有
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{userid:<span class="token string">'1003'</span>}<span class="token punctuation">)</span>

<span class="token number">3.</span> 条件查询第一条
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>findOne<span class="token punctuation">(</span>{userid:<span class="token string">'1003'</span>}<span class="token punctuation">)</span>

<span class="token number">4.</span> 投影查询（Projection Query）：如果要查询结果返回部分字段，则需要使用投影查询，默认 _id 会显示。
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{userid:<span class="token string">&quot;1003&quot;</span>}<span class="token punctuation">,</span>{userid:<span class="token number">1</span><span class="token punctuation">,</span>nickname:<span class="token number">1</span>}<span class="token punctuation">)</span>
{ <span class="token string">&quot;_id&quot;</span> : <span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;userid&quot;</span> : <span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nickname&quot;</span> : <span class="token string">&quot;凯撒&quot;</span> }
{ <span class="token string">&quot;_id&quot;</span> : <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;userid&quot;</span> : <span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nickname&quot;</span> : <span class="token string">&quot;凯撒&quot;</span> }
<span class="token comment"># 不显示id</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{userid:<span class="token string">&quot;1003&quot;</span>}<span class="token punctuation">,</span>{userid:<span class="token number">1</span><span class="token punctuation">,</span>nickname:<span class="token number">1</span><span class="token punctuation">,</span>_id:<span class="token number">0</span>}<span class="token punctuation">)</span>
{ <span class="token string">&quot;userid&quot;</span> : <span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nickname&quot;</span> : <span class="token string">&quot;凯撒&quot;</span> }
{ <span class="token string">&quot;userid&quot;</span> : <span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nickname&quot;</span> : <span class="token string">&quot;凯撒&quot;</span> }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="统计查询"><a href="#统计查询" class="header-anchor">#</a> 统计查询</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 统计查询使用count()方法，语法如下：</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token comment"># 【示例】</span>
<span class="token number">1.</span> 统计所有记录数：
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token number">2.</span> 按条件统计记录数
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>{userid:<span class="token string">&quot;1003&quot;</span>}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="分页查询"><a href="#分页查询" class="header-anchor">#</a> 分页查询</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 可以使用limit()方法来读取指定数量的数据，使用skip()方法来跳过指定数量的数据。</span>
<span class="token comment"># 语法如下所示：</span>
db<span class="token punctuation">.</span>COLLECTION_NAME<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">limit</span><span class="token punctuation">(</span>NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>skip<span class="token punctuation">(</span>NUMBER<span class="token punctuation">)</span>

<span class="token comment"># 案例</span>
<span class="token number">1.</span> 如果你想返回指定条数的记录，可以在find方法后调用<span class="token keyword">limit</span>来返回结果<span class="token punctuation">(</span>TopN<span class="token punctuation">)</span>，默认值<span class="token number">20</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token number">2.</span> skip方法同样接受一个数字参数作为跳过的记录条数。（前N个不要）<span class="token punctuation">,</span>默认值是<span class="token number">0</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>skip<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

分页查询：需求：每页<span class="token number">2</span>个，第二页开始：跳过前两条数据，接着值显示<span class="token number">3</span>和<span class="token number">4</span>条数据
<span class="token comment">//第一页</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>skip<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">//第二页</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>skip<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">//第三页</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>skip<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="排序查询"><a href="#排序查询" class="header-anchor">#</a> 排序查询</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># sort() 方法对数据进行排序，sort() 方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而 -1 是用于降序排列。</span>
<span class="token comment"># 语法如下所示：</span>
db<span class="token punctuation">.</span>COLLECTION_NAME<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort<span class="token punctuation">(</span>{<span class="token keyword">KEY</span>:<span class="token number">1</span>}<span class="token punctuation">)</span>
或
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort<span class="token punctuation">(</span>排序方式<span class="token punctuation">)</span>

<span class="token comment"># 案例</span>
对userid降序排列，并对访问量进行升序排列
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort<span class="token punctuation">(</span>{userid:<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>likenum:<span class="token number">1</span>}<span class="token punctuation">)</span>

<span class="token comment"># 提示</span>
skip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> limilt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sort<span class="token punctuation">(</span><span class="token punctuation">)</span>三个放在一起执行的时候：
执行的顺序是先 sort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 然后是 skip<span class="token punctuation">(</span><span class="token punctuation">)</span>，最后是显示的 <span class="token keyword">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>，和命令编写顺序无关。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="其他查询"><a href="#其他查询" class="header-anchor">#</a> <strong>其他查询</strong></h4> <ul><li><p><strong>正则查询</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 格式</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span>{field:<span class="token operator">/</span>正则表达式<span class="token operator">/</span>}<span class="token punctuation">)</span>
或
db<span class="token punctuation">.</span>集合<span class="token punctuation">.</span>find<span class="token punctuation">(</span>{字段:<span class="token operator">/</span>正则表达式<span class="token operator">/</span>}<span class="token punctuation">)</span>

<span class="token comment">#案例</span>
<span class="token number">1.</span>包含“开水”的所有文档
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{content:<span class="token operator">/</span>开水<span class="token operator">/</span>}<span class="token punctuation">)</span>
<span class="token number">2.</span> 中以“专家”开头的
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{content:<span class="token operator">/</span><span class="token operator">^</span>专家<span class="token operator">/</span>}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p><strong>比较查询</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span>find<span class="token punctuation">(</span>{ <span class="token string">&quot;field&quot;</span> : { $gt: <span class="token keyword">value</span> }}<span class="token punctuation">)</span> <span class="token comment">// 大于: field &gt; value</span>
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span>find<span class="token punctuation">(</span>{ <span class="token string">&quot;field&quot;</span> : { $lt: <span class="token keyword">value</span> }}<span class="token punctuation">)</span> <span class="token comment">// 小于: field &lt; value</span>
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span>find<span class="token punctuation">(</span>{ <span class="token string">&quot;field&quot;</span> : { $gte: <span class="token keyword">value</span> }}<span class="token punctuation">)</span> <span class="token comment">// 大于等于: field &gt;= value</span>
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span>find<span class="token punctuation">(</span>{ <span class="token string">&quot;field&quot;</span> : { $lte: <span class="token keyword">value</span> }}<span class="token punctuation">)</span> <span class="token comment">// 小于等于: field &lt;= value</span>
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span>find<span class="token punctuation">(</span>{ <span class="token string">&quot;field&quot;</span> : { $ne: <span class="token keyword">value</span> }}<span class="token punctuation">)</span> <span class="token comment">// 不等于: field != value</span>

<span class="token comment"># 示例：查询评论点赞数量大于700的记录</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{likenum:{$gt:NumberInt<span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span>}}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><strong>包含查询</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 包含使用$in操作符。 示例：查询评论的集合中userid字段包含1003或1004的文档</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{userid:{$<span class="token operator">in</span>:<span class="token punctuation">[</span><span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1004&quot;</span><span class="token punctuation">]</span>}}<span class="token punctuation">)</span>
<span class="token comment"># 不包含使用$nin操作符。 示例：查询评论集合中userid字段不包含1003和1004的文档</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{userid:{$nin:<span class="token punctuation">[</span><span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1004&quot;</span><span class="token punctuation">]</span>}}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><strong>条件连接查询</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 使用$and操作符将条件进行关联。（相 当于SQL的and） 格式为：</span>
$<span class="token operator">and</span>:<span class="token punctuation">[</span> { }<span class="token punctuation">,</span>{ }<span class="token punctuation">,</span>{ } <span class="token punctuation">]</span>

<span class="token comment"># 示例 ：查询评论集合中likenum大于等于700 并且小于2000的文档：</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{$<span class="token operator">and</span>:<span class="token punctuation">[</span>{likenum:{$gte:NumberInt<span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span>}}<span class="token punctuation">,</span>{likenum:{$lt:NumberInt<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>}}<span class="token punctuation">]</span>}<span class="token punctuation">)</span>

<span class="token comment"># 如果两个以上条件之间是或者的关系，我们使用 操作符进行关联，与前面 and的使用方式相同 格式为：</span>
$<span class="token operator">or</span>:<span class="token punctuation">[</span> { }<span class="token punctuation">,</span>{ }<span class="token punctuation">,</span>{ } <span class="token punctuation">]</span>

<span class="token comment"># 示例：查询评论集合中userid为1003，或者点赞数小于1000的文档记录</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{$<span class="token operator">or</span>:<span class="token punctuation">[</span> {userid:<span class="token string">&quot;1003&quot;</span>} <span class="token punctuation">,</span>{likenum:{$lt:<span class="token number">1000</span>} }<span class="token punctuation">]</span>}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ul> <h3 id="常用命令小结"><a href="#常用命令小结" class="header-anchor">#</a> <strong>常用命令小结</strong></h3> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>选择切换数据库：<span class="token keyword">use</span> articledb
插入数据：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>{bson数据}<span class="token punctuation">)</span>
查询所有数据：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
条件查询数据：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{条件}<span class="token punctuation">)</span>
查询符合条件的第一条记录：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>findOne<span class="token punctuation">(</span>{条件}<span class="token punctuation">)</span>
查询符合条件的前几条记录：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{条件}<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">limit</span><span class="token punctuation">(</span>条数<span class="token punctuation">)</span>
查询符合条件的跳过的记录：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{条件}<span class="token punctuation">)</span><span class="token punctuation">.</span>skip<span class="token punctuation">(</span>条数<span class="token punctuation">)</span>
修改数据：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>{条件}<span class="token punctuation">,</span>{修改后的数据}<span class="token punctuation">)</span> 或db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>{条件}<span class="token punctuation">,</span>{$<span class="token keyword">set</span>:{要修改部分的字段:数据}<span class="token punctuation">)</span>
修改数据并自增某字段值：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token keyword">update</span><span class="token punctuation">(</span>{条件}<span class="token punctuation">,</span>{$inc:{自增的字段:步进值}}<span class="token punctuation">)</span>
删除数据：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span>{条件}<span class="token punctuation">)</span>
统计查询：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>{条件}<span class="token punctuation">)</span>
模糊查询：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{字段名:<span class="token operator">/</span>正则表达式<span class="token operator">/</span>}<span class="token punctuation">)</span>
条件比较运算：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{字段名:{$gt:值}}<span class="token punctuation">)</span>
包含查询：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{字段名:{$<span class="token operator">in</span>:<span class="token punctuation">[</span>值<span class="token number">1</span>，值<span class="token number">2</span><span class="token punctuation">]</span>}}<span class="token punctuation">)</span>或db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{字段名:{$nin:<span class="token punctuation">[</span>值<span class="token number">1</span>，值<span class="token number">2</span><span class="token punctuation">]</span>}}<span class="token punctuation">)</span>
条件连接查询：db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{$<span class="token operator">and</span>:<span class="token punctuation">[</span>{条件<span class="token number">1</span>}<span class="token punctuation">,</span>{条件<span class="token number">2</span>}<span class="token punctuation">]</span>}<span class="token punctuation">)</span>或db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{$<span class="token operator">or</span>:<span class="token punctuation">[</span>{条件<span class="token number">1</span>}<span class="token punctuation">,</span>{条件<span class="token number">2</span>}<span class="token punctuation">]</span>}<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="五、索引"><a href="#五、索引" class="header-anchor">#</a> 五、索引</h2> <p>索引支持在MongoDB中高效地执行查询。如果没有索引，MongoDB必须执行全集合扫描，即扫描集合中的每个文档，以选择与查询语句匹配的文档。这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。</p> <p>如果查询存在适当的索引，MongoDB可以使用该索引限制必须检查的文档数。索引是特殊的数据结构，它以易于遍历的形式存储集合数据集的一小部分。索引存储特定字段或一组字段的值，按字段值排序。索引项的排序支持有效的相等匹配和基于范围的查询操作。此外，MongoDB还可以使用索引中的排序返回排序结果。</p> <p>官网文档：https://docs.mongodb.com/manual/indexes/</p> <p>了解：</p> <p>MongoDB索引使用B树数据结构（确切的说是B-Tree，MySQL是B+Tree）。</p> <h3 id="类型"><a href="#类型" class="header-anchor">#</a> 类型</h3> <p><strong>单字段索引</strong>：在文档的单个字段上创建用户定义的升序/降序索引，称为单字段索引。对于单个字段索引和排序操作，索引键的排序顺序（即升序或降序）并不重要，因为MongoDB可以在任何方向上遍历索引。</p> <p><strong>复合索引</strong>：持多个字段的用户定义索引，即复合索引（Compound Index）。复合索引中列出的字段顺序具有重要意义。例如，如果复合索引由 { userid: 1, score: -1 } 组成，则索引首先按userid正序排序，然后在每个userid的值内，再在按score倒序排序。</p> <p><strong>其他索引</strong>：</p> <ul><li><p><strong>地理空间索引</strong>：为了支持对地理空间坐标数据的有效查询，MongoDB提供了两种特殊的索引：返回结果时使用平面几何的二维索引和返回结果时使用球面几何的二维球面索引。</p></li> <li><p><strong>文本索引</strong>：MongoDB提供了一种文本索引类型，支持在集合中搜索字符串内容。这些文本索引不存储特定于语言的停止词（例如“the”、“a”、“or”），而将集合中的词作为词干，只存储根词。</p></li> <li><p><strong>哈希索引</strong>：为了支持基于散列的分片，MongoDB提供了散列索引类型，它对字段值的散列进行索引。这些索引在其范围内的值分布更加随机，但只支持相等匹配，不支持基于范围的查询。</p></li></ul> <h3 id="管理"><a href="#管理" class="header-anchor">#</a> 管理</h3> <ul><li><p><strong>查看</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 返回一个集合中的所有索引的数组。</span>
<span class="token comment"># 语法</span>
db.collection.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 案例： 查看comment集合中所有的索引情况</span>
<span class="token operator">&gt;</span> db.comment.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>
<span class="token punctuation">{</span>
<span class="token string">&quot;v&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
<span class="token string">&quot;key&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
<span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>,
<span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;_id_&quot;</span>,
<span class="token string">&quot;ns&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;articledb.comment&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token comment"># 结果中显示的是默认 _id 索引。</span>
<span class="token comment"># 默认_id索引：</span>
<span class="token comment"># MongoDB在创建集合的过程中，在 _id 字段上创建一个唯一的索引，默认名字为 _id_ ，该索引可防止客户端插入两个具有相同值的文档，您不能在_id字段上删除此索引。</span>
<span class="token comment"># 注意：该索引是唯一索引，因此值不能重复，即 _id 值不能重复的。在分片集群中，通常使用 _id 作为片键。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li><p><strong>创建</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 在集合上创建索引。</span>
<span class="token comment"># 语法</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>createIndex<span class="token punctuation">(</span><span class="token keyword">keys</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 案例</span>
<span class="token number">1.</span>单字段索引示例
<span class="token comment"># 对 userid 字段建立索引：</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>createIndex<span class="token punctuation">(</span>{userid:<span class="token number">1</span>}<span class="token punctuation">)</span>
{
<span class="token string">&quot;createdCollectionAutomatically&quot;</span> : <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token string">&quot;numIndexesBefore&quot;</span> : <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token string">&quot;numIndexesAfter&quot;</span> : <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token string">&quot;ok&quot;</span> : <span class="token number">1</span>
}
<span class="token comment"># 按升序创建索引</span>
    <span class="token operator">&gt;</span> db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span>
    {
    <span class="token string">&quot;v&quot;</span> : <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">&quot;key&quot;</span> : {
    <span class="token string">&quot;_id&quot;</span> : <span class="token number">1</span>
    }<span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span> : <span class="token string">&quot;_id_&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ns&quot;</span> : <span class="token string">&quot;articledb.comment&quot;</span>
    }<span class="token punctuation">,</span>
    {
    <span class="token string">&quot;v&quot;</span> : <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string">&quot;key&quot;</span> : {
    <span class="token string">&quot;userid&quot;</span> : <span class="token number">1</span>
    }<span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span> : <span class="token string">&quot;userid_1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ns&quot;</span> : <span class="token string">&quot;articledb.comment&quot;</span>
    }
    <span class="token punctuation">]</span>

<span class="token number">2.</span> 复合索引：对 userid 和 nickname 同时建立复合（Compound）索引：
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>createIndex<span class="token punctuation">(</span>{userid:<span class="token number">1</span><span class="token punctuation">,</span>nickname:<span class="token operator">-</span><span class="token number">1</span>}<span class="token punctuation">)</span>
{
<span class="token string">&quot;createdCollectionAutomatically&quot;</span> : <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token string">&quot;numIndexesBefore&quot;</span> : <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token string">&quot;numIndexesAfter&quot;</span> : <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token string">&quot;ok&quot;</span> : <span class="token number">1</span>
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></li> <li><p><strong>移除索引</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 语法：</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>dropIndex<span class="token punctuation">(</span><span class="token keyword">index</span><span class="token punctuation">)</span>

<span class="token comment"># 案例：删除 comment 集合中 userid 字段上的升序索引：</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>dropIndex<span class="token punctuation">(</span>{userid:<span class="token number">1</span>}<span class="token punctuation">)</span>
{ <span class="token string">&quot;nIndexesWas&quot;</span> : <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;ok&quot;</span> : <span class="token number">1</span> }

<span class="token comment"># 语法： 所有索引的移除</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>dropIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <p><strong>执行计划</strong>:</p> <p>分析查询性能（Analyze Query Performance）通常使用执行计划（解释计划、Explain Plan）来查看查询的情况，如查询耗费的时间、是否基于索引查询等。那么，通常，我们想知道，建立的索引是否有效，效果如何，都需要通过执行计划查看。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 语法：</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>find<span class="token punctuation">(</span>query<span class="token punctuation">,</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">explain</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token comment"># 案例：查看根据userid查询数据的情况</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{userid:<span class="token string">&quot;1003&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#关键点看： &quot;stage&quot; : &quot;COLLSCAN&quot;, 表示全集合扫描</span>

<span class="token comment"># 下面对userid建立索引</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>createIndex<span class="token punctuation">(</span>{userid:<span class="token number">1</span>}<span class="token punctuation">)</span>
<span class="token comment"># 再次查看执行计划：</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{userid:<span class="token string">&quot;1003&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 关键点看： &quot;stage&quot; : &quot;IXSCAN&quot; ,基于索引的扫描</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>涵盖的查询</strong>:</p> <p>当查询条件和查询的投影仅包含索引字段时，MongoDB直接从索引返回结果，而不扫描任何文档或将文档带入内存。 这些覆盖的查询可以非常有效。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 【示例】</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{userid:<span class="token string">&quot;1003&quot;</span>}<span class="token punctuation">,</span>{userid:<span class="token number">1</span><span class="token punctuation">,</span>_id:<span class="token number">0</span>}<span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token keyword">comment</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span>{userid:<span class="token string">&quot;1003&quot;</span>}<span class="token punctuation">,</span>{userid:<span class="token number">1</span><span class="token punctuation">,</span>_id:<span class="token number">0</span>}<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="六、springboot整合"><a href="#六、springboot整合" class="header-anchor">#</a> 六、SpringBoot整合</h2> <ol><li><p><strong>添加pom依赖</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.axcmsm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>test-mongo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--启动依赖--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.1.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--    插件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div></li> <li><p><strong>添加配置参数</strong></p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> master
      <span class="token key atrule">database</span><span class="token punctuation">:</span> test
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
      <span class="token comment">#uri:  mongodb://master:27017/test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p><strong>封装实体类</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@Data</span>
<span class="token comment">// 若未加 @Document ，该 bean save 到 mongo 的 comment collection</span>
<span class="token comment">// 若添加 @Document ，则 save 到 comment collection</span>
<span class="token annotation punctuation">@Document</span><span class="token punctuation">(</span>collection <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token comment">//可以省略，如果省略，则默认使用类名小写映射集合</span>
<span class="token comment">//复合索引</span>
<span class="token comment">// @CompoundIndex( def = &quot;{'aid': 1, 'name': -1}&quot;)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token comment">//添加了一个单字段的索引</span>
    <span class="token annotation punctuation">@Indexed</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> aid<span class="token punctuation">;</span>
    <span class="token comment">//该属性对应mongodb的字段的名字，如果一致，则无需该注解</span>
    <span class="token annotation punctuation">@Field</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> sex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li> <li><p><strong>MongoRepository操作</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token keyword">extends</span> <span class="token class-name">MongoRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// 提示查询</span>
    <span class="token class-name">User</span> <span class="token function">findUserByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 查询+分页</span>
    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findUserByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> aid<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><strong>测试案例</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationTest1</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAid</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;王五2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> save <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;存储：{}&quot;</span><span class="token punctuation">,</span>save<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;648c9265305350663143782b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAid</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;王五1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> update <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;修改：{}&quot;</span><span class="token punctuation">,</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 查询所有</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        all<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据id查询</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">&quot;648c9265305350663143782b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;根据id查询：{}&quot;</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//条件+排序</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userByName <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">findUserByName</span><span class="token punctuation">(</span><span class="token string">&quot;王五2&quot;</span><span class="token punctuation">,</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----总记录数：&quot;</span><span class="token operator">+</span>userByName<span class="token punctuation">.</span><span class="token function">getTotalElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----当前页数据：&quot;</span><span class="token operator">+</span>userByName<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 删除查询</span>
        userMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token string">&quot;648c9265305350663143782b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div></li> <li><p><strong>mongoTemplate测试案例</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationTest2</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;zzz1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;测试mongoTemplate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> save <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;存储:{}&quot;</span><span class="token punctuation">,</span>save<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;5d1312aeb1829c279c6c256b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;5d1312aeb1829c279c6c256b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token class-name">Update</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;zs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  更新一条数据</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span>update<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  更新多条数据</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">updateMulti</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span>update<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  更新数据，如果数据不存在就新增</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">upsert</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span>update<span class="token punctuation">,</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 查询所有</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        all<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 匹配查询</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;aid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 分页查询</span>
        <span class="token keyword">int</span> pageSize<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> page<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//从0开始</span>
        <span class="token class-name">PageRequest</span> aid <span class="token operator">=</span> <span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>page<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> pageSize<span class="token punctuation">,</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token string">&quot;aid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> <span class="token keyword">with</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span>aid<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">with</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//  查询多个</span>
        <span class="token class-name">Query</span> query3<span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;aid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Order</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token string">&quot;aid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list<span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//  查询数量</span>
        <span class="token class-name">Query</span> queryC <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;23&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token string">&quot;aid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>queryC<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token string">&quot;5d1312aeb1829c279c6c256b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">in</span><span class="token punctuation">(</span><span class="token string">&quot;5d1312aeb1829c279c6c256b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;5d13133ab1829c29d02ce29c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  根据条件删除</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//（可删除多条）</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 年龄加1功能</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ageAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query<span class="token operator">=</span><span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">&quot;648c90d634ad3e1591010b6b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Update</span> update<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//局部更新，相当于$set</span>
        <span class="token comment">// update.set(key,value)</span>
        <span class="token comment">//递增$inc</span>
        <span class="token comment">// update.inc(&quot;age&quot;,1);</span>
        update<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//参数1：查询对象</span>
        <span class="token comment">//参数2：更新对象</span>
        <span class="token comment">//参数3：集合的名字或实体类的类型Comment.class</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span>update<span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br></div></div></li></ol> <h2 id="七、集群"><a href="#七、集群" class="header-anchor">#</a> 七、集群</h2> <h3 id="副本集群"><a href="#副本集群" class="header-anchor">#</a> 副本集群</h3> <p>一组维护相同数据集的mongod服务。 副本集可提供冗余和高可用性，是所有生产部署的基础。类似于有自动故障恢复功能的主从集群。</p> <p>用多台机器进行同一数据的异步同步，从而使多台机器拥有同一数据的多个副本，并且当主库当掉时在不需要用户干预的情况下自动切换其他备份服务器做主库。而且还可以利用副本服务器做只读服务器，实现读写分离，提高负载。</p> <ul><li><p>冗余和数据可用性</p> <blockquote><p>复制提供冗余并提高数据可用性。 通过在不同数据库服务器上提供多个数据副本，复制可提供一定级别</p> <p>的容错功能，以防止丢失单个数据库服务器。</p> <p>在某些情况下，复制可以提供增加的读取性能，因为客户端可以将读取操作发送到不同的服务上，</p> <p>在不同数据中心维护数据副本可以增加分布式应用程序的数据位置和可用性。 您还可以为专用目的维护其他</p> <p>副本，例如灾难恢复，报告或备份。</p></blockquote></li> <li><p>MongoDB中的复制</p> <blockquote><p>副本集是一组维护相同数据集的mongod实例。 副本集包含多个数据承载节点和可选的一个仲裁节点。</p> <p>在承载数据的节点中，一个且仅一个成员被视为主节点，而其他节点被视为次要（从）节点。</p> <p>主节点接收所有写操作。 副本集只能有一个主要能够确认具有{w：“most”}写入关注的写入; 虽然在某些情况下，另一个mongod实例可能暂时认为自己也是主要的。主要记录其操作日志中的数据集的所有更改，即oplog。辅助(副本)节点复制主节点的oplog并将操作应用于其数据集，以使辅助节点的数据集反映主节点的数据集。 如果主要人员不在，则符合条件的中学将举行选举以选出新的主要人员。</p></blockquote></li> <li><p>主从复制和副本集区别</p> <blockquote><p>主从集群和副本集最大的区别就是副本集没有固定的“主节点”；整个集群会选出一个“主节点”，当其挂掉后，又在剩下的从节点中选中其他节点为“主节点”，副本集总有一个活跃点(主、primary)和一个或多个备份节点(从、secondary)。</p></blockquote></li></ul> <p><strong>类型与角色</strong>：</p> <ul><li><p>两种类型</p> <blockquote><p>主节点（Primary）类型：数据操作的主要连接点，可读写。</p> <p>次要（辅助、从）节点（Secondaries）类型：数据冗余备份节点，可以读或选举。</p></blockquote></li> <li><p>三种角色</p> <blockquote><p>主要成员（Primary）：主要接收所有写操作。就是主节点。</p> <p>副本成员（Replicate）：从主节点通过复制操作以维护相同的数据集，即备份数据，不可写操作，但可以读操作（但需要置）。是默认的一种从节点类型。</p> <p>仲裁者（Arbiter）：不保留任何数据的副本，只具有投票选举作用。当然也可以将仲裁服务器维护为副本集的一部分，即副本成员同时也可以是仲裁者。也是一种从节点类型。</p></blockquote></li></ul> <h4 id="集群搭建"><a href="#集群搭建" class="header-anchor">#</a> 集群搭建</h4> <p><strong>目标</strong>：一主一副本一仲裁</p> <ol><li><p><strong>创建主节点</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 建立存放数据和日志的目录</span>
<span class="token comment">#主节点</span>
<span class="token function">mkdir</span> -p /mongodb/replica_sets/myrs_27017/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/replica_sets/myrs_27017/data/db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 新建或修改配置文件：</span>
<span class="token function">vim</span> /mongodb/replica_sets/myrs_27017/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/replica_sets/myrs_27017/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/replica_sets/myrs_27017/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/replica_sets/myrs_27017/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP，有副作用，副本集初始化的时候，节点名字会自动设置为本地域名，而不是ip</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#bindIp</span>
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token comment">#副本集的名称</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myrs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 启动节点服务</span>
/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27017/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><strong>创建副本节点</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 建立存放数据和日志的目录</span>
<span class="token comment">#-----------myrs</span>
<span class="token comment">#副本节点</span>
<span class="token function">mkdir</span> -p /mongodb/replica_sets/myrs_27018/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/replica_sets/myrs_27018/data/db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 新建或修改配置文件：</span>
<span class="token function">vim</span> /mongodb/replica_sets/myrs_27018/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/replica_sets/myrs_27018/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/replica_sets/myrs_27018/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/replica_sets/myrs_27018/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP，有副作用，副本集初始化的时候，节点名字会自动设置为本地域名，而不是ip</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#bindIp</span>
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27018</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token comment">#副本集的名称</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myrs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 启动服务</span>
/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27018/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><strong>创建仲裁节点</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 建立存放数据和日志的目录</span>
<span class="token comment">#-----------myrs</span>
<span class="token comment">#仲裁节点</span>
<span class="token function">mkdir</span> -p /mongodb/replica_sets/myrs_27019/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/replica_sets/myrs_27019/data/db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 新建或修改配置文件</span>
<span class="token function">vim</span> /mongodb/replica_sets/myrs_27019/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># myrs_27019</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/replica_sets/myrs_27019/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/replica_sets/myrs_27019/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/replica_sets/myrs_27019/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP，有副作用，副本集初始化的时候，节点名字会自动设置为本地域名，而不是ip</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#bindIp</span>
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27019</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token comment">#副本集的名称</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myrs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 启动服务</span>
/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27019/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><strong>初始化配置副本集和主节点</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 使用客户端命令连接任意一个节点，但这里尽量要连接主节点(27017节点)：</span>
/usr/local/mongodb/bin/mongo --host<span class="token operator">=</span><span class="token number">180.76</span>.159.126 --port<span class="token operator">=</span><span class="token number">27017</span>
<span class="token comment"># 结果，连接上之后，很多命令无法使用，，比如 show dbs 等，必须初始化副本集才行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 准备初始化新的副本集</span>
<span class="token comment"># 语法：</span>
rs.initiate<span class="token punctuation">(</span>configuration<span class="token punctuation">)</span>

<span class="token comment"># 【示例】</span>
rs.initiate<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 提示</span>
<span class="token number">1</span>）“ok”的值为1，说明创建成功。
<span class="token number">2</span>）命令行提示符发生变化，变成了一个从节点角色，此时默认不能读写。稍等片刻，回车，变成主节
点。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p><strong>查看副本集的配置内容</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 返回包含当前副本集配置的文档。</span>
<span class="token comment"># 语法：</span>
rs.conf<span class="token punctuation">(</span>configuration<span class="token punctuation">)</span>

<span class="token comment"># 提示：</span>
    rs.config<span class="token punctuation">(</span><span class="token punctuation">)</span> 是该方法的别名。
    configuration：可选，如果没有配置，则使用默认主节点配置。

<span class="token comment"># 【示例】 在27017上执行副本集中当前节点的默认节点配置</span>
rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>

说明：
<span class="token number">1</span>） <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;myrs&quot;</span> ：副本集的配置数据存储的主键值，默认就是副本集的名字
<span class="token number">2</span>） <span class="token string">&quot;members&quot;</span> ：副本集成员数组，此时只有一个： <span class="token string">&quot;host&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;180.76.159.126:27017&quot;</span> ，该成员不
是仲裁节点： <span class="token string">&quot;arbiterOnly&quot;</span> <span class="token builtin class-name">:</span> <span class="token boolean">false</span> ，优先级（权重值）： <span class="token string">&quot;priority&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token number">3</span>） <span class="token string">&quot;settings&quot;</span> ：副本集的参数配置。

<span class="token comment"># 提示：副本集配置的查看命令，本质是查询的是 system.replset 的表中的数据：</span>
use <span class="token builtin class-name">local</span>

show collections

db.system.replset.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li> <li><p><strong>查看副本集状态</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 返回包含状态信息的文档。此输出使用从副本集的其他成员发送的心跳包中获得的数据反映副本集的当前状态。</span>
<span class="token comment"># 语法：</span>
rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 说明： 在27017上查看副本集状态</span>
<span class="token number">1</span>） <span class="token string">&quot;set&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;myrs&quot;</span> ：副本集的名字
<span class="token number">2</span>） <span class="token string">&quot;myState&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>：说明状态正常
<span class="token number">3</span>） <span class="token string">&quot;members&quot;</span> ：副本集成员数组，此时只有一个： <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;180.76.159.126:27017&quot;</span> ，该成员的
角色是 <span class="token string">&quot;stateStr&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;PRIMARY&quot;</span>, 该节点是健康的： <span class="token string">&quot;health&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> 。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p><strong>添加副本从节点</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 在主节点添加从节点，将其他成员加入到副本集</span>
<span class="token comment"># 语法：</span>
rs.add<span class="token punctuation">(</span>host, arbiterOnly<span class="token punctuation">)</span>

<span class="token comment"># 【示例】 将27018的副本节点添加到副本集中：</span>
rs.add<span class="token punctuation">(</span><span class="token string">&quot;180.76.159.126:27018&quot;</span><span class="token punctuation">)</span>
说明：
<span class="token number">1</span>） <span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> ：说明添加成功。

<span class="token comment"># rs.status()</span>
说明：
<span class="token number">1</span>） <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;180.76.159.126:27018&quot;</span> 是第二个节点的名字，其角色是 <span class="token string">&quot;stateStr&quot;</span> <span class="token builtin class-name">:</span>
<span class="token string">&quot;SECONDARY&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p><strong>添加仲裁从节点</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 添加一个仲裁节点到副本集</span>
<span class="token comment"># 语法：</span>
rs.addArb<span class="token punctuation">(</span>host<span class="token punctuation">)</span>

<span class="token comment"># 案例：将27019的仲裁节点添加到副本集中</span>
rs.addArb<span class="token punctuation">(</span><span class="token string">&quot;180.76.159.126:27019&quot;</span><span class="token punctuation">)</span>
说明：
<span class="token number">1</span>） <span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> ：说明添加成功。

<span class="token comment"># 查看</span>
rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span>
说明：
<span class="token number">1</span>） <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;180.76.159.126:27019&quot;</span> 是第二个节点的名字，其角色是 <span class="token string">&quot;stateStr&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;ARBITER&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <h4 id="数据读写操作"><a href="#数据读写操作" class="header-anchor">#</a> <strong>数据读写操作</strong></h4> <blockquote><p>测试三个不同角色的节点的数据读写情况。</p></blockquote> <ol><li><p>登录主节点27017，写入和读取数据：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27017</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>use articledb
db
db.comment.insert({&quot;articleid&quot;:&quot;100000&quot;,&quot;content&quot;:&quot;今天天气真好，阳光明媚&quot;,&quot;userid&quot;:&quot;1001&quot;,&quot;nickname&quot;:&quot;Rose&quot;,&quot;createdatetime&quot;:new Date()})
db.comment.find()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>登录从节点27018</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27018</span>
show dbs<span class="token punctuation">;</span>

<span class="token comment"># 发现，不能读取集合的数据。当前从节点只是一个备份，不是奴隶节点，无法读取数据，写当然更不行。</span>
<span class="token comment"># 因为默认情况下，从节点是没有读写权限的，可以增加读的权限，但需要进行设置。</span>
<span class="token comment"># 设置读操作权限：</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 说明： 设置为奴隶节点，允许在从成员上运行读的操作</span>
<span class="token comment"># 提示： 该命令是 db.getMongo().setSlaveOk() 的简化命令。</span>
<span class="token comment"># 语法：</span>
rs.slaveOk<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#或</span>
rs.slaveOk<span class="token punctuation">(</span>true<span class="token punctuation">)</span>

<span class="token comment"># 此时，在执行查询命令，运行成功！但仍然不允许插入。</span>
<span class="token comment"># 现在可实现了读写分离，让主插入数据，让从来读取数据。</span>

<span class="token comment"># 取消读权限</span>
rs.slaveOk<span class="token punctuation">(</span>false<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>仲裁者节点，不存放任何业务数据的，可以登录查看</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27019</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>rs.slaveOk<span class="token punctuation">(</span><span class="token punctuation">)</span>
show dbs
use <span class="token builtin class-name">local</span>
show collections
<span class="token comment"># 发现，只存放副本集配置等数据。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <p><strong>主节点的选举原则</strong>：</p> <p>MongoDB在副本集中，会自动进行主节点的选举，主节点选举的触发条件：</p> <ol><li>主节点故障</li> <li>主节点网络不可达（默认心跳信息为10秒）</li> <li>人工干预（rs.stepDown(600)）</li></ol> <p>一旦触发选举，就要根据一定规则来选主节点。</p> <p>选举规则是根据票数来决定谁获胜：</p> <ul><li>票数最高，且获得了“大多数”成员的投票支持的节点获胜。“大多数”的定义为：假设复制集内投票成员数量为N，则大多数为 N/2 + 1。例如：3个投票成员，则大多数的值是2。当复制集内存活成员数量不足大多数时，整个复制集将无法选举出Primary，复制集将无法提供写服务，处于只读状态。</li> <li>若票数相同，且都获得了“大多数”成员的投票支持的，数据新的节点获胜。数据的新旧是通过操作日志oplog来对比的。</li></ul> <p>在获得票数的时候，优先级（priority）参数影响重大。可以通过设置优先级（priority）来设置额外票数。优先级即权重，取值为0-1000，相当于可额外增加0-1000的票数，优先级的值越大，就越可能获得多数成员的投票（votes）数。指定较高的值可使成员更有资格成为主要成员，更低的值可使成员更不符合条件。默认情况下，优先级的值是1</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 可以看出，主节点和副本节点的优先级各为1，即，默认可以认为都已经有了一票。但选举节点，优先级是0，（要注意是，官方说了，选举节点的优先级必须是0，不能是别的值。即不具备选举权，但具有投票权）</span>


<span class="token comment"># 修改优先级</span>
<span class="token comment">#1. 先将配置导入cfg变量</span>
<span class="token assign-left variable">cfg</span><span class="token operator">=</span>rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#2. 然后修改值（ID号默认从0开始）：</span>
cfg.members<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>.priority<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment">#3. 重新加载配置</span>
rs.reconfig<span class="token punctuation">(</span>cfg<span class="token punctuation">)</span>
<span class="token comment"># 稍等片刻会重新开始选举</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>故障测试</strong>：</p> <p>关闭27018副本节点：发现，主节点和仲裁节点对27018的心跳失败。因为<strong>主节点还在，因此，没有触发投票选举</strong>。如果此时，在主节点写入数据。再启动从节点，会发现，主节点写入的数据，会自动同步给从节点。</p> <ol><li><strong>主节点故障</strong>：关闭主节点，从节点和仲裁节点对27017的心跳失败，当失败超过10秒，会自动发起投票。而副本节点只有27018，因此，候选人只有一个就是27018，开始投票。27019向27018投了一票，27018本身自带一票，因此共两票，超过了“大多数”27019是仲裁节点，没有选举权，27018不向其投票，其票数是0.最终结果，27018成为主节点。具备读写功能。再启动27017节点，发现27017变成了从节点，27018仍保持主节点。登录27017节点，发现是从节点了，数据自动从27018同步。从而实现了高可用。</li> <li><strong>仲裁节点和主节点故障</strong>：先关掉仲裁节点27019，关掉现在的主节点27018。登录27017后，发现，27017仍然是从节点，副本集中没有主节点了，导致此时，副本集是只读状态，无法写入。为啥不选举了？因为27017的票数，没有获得大多数，即没有大于等于2，它只有默认的一票（优先级是1）如果要触发选举，随便加入一个成员即可。如果只加入27019仲裁节点成员，则主节点一定是27017，因为没得选了，仲裁节点不参与选举，但参与投票。如果只加入27018节点，会发起选举。因为27017和27018都是两票，则按照谁数据新，谁当主节点。</li> <li><strong>仲裁节点和从节点故障</strong>：先关掉仲裁节点27019，关掉现在的副本节点27018的10秒后，27017主节点自动降级为副本节点。（服务降级）副本集不可写数据了，已经故障了。</li></ol> <p><strong>连接</strong>：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 如果使用云服务器需要修改配置中的主节点ip</span>
var config <span class="token operator">=</span> rs.config<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
config.members<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.host<span class="token operator">=</span><span class="token string">&quot;180.76.159.126:27017&quot;</span><span class="token punctuation">;</span>rs.reconfig<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># uri</span>
mongodb://host1,host2,host3/articledb?connect<span class="token operator">=</span>replicaSet<span class="token operator">&amp;</span><span class="token assign-left variable">slaveOk</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">replicaSet</span><span class="token operator">=</span>副本集名字

其中：
<span class="token assign-left variable">slaveOk</span><span class="token operator">=</span>true：开启副本节点读的功能，可实现读写分离。
<span class="token assign-left variable">connect</span><span class="token operator">=</span>replicaSet：自动到副本集中选择读写的主机。如果slaveOK是打开的，则实现了读写分离
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 【示例】</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment">#数据源配置</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
     <span class="token comment"># 主机地址</span>
     <span class="token comment"># host: 180.76.159.126</span>
     <span class="token comment"># 数据库</span>
     <span class="token comment"># database: articledb</span>
     <span class="token comment"># 默认端口是27017</span>
     <span class="token comment"># port: 27017</span>
     <span class="token comment">#也可以使用uri连接</span>
     <span class="token comment">#uri: mongodb://192.168.40.134:27017/articledb</span>
     <span class="token comment"># 副本集的连接字符串</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">:</span>//180.76.159.126<span class="token punctuation">:</span><span class="token number">27017</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span><span class="token number">27018</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span>27019/articledb<span class="token punctuation">?</span>connect=replicaSet<span class="token important">&amp;slaveOk=true&amp;replicaSet=myrs</span>
<span class="token comment"># 注意：主机必须是副本集中所有的主机，包括主节点、副本节点、仲裁节点。SpringDataMongoDB自动实现了读写分离：</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="分片集群"><a href="#分片集群" class="header-anchor">#</a> 分片集群</h3> <p>分片（sharding）是一种跨多台机器分布数据的方法， MongoDB使用分片来支持具有非常大的数据集和高吞吐量操作的部署。</p> <p>换句话说：分片(sharding)是指将数据拆分，将其分散存在不同的机器上的过程。有时也用分区(partitioning)来表示这个概念。将数据分散到不同的机器上，不需要功能强大的大型计算机就可以储存更多的数据，处理更多的负载。具有大型数据集或高吞吐量应用程序的数据库系统可以会挑战单个服务器的容量。例如，高查询率会耗尽服务器的CPU容量。工作集大小大于系统的RAM会强调磁盘驱动器的I / O容量。有两种解决系统增长的方法：垂直扩展和水平扩展。垂直扩展意味着增加单个服务器的容量，例如使用更强大的CPU，添加更多RAM或增加存储空间量。可用技术的局限性可能会限制单个机器对于给定工作负载而言足够强大。此外，基于云的提供商基于可用的硬件配置具有硬性上限。结果，垂直缩放有实际的最大值。水平扩展意味着划分系统数据集并加载多个服务器，添加其他服务器以根据需要增加容量。虽然单个机器的总体速度或容量可能不高，但每台机器处理整个工作负载的子集，可能提供比单个高速大容量服务器更高的效率。扩展部署容量只需要根据需要添加额外的服务器，这可能比单个机器的高端硬件的总体成本更低。权衡是基础架构和部署维护的复杂性增加。MongoDB支持通过分片进行水平扩展。</p> <p><strong>分片集群包含的组件</strong>:</p> <ul><li>分片（存储）：每个分片包含分片数据的子集。 每个分片都可以部署为副本集。</li> <li>mongos（路由）：mongos充当查询路由器，在客户端应用程序和分片集群之间提供接口。</li> <li>confifig servers（“调度”的配置）：配置服务器存储群集的元数据和配置设置。 从MongoDB 3.4开始，必须将配置服务器部署为副本集（CSRS）。</li></ul> <blockquote><p>MongoDB在集合级别对数据进行分片，将集合数据分布在集群中的分片上。</p></blockquote> <h4 id="集群搭建-2"><a href="#集群搭建-2" class="header-anchor">#</a> 集群搭建</h4> <p><strong>目标</strong>：两个分片节点副本集（3+3）+一个配置节点副本集（3）+两个路由节点（2），共11个服务节点。</p> <p><strong>分片（存储）节点副本集的创建</strong></p> <blockquote><p>所有的的配置文件都直接放到 sharded_cluster 的相应的子目录下面，默认配置文件名字：mongod.conf</p></blockquote> <ol><li><p><strong>第一套副本集</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 准备存放数据和日志的目录：</span>
<span class="token comment"># -----------myshardrs01</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs01_27018/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs01_27018/data/db <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs01_27118/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs01_27118/data/db <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs01_27218/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs01_27218/data/db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 新建或修改配置文件：</span>
<span class="token function">vim</span> /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># myshardrs01_27018</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs01_27018/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs01_27018/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs01_27018/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP，有副作用，副本集初始化的时候，节点名字会自动设置为本地域名，而不是ip</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#bindIp</span>
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27018</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token comment">#副本集的名称</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myshardrs01
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token comment">#分片角色</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> shardsvr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code># 新建或修改配置文件
vim /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># myshardrs01_27118：</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs01_27118/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs01_27118/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs01_27118/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27118</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myshardrs01
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> shardsvr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 新建或修改配置文件：</span>
<span class="token function">vim</span> /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># myshardrs01_27218：</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs01_27218/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs01_27218/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs01_27218/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27218</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myshardrs01
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> shardsvr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>启动第一套副本集：一主一副本一仲裁</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 依次启动三个mongod服务：</span>
/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf
/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf
/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf

<span class="token comment"># 查看服务是否启动</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span><span class="token function">grep</span> mongod

<span class="token comment"># 1. 初始化副本集和创建主节点：</span>
/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27018</span>

<span class="token comment"># 执行初始化副本集命令：</span>
rs.initiate<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查看副本集情况(节选内容)：</span>
 rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
 <span class="token comment"># 2. 主节点配置查看：</span>
 rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
 <span class="token comment"># 3. 添加副本节点：</span>
 rs.add<span class="token punctuation">(</span><span class="token string">&quot;180.76.159.126:27118&quot;</span><span class="token punctuation">)</span>
 
 <span class="token comment"># 4. 添加仲裁节点</span>
 rs.addArb<span class="token punctuation">(</span><span class="token string">&quot;180.76.159.126:27218&quot;</span><span class="token punctuation">)</span>
 
 <span class="token comment"># 5. 查看</span>
  rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li> <li><p><strong>第二套副本集</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 准备存放数据和日志的目录：</span>
<span class="token comment">#-----------myshardrs02</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs02_27318/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs02_27318/data/db <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs02_27418/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs02_27418/data/db <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs02_27518/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myshardrs02_27518/data/db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 新建或修改配置文件：</span>
<span class="token function">vim</span> /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># myshardrs02_27318：</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs02_27318/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs02_27318/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs02_27318/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27318</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myshardrs02
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> shardsvr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 新建或修改配置文件：</span>
<span class="token function">vim</span> /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># myshardrs02_27418</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs02_27418/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs02_27418/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs02_27418/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27418</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myshardrs02
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> shardsvr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 新建或修改配置文件：</span>
<span class="token function">vim</span> /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># myshardrs02_27518：</span>
<span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs02_27518/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs02_27518/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myshardrs02_27518/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27518</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myshardrs02
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> shardsvr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>启动第二套副本集：一主一副本一仲裁</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 依次启动三个mongod服务：</span>
/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf
/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf
/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf

<span class="token comment"># 查看是否启动成功</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span><span class="token function">grep</span> mongod

<span class="token comment"># 1. 初始化副本集和创建主节点：</span>
<span class="token comment">#  使用客户端命令连接任意一个节点，但这里尽量要连接主节点：</span>
/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27318</span>
<span class="token comment"># 执行初始化副本集命令：</span>
rs.initiate<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 查看副本集情况(节选内容)：</span>
 rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
<span class="token comment"># 2. 主节点配置查看：</span>
rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 3. 添加副本节点：</span>
rs.add<span class="token punctuation">(</span><span class="token string">&quot;180.76.159.126:27418&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 4. 添加仲裁节点：</span>
rs.addArb<span class="token punctuation">(</span><span class="token string">&quot;180.76.159.126:27518&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 查看副本集的配置情况：</span>
rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li></ol> <p><strong>配置节点副本集的创建</strong>：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#-----------configrs</span>
<span class="token comment">#建立数据节点data和日志目录</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myconfigrs_27019/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myconfigrs_27019/data/db <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myconfigrs_27119/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myconfigrs_27119/data/db <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myconfigrs_27219/log <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/myconfigrs_27219/data/db
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>vim /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>systemLog:
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    destination: <span class="token function">file</span>
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    path: <span class="token string">&quot;/mongodb/sharded_cluster/myconfigrs_27019/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    logAppend: <span class="token boolean">true</span>
storage:
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    dbPath: <span class="token string">&quot;/mongodb/sharded_cluster/myconfigrs_27019/data/db&quot;</span>
    journal:
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        enabled: <span class="token boolean">true</span>
processManagement:
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    fork: <span class="token boolean">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    pidFilePath: <span class="token string">&quot;/mongodb/sharded_cluster/myconfigrs_27019/log/mongod.pid&quot;</span>
net:
    <span class="token comment">#服务实例绑定所有IP</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    bindIp: localhost,192.168.0.2
    <span class="token comment">#绑定的端口</span>
    port: <span class="token number">27019</span>
replication:
    replSetName: myconfigrs
sharding:
    clusterRole: configsvr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>systemLog:
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    destination: <span class="token function">file</span>
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    path: <span class="token string">&quot;/mongodb/sharded_cluster/myconfigrs_27119/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    logAppend: <span class="token boolean">true</span>
storage:
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    dbPath: <span class="token string">&quot;/mongodb/sharded_cluster/myconfigrs_27119/data/db&quot;</span>
    journal:
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        enabled: <span class="token boolean">true</span>
processManagement:
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    fork: <span class="token boolean">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    pidFilePath: <span class="token string">&quot;/mongodb/sharded_cluster/myconfigrs_27119/log/mongod.pid&quot;</span>
net:
    <span class="token comment">#服务实例绑定所有IP</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    bindIp: localhost,192.168.0.2
    <span class="token comment">#绑定的端口</span>
    port: <span class="token number">27119</span>
replication:
    replSetName: myconfigrs
sharding:
    clusterRole: configsvr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vim</span> /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myconfigrs_27219/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
    <span class="token comment">#mongod实例存储其数据的目录。storage.dbPath设置仅适用于mongod。</span>
    <span class="token key atrule">dbPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myconfigrs_27219/data/db&quot;</span>
    <span class="token key atrule">journal</span><span class="token punctuation">:</span>
        <span class="token comment">#启用或禁用持久性日志以确保数据文件保持有效和可恢复。</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/myconfigrs_27219/log/mongod.pid&quot;</span>
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27219</span>
<span class="token key atrule">replication</span><span class="token punctuation">:</span>
    <span class="token key atrule">replSetName</span><span class="token punctuation">:</span> myconfigrs
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterRole</span><span class="token punctuation">:</span> configsvr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 依次启动三个mongod服务 启动配置副本集：一主两副本</span>
/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf
/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf
/usr/local/mongodb/bin/mongod -f /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf

<span class="token comment"># 查看</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span><span class="token function">grep</span> mongod
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 初始化副本集和创建主节点,但这里尽量要连接主节点：</span>
/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27019</span>

<span class="token comment"># 1.初始化副本集命令：</span>
 rs.initiate<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 2.  查看副本集情况(节选内容)：</span>
rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 3. 主节点配置查看：</span>
rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 4. 添加两个副本节点：</span>
rs.add<span class="token punctuation">(</span><span class="token string">&quot;180.76.159.126:27119&quot;</span><span class="token punctuation">)</span>
rs.add<span class="token punctuation">(</span><span class="token string">&quot;180.76.159.126:27219&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 查看副本集的配置情况：</span>
rs.conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h5 id="路由节点的创建和操作"><a href="#路由节点的创建和操作" class="header-anchor">#</a> <strong>路由节点的创建和操作</strong></h5> <p><strong>第一个路由节点的创建和连接</strong>：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#-----------mongos01</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/mymongos_27017/log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>vi /mongodb/sharded_cluster/mymongos_27017/mongos.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/mymongos_27017/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/mymongos_27017/log/mongod.pid&quot;
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP，有副作用，副本集初始化的时候，节点名字会自动设置为本地域名，而不是ip</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#bindIp</span>
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27017</span>
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token comment">#指定配置节点副本集</span>
    <span class="token key atrule">configDB</span><span class="token punctuation">:</span>
    myconfigrs/180.76.159.126<span class="token punctuation">:</span><span class="token number">27019</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span><span class="token number">27119</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span><span class="token number">27219</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 启动</span>
/usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27017/mongos.conf
<span class="token comment"># 提示：启动如果失败，可以查看log目录下的日志，查看失败原因。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 客户端登录mongos，测试</span>
/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27017</span>
<span class="token comment"># 此时，写不进去数据，如果写数据会报错：</span>
<span class="token comment"># 原因：通过路由节点操作，现在只是连接了配置节点，还没有连接分片数据节点，因此无法写入业务数据。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># properties配置文件参考：</span>
<span class="token attr-name">logpath</span><span class="token punctuation">=</span><span class="token attr-value">/mongodb/sharded_cluster/mymongos_27017/log/mongos.log</span>
<span class="token attr-name">logappend</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">bind_ip_all</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">port</span><span class="token punctuation">=</span><span class="token attr-value">27017</span>
<span class="token attr-name">fork</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">configdb</span><span class="token punctuation">=</span><span class="token attr-value">myconfigrs/180.76.159.126:27019,180.76.159.126:27119,180.76.159.126:27219</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>在路由节点上进行分片配置操作</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#使用命令添加分片</span>
<span class="token comment"># 语法：</span>
sh.addShard<span class="token punctuation">(</span><span class="token string">&quot;IP:Port&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 将第一套分片副本集添加进来：</span>
sh.addShard<span class="token punctuation">(</span><span class="token string">&quot;myshardrs01/192.168.0.2:27018,180.76.159.126:27118,180.76.159.126:27218&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># 查看分片状态情况</span>
sh.status<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 继续将第二套分片副本集添加进来：</span>
sh.addShard<span class="token punctuation">(</span><span class="token string">&quot;myshardrs02/192.168.0.2:27318,180.76.159.126:27418,180.76.159.126:27518&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 查看分片状态：</span>
sh.status<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 提示：如果添加分片失败，需要先手动移除分片，检查添加分片的信息的正确性后，再次添加分片。</span>
use admin
db.runCommand<span class="token punctuation">(</span> <span class="token punctuation">{</span> removeShard: <span class="token string">&quot;myshardrs02&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
注意：如果只剩下最后一个shard，是无法删除的移除时会自动转移分片数据，需要一个时间过程。完成后，再次执行删除分片命令才能真正删除。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 开启分片功能：</span>
sh.enableSharding<span class="token punctuation">(</span><span class="token string">&quot;库名&quot;</span><span class="token punctuation">)</span>、sh.shardCollection<span class="token punctuation">(</span><span class="token string">&quot;库名.集合名&quot;</span>,<span class="token punctuation">{</span><span class="token string">&quot;key&quot;</span>:1<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 在mongos上的articledb数据库配置sharding:</span>
sh.enableSharding<span class="token punctuation">(</span><span class="token string">&quot;articledb&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 集合分片：对集合分片，你必须使用 sh.shardCollection() 方法指定集合和分片键。</span>
<span class="token comment"># 语法：</span>
sh.shardCollection<span class="token punctuation">(</span>namespace, key, unique<span class="token punctuation">)</span>

<span class="token comment"># 分片规则一：哈希策略</span>
对于 基于哈希的分片 ,MongoDB计算一个字段的哈希值,并用这个哈希值来创建数据块.在使用基于哈希分片的系统中,拥有”相近”片键的文档 很可能不会 存储在同一个数据块中,因此数据的分离性更好一些
使用nickname作为片键，根据其值的哈希值进行数据分片
sh.shardCollection<span class="token punctuation">(</span><span class="token string">&quot;articledb.comment&quot;</span>,<span class="token punctuation">{</span><span class="token string">&quot;nickname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;hashed&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
查看分片状态：sh.status<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 分片规则二：范围策略</span>
对于 基于范围的分片 ,MongoDB按照片键的范围把数据分成不同部分.假设有一个数字的片键:想象一个从负无穷到正无穷的直线,每一个片键的值都在直线上画了一个点.MongoDB把这条直线划分为更短的不重叠的片段,并称之为 数据块 ,每个数据块包含了片键在一定范围内的数据.在使用片键做范围划分的系统中,拥有”相近”片键的文档很可能存储在同一个数据块中,因此也会存储在同一个分片中.
如使用作者年龄字段作为片键，按照点赞数的值进行分片：
 sh.shardCollection<span class="token punctuation">(</span><span class="token string">&quot;articledb.author&quot;</span>,<span class="token punctuation">{</span><span class="token string">&quot;age&quot;</span>:1<span class="token punctuation">}</span><span class="token punctuation">)</span>

注意的是：
<span class="token number">1</span>）一个集合只能指定一个片键，否则报错。
<span class="token number">2</span>）一旦对一个集合分片，分片键和分片值就不可改变。 如：不能给集合选择不同的分片键、不能更新分片键的值。
<span class="token number">3</span>）根据age索引进行分配数据。
基于范围的分片方式与基于哈希的分片方式性能对比：
基于范围的分片方式提供了更高效的范围查询,给定一个片键的范围,分发路由可以很简单地确定哪个数
据块存储了请求需要的数据,并将请求转发到相应的分片中.
不过,基于范围的分片会导致数据在不同分片上的不均衡,有时候,带来的消极作用会大于查询性能的积极
作用.比如,如果片键所在的字段是线性增长的,一定时间内的所有请求都会落到某个固定的数据块中,最终
导致分布在同一个分片中.在这种情况下,一小部分分片承载了集群大部分的数据,系统并不能很好地进行
扩展.与此相比,基于哈希的分片方式以范围查询性能的损失为代价,保证了集群中数据的均衡.哈希值的随机性
使数据随机分布在每个数据块中,因此也随机分布在不同分片中.但是也正由于随机性,一个范围查询很难
确定应该请求哪些分片,通常为了返回需要的结果,需要请求所有分片.
如无特殊情况，一般推荐使用 Hash Sharding。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 显示集群的详细信息：</span>
db.printShardingStatus<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 查看均衡器是否工作（需要重新均衡时系统才会自动启动，不用管它）：</span>
sh.isBalancerRunning<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 查看当前Balancer状态：</span>
sh.getBalancerState<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>分片后插入数据测试</strong>：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 测试一（哈希规则）：登录mongs后，向comment循环插入1000条数据做测试：</span>
use articledb
for<span class="token punctuation">(</span>var <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">1000</span><span class="token punctuation">;</span>i++<span class="token punctuation">)</span><span class="token punctuation">{</span>db.comment.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>_id:i+<span class="token string">&quot;&quot;</span>,nickname:<span class="token string">&quot;BoBo&quot;</span>+i<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
提示：js的语法，因为mongo的shell是一个JavaScript的shell。
注意：从路由上插入的数据，必须包含片键，否则无法插入。

<span class="token comment"># 分别登陆两个片的主节点，统计文档数量</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>再增加一个路由节点</strong>：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#-----------mongos02</span>
<span class="token function">mkdir</span> -p /mongodb/sharded_cluster/mymongos_27117/log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">vi</span> /mongodb/sharded_cluster/mymongos_27117/mongos.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">systemLog</span><span class="token punctuation">:</span>
    <span class="token comment">#MongoDB发送所有日志输出的目标指定为文件</span>
    <span class="token key atrule">destination</span><span class="token punctuation">:</span> file
    <span class="token comment">#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/mongodb/sharded_cluster/mymongos_27117/log/mongod.log&quot;</span>
    <span class="token comment">#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。</span>
    <span class="token key atrule">logAppend</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">processManagement</span><span class="token punctuation">:</span>
    <span class="token comment">#启用在后台运行mongos或mongod进程的守护进程模式。</span>
    <span class="token key atrule">fork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#指定用于保存mongos或mongod进程的进程ID的文件位置，其中mongos或mongod将写入其PID</span>
    <span class="token key atrule">pidFilePath</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/mymongos_27117/log/mongod.pid&quot;
<span class="token key atrule">net</span><span class="token punctuation">:</span>
    <span class="token comment">#服务实例绑定所有IP，有副作用，副本集初始化的时候，节点名字会自动设置为本地域名，而不是ip</span>
    <span class="token comment">#bindIpAll: true</span>
    <span class="token comment">#服务实例绑定的IP</span>
    <span class="token key atrule">bindIp</span><span class="token punctuation">:</span> localhost<span class="token punctuation">,</span>192.168.0.2
    <span class="token comment">#bindIp</span>
    <span class="token comment">#绑定的端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">27117</span>
<span class="token key atrule">sharding</span><span class="token punctuation">:</span>
    <span class="token key atrule">configDB</span><span class="token punctuation">:</span>
    myconfigrs/180.76.159.126<span class="token punctuation">:</span><span class="token number">27019</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span><span class="token number">27119</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span><span class="token number">27219</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 启动</span>
/usr/local/mongodb/bin/mongos -f /mongodb/sharded_cluster/mymongos_27117/mongos.conf
<span class="token comment"># 使用mongo客户端登录27117，发现，第二个路由无需配置，因为分片配置都保存到了配置服务器中了。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">uri</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">:</span>//180.76.159.126<span class="token punctuation">:</span><span class="token number">27017</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span>27117/articledb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="清除所有的节点数据"><a href="#清除所有的节点数据" class="header-anchor">#</a> <strong>清除所有的节点数据</strong></h5> <p>如果在搭建分片的时候有操作失败或配置有问题，需要重新来过的，可以进行如下操作：</p> <p>第一步：查询出所有的测试服务节点的进程：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">ps</span> -ef <span class="token operator">|</span><span class="token function">grep</span> mongo
<span class="token function">kill</span> -2 进程编号
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>第二步：清除所有的节点的数据：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">rm</span> -rf /mongodb/sharded_cluster/myconfigrs_27019/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/myconfigrs_27119/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/myconfigrs_27219/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/myshardrs01_27018/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/myshardrs01_27118/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/myshardrs01_27218/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/myshardrs02_27318/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/myshardrs02_27418/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/myshardrs02_27518/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/mymongos_27017/data/db/*.* <span class="token punctuation">\</span> <span class="token operator">&amp;</span>
<span class="token function">rm</span> -rf /mongodb/sharded_cluster/mymongos_27117/data/db/*.*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>第三步：查看或修改有问题的配置</p> <p>第四步：依次启动所有节点，不包括路由节点：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs01_27018/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs01_27118/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs01_27218/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs02_27318/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs02_27418/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs02_27518/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myconfigrs_27019/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myconfigrs_27119/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myconfigrs_27219/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>第五步：对两个数据分片副本集和一个配置副本集进行初始化和相关配置</p> <p>第六步：检查路由mongos的配置，并启动mongos</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/mymongos_27017/mongos.cfg
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/mymongos_27017/mongos.cfg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第七步：mongo登录mongos，在其上进行相关操作。</p> <h2 id="八、安全认证"><a href="#八、安全认证" class="header-anchor">#</a> 八、安全认证</h2> <p>默认情况下，MongoDB实例启动运行时是没有启用用户访问权限控制的，也就是说，在实例本机服务器上都可以随意连接到实例进行各种操作，MongoDB不会对连接客户端进行用户验证，这是非常危险的。</p> <p>mongodb官网上说，为了能保障mongodb的安全可以做以下几个步骤：</p> <p>1）使用新的端口，默认的27017端口如果一旦知道了ip就能连接上，不太安全。</p> <p>2）设置mongodb的网络环境，最好将mongodb部署到公司服务器内网，这样外网是访问不到的。公司内部访问使用vpn等。</p> <p>3）开启安全认证。认证要同时设置服务器之间的内部认证方式，同时要设置客户端连接到集群的账号密码认证方式。</p> <p>为了强制开启用户访问控制(用户验证)，则需要在MongoDB实例启动时使用选项 --auth 或在指定启动配置文件中添加选项 auth=true 。</p> <p><strong>概念</strong></p> <ul><li><strong>启用访问控制</strong>：MongoDB使用的是基于角色的访问控制(Role-Based Access Control,RBAC)来管理用户对实例的访问。通过对用户授予一个或多个角色来控制用户访问数据库资源的权限和数据库操作的权限，在对用户分配角色之前，用户无法访问实例。在实例启动时添加选项 --auth 或指定启动配置文件中添加选项 auth=true 。</li> <li><strong>角色</strong>：在MongoDB中通过角色对用户授予相应数据库资源的操作权限，每个角色当中的权限可以显式指定，也可以通过继承其他角色的权限，或者两都都存在的权限。</li> <li><strong>权限</strong>：权限由指定的数据库资源(resource)以及允许在指定资源上进行的操作(action)组成。
<ul><li>资源(resource)包括：数据库、集合、部分集合和集群；</li> <li>操作(action)包括：对资源进行的增、删、改、查(CRUD)操作。</li></ul></li></ul> <p>在角色定义时可以包含一个或多个已存在的角色，新创建的角色会继承包含的角色所有的权限。在同一个数据库中，新创建角色可以继承其他角色的权限，在 admin 数据库中创建的角色可以继承在其它任意数据库中角色的权限。关于角色权限的查看，可以通过如下命令查询（了解）：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">// 查询所有角色权限(仅用户自定义角色)</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{ rolesInfo: <span class="token number">1</span> }<span class="token punctuation">)</span>
<span class="token comment">// 查询所有角色权限(包含内置角色)</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{ rolesInfo: <span class="token number">1</span><span class="token punctuation">,</span> showBuiltinRoles: <span class="token boolean">true</span> }<span class="token punctuation">)</span>
<span class="token comment">// 查询当前数据库中的某角色的权限</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{ rolesInfo: <span class="token string">&quot;&lt;rolename&gt;&quot;</span> }<span class="token punctuation">)</span>
<span class="token comment">// 查询其它数据库中指定的角色权限</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{ rolesInfo: { role: <span class="token string">&quot;&lt;rolename&gt;&quot;</span><span class="token punctuation">,</span> db: <span class="token string">&quot;&lt;database&gt;&quot;</span> } }
<span class="token comment">// 查询多个角色权限</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>
{
rolesInfo: <span class="token punctuation">[</span>
<span class="token string">&quot;&lt;rolename&gt;&quot;</span><span class="token punctuation">,</span>
{ role: <span class="token string">&quot;&lt;rolename&gt;&quot;</span><span class="token punctuation">,</span> db: <span class="token string">&quot;&lt;database&gt;&quot;</span> }<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>
}
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 示例:查看所有内置角色：</span>
db.runCommand<span class="token punctuation">(</span><span class="token punctuation">{</span> rolesInfo: <span class="token number">1</span>, showBuiltinRoles: <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>常用的内置角色：</p> <p><strong>数据库用户角色</strong>：read、readWrite;</p> <p><strong>所有数据库用户角色</strong>：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</p> <p><strong>数据库管理角色</strong>：dbAdmin、dbOwner、userAdmin；</p> <p><strong>集群管理角色</strong>：clusterAdmin、clusterManager、clusterMonitor、hostManager；</p> <p><strong>备份恢复角色</strong>：backup、restore；</p> <p><strong>超级用户角色</strong>：root</p> <p><strong>内部角色</strong>：system</p></blockquote> <h3 id="单实例环境"><a href="#单实例环境" class="header-anchor">#</a> <strong>单实例环境</strong></h3> <p><strong>添加用户和权限</strong>:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27017</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 创建两个管理员用户，一个是系统的超级管理员 myroot ，一个是admin库的管理用户myadmin ：</span>
<span class="token comment"># 切换到admin库</span>
<span class="token operator">&gt;</span> use admin
<span class="token comment"># 创建系统超级用户 myroot,设置密码123456，设置角色root</span>
<span class="token operator">&gt;</span> db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user:<span class="token string">&quot;myroot&quot;</span>,pwd:<span class="token string">&quot;123456&quot;</span>,roles:<span class="token punctuation">[</span> <span class="token punctuation">{</span> <span class="token string">&quot;role&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;root&quot;</span>, <span class="token string">&quot;db&quot;</span> <span class="token builtin class-name">:</span>
<span class="token string">&quot;admin&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 或</span>
<span class="token operator">&gt;</span> db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user:<span class="token string">&quot;myroot&quot;</span>,pwd:<span class="token string">&quot;123456&quot;</span>,roles:<span class="token punctuation">[</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">#创建专门用来管理admin库的账号myadmin，只用来作为用户权限的管理</span>
<span class="token operator">&gt;</span> db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user:<span class="token string">&quot;myadmin&quot;</span>,pwd:<span class="token string">&quot;123456&quot;</span>,roles:
<span class="token punctuation">[</span><span class="token punctuation">{</span>role:<span class="token string">&quot;userAdminAnyDatabase&quot;</span>,db:<span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">#查看已经创建了的用户的情况：</span>
<span class="token operator">&gt;</span> db.system.users.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#删除用户</span>
<span class="token operator">&gt;</span> db.dropUser<span class="token punctuation">(</span><span class="token string">&quot;myadmin&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> db.system.users.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#修改密码</span>
<span class="token operator">&gt;</span> db.changeUserPassword<span class="token punctuation">(</span><span class="token string">&quot;myroot&quot;</span>, <span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><blockquote><p><strong>提示</strong>：</p> <ul><li><p>本案例创建了两个用户，分别对应超管和专门用来管理用户的角色，事实上，你只需要一个用户即可。如果你对安全要求很高，防止超管泄漏，则不要创建超管用户。</p></li> <li><p>和其它数据库（MySQL）一样，权限的管理都差不多一样，也是将用户和权限信息保存到数据库对应的表中。Mongodb存储所有的用户信息在admin 数据库的集合system.users中，保存用户名、密码和数据库信息。</p></li> <li><p>如果不指定数据库，则创建的指定的权限的用户在所有的数据库上有效，如 {role:&quot;userAdminAnyDatabase&quot;, db:&quot;&quot;}</p></li></ul></blockquote> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 认证测试 测试添加的用户是否正确</span>
//切换到admin
<span class="token operator">&gt;</span> use admin
//密码输错
<span class="token operator">&gt;</span> db.auth<span class="token punctuation">(</span><span class="token string">&quot;myroot&quot;</span>,<span class="token string">&quot;12345&quot;</span><span class="token punctuation">)</span>
Error: Authentication failed.
<span class="token number">0</span>
//密码正确
<span class="token operator">&gt;</span> db.auth<span class="token punctuation">(</span><span class="token string">&quot;myroot&quot;</span>,<span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
<span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 创建普通用户</span>
创建普通用户可以在没有开启认证的时候添加，也可以在开启认证之后添加，但开启认证之后，必须使用有操作admin库的用户登录认证后才能作。底层都是将用户信息保存在了admin数据库的集合system.users中。
//创建<span class="token punctuation">(</span>切换<span class="token punctuation">)</span>将来要操作的数据库articledb,
<span class="token operator">&gt;</span> use articledb
//创建用户，拥有articledb数据库的读写权限readWrite，密码是123456
<span class="token operator">&gt;</span> db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user: <span class="token string">&quot;bobo&quot;</span>, pwd: <span class="token string">&quot;123456&quot;</span>, roles: <span class="token punctuation">[</span><span class="token punctuation">{</span> role: <span class="token string">&quot;readWrite&quot;</span>, db:<span class="token string">&quot;articledb&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
//测试是否可用
<span class="token operator">&gt;</span> db.auth<span class="token punctuation">(</span><span class="token string">&quot;bobo&quot;</span>,<span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>

提示：
如果开启了认证后，登录的客户端的用户必须使用admin库的角色，如拥有root角色的myadmin用户，再通过myadmin用户去创建其他角色的用户
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>服务端开启认证和客户端连接登录</strong>:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 有两种方式开启权限认证启动服务：一种是参数方式，一种是配置文件方式。</span>
<span class="token number">1</span>. 参数方式
/usr/local/mongodb/bin/mongod -f /mongodb/single/mongod.conf --auth
<span class="token number">2</span>. 配置
<span class="token function">vim</span> /mongodb/single/mongod.conf
security:
    <span class="token comment">#开启授权认证</span>
    authorization: enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 开启了认证的情况下的客户端登录</span>
<span class="token comment"># 有两种认证方式，一种是先登录，在mongo shell中认证；一种是登录时直接认证。</span>
<span class="token number">1</span>. 先连接再认证
/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27017</span>
db.auth<span class="token punctuation">(</span><span class="token string">&quot;myroot&quot;</span>,<span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
db.system.users.find<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin class-name">exit</span> 退出用户
<span class="token number">2</span>. 连接时直接认证
/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27017</span> --authenticationDatabase admin -u myroot -p <span class="token number">123456</span>

提示：
-u ：用户名
-p ：密码
--authenticationDatabase ：指定连接到哪个库。当登录是指定用户名密码时，必须指定对应的
数据库！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>SpringDataMongoDB连接认证</strong>：</p> <blockquote><p>使用用户名和密码连接到 MongoDB 服务器，你必须使用</p> <p>'<strong>username:password@hostname/dbname</strong>' 格式，</p> <p>'username'为用户名，</p> <p>'password' 为密码。</p></blockquote> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token comment">#数据源配置</span>
    <span class="token key atrule">data</span><span class="token punctuation">:</span>
        <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
            <span class="token comment"># 主机地址</span>
            <span class="token comment"># host: 180.76.159.126</span>
            <span class="token comment"># 数据库</span>
            <span class="token comment"># database: articledb</span>
            <span class="token comment"># 默认端口是27017</span>
            <span class="token comment"># port: 27017</span>
            <span class="token comment">#帐号</span>
            <span class="token comment"># username: bobo</span>
            <span class="token comment">#密码</span>
            <span class="token comment"># password: 123456</span>
            <span class="token comment">#单机有认证的情况下，也使用字符串连接</span>
            <span class="token key atrule">uri</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">:</span>//bobo<span class="token punctuation">:</span>123456@180.76.159.126<span class="token punctuation">:</span>27017/articledb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="副本环境"><a href="#副本环境" class="header-anchor">#</a> 副本环境</h3> <p><strong>对副本集执行访问控制需要配置两个方面</strong>:</p> <ul><li>副本集和共享集群的各个节点成员之间使用内部身份验证，可以使用密钥文件或x.509证书。密钥文件比较简单，本文使用密钥文件，官方推荐如果是测试环境可以使用密钥文件，但是正式环境，官方推荐x.509证书。原理就是，集群中每一个实例彼此连接的时候都检验彼此使用的证书的内容是否相同。只有证书相同的实例彼此才可以访问</li> <li>使用客户端连接到mongodb集群时，开启访问授权。对于集群外部的访问。如通过可视化客户端，或者通过代码连接的时候，需要开启授权。在keyfifile身份验证中，副本集中的每个mongod实例都使用keyfifile的内容作为共享密码，只有具有正确密钥文件的mongod或者mongos实例可以连接到副本集。密钥文件的内容必须在6到1024个字符之间，并且在unix/linux系统中文件所有者必须有对文件至少有读的权限。</li></ul> <p><strong>通过主节点添加一个管理员帐号</strong>：</p> <p>只需要在主节点上添加用户，副本集会自动同步。开启认证之前，创建超管用户：myroot，密码：123456</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>myrs:PRIMARY<span class="token operator">&gt;</span> use admin
switched to db admin
myrs:PRIMARY<span class="token operator">&gt;</span> db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user:<span class="token string">&quot;myroot&quot;</span>,pwd:<span class="token string">&quot;123456&quot;</span>,roles:<span class="token punctuation">[</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>创建副本集认证的key文件</strong>:</p> <p>第一步：生成一个key文件到当前文件夹中。可以使用任何方法生成密钥文件。例如，以下操作使用openssl生成密码文件，然后使用chmod来更改文件权限，仅为文件所有者提供读取权限</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@bobohost ~<span class="token punctuation">]</span><span class="token comment"># openssl rand -base64 90 -out ./mongo.keyfile</span>
<span class="token punctuation">[</span>root@bobohost ~<span class="token punctuation">]</span><span class="token comment"># chmod 400 ./mongo.keyfile</span>
<span class="token punctuation">[</span>root@bobohost ~<span class="token punctuation">]</span><span class="token comment"># ll mongo.keyfile</span>
-r--------. <span class="token number">1</span> root root <span class="token number">122</span> <span class="token number">8</span>月 <span class="token number">14</span> <span class="token number">14</span>:23 mongo.keyfile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>提示</strong>：所有副本集节点都必须要用同一份keyfifile，一般是在一台机器上生成，然后拷贝到其他机器上，且必须有读的权限，否则将来会报错： permissions on</p> <p>/mongodb/replica_sets/myrs_27017/mongo.keyfile are too open</p> <p>一定要保证密钥文件一致，文件位置随便。但是为了方便查找，建议每台机器都放到一个固定的位置，都放到和配置文件一起的目录中。</p> <p>这里将该文件分别拷贝到多个目录中：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@bobohost ~<span class="token punctuation">]</span><span class="token comment"># cp mongo.keyfile /mongodb/replica_sets/myrs_27017</span>
<span class="token punctuation">[</span>root@bobohost ~<span class="token punctuation">]</span><span class="token comment"># cp mongo.keyfile /mongodb/replica_sets/myrs_27018</span>
<span class="token punctuation">[</span>root@bobohost ~<span class="token punctuation">]</span><span class="token comment"># cp mongo.keyfile /mongodb/replica_sets/myrs_27019</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>修改配置文件指定keyfifile</strong></p> <p>分别编辑几个服务的mongod.conf文件，添加相关内容：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># /mongodb/replica_sets/myrs_27017/mongod.conf</span>
security:
    <span class="token comment">#KeyFile鉴权文件</span>
    keyFile: /mongodb/replica_sets/myrs_27017/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    authorization: enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># /mongodb/replica_sets/myrs_27018/mongod.conf</span>
security:
    <span class="token comment">#KeyFile鉴权文件</span>
    keyFile: /mongodb/replica_sets/myrs_27018/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    authorization: enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># /mongodb/replica_sets/myrs_27019/mongod.conf</span>
security:
    <span class="token comment">#KeyFile鉴权文件</span>
    keyFile: /mongodb/replica_sets/myrs_27019/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    authorization: enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>重启</strong>：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#通过进程编号关闭三个节点
kill -2 54410 54361 54257
# 启动
/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27017/mongod.conf
/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27018/mongod.conf
/usr/local/mongodb/bin/mongod -f /mongodb/replica_sets/myrs_27019/mongod.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>在主节点上添加普通账号</strong>：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment">#先用管理员账号登录</span>
<span class="token comment">#切换到admin库</span>
use admin
<span class="token comment">#管理员账号认证</span>
db.auth<span class="token punctuation">(</span><span class="token string">&quot;myroot&quot;</span>,<span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
<span class="token comment">#切换到要认证的库</span>
use articledb
<span class="token comment">#添加普通用户</span>
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user: <span class="token string">&quot;bobo&quot;</span>, pwd: <span class="token string">&quot;123456&quot;</span>, roles: <span class="token punctuation">[</span><span class="token string">&quot;readWrite&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
重新连接，使用普通用户bobo重新登录，查看数据。
注意：也要使用rs.status<span class="token punctuation">(</span><span class="token punctuation">)</span>命令查看副本集是否健康。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>连接</strong>：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token comment">#数据源配置</span>
    <span class="token key atrule">data</span><span class="token punctuation">:</span>
        <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
        <span class="token comment">#副本集有认证的情况下，字符串连接</span>
        <span class="token key atrule">uri</span><span class="token punctuation">:</span>
        mongodb<span class="token punctuation">:</span>//bobo<span class="token punctuation">:</span>123456@180.76.159.126<span class="token punctuation">:</span><span class="token number">27017</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span><span class="token number">27018</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span><span class="token number">2</span>
        7019/articledb<span class="token punctuation">?</span>connect=replicaSet<span class="token important">&amp;slaveOk=true&amp;replicaSet=myrs</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="分片环境"><a href="#分片环境" class="header-anchor">#</a> 分片环境</h3> <p>第一步：生成一个key文件到当前文件夹中。可以使用任何方法生成密钥文件。例如，以下操作使用openssl生成密码文件，然后使用chmod来更改文件权限，仅为文件所有者提供读取权限.</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token punctuation">[</span>root@bobohost ~<span class="token punctuation">]</span><span class="token comment"># openssl rand -base64 90 -out ./mongo.keyfile</span>
<span class="token punctuation">[</span>root@bobohost ~<span class="token punctuation">]</span><span class="token comment"># chmod 400 ./mongo.keyfile</span>
<span class="token punctuation">[</span>root@bobohost ~<span class="token punctuation">]</span><span class="token comment"># ll mongo.keyfile</span>
-r--------. <span class="token number">1</span> root root <span class="token number">122</span> <span class="token number">8</span>月 <span class="token number">14</span> <span class="token number">14</span>:23 mongo.keyfile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>提示</strong>：</p> <p>所有副本集节点都必须要用同一份keyfifile，一般是在一台机器上生成，然后拷贝到其他机器上，且必须有读的权限，否则将来会报错。</p> <p>一定要保证密钥文件一致，文件位置随便。但是为了方便查找，建议每台机器都放到一个固定的位置，都放到和配置文件一起的目录中。</p> <p>这里将该文件分别拷贝到多个目录中：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">echo</span> <span class="token string">'/mongodb/sharded_cluster/myshardrs01_27018/mongo.keyfile
/mongodb/sharded_cluster/myshardrs01_27118/mongo.keyfile
/mongodb/sharded_cluster/myshardrs01_27218/mongo.keyfile
/mongodb/sharded_cluster/myshardrs02_27318/mongo.keyfile
/mongodb/sharded_cluster/myshardrs02_27418/mongo.keyfile
/mongodb/sharded_cluster/myshardrs02_27518/mongo.keyfile
/mongodb/sharded_cluster/myconfigrs_27019/mongo.keyfile
/mongodb/sharded_cluster/myconfigrs_27119/mongo.keyfile
/mongodb/sharded_cluster/myconfigrs_27219/mongo.keyfile
/mongodb/sharded_cluster/mymongos_27017/mongo.keyfile
/mongodb/sharded_cluster/mymongos_27117/mongo.keyfile'</span> <span class="token operator">|</span> <span class="token function">xargs</span> -n <span class="token number">1</span> <span class="token function">cp</span> -v
/root/mongo.keyfile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>修改配置文件指定keyfifile</strong>:</p> <p>分别编辑几个服务的mongod.conf文件，添加相关内容：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/myshardrs01_27018/mongod.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/myshardrs01_27018/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    <span class="token key atrule">authorization</span><span class="token punctuation">:</span> enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/myshardrs01_27118/mongod.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/myshardrs01_27118/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    <span class="token key atrule">authorization</span><span class="token punctuation">:</span> enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/myshardrs01_27218/mongod.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/myshardrs01_27218/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    <span class="token key atrule">authorization</span><span class="token punctuation">:</span> enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># /mongodb/sharded_cluster/myshardrs02_27318/mongod.conf</span>
security:
    <span class="token comment">#KeyFile鉴权文件</span>
    keyFile: /mongodb/sharded_cluster/myshardrs02_27318/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    authorization: enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/myshardrs02_27418/mongod.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/myshardrs02_27418/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    <span class="token key atrule">authorization</span><span class="token punctuation">:</span> enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/myshardrs02_27518/mongod.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/myshardrs02_27518/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    <span class="token key atrule">authorization</span><span class="token punctuation">:</span> enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/myconfigrs_27019/mongod.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/myconfigrs_27019/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    <span class="token key atrule">authorization</span><span class="token punctuation">:</span> enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/myconfigrs_27119/mongod.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/myconfigrs_27119/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    <span class="token key atrule">authorization</span><span class="token punctuation">:</span> enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/myconfigrs_27219/mongod.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/myconfigrs_27219/mongo.keyfile
    <span class="token comment">#开启认证方式运行</span>
    <span class="token key atrule">authorization</span><span class="token punctuation">:</span> enabled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/mymongos_27017/mongos.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/mymongos_27017/mongo.keyfile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># /mongodb/sharded_cluster/mymongos_27117/mongos.conf</span>
<span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token comment">#KeyFile鉴权文件</span>
    <span class="token key atrule">keyFile</span><span class="token punctuation">:</span> /mongodb/sharded_cluster/mymongos_27117/mongo.keyfile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>mongos比mongod少了authorization：enabled的配置。原因是，副本集加分片的安全认证需要配置两方面的，副本集各个节点之间使用内部身份验证，用于内部各个mongo实例的通信，只有相同keyfifile才能相互访问。所以都要开启 keyFile:</p> <p>/mongodb/sharded_cluster/mymongos_27117/mongo.keyfile 。然而对于所有的mongod，才是真正的保存数据的分片。mongos只做路由，不保存数据。所以所有的mongod开启访问数据的授权authorization:enabled。这样用户只有账号密码正确才能访问到数据。</p> <p><strong>重新启动节点</strong></p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># 必须依次启动配置节点、分片节点、路由节点：</span>
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myconfigrs_27019/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myconfigrs_27119/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myconfigrs_27219/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs01_27018/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs01_27118/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs01_27218/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs02_27318/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs02_27418/mongod.conf
/usr/local/mongodb/bin/mongod -f
/mongodb/sharded_cluster/myshardrs02_27518/mongod.conf
/usr/local/mongodb/bin/mongos -f
/mongodb/sharded_cluster/mymongos_27017/mongos.conf
/usr/local/mongodb/bin/mongos -f
/mongodb/sharded_cluster/mymongos_27117/mongos.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>注意</strong>：这里有个非常特别的情况，就是启动顺序。先启动配置节点，再启动分片节点，最后启动路由节点。如果先启动分片节点，会卡住。</p> <p><strong>创建帐号和认证</strong>:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>客户端mongo，通过localhost登录任意一个mongos路由，
<span class="token punctuation">[</span>root@bobohost db<span class="token punctuation">]</span><span class="token comment"># /usr/local/mongodb/bin/mongo --port 27017</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>提示：相当于一个后门，只能在admin下添加用户。
创建一个管理员帐号
mongos<span class="token operator">&gt;</span> use admin
switched to db admin
mongos<span class="token operator">&gt;</span> db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user:<span class="token string">&quot;myroot&quot;</span>,pwd:<span class="token string">&quot;123456&quot;</span>,roles:<span class="token punctuation">[</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
Successfully added user: <span class="token punctuation">{</span> <span class="token string">&quot;user&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;myroot&quot;</span>, <span class="token string">&quot;roles&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;root&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
提示：如果在开启认证之前已经创建了管理员账号，这里可以忽略
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>创建一个普通权限帐号：
mongos<span class="token operator">&gt;</span> use admin
switched to db admin
mongos<span class="token operator">&gt;</span> db.auth<span class="token punctuation">(</span><span class="token string">&quot;myroot&quot;</span>,<span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
<span class="token number">1</span>
mongos<span class="token operator">&gt;</span> use articledb
switched to db articledb
mongos<span class="token operator">&gt;</span> db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span>user: <span class="token string">&quot;bobo&quot;</span>, pwd: <span class="token string">&quot;123456&quot;</span>, roles: <span class="token punctuation">[</span><span class="token punctuation">{</span> role: <span class="token string">&quot;readWrite&quot;</span>,db: <span class="token string">&quot;articledb&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

提示：
通过mongos添加的账号信息，只会保存到配置节点的服务中，具体的数据节点不保存账号信息，因此，分片中的账号信息不涉及到同步问题。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>mongo客户端登录mongos路由，用管理员帐号登录可查看分片情况：
mongos<span class="token operator">&gt;</span> use admin
switched to db admin
mongos<span class="token operator">&gt;</span> db.auth<span class="token punctuation">(</span><span class="token string">&quot;myroot&quot;</span>,<span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
<span class="token number">1</span>
mongos<span class="token operator">&gt;</span> sh.status<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-sh line-numbers-mode"><pre class="language-sh"><code>退出连接，重新连接服务，使用普通权限帐号访问数据：
/usr/local/mongodb/bin/mongo --host <span class="token number">180.76</span>.159.126 --port <span class="token number">27017</span>
mongos<span class="token operator">&gt;</span> use articledb
switched to db articledb
mongos<span class="token operator">&gt;</span> db.auth<span class="token punctuation">(</span><span class="token string">&quot;bobo&quot;</span>,<span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span>
<span class="token number">1</span>
mongos<span class="token operator">&gt;</span> show collections
comment
comment2
mongos<span class="token operator">&gt;</span> db.comment.count<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>SpringDataMongoDB连接认证</strong>：</p> <blockquote><p>使用用户名和密码连接到 MongoDB 服务器，你必须使用</p> <p>'<strong>username:password@hostname/dbname</strong>' 格式，</p> <p>'username'为用户名，</p> <p>'password' 为密码。</p> <p>目标：使用用户bobo使用密码 123456 连接到MongoDB 服务上。</p></blockquote> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token comment">#数据源配置</span>
    <span class="token key atrule">data</span><span class="token punctuation">:</span>
        <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
            <span class="token comment"># 分片集群有认证的情况下，字符串连接</span>
            <span class="token key atrule">uri</span><span class="token punctuation">:</span>
            mongodb<span class="token punctuation">:</span>//bobo<span class="token punctuation">:</span>123456@180.76.159.126<span class="token punctuation">:</span><span class="token number">27017</span><span class="token punctuation">,</span>180.76.159.126<span class="token punctuation">:</span>27117/articledb	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/06/19, 00:50:31</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/546e04/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">设计模式</div></a> <a href="/pages/ba69ad/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">若依二开</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/546e04/" class="prev">设计模式</a></span> <span class="next"><a href="/pages/ba69ad/">若依二开</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f53939/"><div>Spring6</div></a> <span>06-18</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ba69ad/"><div>若依二开</div></a> <span>06-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/546e04/"><div>设计模式</div></a> <span>06-13</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=2461475139&amp;site=qq&amp;menu=yes" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/axcmsm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=6757658477" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>axcmsm | 转载注明出处 </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.e7d9515b.js" defer></script><script src="/assets/js/2.125ae6e8.js" defer></script><script src="/assets/js/116.fd44dc61.js" defer></script>
  </body>
</html>