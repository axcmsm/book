<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MapReduce | ğŸ¦</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="webå‰ç«¯æŠ€æœ¯åšå®¢,ç®€æ´è‡³ä¸Š,ä¸“æ³¨webå‰ç«¯å­¦ä¹ ä¸æ€»ç»“ã€‚JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,githubç­‰æŠ€æœ¯æ–‡ç« ã€‚">
    <meta name="keywords" content="ä¸ªäººæŠ€æœ¯åšå®¢,åç«¯,å¤§æ•°æ®,æŠ€æœ¯æ–‡æ¡£,å­¦ä¹ ,js,vue,python,css3,java,javaEE,SpringBoot,Spring,Hadoop,html5,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.546f0649.css" as="style"><link rel="preload" href="/assets/js/app.e7d9515b.js" as="script"><link rel="preload" href="/assets/js/2.125ae6e8.js" as="script"><link rel="preload" href="/assets/js/18.7cbf0ef4.js" as="script"><link rel="prefetch" href="/assets/js/10.95c2d7b0.js"><link rel="prefetch" href="/assets/js/100.b4e10546.js"><link rel="prefetch" href="/assets/js/101.d6d23fe2.js"><link rel="prefetch" href="/assets/js/102.b368fb26.js"><link rel="prefetch" href="/assets/js/103.b87bfabc.js"><link rel="prefetch" href="/assets/js/104.3d0ae07d.js"><link rel="prefetch" href="/assets/js/105.e9f9588c.js"><link rel="prefetch" href="/assets/js/106.76130cbc.js"><link rel="prefetch" href="/assets/js/107.11dd35ba.js"><link rel="prefetch" href="/assets/js/108.de8bb9b7.js"><link rel="prefetch" href="/assets/js/109.e26f138c.js"><link rel="prefetch" href="/assets/js/11.5682c637.js"><link rel="prefetch" href="/assets/js/110.2c9036b9.js"><link rel="prefetch" href="/assets/js/111.d91b7424.js"><link rel="prefetch" href="/assets/js/112.0edf9093.js"><link rel="prefetch" href="/assets/js/113.dbc0bf4d.js"><link rel="prefetch" href="/assets/js/114.439ad4ee.js"><link rel="prefetch" href="/assets/js/115.0cff9cd8.js"><link rel="prefetch" href="/assets/js/116.fd44dc61.js"><link rel="prefetch" href="/assets/js/117.e893d264.js"><link rel="prefetch" href="/assets/js/118.ec4b3d32.js"><link rel="prefetch" href="/assets/js/119.ea5c3eba.js"><link rel="prefetch" href="/assets/js/12.5a51d307.js"><link rel="prefetch" href="/assets/js/120.9aaee23f.js"><link rel="prefetch" href="/assets/js/121.4fc7842c.js"><link rel="prefetch" href="/assets/js/122.2b8f75d1.js"><link rel="prefetch" href="/assets/js/123.78dbfead.js"><link rel="prefetch" href="/assets/js/124.84b6382a.js"><link rel="prefetch" href="/assets/js/125.c2a2a818.js"><link rel="prefetch" href="/assets/js/126.83ea2963.js"><link rel="prefetch" href="/assets/js/127.dffd5eae.js"><link rel="prefetch" href="/assets/js/128.bb0a0738.js"><link rel="prefetch" href="/assets/js/129.45a56702.js"><link rel="prefetch" href="/assets/js/13.d1b5b29f.js"><link rel="prefetch" href="/assets/js/130.7fee331a.js"><link rel="prefetch" href="/assets/js/131.6aaa557b.js"><link rel="prefetch" href="/assets/js/132.9526e280.js"><link rel="prefetch" href="/assets/js/133.610c1c84.js"><link rel="prefetch" href="/assets/js/134.1dcf27f7.js"><link rel="prefetch" href="/assets/js/14.83de980a.js"><link rel="prefetch" href="/assets/js/15.0fa06ae1.js"><link rel="prefetch" href="/assets/js/16.d1d3c9c1.js"><link rel="prefetch" href="/assets/js/17.c9772d78.js"><link rel="prefetch" href="/assets/js/19.66ee7cfc.js"><link rel="prefetch" href="/assets/js/20.8fbb5432.js"><link rel="prefetch" href="/assets/js/21.74a586bf.js"><link rel="prefetch" href="/assets/js/22.f85a2ced.js"><link rel="prefetch" href="/assets/js/23.a65163b5.js"><link rel="prefetch" href="/assets/js/24.5c2898c6.js"><link rel="prefetch" href="/assets/js/25.929f22ff.js"><link rel="prefetch" href="/assets/js/26.20d74c65.js"><link rel="prefetch" href="/assets/js/27.e790af79.js"><link rel="prefetch" href="/assets/js/28.6b84abe6.js"><link rel="prefetch" href="/assets/js/29.acc0fc34.js"><link rel="prefetch" href="/assets/js/3.dd3750e6.js"><link rel="prefetch" href="/assets/js/30.fadb6cbd.js"><link rel="prefetch" href="/assets/js/31.386f82c2.js"><link rel="prefetch" href="/assets/js/32.e934f71c.js"><link rel="prefetch" href="/assets/js/33.684ac64c.js"><link rel="prefetch" href="/assets/js/34.38f8fd76.js"><link rel="prefetch" href="/assets/js/35.3fe27233.js"><link rel="prefetch" href="/assets/js/36.993695b7.js"><link rel="prefetch" href="/assets/js/37.d735018c.js"><link rel="prefetch" href="/assets/js/38.0d23a384.js"><link rel="prefetch" href="/assets/js/39.808de65c.js"><link rel="prefetch" href="/assets/js/4.4a137b18.js"><link rel="prefetch" href="/assets/js/40.2fc7d5f7.js"><link rel="prefetch" href="/assets/js/41.6647cff7.js"><link rel="prefetch" href="/assets/js/42.f4d93aa6.js"><link rel="prefetch" href="/assets/js/43.a5d40107.js"><link rel="prefetch" href="/assets/js/44.3ae864d3.js"><link rel="prefetch" href="/assets/js/45.c66f1afe.js"><link rel="prefetch" href="/assets/js/46.750f2be2.js"><link rel="prefetch" href="/assets/js/47.1722c1b9.js"><link rel="prefetch" href="/assets/js/48.7c8df7cc.js"><link rel="prefetch" href="/assets/js/49.f9b58d70.js"><link rel="prefetch" href="/assets/js/5.51ca929a.js"><link rel="prefetch" href="/assets/js/50.fad73ad9.js"><link rel="prefetch" href="/assets/js/51.b88c6213.js"><link rel="prefetch" href="/assets/js/52.21244293.js"><link rel="prefetch" href="/assets/js/53.1c2189f3.js"><link rel="prefetch" href="/assets/js/54.95ba12bc.js"><link rel="prefetch" href="/assets/js/55.d8f79989.js"><link rel="prefetch" href="/assets/js/56.63c36b2d.js"><link rel="prefetch" href="/assets/js/57.270857ec.js"><link rel="prefetch" href="/assets/js/58.156073cc.js"><link rel="prefetch" href="/assets/js/59.5a300643.js"><link rel="prefetch" href="/assets/js/6.2dccf462.js"><link rel="prefetch" href="/assets/js/60.92f4ce87.js"><link rel="prefetch" href="/assets/js/61.0f312cea.js"><link rel="prefetch" href="/assets/js/62.0c55901b.js"><link rel="prefetch" href="/assets/js/63.613b1add.js"><link rel="prefetch" href="/assets/js/64.1e5070b6.js"><link rel="prefetch" href="/assets/js/65.dc215238.js"><link rel="prefetch" href="/assets/js/66.4a1319e4.js"><link rel="prefetch" href="/assets/js/67.841428fe.js"><link rel="prefetch" href="/assets/js/68.7380e054.js"><link rel="prefetch" href="/assets/js/69.0a503182.js"><link rel="prefetch" href="/assets/js/7.1096b6fa.js"><link rel="prefetch" href="/assets/js/70.09f4c416.js"><link rel="prefetch" href="/assets/js/71.a279d635.js"><link rel="prefetch" href="/assets/js/72.057aa49f.js"><link rel="prefetch" href="/assets/js/73.767f542c.js"><link rel="prefetch" href="/assets/js/74.3eb6f7e5.js"><link rel="prefetch" href="/assets/js/75.50ecd31e.js"><link rel="prefetch" href="/assets/js/76.602f67fb.js"><link rel="prefetch" href="/assets/js/77.3b5a8e7d.js"><link rel="prefetch" href="/assets/js/78.40c6990e.js"><link rel="prefetch" href="/assets/js/79.ecb155e0.js"><link rel="prefetch" href="/assets/js/8.4b82b135.js"><link rel="prefetch" href="/assets/js/80.d7279b34.js"><link rel="prefetch" href="/assets/js/81.f58f78af.js"><link rel="prefetch" href="/assets/js/82.8399bcab.js"><link rel="prefetch" href="/assets/js/83.67c3c861.js"><link rel="prefetch" href="/assets/js/84.5a8f7c4b.js"><link rel="prefetch" href="/assets/js/85.c6f0af81.js"><link rel="prefetch" href="/assets/js/86.f9f3d0b8.js"><link rel="prefetch" href="/assets/js/87.fec83ae4.js"><link rel="prefetch" href="/assets/js/88.ca11e236.js"><link rel="prefetch" href="/assets/js/89.ae243724.js"><link rel="prefetch" href="/assets/js/9.b8d3ed93.js"><link rel="prefetch" href="/assets/js/90.c242e238.js"><link rel="prefetch" href="/assets/js/91.ad0080a6.js"><link rel="prefetch" href="/assets/js/92.a435d70c.js"><link rel="prefetch" href="/assets/js/93.3232bfbf.js"><link rel="prefetch" href="/assets/js/94.6101d03c.js"><link rel="prefetch" href="/assets/js/95.8c95af7a.js"><link rel="prefetch" href="/assets/js/96.a582908e.js"><link rel="prefetch" href="/assets/js/97.1b560b4f.js"><link rel="prefetch" href="/assets/js/98.a686266f.js"><link rel="prefetch" href="/assets/js/99.e03a81a9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.546f0649.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.ico" alt="ğŸ¦" class="logo"> <span class="site-name can-hide">ğŸ¦</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bigæ•°æ®" class="dropdown-title"><a href="/BigData/" class="link-title">Bigæ•°æ®</a> <span class="title" style="display:none;">Bigæ•°æ®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>å¤§æ•°æ®è·¯çº¿</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">å¼€å‘è·¯çº¿</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linuxå¯¼å›¾</a></li></ul></li><li class="dropdown-item"><h4>å­¦ä¹ ç¬”è®°</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">ã€ŠLinuxã€‹</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">ã€ŠHadoopã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">ã€Šç”Ÿæ€åœˆç»„ä»¶ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">ã€Šæ¶ˆæ¯é˜Ÿåˆ—ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">ã€Šsparkã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" class="nav-link">ã€Šflinkã€‹</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">æŠ€æœ¯æ ˆğŸˆ</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â›³ğŸ–¥" class="dropdown-title"><a href="/technology/" class="link-title">â›³ğŸ–¥</a> <span class="title" style="display:none;">â›³ğŸ–¥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">è®¡ç®—æœºå¿…å¤‡</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">æ•°å­¦åŸºç¡€</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">å­¦ä¹ </a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">æŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">æŠ€æœ¯æ–‡æ¡£</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHubæŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">æœ¬ç«™å…³è”</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">æ”¶è—</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/zzx.jpg"> <div class="blogger-info"><h3>AxcmsmğŸ¼</h3> <span>çºµæœ‰ç–¾é£èµ·ï¼Œäººç”Ÿä¸è¨€å¼ƒğŸ…</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bigæ•°æ®" class="dropdown-title"><a href="/BigData/" class="link-title">Bigæ•°æ®</a> <span class="title" style="display:none;">Bigæ•°æ®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>å¤§æ•°æ®è·¯çº¿</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">å¼€å‘è·¯çº¿</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linuxå¯¼å›¾</a></li></ul></li><li class="dropdown-item"><h4>å­¦ä¹ ç¬”è®°</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">ã€ŠLinuxã€‹</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">ã€ŠHadoopã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">ã€Šç”Ÿæ€åœˆç»„ä»¶ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">ã€Šæ¶ˆæ¯é˜Ÿåˆ—ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">ã€Šsparkã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" class="nav-link">ã€Šflinkã€‹</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">æŠ€æœ¯æ ˆğŸˆ</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â›³ğŸ–¥" class="dropdown-title"><a href="/technology/" class="link-title">â›³ğŸ–¥</a> <span class="title" style="display:none;">â›³ğŸ–¥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">è®¡ç®—æœºå¿…å¤‡</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">æ•°å­¦åŸºç¡€</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">å­¦ä¹ </a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">æŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">æŠ€æœ¯æ–‡æ¡£</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHubæŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">æœ¬ç«™å…³è”</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">æ”¶è—</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>è·¯çº¿orå¯¼å›¾</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>å­¦ä¹ ç¬”è®°</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šlinuxã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>ã€ŠHadoopã€‹</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/hasy2d21do11dop/" class="sidebar-link">Hadoopæ¦‚è¿°</a></li><li><a href="/pages/hdf2shad2o4p3/" class="sidebar-link">Hdfsåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ</a></li><li><a href="/pages/1b8ea6/" aria-current="page" class="active sidebar-link">MapReduce</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#æ¦‚è¿°" class="sidebar-link">æ¦‚è¿°</a></li><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#åºåˆ—åŒ–" class="sidebar-link">åºåˆ—åŒ–</a></li><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#æ¡†æ¶åŸç†ğŸ’¨ğŸ’¨ğŸ’¨ğŸ’¨" class="sidebar-link">æ¡†æ¶åŸç†ğŸ’¨ğŸ’¨ğŸ’¨ğŸ’¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#inputformat" class="sidebar-link">InputFormat</a></li><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#å·¥ä½œæµç¨‹" class="sidebar-link">å·¥ä½œæµç¨‹</a></li><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#shuffleæœºåˆ¶" class="sidebar-link">Shuffleæœºåˆ¶</a></li><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#outputformat" class="sidebar-link">OutputFormat</a></li><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#join" class="sidebar-link">join</a></li><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#etlæ•°æ®æ¸…æ´—" class="sidebar-link">ETLæ•°æ®æ¸…æ´—</a></li><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#æ€»ç»“" class="sidebar-link">æ€»ç»“</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/1b8ea6/#æ•°æ®å‹ç¼©" class="sidebar-link">æ•°æ®å‹ç¼©</a></li></ul></li><li><a href="/pages/a611d4/" class="sidebar-link">yarn</a></li><li><a href="/pages/ad2s1a123s2fa/" class="sidebar-link">Hadoopç”Ÿäº§è°ƒä¼˜</a></li><li><a href="/pages/f225ff/" class="sidebar-link">hadoopæºç è§£æ</a></li><li><a href="/pages/e7984e/" class="sidebar-link">æ€»ç»“hadoop</a></li><li><a href="/pages/9067f7/" class="sidebar-link">HAé«˜å¯ç”¨</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šzookeeperã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šhiveã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šç”Ÿæ€åœˆç»„ä»¶ã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šæ¶ˆæ¯é˜Ÿåˆ—ã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šsparkã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šflinkã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šæ•°æ®å¯è§†åŒ–ã€‹</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é¡¹ç›®</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å®‰è£…</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- æ­£æ–¹å½¢ -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/BigData" title="å¤§æ•°æ®-ç›®å½•é¡µ" data-v-1cd794fe>å¤§æ•°æ®</a></li> <li data-v-1cd794fe><a href="/BigData/#å­¦ä¹ ç¬”è®°" title="å¤§æ•°æ®#å­¦ä¹ ç¬”è®°" data-v-1cd794fe>å­¦ä¹ ç¬”è®°</a></li> <li data-v-1cd794fe><a href="/BigData/#ã€ŠHadoopã€‹" title="å¤§æ•°æ®#ã€ŠHadoopã€‹" data-v-1cd794fe>ã€ŠHadoopã€‹</a></li></ul> <div class="info" data-v-1cd794fe><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/axcmsm" target="_blank" title="ä½œè€…" class="beLink" data-v-1cd794fe>Wei Ye</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-09-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="/img/bj1.jpg">
          MapReduce
        </h1> <div class="page-slot page-slot-top"><!-- å›ºå®š100% * 90pxå¯æ˜¾ç¤ºï¼Œmax-height:90pxæœªè§æ˜¾ç¤º-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="header-anchor">#</a> æ¦‚è¿°</h2> <p>MapReduce æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œå°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„ åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ª Hadoop é›†ç¾¤ä¸Šã€‚</p> <p><strong>ä¼˜ç‚¹</strong>ï¼š</p> <ul><li>æ˜“äºç¼–ç¨‹</li> <li>è‰¯å¥½æ‰©å±•æ€§</li> <li>é«˜å®¹é”™æ€§</li> <li>é€‚åˆ PB çº§ä»¥ä¸Šæµ·é‡æ•°æ®çš„ç¦»çº¿å¤„ç†</li></ul> <p><strong>ç¼ºç‚¹</strong>ï¼š</p> <ul><li>ä¸æ“…é•¿å®æ—¶è®¡ç®—</li> <li>ä¸æ“…é•¿æµå¼è®¡ç®—</li> <li>ä¸æ“…é•¿DAG(æœ‰å‘æ— ç¯å›¾)è®¡ç®—</li></ul> <p><strong>æ ¸å¿ƒæ€æƒ³</strong></p> <blockquote><p>å…ˆåˆ†å†åˆï¼Œåˆ†è€Œæ²»ä¹‹</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>ï¼ˆ1ï¼‰åˆ†å¸ƒå¼çš„è¿ç®—ç¨‹åºå¾€å¾€éœ€è¦åˆ†æˆè‡³å°‘ 2 ä¸ªé˜¶æ®µã€‚
ï¼ˆ2ï¼‰ç¬¬ä¸€ä¸ªé˜¶æ®µçš„ MapTask å¹¶å‘å®ä¾‹ï¼Œå®Œå…¨å¹¶è¡Œè¿è¡Œï¼Œäº’ä¸ç›¸å¹²ã€‚
ï¼ˆ3ï¼‰ç¬¬äºŒä¸ªé˜¶æ®µçš„ ReduceTask å¹¶å‘å®ä¾‹äº’ä¸ç›¸å¹²ï¼Œä½†æ˜¯ä»–ä»¬çš„æ•°æ®ä¾èµ–äºä¸Šä¸€ä¸ªé˜¶æ®µçš„æ‰€æœ‰ MapTask å¹¶å‘å®ä¾‹çš„è¾“å‡ºã€‚
ï¼ˆ4ï¼‰MapReduce ç¼–ç¨‹æ¨¡å‹åªèƒ½åŒ…å«ä¸€ä¸ª Map é˜¶æ®µå’Œä¸€ä¸ª Reduce é˜¶æ®µï¼Œå¦‚æœç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘éå¸¸å¤æ‚ï¼Œé‚£å°±åªèƒ½å¤šä¸ª MapReduce ç¨‹åºï¼Œä¸²è¡Œè¿è¡Œã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>MapReduce è¿›ç¨‹</strong></p> <p>ä¸€ä¸ªå®Œæ•´çš„ MapReduce ç¨‹åºåœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æœ‰ä¸‰ç±»å®ä¾‹è¿›ç¨‹ï¼š</p> <ul><li>MrAppMasterï¼šè´Ÿè´£æ•´ä¸ªç¨‹åºçš„è¿‡ç¨‹è°ƒåº¦åŠçŠ¶æ€åè°ƒ</li> <li>MapTaskï¼šè´Ÿè´£ Map é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹</li> <li>ReduceTaskï¼šè´Ÿè´£ Reduce é˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹ã€‚</li></ul> <p><strong>ç¨‹åºä»£ç åˆ†æˆä¸‰éƒ¨åˆ†</strong>ï¼šç»§æ‰¿</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> - Mapper ä¸­çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨map()æ–¹æ³•ä¸­   ä¸šåŠ¡ä»£ç 
 - Reducerçš„ä¸šåŠ¡é€»è¾‘å†™åœ¨reduce()æ–¹æ³•ä¸­    ä¸šåŠ¡ä»£ç 
 - Driver(å®¢æˆ·ç«¯æäº¤ä½œä¸šé©±åŠ¨ç¨‹åº)   é…ç½®å‚æ•° æ¨¡æ¿ä»£ç 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¯»å–è¾“å‡ºæ•°æ®é»˜è®¤ç»„ä»¶ï¼šè¾“å…¥è¾“å‡ºéƒ½æ˜¯ä»¥kvé”®å€¼æ®µ</p> <p>è¯»å–æ•°æ®ç»„ä»¶InputFormat</p> <p>è¾“å‡ºæ•°æ®ç»„ä»¶OutputFormat</p> <p>è¡Œä¸ºï¼šæ’åºï¼ˆkeyçš„å­—å…¸åºæ’åºï¼‰ã€åˆ†ç»„ï¼ˆreduceé˜¶æ®µkeyç›¸åŒçš„åˆ†ä¸ºä¸€ç»„ï¼Œä¸€ç»„è°ƒç”¨ä¸€æ¬¡reduceå¤„ç†ï¼‰</p> <h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="header-anchor">#</a> åºåˆ—åŒ–</h2> <p>åºåˆ—åŒ–æ¦‚è¿°</p> <p>åºåˆ—åŒ–å°±æ˜¯æŠŠå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œè½¬æ¢æˆå­—èŠ‚åºåˆ—ï¼ˆæˆ–å…¶ä»–æ•°æ®ä¼ è¾“åè®®ï¼‰ä»¥ä¾¿äºå­˜å‚¨åˆ°ç£ ç›˜ï¼ˆæŒä¹…åŒ–ï¼‰å’Œç½‘ç»œä¼ è¾“ã€‚ ååºåˆ—åŒ–å°±æ˜¯å°†æ”¶åˆ°å­—èŠ‚åºåˆ—ï¼ˆæˆ–å…¶ä»–æ•°æ®ä¼ è¾“åè®®ï¼‰æˆ–è€…æ˜¯ç£ç›˜çš„æŒä¹…åŒ–æ•°æ®ï¼Œè½¬æ¢ æˆå†…å­˜ä¸­çš„å¯¹è±¡ã€‚</p> <p>hadoopæ²¡æœ‰é‡‡ç”¨javaçš„åºåˆ—åŒ–æœºåˆ¶,å› ä¸ºæ¯”è¾ƒé‡(éœ€è¦æ£€éªŒå„ç§ä¿¡æ¯ï¼‰ï¼Œhadoopè‡ªå·±å¼€å‘äº†ä¸€å¥—åºåˆ—åŒ–æœºåˆ¶ï¼ˆWritableï¼‰ã€‚</p> <p>Hadoop åºåˆ—åŒ–ç‰¹ç‚¹</p> <ul><li>ç´§å‡‘ï¼šé«˜æ•ˆä½¿ç”¨å­˜å‚¨ç©ºé—´ã€‚</li> <li>å¿«é€Ÿï¼šè¯»å†™æ•°æ®çš„é¢å¤–å¼€é”€å°ã€‚</li> <li>äº’æ“ä½œï¼šæ”¯æŒå¤šè¯­è¨€çš„äº¤äº’</li></ul> <p><strong>hadoopå°è£…çš„æ•°æ®ç±»å‹</strong></p> <table><thead><tr><th>Hadoopæ•°æ®ç±»å‹</th> <th>Javaæ•°æ®ç±»å‹</th></tr></thead> <tbody><tr><td>BooleanWritable</td> <td>boolean</td></tr> <tr><td>ByteWritable</td> <td>byte</td></tr> <tr><td>IntWritable</td> <td>int</td></tr> <tr><td>FloatWritable</td> <td>float</td></tr> <tr><td>LongWritable</td> <td>long</td></tr> <tr><td>DoubleWritable</td> <td>double</td></tr> <tr><td><strong>Text</strong></td> <td>String</td></tr> <tr><td>MapWritable</td> <td>map</td></tr> <tr><td>ArrayWritable</td> <td>array</td></tr> <tr><td>NullWritable</td> <td>null</td></tr></tbody></table> <p><strong>è‡ªå®šä¹‰æ•°æ®ç±»å‹</strong>ï¼š</p> <p>å½“å†…ç½®æ•°æ®ç±»å‹ä¸æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå¯è‡ªå®šä¹‰beanå¯¹è±¡ï¼Œå®ç°åºåˆ—åŒ–æ¥å£Writable</p> <p><strong>æ­¥éª¤</strong>ï¼š</p> <ol><li>å®ç°Writableæ¥å£</li> <li>ååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦åå°„è°ƒç”¨ç©ºå‚æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å¿…é¡»æœ‰ç©ºå‚æ„é€ </li> <li>é‡å†™åºåˆ—åŒ–æ–¹æ³•</li> <li>é‡å†™ååºåˆ—åŒ–æ–¹æ³•</li> <li>æ³¨æ„ååºåˆ—åŒ–çš„é¡ºåºå’Œåºåˆ—åŒ–çš„é¡ºåºå®Œå…¨ä¸€è‡´</li> <li>è¦æƒ³æŠŠç»“æœæ˜¾ç¤ºåœ¨æ–‡ä»¶ä¸­ï¼Œéœ€è¦é‡å†™ toString()ï¼Œå¯ç”¨&quot;\t&quot;åˆ†å¼€ï¼Œæ–¹ä¾¿åç»­ç”¨ã€‚</li> <li>å¦‚æœéœ€è¦å°†è‡ªå®šä¹‰çš„ bean æ”¾åœ¨ key ä¸­ä¼ è¾“ï¼Œåˆ™è¿˜éœ€è¦å®ç° Comparable æ¥å£ï¼Œå› ä¸º MapReduce æ¡†ä¸­çš„ Shuffle è¿‡ç¨‹è¦æ±‚å¯¹ key å¿…é¡»èƒ½æ’åºã€‚</li></ol> <p><strong>æ¡ˆä¾‹</strong>ï¼šç»Ÿè®¡æ¯ä¸€ä¸ªæ‰‹æœºå·è€—è´¹çš„æ€»ä¸Šè¡Œæµé‡ã€æ€»ä¸‹è¡Œæµé‡ã€æ€»æµé‡</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># è¾“å…¥æ•°æ®æ ¼å¼ï¼š
7 13560436666 120.196.100.99 1116 954 200
id æ‰‹æœºå·ç  ç½‘ç»œ ip ä¸Šè¡Œæµé‡ ä¸‹è¡Œæµé‡ ç½‘ç»œçŠ¶æ€ç 
# è¾“å‡ºå‡ºæ•°æ®æ ¼å¼
13560436666 1116 954 2070
æ‰‹æœºå·ç  ä¸Šè¡Œæµé‡ ä¸‹è¡Œæµé‡ æ€»æµé‡
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><details class="custom-block details"><summary>ğŸ’¦</summary> <p>Bean å¯¹è±¡</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//1 ç»§æ‰¿ Writable æ¥å£</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowBean</span> <span class="token keyword">implements</span> <span class="token class-name">Writable</span> <span class="token punctuation">{</span>
 <span class="token keyword">private</span> <span class="token keyword">long</span> upFlow<span class="token punctuation">;</span> <span class="token comment">//ä¸Šè¡Œæµé‡</span>
 <span class="token keyword">private</span> <span class="token keyword">long</span> downFlow<span class="token punctuation">;</span> <span class="token comment">//ä¸‹è¡Œæµé‡</span>
 <span class="token keyword">private</span> <span class="token keyword">long</span> sumFlow<span class="token punctuation">;</span> <span class="token comment">//æ€»æµé‡</span>
 <span class="token comment">//2 æä¾›æ— å‚æ„é€ </span>
 <span class="token keyword">public</span> <span class="token class-name">FlowBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//3 æä¾›ä¸‰ä¸ªå‚æ•°çš„ getter å’Œ setter æ–¹æ³•</span>
 <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getUpFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> upFlow<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUpFlow</span><span class="token punctuation">(</span><span class="token keyword">long</span> upFlow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>upFlow <span class="token operator">=</span> upFlow<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getDownFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> downFlow<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDownFlow</span><span class="token punctuation">(</span><span class="token keyword">long</span> downFlow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>downFlow <span class="token operator">=</span> downFlow<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getSumFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> sumFlow<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSumFlow</span><span class="token punctuation">(</span><span class="token keyword">long</span> sumFlow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>sumFlow <span class="token operator">=</span> sumFlow<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSumFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>sumFlow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>upFlow <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>downFlow<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//4 å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•,æ³¨æ„é¡ºåºä¸€å®šè¦ä¿æŒä¸€è‡´</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">DataOutput</span> dataOutput<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
 dataOutput<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>upFlow<span class="token punctuation">)</span><span class="token punctuation">;</span>
 dataOutput<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>downFlow<span class="token punctuation">)</span><span class="token punctuation">;</span>
 dataOutput<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>sumFlow<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readFields</span><span class="token punctuation">(</span><span class="token class-name">DataInput</span> dataInput<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>upFlow <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>downFlow <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>sumFlow <span class="token operator">=</span> dataInput<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//5 é‡å†™ ToString</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> upFlow <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> downFlow <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> sumFlow<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>ç¼–å†™ Mapper ç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">FlowBean</span><span class="token punctuation">&gt;</span></span> 
<span class="token punctuation">{</span>
 <span class="token keyword">private</span> <span class="token class-name">Text</span> outK <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">private</span> <span class="token class-name">FlowBean</span> outV <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlowBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> 
<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token comment">//1 è·å–ä¸€è¡Œæ•°æ®,è½¬æˆå­—ç¬¦ä¸²</span>
 <span class="token class-name">String</span> line <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//2 åˆ‡å‰²æ•°æ®</span>
 <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//3 æŠ“å–æˆ‘ä»¬éœ€è¦çš„æ•°æ®:æ‰‹æœºå·,ä¸Šè¡Œæµé‡,ä¸‹è¡Œæµé‡</span>
 <span class="token class-name">String</span> phone <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token class-name">String</span> up <span class="token operator">=</span> split<span class="token punctuation">[</span>split<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token class-name">String</span> down <span class="token operator">=</span> split<span class="token punctuation">[</span>split<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token comment">//4 å°è£… outK outV</span>
 outK<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
outV<span class="token punctuation">.</span><span class="token function">setUpFlow</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>up<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 outV<span class="token punctuation">.</span><span class="token function">setDownFlow</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>down<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 outV<span class="token punctuation">.</span><span class="token function">setSumFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//5 å†™å‡º outK outV</span>
 context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>outK<span class="token punctuation">,</span> outV<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>ç¼–å†™ Reducer ç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">FlowBean</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">FlowBean</span><span class="token punctuation">&gt;</span></span> 
<span class="token punctuation">{</span>
 <span class="token keyword">private</span> <span class="token class-name">FlowBean</span> outV <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlowBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FlowBean</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Context</span> 
context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token keyword">long</span> totalUp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token keyword">long</span> totalDown <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token comment">//1 éå† values,å°†å…¶ä¸­çš„ä¸Šè¡Œæµé‡,ä¸‹è¡Œæµé‡åˆ†åˆ«ç´¯åŠ </span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FlowBean</span> flowBean <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 totalUp <span class="token operator">+=</span> flowBean<span class="token punctuation">.</span><span class="token function">getUpFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 totalDown <span class="token operator">+=</span> flowBean<span class="token punctuation">.</span><span class="token function">getDownFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//2 å°è£… outKV</span>
 outV<span class="token punctuation">.</span><span class="token function">setUpFlow</span><span class="token punctuation">(</span>totalUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
 outV<span class="token punctuation">.</span><span class="token function">setDownFlow</span><span class="token punctuation">(</span>totalDown<span class="token punctuation">)</span><span class="token punctuation">;</span>
 outV<span class="token punctuation">.</span><span class="token function">setSumFlow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//3 å†™å‡º outK outV</span>
 context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>outV<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ç¼–å†™ Driver é©±åŠ¨ç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlowDriver</span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> 
<span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token comment">//1 è·å– job å¯¹è±¡</span>
 <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//2 å…³è”æœ¬ Driver ç±»</span>
job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">FlowDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//3 å…³è” Mapper å’Œ Reducer</span>
 job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">FlowMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">FlowReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//4 è®¾ç½® Map ç«¯è¾“å‡º KV ç±»å‹</span>
 job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">FlowBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//5 è®¾ç½®ç¨‹åºæœ€ç»ˆè¾“å‡ºçš„ KV ç±»å‹</span>
 job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">FlowBean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//6 è®¾ç½®ç¨‹åºçš„è¾“å…¥è¾“å‡ºè·¯å¾„</span>
 <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\inputflow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\flowoutput&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//7 æäº¤ Job</span>
 <span class="token keyword">boolean</span> b <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>b <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>æ‰“åŒ…ä¾èµ–</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--                æ‰“åŒ…æ’ä»¶--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-jar-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>archive</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addClasspath</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addClasspath</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classpathPrefix</span><span class="token punctuation">&gt;</span></span>lib/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classpathPrefix</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--                            ä¸»ç±»--&gt;</span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span>Test.ExpressCountDriver_v1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>archive</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></details> <h2 id="æ¡†æ¶åŸç†ğŸ’¨ğŸ’¨ğŸ’¨ğŸ’¨"><a href="#æ¡†æ¶åŸç†ğŸ’¨ğŸ’¨ğŸ’¨ğŸ’¨" class="header-anchor">#</a> æ¡†æ¶åŸç†ğŸ’¨ğŸ’¨ğŸ’¨ğŸ’¨</h2> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210902200949.png" alt=""></p> <h3 id="inputformat"><a href="#inputformat" class="header-anchor">#</a> InputFormat</h3> <p><strong>åˆ‡ç‰‡ä¸ MapTask å¹¶è¡Œåº¦å†³å®šæœºåˆ¶</strong></p> <ul><li><p>æ•°æ®å—ï¼šæ•°æ®å—æ˜¯ HDFS å­˜å‚¨æ•°æ®å•ä½Block</p></li> <li><p>æ•°æ®åˆ‡ç‰‡</p> <blockquote><p>åœ¨é€»è¾‘ä¸Šå¯¹è¾“å…¥è¿›è¡Œåˆ†ç‰‡ï¼Œæ•°æ®åˆ‡ç‰‡æ˜¯ MapReduce ç¨‹åºè®¡ç®—è¾“å…¥æ•°æ®çš„å•ä½,ä¸€ä¸ªåˆ‡ç‰‡ä¼šå¯¹åº”å¯åŠ¨ä¸€ä¸ª MapTaskã€‚</p></blockquote></li></ul> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210902201530.png" alt=""></p> <p><strong>Jobæäº¤æµç¨‹æºç </strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>waitForCompletion()

submit();
// 1 å»ºç«‹è¿æ¥
connect();
// 1ï¼‰åˆ›å»ºæäº¤ Job çš„ä»£ç†
new Cluster(getConfiguration());
// ï¼ˆ1ï¼‰åˆ¤æ–­æ˜¯æœ¬åœ°è¿è¡Œç¯å¢ƒè¿˜æ˜¯ yarn é›†ç¾¤è¿è¡Œç¯å¢ƒ
initialize(jobTrackAddr, conf); 
// 2 æäº¤ job
submitter.submitJobInternal(Job.this, cluster)
// 1ï¼‰åˆ›å»ºç»™é›†ç¾¤æäº¤æ•°æ®çš„ Stag è·¯å¾„
Path jobStagingArea = JobSubmissionFiles.getStagingDir(cluster, conf);
// 2ï¼‰è·å– jobid ï¼Œå¹¶åˆ›å»º Job è·¯å¾„
JobID jobId = submitClient.getNewJobID();
// 3ï¼‰æ‹·è´ jar åŒ…åˆ°é›†ç¾¤
copyAndConfigureFiles(job, submitJobDir);
rUploader.uploadFiles(job, jobSubmitDir);
// 4ï¼‰è®¡ç®—åˆ‡ç‰‡ï¼Œç”Ÿæˆåˆ‡ç‰‡è§„åˆ’æ–‡ä»¶
writeSplits(job, submitJobDir);
maps = writeNewSplits(job, jobSubmitDir);
input.getSplits(job);
// 5ï¼‰å‘ Stag è·¯å¾„å†™ XML é…ç½®æ–‡ä»¶
writeConf(conf, submitJobFile);
conf.writeXml(out);
// 6ï¼‰æäº¤ Job,è¿”å›æäº¤çŠ¶æ€
status = submitClient.submitJob(jobId, submitJobDir.toString(),

job.getCredentials());
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>å›¾è§£ï¼š</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210902201908.png" alt=""></p> <p><strong>åˆ‡ç‰‡æºç è§£æ</strong>ï¼ˆinput.getSplits(job)ï¼‰</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ï¼ˆ1ï¼‰ç¨‹åºå…ˆæ‰¾åˆ°ä½ æ•°æ®å­˜å‚¨çš„ç›®å½•ã€‚
ï¼ˆ2ï¼‰å¼€å§‹éå†å¤„ç†ï¼ˆè§„åˆ’åˆ‡ç‰‡ï¼‰ç›®å½•ä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶
ï¼ˆ3ï¼‰éå†ç¬¬ä¸€ä¸ªæ–‡ä»¶ss.txt
	aï¼‰è·å–æ–‡ä»¶å¤§å°fs.sizeOf(ss.txt)
	bï¼‰è®¡ç®—åˆ‡ç‰‡å¤§å°
computeSplitSize(Math.max(minSize,Math.min(maxSize,blocksize)))=blocksize=128M
	cï¼‰é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ‡ç‰‡å¤§å°=blocksize
	dï¼‰å¼€å§‹åˆ‡ï¼Œå½¢æˆç¬¬1ä¸ªåˆ‡ç‰‡ï¼šss.txtâ€”0:128M ç¬¬2ä¸ªåˆ‡ç‰‡ss.txtâ€”128:256M ç¬¬3ä¸ªåˆ‡ç‰‡ss.txtâ€”256M:300Mï¼ˆæ¯æ¬¡åˆ‡ç‰‡æ—¶ï¼Œéƒ½è¦åˆ¤æ–­åˆ‡å®Œå‰©ä¸‹çš„éƒ¨åˆ†æ˜¯å¦å¤§äºå—çš„1.1å€ï¼Œä¸å¤§äº1.1å€å°±åˆ’åˆ†ä¸€å—åˆ‡ç‰‡ï¼‰
	eï¼‰å°†åˆ‡ç‰‡ä¿¡æ¯å†™åˆ°ä¸€ä¸ªåˆ‡ç‰‡è§„åˆ’æ–‡ä»¶ä¸­
	fï¼‰æ•´ä¸ªåˆ‡ç‰‡çš„æ ¸å¿ƒè¿‡ç¨‹åœ¨getSplit()æ–¹æ³•ä¸­å®Œæˆ
	gï¼‰InputSplitåªè®°å½•äº†åˆ‡ç‰‡çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚èµ·å§‹ä½ç½®ã€é•¿åº¦ä»¥åŠæ‰€åœ¨çš„èŠ‚ç‚¹åˆ—è¡¨ç­‰ã€‚
	
ï¼ˆ4ï¼‰æäº¤åˆ‡ç‰‡è§„åˆ’æ–‡ä»¶åˆ°YARNä¸Šï¼ŒYARNä¸Šçš„MrAppMasterå°±å¯ä»¥æ ¹æ®åˆ‡ç‰‡è§„åˆ’æ–‡ä»¶è®¡ç®—å¼€å¯MapTaskä¸ªæ•°ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>åˆ‡ç‰‡æœºåˆ¶</strong>ï¼š</p> <ul><li>ç®€å•åœ°æŒ‰ç…§æ–‡ä»¶çš„å†…å®¹é•¿åº¦è¿›è¡Œåˆ‡ç‰‡</li> <li>åˆ‡ç‰‡å¤§å°ï¼Œé»˜è®¤ç­‰äºBlockå¤§å°</li> <li>åˆ‡ç‰‡æ—¶ä¸è€ƒè™‘æ•°æ®é›†æ•´ä½“ï¼Œè€Œæ˜¯é’ˆå¯¹æ¯ä¸€ä¸ªæ–‡ä»¶å•ç‹¬åˆ‡ç‰‡</li></ul> <p><strong>åˆ‡ç‰‡å¤§å°çš„å‚æ•°é…ç½®</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ï¼ˆ1ï¼‰æºç ä¸­è®¡ç®—åˆ‡ç‰‡å¤§å°çš„å…¬å¼
Math.max(minSize, Math.min(maxSize, blockSize));
mapreduce.input.fileinputformat.split.minsize=1 é»˜è®¤å€¼ä¸º1
mapreduce.input.fileinputformat.split.maxsize= Long.MAXValue é»˜è®¤å€¼Long.MAXValueå› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ‡ç‰‡å¤§å°=blocksizeã€‚
ï¼ˆ2ï¼‰åˆ‡ç‰‡å¤§å°è®¾ç½®
maxsizeï¼ˆåˆ‡ç‰‡æœ€å¤§å€¼ï¼‰ï¼šå‚æ•°å¦‚æœè°ƒå¾—æ¯”blockSizeå°ï¼Œåˆ™ä¼šè®©åˆ‡ç‰‡å˜å°ï¼Œè€Œä¸”å°±ç­‰äºé…ç½®çš„è¿™ä¸ªå‚æ•°çš„å€¼ã€‚
minsizeï¼ˆåˆ‡ç‰‡æœ€å°å€¼ï¼‰ï¼šå‚æ•°è°ƒçš„æ¯”blockSizeå¤§ï¼Œåˆ™å¯ä»¥è®©åˆ‡ç‰‡å˜å¾—æ¯”blockSizeè¿˜å¤§ã€‚
ï¼ˆ3ï¼‰è·å–åˆ‡ç‰‡ä¿¡æ¯API
// è·å–åˆ‡ç‰‡çš„æ–‡ä»¶åç§°
String name = inputSplit.getPath().getName();
// æ ¹æ®æ–‡ä»¶ç±»å‹è·å–åˆ‡ç‰‡ä¿¡æ¯
FileSplit inputSplit = (FileSplit) context.getInputSplit();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>FileInputFormatå®ç°ç±»</strong></p> <blockquote><p>FileInputFormat å¸¸è§çš„æ¥å£å®ç°ç±»åŒ…æ‹¬ï¼š<strong>TextInputFormat</strong>ã€KeyValueTextInputFormatã€ NLineInputFormatã€<strong>CombineTextInputFormat</strong> å’Œè‡ªå®šä¹‰ InputFormat ç­‰ã€‚</p></blockquote> <p><strong>TextInputFormat</strong></p> <p>TextInputFormat æ˜¯é»˜è®¤çš„ FileInputFormat å®ç°ç±»</p> <blockquote><p>æŒ‰è¡Œè¯»å–æ¯æ¡è®°å½•ã€‚kèµ·å§‹å­—èŠ‚åç§»é‡ï¼Œ LongWritable ç±»å‹ã€‚vè¡Œçš„å†…å®¹Text ç±»å‹ã€‚</p></blockquote> <p><strong>CombineTextInputFormat</strong></p> <blockquote><p>ç”¨äºå°æ–‡ä»¶è¿‡å¤šçš„åœºæ™¯ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªå°æ–‡ä»¶ä»é€»è¾‘ä¸Šè§„åˆ’åˆ° ä¸€ä¸ªåˆ‡ç‰‡ä¸­ï¼Œè¿™æ ·ï¼Œå¤šä¸ªå°æ–‡ä»¶å°±å¯ä»¥äº¤ç»™ä¸€ä¸ª MapTask å¤„ç†.</p> <p>è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®:</p> <p>CombineTextInputFormat.setMaxInputSplitSize(job, 4194304);// 4m</p> <p>æ³¨æ„ï¼šè™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®æœ€å¥½æ ¹æ®å®é™…çš„å°æ–‡ä»¶å¤§å°æƒ…å†µæ¥è®¾ç½®</p> <p>åˆ‡ç‰‡è¿‡ç¨‹ï¼š</p> <ul><li>åˆ¤æ–­å†…å­˜æ–‡ä»¶æ˜¯å¦å¤§äºsetMaxInputSplitSizeå€¼ï¼Œå¤§äºç­‰äºå•ç‹¬å½¢æˆä¸€ä¸ªåˆ‡ç‰‡ã€‚</li> <li>å¦‚æœä¸å¤§äºå°±è·Ÿä¸‹ä¸€ä¸ªè™šæ‹Ÿå­˜å‚¨æ–‡ä»¶è¿›è¡Œåˆå¹¶å½¢æˆä¸€ä¸ªåˆ‡ç‰‡ã€‚</li></ul> <p>ä¾‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>4 ä¸ªå°æ–‡ä»¶å¤§å°åˆ†åˆ«ä¸º 1.7Mã€5.1Mã€3.4M ä»¥åŠ 6.8M
è™šæ‹Ÿå­˜å‚¨ä¹‹åå½¢æˆ 6 ä¸ªæ–‡ä»¶å—ï¼Œå¤§å°åˆ†åˆ«ä¸ºï¼š
 1.7Mï¼Œï¼ˆ2.55Mã€2.55Mï¼‰ï¼Œ3.4M ä»¥åŠï¼ˆ3.4Mã€3.4Mï¼‰ 
æœ€ç»ˆä¼šå½¢æˆ 3 ä¸ªåˆ‡ç‰‡ï¼Œå¤§å°åˆ†åˆ«ä¸ºï¼š ï¼ˆ1.7+2.55ï¼‰Mï¼Œï¼ˆ2.55+3.4ï¼‰Mï¼Œï¼ˆ3.4+3.4ï¼‰
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></blockquote> <p>CombineTextInputFormat æ¡ˆä¾‹</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>è¾“å…¥æ•°æ®
å‡†å¤‡ 4 ä¸ªå°æ–‡ä»¶
æœŸæœ›ä¸€ä¸ªåˆ‡ç‰‡å¤„ç† 4 ä¸ªæ–‡ä»¶
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><details class="custom-block details"><summary>ğŸ’¦</summary> <p>ä¸åšä»»ä½•å¤„ç†ï¼šnumber of splits:4</p> <p>é©±åŠ¨ç±»ä¸­æ·»åŠ ä»£ç </p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// å¦‚æœä¸è®¾ç½® InputFormatï¼Œå®ƒé»˜è®¤ç”¨çš„æ˜¯ TextInputFormat.class
job.setInputFormatClass(CombineTextInputFormat.class);
//è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½® 4m
CombineTextInputFormat.setMaxInputSplitSize(job, 4194304);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è¿è¡Œå¦‚æœä¸º 3 ä¸ªåˆ‡ç‰‡</p> <p>ç»§ç»­åŠ å¤§</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// å¦‚æœä¸è®¾ç½® InputFormatï¼Œå®ƒé»˜è®¤ç”¨çš„æ˜¯ TextInputFormat.class
job.setInputFormatClass(CombineTextInputFormat.class);
//è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½® 20m
CombineTextInputFormat.setMaxInputSplitSize(job, 20971520);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>è¿è¡Œå¦‚æœä¸º 1 ä¸ªåˆ‡ç‰‡</p></details> <h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="header-anchor">#</a> å·¥ä½œæµç¨‹</h3> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210902204417.png" alt=""></p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210902204451.png" alt=""></p> <p>ä¸Šé¢çš„æµç¨‹æ˜¯æ•´ä¸ª MapReduce æœ€å…¨å·¥ä½œæµç¨‹ï¼Œä½†æ˜¯ Shuffle è¿‡ç¨‹åªæ˜¯ä»ç¬¬ 7 æ­¥å¼€å§‹åˆ°ç¬¬ 16 æ­¥ç»“æŸï¼Œå…·ä½“ Shuffle è¿‡ç¨‹è¯¦è§£ï¼Œå¦‚ä¸‹ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ï¼ˆ1ï¼‰MapTask æ”¶é›†æˆ‘ä»¬çš„ map()æ–¹æ³•è¾“å‡ºçš„ kv å¯¹ï¼Œæ”¾åˆ°å†…å­˜ç¼“å†²åŒºä¸­
ï¼ˆ2ï¼‰ä»å†…å­˜ç¼“å†²åŒºä¸æ–­æº¢å‡ºæœ¬åœ°ç£ç›˜æ–‡ä»¶ï¼Œå¯èƒ½ä¼šæº¢å‡ºå¤šä¸ªæ–‡ä»¶
ï¼ˆ3ï¼‰å¤šä¸ªæº¢å‡ºæ–‡ä»¶ä¼šè¢«åˆå¹¶æˆå¤§çš„æº¢å‡ºæ–‡ä»¶
ï¼ˆ4ï¼‰åœ¨æº¢å‡ºè¿‡ç¨‹åŠåˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½è¦è°ƒç”¨ Partitioner è¿›è¡Œåˆ†åŒºå’Œé’ˆå¯¹ key è¿›è¡Œæ’åº
ï¼ˆ5ï¼‰ReduceTask æ ¹æ®è‡ªå·±çš„åˆ†åŒºå·ï¼Œå»å„ä¸ª MapTask æœºå™¨ä¸Šå–ç›¸åº”çš„ç»“æœåˆ†åŒºæ•°æ®
ï¼ˆ6ï¼‰ReduceTask ä¼šæŠ“å–åˆ°åŒä¸€ä¸ªåˆ†åŒºçš„æ¥è‡ªä¸åŒ MapTask çš„ç»“æœæ–‡ä»¶ï¼ŒReduceTask ä¼šå°†è¿™äº›æ–‡ä»¶å†è¿›è¡Œåˆå¹¶ï¼ˆå½’å¹¶æ’åºï¼‰
ï¼ˆ7ï¼‰åˆå¹¶æˆå¤§æ–‡ä»¶åï¼ŒShuffle çš„è¿‡ç¨‹ä¹Ÿå°±ç»“æŸäº†ï¼Œåé¢è¿›å…¥ ReduceTask çš„é€»è¾‘è¿ç®—è¿‡
ç¨‹ï¼ˆä»æ–‡ä»¶ä¸­å–å‡ºä¸€ä¸ªä¸€ä¸ªçš„é”®å€¼å¯¹ Groupï¼Œè°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„ reduce()æ–¹æ³•ï¼‰
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p>ï¼ˆ1ï¼‰Shuffle ä¸­çš„ç¼“å†²åŒºå¤§å°ä¼šå½±å“åˆ° MapReduce ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼ŒåŸåˆ™ä¸Šè¯´ï¼Œç¼“å†²åŒº è¶Šå¤§ï¼Œç£ç›˜ io çš„æ¬¡æ•°è¶Šå°‘ï¼Œæ‰§è¡Œé€Ÿåº¦å°±è¶Šå¿«ã€‚</p> <p>ï¼ˆ2ï¼‰ç¼“å†²åŒºçš„å¤§å°å¯ä»¥é€šè¿‡å‚æ•°è°ƒæ•´ï¼Œå‚æ•°ï¼šmapreduce.task.io.sort.mb é»˜è®¤ 100Mã€‚</p></div> <h3 id="shuffleæœºåˆ¶"><a href="#shuffleæœºåˆ¶" class="header-anchor">#</a> Shuffleæœºåˆ¶</h3> <p>Map æ–¹æ³•ä¹‹åï¼ŒReduce æ–¹æ³•ä¹‹å‰çš„æ•°æ®å¤„ç†è¿‡ç¨‹ç§°ä¹‹ä¸º Shuffleã€‚</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210902205006.png" alt=""></p> <p><strong>Partitionåˆ†åŒº</strong></p> <p>æŒ‰ç…§æ¡ä»¶è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ä¸­ï¼ˆåˆ†åŒºï¼‰</p> <p>é»˜è®¤åˆ†åŒº:æ˜¯æ ¹æ®keyçš„hashCodeå¯¹ReduceTasksä¸ªæ•°å–æ¨¡å¾—åˆ°çš„ã€‚</p> <p>è‡ªå®šä¹‰Partitioneræ­¥éª¤:</p> <ul><li>è‡ªå®šä¹‰ç±»ç»§æ‰¿Partitionerï¼Œé‡å†™getPartition()æ–¹æ³•</li> <li>åœ¨Jobé©±åŠ¨ä¸­ï¼Œè®¾ç½®è‡ªå®šä¹‰Partitioner</li> <li>è‡ªå®šä¹‰Partitionåï¼Œè¦æ ¹æ®è‡ªå®šä¹‰Partitionerçš„é€»è¾‘è®¾ç½®ç›¸åº”æ•°é‡çš„ReduceTask</li></ul> <p><strong>åˆ†åŒºæ€»ç»“</strong>ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ï¼ˆ1ï¼‰å¦‚æœReduceTaskçš„æ•°é‡&gt; getPartitionçš„ç»“æœæ•°ï¼Œåˆ™ä¼šå¤šäº§ç”Ÿå‡ ä¸ªç©ºçš„è¾“å‡ºæ–‡ä»¶part-r-000xxï¼›
ï¼ˆ2ï¼‰å¦‚æœ1&lt;ReduceTaskçš„æ•°é‡&lt;getPartitionçš„ç»“æœæ•°ï¼Œåˆ™æœ‰ä¸€éƒ¨åˆ†åˆ†åŒºæ•°æ®æ— å¤„å®‰æ”¾ï¼Œä¼šExceptionï¼›
ï¼ˆ3ï¼‰å¦‚ æœReduceTaskçš„æ•°é‡=1ï¼Œåˆ™ä¸ç®¡MapTaskç«¯è¾“å‡ºå¤šå°‘ä¸ªåˆ†åŒºæ–‡ä»¶ï¼Œæœ€ç»ˆç»“æœéƒ½äº¤ç»™è¿™ä¸€ä¸ªReduceTaskï¼Œæœ€ç»ˆä¹Ÿå°±åªä¼šäº§ç”Ÿä¸€ä¸ªç»“æœæ–‡ä»¶ part-r-00000ï¼›
ï¼ˆ4ï¼‰åˆ†åŒºå·å¿…é¡»ä»é›¶å¼€å§‹ï¼Œé€ä¸€ç´¯åŠ ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>åˆ†åŒºæ¡ˆä¾‹ï¼š</strong></p> <p>å°†ç»Ÿè®¡ç»“æœæŒ‰ç…§æ‰‹æœºå½’å±åœ°ä¸åŒçœä»½è¾“å‡ºåˆ°ä¸åŒæ–‡ä»¶ä¸­ï¼ˆåˆ†åŒºï¼‰</p> <details class="custom-block details"><summary>ğŸ’¦ğŸ’¦</summary> <p>åˆ†åŒºç±»</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class ProvincePartitioner extends Partitioner&lt;Text, FlowBean&gt; {
 @Override
 public int getPartition(Text text, FlowBean flowBean, int numPartitions) 
{
 //è·å–æ‰‹æœºå·å‰ä¸‰ä½ prePhone
 String phone = text.toString();
 String prePhone = phone.substring(0, 3);
 //å®šä¹‰ä¸€ä¸ªåˆ†åŒºå·å˜é‡ partition,æ ¹æ® prePhone è®¾ç½®åˆ†åŒºå·
 int partition;
 if(&quot;136&quot;.equals(prePhone)){
 partition = 0;
 }else if(&quot;137&quot;.equals(prePhone)){
 partition = 1;
 }else if(&quot;138&quot;.equals(prePhone)){
 partition = 2;
 }else if(&quot;139&quot;.equals(prePhone)){
 partition = 3;
 }else {
 partition = 4;
 }
 //æœ€åè¿”å›åˆ†åŒºå· partition
 return partition;
 }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>é©±åŠ¨ç±»</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class FlowDriver {
 public static void main(String[] args) throws IOException, 
ClassNotFoundException, InterruptedException {
 //1 è·å– job å¯¹è±¡
 Configuration conf = new Configuration();
 Job job = Job.getInstance(conf);
 //2 å…³è”æœ¬ Driver ç±»
 job.setJarByClass(FlowDriver.class);
 //3 å…³è” Mapper å’Œ Reducer
 job.setMapperClass(FlowMapper.class);
 job.setReducerClass(FlowReducer.class);
 //4 è®¾ç½® Map ç«¯è¾“å‡ºæ•°æ®çš„ KV ç±»å‹
 job.setMapOutputKeyClass(Text.class);
 job.setMapOutputValueClass(FlowBean.class);
 //5 è®¾ç½®ç¨‹åºæœ€ç»ˆè¾“å‡ºçš„ KV ç±»å‹
 job.setOutputKeyClass(Text.class);
 job.setOutputValueClass(FlowBean.class);
 //8 æŒ‡å®šè‡ªå®šä¹‰åˆ†åŒºå™¨
 job.setPartitionerClass(ProvincePartitioner.class);
 //9 åŒæ—¶æŒ‡å®šç›¸åº”æ•°é‡çš„ ReduceTask
 job.setNumReduceTasks(5);
 //6 è®¾ç½®è¾“å…¥è¾“å‡ºè·¯å¾„
 FileInputFormat.setInputPaths(job, new Path(&quot;D:\\inputflow&quot;));
 FileOutputFormat.setOutputPath(job, new Path(&quot;D\\partitionout&quot;));
 //7 æäº¤ Job
 boolean b = job.waitForCompletion(true);
 System.exit(b ? 0 : 1);
 }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></details> <p><strong>æ’åº</strong>ï¼š</p> <p>MapTaskå’ŒReduceTaskå‡ä¼šå¯¹æ•°æ®æŒ‰ ç…§keyè¿›è¡Œæ’åºã€‚è¯¥æ“ä½œå±äº Hadoopçš„é»˜è®¤è¡Œä¸ºã€‚ä»»ä½•åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®å‡ä¼šè¢«æ’åºï¼Œè€Œä¸ç®¡é€»è¾‘ä¸Šæ˜¯ å¦éœ€è¦ã€‚</p> <blockquote><p>é»˜è®¤æ’åºæ˜¯æŒ‰ç…§<strong>å­—å…¸</strong>é¡ºåºæ’åºï¼Œä¸”å®ç°è¯¥æ’åºçš„æ–¹æ³•æ˜¯<strong>å¿«é€Ÿ</strong>æ’åºã€‚</p></blockquote> <p>æ’åºæ¦‚è¿°ï¼š</p> <blockquote><p>maptaskå¤„ç†çš„ç»“æœæ”¾åˆ°ç¯å½¢ç¼“å†²åŒºå½“ä¸­ï¼Œå½“å…¶åˆ°è¾¾é˜ˆå€¼åï¼Œä¼šå¯¹å…¶è¿›è¡Œä¸€æ¬¡å¿«é€Ÿæ’åºï¼Œå¹¶å°†è¿™äº›æœ‰åºçš„æ•°æ®æº¢å†™åˆ°ç£ç›˜ä¸Š,å¤„ç†å®Œåå†å¯¹ç£ç›˜çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå½’å¹¶æ’åºã€‚</p> <p>ReduceTaskï¼Œä»æ¯ä¸ªmaptaskä¸­æ‹‰å–(æ‹·è´)æ•°æ®,å½“æ–‡ä»¶å¤§å°è¶…è¿‡é˜ˆå€¼,å°±ä¼šæº¢å†™ç£ç›˜ä¸Šï¼Œå¦åˆ™å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ•°ç›®åˆ°è¾¾ä¸€å®šæ—¶ï¼Œè¿›è¡Œä¸€æ¬¡å½’å¹¶æ’åºç”Ÿæˆæ›´å¤§çš„æ–‡ä»¶ï¼Œå¦‚æœå¤§å°å’Œæ•°é‡è¶…è¿‡ä¸€å®šå€¼æ—¶ï¼Œä¹Ÿä¼šæº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œå½“æ‹‰å–å®Œå…¨éƒ¨æ•°æ®ï¼ŒReduceTaskç»Ÿä¸€å¯¹å†…å­˜å’Œç£ç›˜æ‰€æœ‰æ•°æ®è¿›è¡Œå½’å¹¶æ’åº.</p></blockquote> <p><strong>æ’åºåˆ†ç±»</strong></p> <ul><li>éƒ¨åˆ†æ’åº ï¼ˆä¿è¯æ¯ä¸ªæ–‡ä»¶å†…éƒ¨æœ‰åºï¼‰</li> <li>å…¨æ’åº  ï¼ˆè¾“å‡ºä¸€ä¸ªç»“æœæ–‡ä»¶ï¼Œæ–‡ä»¶å†…éƒ¨æœ‰åºï¼‰</li> <li>è¾…åŠ©æ’åº</li> <li>äºŒæ¬¡æ’åºï¼ˆè‡ªå®šä¹‰ï¼‰ï¼ˆå¯¹compareToæ¯”è¾ƒè§„åˆ™è®¾ç½®å¤šç§åˆ¤æ–­ï¼‰</li></ul> <p><strong>è‡ªå®šä¹‰æ’åº</strong></p> <p>beanå¯¹è±¡ä½œä¸ºkeyä¼ è¾“ï¼Œå®ç°WritableComparable æ¥å£é‡å†™ compareTo æ–¹æ³•</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>@Override
public int compareTo(FlowBean bean) {
int result;
// æŒ‰ç…§æ€»æµé‡å¤§å°ï¼Œå€’åºæ’åˆ—
if (this.sumFlow &gt; bean.getSumFlow()) {
result = -1;
}else if (this.sumFlow &lt; bean.getSumFlow()) {
result = 1;
}else {
result = 0;
}
return result;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>Combiner åˆå¹¶</strong>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ï¼ˆ1ï¼‰Combineræ˜¯MRç¨‹åºä¸­Mapperå’ŒReducerä¹‹å¤–çš„ä¸€ç§ç»„ä»¶ã€‚
ï¼ˆ2ï¼‰Combinerç»„ä»¶çš„çˆ¶ç±»å°±æ˜¯Reducerã€‚
ï¼ˆ3ï¼‰Combinerå’ŒReducerçš„åŒºåˆ«åœ¨äºè¿è¡Œçš„ä½ç½®Combineræ˜¯åœ¨æ¯ä¸€ä¸ªMapTaskæ‰€åœ¨çš„èŠ‚ç‚¹è¿è¡Œ;
ï¼ˆ4ï¼‰Combinerçš„æ„ä¹‰å°±æ˜¯å¯¹æ¯ä¸€ä¸ªMapTaskçš„è¾“å‡ºè¿›è¡Œå±€éƒ¨æ±‡æ€»ï¼Œä»¥å‡å°ç½‘ç»œä¼ è¾“é‡ã€‚
ï¼ˆ5ï¼‰Combinerèƒ½å¤Ÿåº”ç”¨çš„å‰ææ˜¯ä¸èƒ½å½±å“æœ€ç»ˆçš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”ï¼ŒCombinerçš„è¾“å‡ºkvåº”è¯¥è·ŸReducerçš„è¾“å…¥kvç±»å‹è¦å¯¹åº”èµ·æ¥ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>å®ç°æ­¥éª¤ï¼š</p> <ul><li><p>è‡ªå®šä¹‰ä¸€ä¸ª Combiner ç»§æ‰¿ Reducerï¼Œé‡å†™ Reduce æ–¹æ³•</p></li> <li><p>åœ¨ Job é©±åŠ¨ç±»ä¸­è®¾ç½®  ï¼ˆå¦‚æœä¸šåŠ¡é€»è¾‘ä¸€æ ·å¯ç›´æ¥ä½¿ç”¨å†™å¥½Reduceï¼‰</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>job.setCombinerClass(WordCountCombiner.class);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <div class="custom-block warning"><p class="custom-block-title">æ³¨æ„</p> <p>Combiner å¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“ï¼Œä½†ä»–çš„æœ¬è´¨æ˜¯reduce,é‡Œé¢ä¼šæ‰§è¡Œåˆ†åŒºæ’åºåˆå¹¶ç­‰è¡Œä¸ºï¼Œå¯ä»¥ç”¨æ¥æ±‚å’Œï¼Œä½†æ˜¯æ±‚å¹³å‡å€¼æ…ç”¨ï¼</p></div> <h3 id="outputformat"><a href="#outputformat" class="header-anchor">#</a> OutputFormat</h3> <p>outputformatæ˜¯MapReduceè¾“å‡ºçš„åŸºç±»ï¼Œæ‰€æœ‰å®ç°MapReduceè¾“å‡ºéƒ½å®ç°äº† OutputFormat æ¥å£ã€‚</p> <p><strong>å¸¸ç”¨çš„å®ç°ç±»</strong>ï¼š</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20210903141051.png" alt=""></p> <blockquote><p>é»˜è®¤çš„è¾“å‡ºæ ¼å¼æ˜¯ï¼šTextoutputformat</p></blockquote> <p><strong>è‡ªå®šä¹‰outputformat:</strong></p> <p>å½“è¾“å‡ºæ•°æ®åˆ°MySQL/HBase/Elasticsearchç­‰å­˜å‚¨æ¡†æ¶ä¸­æ—¶,æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰</p> <p>æ­¥éª¤ï¼š</p> <ul><li>è‡ªå®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿FileOutputFormatã€‚</li> <li>æ”¹å†™RecordWriterï¼Œå…·ä½“æ”¹å†™è¾“å‡ºæ•°æ®çš„æ–¹æ³•write()ã€‚</li></ul> <p>æ¡ˆä¾‹ï¼š</p> <p>è¿‡æ»¤è¾“å…¥çš„ log æ—¥å¿—ï¼ŒåŒ…å« atguigu çš„ç½‘ç«™è¾“å‡ºåˆ° e:/atguigu.logï¼Œä¸åŒ…å« atguigu çš„ç½‘ç«™</p> <p>::: detalis ğŸ’¦ğŸ’¦</p> <p>mapperç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span><span class="token class-name">Text</span><span class="token punctuation">,</span> 
<span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> 
<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token comment">//ä¸åšä»»ä½•å¤„ç†,ç›´æ¥å†™å‡ºä¸€è¡Œ log æ•°æ®</span>
 context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>reducerç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogReducer</span> <span class="token keyword">extends</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">,</span><span class="token class-name">Text</span><span class="token punctuation">,</span> 
<span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> values<span class="token punctuation">,</span> <span class="token class-name">Context</span> 
context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token comment">// é˜²æ­¢æœ‰ç›¸åŒçš„æ•°æ®,è¿­ä»£å†™å‡º</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NullWritable</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>logforputformatç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogOutputFormat</span> <span class="token keyword">extends</span> <span class="token class-name">FileOutputFormat</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> 
<span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">RecordWriter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> 
<span class="token function">getRecordWriter</span><span class="token punctuation">(</span><span class="token class-name">TaskAttemptContext</span> job<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> 
<span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token comment">//åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ RecordWriter è¿”å›</span>
 <span class="token class-name">LogRecordWriter</span> logRecordWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LogRecordWriter</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> logRecordWriter<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>LogRecordWriterç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogRecordWriter</span> <span class="token keyword">extends</span> <span class="token class-name">RecordWriter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
 <span class="token keyword">private</span> <span class="token class-name">FSDataOutputStream</span> atguiguOut<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">FSDataOutputStream</span> otherOut<span class="token punctuation">;</span>
 <span class="token keyword">public</span> <span class="token class-name">LogRecordWriter</span><span class="token punctuation">(</span><span class="token class-name">TaskAttemptContext</span> job<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">try</span> <span class="token punctuation">{</span>
 <span class="token comment">//è·å–æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡</span>
 <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>job<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//ç”¨æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡åˆ›å»ºä¸¤ä¸ªè¾“å‡ºæµå¯¹åº”ä¸åŒçš„ç›®å½•</span>
 atguiguOut <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;d:/hadoop/atguigu.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 otherOut <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;d:/hadoop/other.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Text</span> key<span class="token punctuation">,</span> <span class="token class-name">NullWritable</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> 
<span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token class-name">String</span> log <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//æ ¹æ®ä¸€è¡Œçš„ log æ•°æ®æ˜¯å¦åŒ…å« atguigu,åˆ¤æ–­ä¸¤æ¡è¾“å‡ºæµè¾“å‡ºçš„å†…å®¹</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;atguigu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 atguiguOut<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>log <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
 otherOut<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>log <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">TaskAttemptContext</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> 
<span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token comment">//å…³æµ</span>
 <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>atguiguOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>otherOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>dirverç±»</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogDriver</span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> 
<span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">LogDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">LogMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setReducerClass</span><span class="token punctuation">(</span><span class="token class-name">LogReducer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//è®¾ç½®è‡ªå®šä¹‰çš„ outputformat</span>
 job<span class="token punctuation">.</span><span class="token function">setOutputFormatClass</span><span class="token punctuation">(</span><span class="token class-name">LogOutputFormat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// è™½ ç„¶ æˆ‘ ä»¬ è‡ª å®š ä¹‰ äº† outputformat ï¼Œ ä½† æ˜¯ å›  ä¸º æˆ‘ ä»¬ çš„ outputformat ç»§æ‰¿è‡ª</span>
fileoutputformat
 <span class="token comment">//è€Œ fileoutputformat è¦è¾“å‡ºä¸€ä¸ª_SUCCESS æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨è¿™è¿˜å¾—æŒ‡å®šä¸€ä¸ªè¾“å‡ºç›®å½•</span>
 <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\logoutput&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">boolean</span> b <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>b <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>:::</p> <h3 id="join"><a href="#join" class="header-anchor">#</a> join</h3> <p>åˆå¹¶,å°†ä¿©ä¸ªä¸åŒçš„æ–‡ä»¶æŒ‰ç…§è§„å¾‹(è”ç³»)åˆæˆä¸€ä¸ªæ–‡ä»¶ã€‚</p> <p>å¯åˆ†ä¸ºï¼š</p> <ul><li><p>mapjoin ï¼ˆé€‚ç”¨ä¸€å¼ è¡¨ååˆ†å°ã€ä¸€å¼ è¡¨å¾ˆå¤§ï¼Œå‡å°‘æ•°æ®å€¾æ–œï¼‰</p> <ul><li><p>åœ¨ Mapper çš„ setup é˜¶æ®µï¼Œå°†æ–‡ä»¶è¯»å–åˆ°ç¼“å­˜é›†åˆä¸­ã€‚</p></li> <li><p>Driver é©±åŠ¨ç±»ä¸­åŠ è½½ç¼“å­˜ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//ç¼“å­˜æ™®é€šæ–‡ä»¶åˆ° Task è¿è¡ŒèŠ‚ç‚¹ã€‚
job.addCacheFile(new URI(&quot;file:///e:/cache/pd.txt&quot;));
//å¦‚æœæ˜¯é›†ç¾¤è¿è¡Œ,éœ€è¦è®¾ç½® HDFS è·¯å¾„
job.addCacheFile(new URI(&quot;hdfs://hadoop102:8020/cache/pd.txt&quot;));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li> <li><p>reducejoin</p></li></ul> <p><strong>reducejoinæ¡ˆä¾‹</strong></p> <details class="custom-block details"><summary>ğŸ’¦ğŸ’¦</summary> <p>TableBean ç±»</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class TableBean implements Writable {
 private String id; //è®¢å• id
 private String pid; //äº§å“ id
 private int amount; //äº§å“æ•°é‡
private String pname; //äº§å“åç§°
 private String flag; //åˆ¤æ–­æ˜¯ order è¡¨è¿˜æ˜¯ pd è¡¨çš„æ ‡å¿—å­—æ®µ
 public TableBean() {
 }
 public String getId() {
 return id;
 }
 public void setId(String id) {
 this.id = id;
 }
 public String getPid() {
 return pid;
 }
 public void setPid(String pid) {
 this.pid = pid;
 }
 public int getAmount() {
 return amount;
 }
 public void setAmount(int amount) {
 this.amount = amount;
 }
 public String getPname() {
 return pname;
 }
 public void setPname(String pname) {
 this.pname = pname;
 }
 public String getFlag() {
 return flag;
 }
 public void setFlag(String flag) {
 this.flag = flag;
 }
 @Override
 public String toString() {
 return id + &quot;\t&quot; + pname + &quot;\t&quot; + amount;
 }
 @Override
 public void write(DataOutput out) throws IOException {
 out.writeUTF(id);
 out.writeUTF(pid);
 out.writeInt(amount);
 out.writeUTF(pname);
 out.writeUTF(flag);
 }
 @Override
 public void readFields(DataInput in) throws IOException {
this.id = in.readUTF();
 this.pid = in.readUTF();
 this.amount = in.readInt();
 this.pname = in.readUTF();
 this.flag = in.readUTF();
 }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>TableMapperç±»</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class TableMapper extends Mapper&lt;LongWritable,Text,Text,TableBean&gt; 
{
 private String filename;
 private Text outK = new Text();
 private TableBean outV = new TableBean();
 @Override
 protected void setup(Context context) throws IOException, 
InterruptedException {
 //è·å–å¯¹åº”æ–‡ä»¶åç§°
 InputSplit split = context.getInputSplit();
 FileSplit fileSplit = (FileSplit) split;
 filename = fileSplit.getPath().getName();
 }
 @Override
 protected void map(LongWritable key, Text value, Context context) 
throws IOException, InterruptedException {
 //è·å–ä¸€è¡Œ
 String line = value.toString();
 //åˆ¤æ–­æ˜¯å“ªä¸ªæ–‡ä»¶,ç„¶åé’ˆå¯¹æ–‡ä»¶è¿›è¡Œä¸åŒçš„æ“ä½œ
 if(filename.contains(&quot;order&quot;)){ //è®¢å•è¡¨çš„å¤„ç†
 String[] split = line.split(&quot;\t&quot;);
 //å°è£… outK
 outK.set(split[1]);
 //å°è£… outV
 outV.setId(split[0]);
 outV.setPid(split[1]);
 outV.setAmount(Integer.parseInt(split[2]));
 outV.setPname(&quot;&quot;);
 outV.setFlag(&quot;order&quot;);
 }else { //å•†å“è¡¨çš„å¤„ç†
 String[] split = line.split(&quot;\t&quot;);
 //å°è£… outK
 outK.set(split[0]);
 //å°è£… outV
 outV.setId(&quot;&quot;);
 outV.setPid(split[0]);
 outV.setAmount(0);
 outV.setPname(split[1]);
outV.setFlag(&quot;pd&quot;);
 }
 //å†™å‡º KV
 context.write(outK,outV);
 }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>TableReducerç±»</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class TableReducer extends Reducer&lt;Text,TableBean,TableBean, 
NullWritable&gt; {
 @Override
 protected void reduce(Text key, Iterable&lt;TableBean&gt; values, Context 
context) throws IOException, InterruptedException {
 ArrayList&lt;TableBean&gt; orderBeans = new ArrayList&lt;&gt;();
 TableBean pdBean = new TableBean();
 for (TableBean value : values) {
 //åˆ¤æ–­æ•°æ®æ¥è‡ªå“ªä¸ªè¡¨
 if(&quot;order&quot;.equals(value.getFlag())){ //è®¢å•è¡¨
 //åˆ›å»ºä¸€ä¸ªä¸´æ—¶ TableBean å¯¹è±¡æ¥æ”¶ value
 TableBean tmpOrderBean = new TableBean();
 try {
 BeanUtils.copyProperties(tmpOrderBean,value);
 } catch (IllegalAccessException e) {
 e.printStackTrace();
 } catch (InvocationTargetException e) {
 e.printStackTrace();
 }
 //å°†ä¸´æ—¶ TableBean å¯¹è±¡æ·»åŠ åˆ°é›†åˆ orderBeans
 orderBeans.add(tmpOrderBean);
 }else { //å•†å“è¡¨
 try {
 BeanUtils.copyProperties(pdBean,value);
 } catch (IllegalAccessException e) {
 e.printStackTrace();
 } catch (InvocationTargetException e) {
 e.printStackTrace();
 }
 }
 }
 //éå†é›†åˆ orderBeans,æ›¿æ¢æ‰æ¯ä¸ª orderBean çš„ pid ä¸º pname,ç„¶åå†™å‡º
 for (TableBean orderBean : orderBeans) {
 orderBean.setPname(pdBean.getPname());
 //å†™å‡ºä¿®æ”¹åçš„ orderBean å¯¹è±¡
 context.write(orderBean,NullWritable.get());
 }
 }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>Driver ç±»</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class TableDriver {
 public static void main(String[] args) throws IOException, 
ClassNotFoundException, InterruptedException {
 Job job = Job.getInstance(new Configuration());
 job.setJarByClass(TableDriver.class);
 job.setMapperClass(TableMapper.class);
 job.setReducerClass(TableReducer.class);
 job.setMapOutputKeyClass(Text.class);
 job.setMapOutputValueClass(TableBean.class);
 job.setOutputKeyClass(TableBean.class);
 job.setOutputValueClass(NullWritable.class);
 FileInputFormat.setInputPaths(job, new Path(&quot;D:\\input&quot;));
 FileOutputFormat.setOutputPath(job, new Path(&quot;D:\\output&quot;));
 boolean b = job.waitForCompletion(true);
 System.exit(b ? 0 : 1);
 }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></details> <div class="custom-block tip"><p class="custom-block-title">ç¼ºç‚¹ï¼š</p> <p>è¿™ç§æ–¹å¼ä¸­ï¼Œåˆå¹¶çš„æ“ä½œæ˜¯åœ¨ Reduce é˜¶æ®µå®Œæˆï¼ŒReduce ç«¯çš„å¤„ç†å‹åŠ›å¤ªå¤§ï¼ŒMap èŠ‚ç‚¹çš„è¿ç®—è´Ÿè½½åˆ™å¾ˆä½ï¼Œèµ„æºåˆ©ç”¨ç‡ä¸é«˜ï¼Œä¸”åœ¨ Reduce é˜¶æ®µææ˜“äº§ç”Ÿæ•°æ®å€¾æ–œã€‚</p> <p>è§£å†³æ–¹æ¡ˆï¼šMap ç«¯å®ç°æ•°æ®åˆå¹¶</p></div> <p><strong>mapjoinæ¡ˆä¾‹</strong></p> <details class="custom-block details"><summary>ğŸ’¦ğŸ’¦</summary> <p>dirverç±»åŠ è½½ç¼“å­˜æ–‡ä»¶</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapJoinDriver</span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> 
<span class="token class-name">URISyntaxException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token comment">// 1 è·å– job ä¿¡æ¯</span>
 <span class="token class-name">Configuration</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">Job</span> job <span class="token operator">=</span> <span class="token class-name">Job</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 2 è®¾ç½®åŠ è½½ jar åŒ…è·¯å¾„</span>
 job<span class="token punctuation">.</span><span class="token function">setJarByClass</span><span class="token punctuation">(</span><span class="token class-name">MapJoinDriver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 3 å…³è” mapper</span>
 job<span class="token punctuation">.</span><span class="token function">setMapperClass</span><span class="token punctuation">(</span><span class="token class-name">MapJoinMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 4 è®¾ç½® Map è¾“å‡º KV ç±»å‹</span>
 job<span class="token punctuation">.</span><span class="token function">setMapOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setMapOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 5 è®¾ç½®æœ€ç»ˆè¾“å‡º KV ç±»å‹</span>
 job<span class="token punctuation">.</span><span class="token function">setOutputKeyClass</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 job<span class="token punctuation">.</span><span class="token function">setOutputValueClass</span><span class="token punctuation">(</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// åŠ è½½ç¼“å­˜æ•°æ®</span>
 job<span class="token punctuation">.</span><span class="token function">addCacheFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URI</span><span class="token punctuation">(</span><span class="token string">&quot;file:///D:/input/tablecache/pd.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// Map ç«¯ Join çš„é€»è¾‘ä¸éœ€è¦ Reduce é˜¶æ®µï¼Œè®¾ç½® reduceTask æ•°é‡ä¸º 0</span>
 job<span class="token punctuation">.</span><span class="token function">setNumReduceTasks</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 6 è®¾ç½®è¾“å…¥è¾“å‡ºè·¯å¾„</span>
 <span class="token class-name">FileInputFormat</span><span class="token punctuation">.</span><span class="token function">setInputPaths</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">FileOutputFormat</span><span class="token punctuation">.</span><span class="token function">setOutputPath</span><span class="token punctuation">(</span>job<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\output&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 7 æäº¤</span>
 <span class="token keyword">boolean</span> b <span class="token operator">=</span> job<span class="token punctuation">.</span><span class="token function">waitForCompletion</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>b <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>MapJoinMapper ç±»ä¸­çš„ setup æ–¹æ³•ä¸­è¯»å–ç¼“å­˜æ–‡ä»¶</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapJoinMapper</span> <span class="token keyword">extends</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LongWritable</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> <span class="token class-name">Text</span><span class="token punctuation">,</span> 
<span class="token class-name">NullWritable</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
 <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> pdMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">private</span> <span class="token class-name">Text</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//ä»»åŠ¡å¼€å§‹å‰å°† pd æ•°æ®ç¼“å­˜è¿› pdMap</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> 
<span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token comment">//é€šè¿‡ç¼“å­˜æ–‡ä»¶å¾—åˆ°å°è¡¨æ•°æ® pd.txt</span>
 URI<span class="token punctuation">[</span><span class="token punctuation">]</span> cacheFiles <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getCacheFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">Path</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span>cacheFiles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//è·å–æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡,å¹¶å¼€æµ</span>
 <span class="token class-name">FileSystem</span> fs <span class="token operator">=</span> <span class="token class-name">FileSystem</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">FSDataInputStream</span> fis <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//é€šè¿‡åŒ…è£…æµè½¬æ¢ä¸º reader,æ–¹ä¾¿æŒ‰è¡Œè¯»å–</span>
 <span class="token class-name">BufferedReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> 
<span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>fis<span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//é€è¡Œè¯»å–ï¼ŒæŒ‰è¡Œå¤„ç†</span>
 <span class="token class-name">String</span> line<span class="token punctuation">;</span>
 <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//åˆ‡å‰²ä¸€è¡Œ </span>
<span class="token comment">//01 å°ç±³</span>
 <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> split <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 pdMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//å…³æµ</span>
 <span class="token class-name">IOUtils</span><span class="token punctuation">.</span><span class="token function">closeStream</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">LongWritable</span> key<span class="token punctuation">,</span> <span class="token class-name">Text</span> value<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> 
<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
 <span class="token comment">//è¯»å–å¤§è¡¨æ•°æ® </span>
<span class="token comment">//1001 01 1</span>
 <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;\t&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//é€šè¿‡å¤§è¡¨æ¯è¡Œæ•°æ®çš„ pid,å» pdMap é‡Œé¢å–å‡º pname</span>
 <span class="token class-name">String</span> pname <span class="token operator">=</span> pdMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//å°†å¤§è¡¨æ¯è¡Œæ•°æ®çš„ pid æ›¿æ¢ä¸º pname</span>
 text<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> pname <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> fields<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//å†™å‡º</span>
 context<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span><span class="token class-name">NullWritable</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div></details> <h3 id="etlæ•°æ®æ¸…æ´—"><a href="#etlæ•°æ®æ¸…æ´—" class="header-anchor">#</a> ETLæ•°æ®æ¸…æ´—</h3> <p>æ•°æ®ä»æ¥æºç«¯ç»è¿‡æŠ½å– ï¼ˆExtractï¼‰ã€è½¬æ¢ï¼ˆTransformï¼‰ã€åŠ è½½ï¼ˆLoadï¼‰è‡³ç›®çš„ç«¯çš„è¿‡ç¨‹ã€‚ç§°ä¸ºetl</p> <p>æ¸…ç†çš„è¿‡ç¨‹å¾€å¾€åªéœ€è¦è¿è¡Œ Mapper ç¨‹åºï¼Œä¸éœ€è¦è¿è¡Œ Reduce ç¨‹åºã€‚</p> <p>æ­¥éª¤ï¼š</p> <ul><li><p>è®¾ç½®æˆªå–è§„åˆ™ï¼ˆé€šå¸¸ç”¨matches(æ­£åˆ™è¡¨è¾¾å¼)æ£€éªŒï¼‰</p></li> <li><p>è®¾ç½®reducetask ä¸ªæ•°ä¸º 0</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>job.setNumReduceTasks(0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h3> <ul><li>è¾“å…¥æ•°æ®æ¥å£ï¼šInputformat
<ul><li>é»˜è®¤å®ç°ç±»ï¼šTextinputformat</li> <li>TextInputFormat çš„åŠŸèƒ½é€»è¾‘æ˜¯ï¼šä¸€æ¬¡è¯»ä¸€è¡Œæ–‡æœ¬ï¼Œç„¶åå°†è¯¥è¡Œçš„èµ·å§‹åç§»é‡ä½œä¸º keyï¼Œè¡Œå†…å®¹ä½œä¸º value è¿”å›ã€‚</li> <li>CombineTextInputFormat å¯ä»¥æŠŠå¤šä¸ªå°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªåˆ‡ç‰‡å¤„ç†ï¼Œæé«˜å¤„ç†æ•ˆç‡ã€‚</li></ul></li> <li>é€»è¾‘å¤„ç†æ¥å£ï¼šMapper
<ul><li>ç”¨æˆ·æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®ç°å…¶ä¸­ä¸‰ä¸ªæ–¹æ³•ï¼šmap() setup() cleanup ()</li></ul></li> <li>Partitioner åˆ†åŒº
<ul><li>æœ‰é»˜è®¤å®ç° HashPartitionerï¼Œé€»è¾‘æ˜¯æ ¹æ® key çš„å“ˆå¸Œå€¼å’Œ numReduces æ¥è¿”å›ä¸€ä¸ª åˆ†åŒºå·ï¼›key.hashCode()&amp;Integer.MAXVALUE % numReduces</li> <li>å¦‚æœä¸šåŠ¡ä¸Šæœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰åˆ†åŒºã€‚</li></ul></li> <li>Comparable æ’åº
<ul><li>å½“æˆ‘ä»¬ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸º key æ¥è¾“å‡ºæ—¶ï¼Œå°±å¿…é¡»è¦å®ç° WritableComparable æ¥ å£ï¼Œé‡å†™å…¶ä¸­çš„ compareTo()æ–¹æ³•ã€‚</li> <li>éƒ¨åˆ†æ’åºï¼šå¯¹æœ€ç»ˆè¾“å‡ºçš„æ¯ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå†…éƒ¨æ’åº</li> <li>å…¨æ’åºï¼šå¯¹æ‰€æœ‰æ•°æ®è¿›è¡Œæ’åºï¼Œé€šå¸¸åªæœ‰ä¸€ä¸ª Reduceã€‚</li> <li>äºŒæ¬¡æ’åºï¼šæ’åºçš„æ¡ä»¶æœ‰ä¸¤ä¸ªã€‚</li></ul></li> <li>Combiner åˆå¹¶
<ul><li>Combiner åˆå¹¶å¯ä»¥æé«˜ç¨‹åºæ‰§è¡Œæ•ˆç‡ï¼Œå‡å°‘ IO ä¼ è¾“ã€‚ä½†æ˜¯ä½¿ç”¨æ—¶å¿…é¡»ä¸èƒ½å½±å“åŸæœ‰çš„ ä¸šåŠ¡å¤„ç†ç»“æœã€‚</li></ul></li> <li>é€»è¾‘å¤„ç†æ¥å£ï¼šReducer
<ul><li>ç”¨æˆ·æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®ç°å…¶ä¸­ä¸‰ä¸ªæ–¹æ³•ï¼šreduce() setup() cleanup ()</li></ul></li> <li>è¾“å‡ºæ•°æ®æ¥å£ï¼šOutputFormat
<ul><li>é»˜è®¤å®ç°ç±»æ˜¯ TextOutputFormatï¼ŒåŠŸèƒ½é€»è¾‘æ˜¯ï¼šå°†æ¯ä¸€ä¸ª KV å¯¹ï¼Œå‘ç›®æ ‡æ–‡æœ¬æ–‡ä»¶ è¾“å‡ºä¸€è¡Œã€‚</li> <li>ç”¨æˆ·è¿˜å¯ä»¥è‡ªå®šä¹‰ OutputFormatã€‚</li></ul></li></ul> <hr> <h2 id="æ•°æ®å‹ç¼©"><a href="#æ•°æ®å‹ç¼©" class="header-anchor">#</a> æ•°æ®å‹ç¼©</h2> <p>ä¼˜ç‚¹/ç¼ºç‚¹ï¼š</p> <ul><li><p>å‡å°‘ç£ç›˜IOï¼Œå‡å°‘å­˜å‚¨ç©ºé—´ï¼ˆä¼˜ç‚¹ï¼‰</p></li> <li><p>å¢åŠ  CPU å¼€é”€ã€‚ï¼ˆç¼ºç‚¹ï¼‰</p></li></ul> <p><strong>å‹ç¼©è§„åˆ™</strong>ï¼š</p> <ul><li>è¿ç®—å¯†é›†å‹çš„ Jobï¼Œå°‘ç”¨å‹ç¼©</li> <li>IO å¯†é›†å‹çš„ Jobï¼Œå¤šç”¨å‹ç¼©</li></ul> <p><strong>MRæ”¯æŒçš„å‹ç¼©ç¼–ç æ ¼å¼ï¼š</strong></p> <table><thead><tr><th>å‹ç¼©æ ¼å¼</th> <th>Hadoop è‡ªå¸¦ï¼Ÿ</th> <th>ç®—æ³•</th> <th>æ–‡ä»¶æ‰©å±•å</th> <th>æ˜¯å¦å¯åˆ‡ç‰‡</th> <th>æ¢æˆå‹ç¼©æ ¼å¼åï¼ŒåŸæ¥çš„ ç¨‹åºæ˜¯å¦éœ€è¦ä¿®æ”¹</th></tr></thead> <tbody><tr><td>DEFLATE</td> <td>æ˜¯ï¼Œç›´æ¥ä½¿ç”¨</td> <td>DEFLATE</td> <td>.deflate</td> <td>å¦</td> <td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ ä¿®æ”¹</td></tr> <tr><td>Gzip</td> <td>æ˜¯,ç›´æ¥ä½¿ç”¨</td> <td>DEFLATE</td> <td>.gz</td> <td>å¦</td> <td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ ä¿®æ”¹</td></tr> <tr><td>bzip2</td> <td>æ˜¯ï¼Œç›´æ¥é€‚ç”¨</td> <td>bzip2</td> <td>.bz2</td> <td>æ˜¯</td> <td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ ä¿®æ”¹</td></tr> <tr><td>LZO</td> <td>å¦ï¼Œéœ€è¦å®‰è£…</td> <td>LZO</td> <td>.lzo</td> <td>æ˜¯</td> <td>éœ€è¦å»ºç´¢å¼•ï¼Œéœ€æŒ‡å®šè¾“å…¥æ ¼å¼</td></tr> <tr><td>Snappy</td> <td>ç›´æ¥é€‚ç”¨</td> <td>Snappy</td> <td>.snappy</td> <td>å¦</td> <td>å’Œæ–‡æœ¬å¤„ç†ä¸€æ ·ï¼Œä¸éœ€è¦ ä¿®æ”¹</td></tr></tbody></table> <p><strong>æ€§èƒ½æ¯”è¾ƒ</strong>ï¼š</p> <table><thead><tr><th>å‹ç¼©ç®—æ³•</th> <th>åŸå§‹æ–‡ä»¶å¤§å°</th> <th>å‹ç¼©æ–‡ä»¶å¤§å°</th> <th>å‹ç¼©é€Ÿåº¦</th> <th>è§£å‹é€Ÿåº¦</th></tr></thead> <tbody><tr><td>gzip</td> <td>8.3GB</td> <td>1.8GB</td> <td>17.5MB/s</td> <td>58MB/s</td></tr> <tr><td>bzip2</td> <td>8.3GB</td> <td>1.1GB</td> <td>2.4MB/s</td> <td>9.5MB/s</td></tr> <tr><td>LZO</td> <td>8.3GB</td> <td>2.9GB</td> <td>49.3MB/s</td> <td>74.6MB/s</td></tr></tbody></table> <p><strong>é€‰æ‹©</strong>ï¼š</p> <p>é€‰æ‹©å‹ç¼©é‡ç‚¹è€ƒè™‘ï¼šå‹ç¼©/è§£å‹ç¼©é€Ÿåº¦ã€å‹ç¼©ç‡ï¼ˆå‹ç¼©åå­˜å‚¨å¤§å°ï¼‰ã€å‹ç¼©åæ˜¯å¦ å¯ä»¥æ”¯æŒåˆ‡ç‰‡ã€‚</p> <ul><li><p>Gzip</p> <blockquote><p>ä¼˜ç‚¹ï¼šå‹ç¼©ç‡æ¯”è¾ƒé«˜ï¼› ç¼ºç‚¹ï¼šä¸æ”¯æŒ Splitï¼›å‹ç¼©/è§£å‹é€Ÿåº¦ä¸€èˆ¬ï¼›</p></blockquote></li> <li><p>Bzip2</p> <blockquote><p>ä¼˜ç‚¹ï¼šå‹ç¼©ç‡é«˜ï¼›æ”¯æŒ Splitï¼› ç¼ºç‚¹ï¼šå‹ç¼©/è§£å‹é€Ÿåº¦æ…¢ã€‚</p></blockquote></li> <li><p>Lzo</p> <blockquote><p>ä¼˜ç‚¹ï¼šå‹ç¼©/è§£å‹é€Ÿåº¦æ¯”è¾ƒå¿«ï¼›æ”¯æŒ Splitï¼› ç¼ºç‚¹ï¼šå‹ç¼©ç‡ä¸€èˆ¬ï¼›æƒ³æ”¯æŒåˆ‡ç‰‡éœ€è¦é¢å¤–åˆ›å»ºç´¢å¼•ã€‚</p></blockquote></li> <li><p>Snappy</p> <blockquote><p>ä¼˜ç‚¹ï¼šå‹ç¼©å’Œè§£å‹ç¼©é€Ÿåº¦å¿«ï¼› ç¼ºç‚¹ï¼šä¸æ”¯æŒ Splitï¼›å‹ç¼©ç‡ä¸€èˆ¬ï¼›</p></blockquote></li></ul> <blockquote><p>é€‰æ‹©çš„ä½ç½®ï¼šå¯åœ¨ MapReduce ä½œç”¨çš„ä»»æ„é˜¶æ®µå¯ç”¨ã€‚</p></blockquote> <p><strong>å‹ç¼©å‚æ•°é…ç½®</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å‹ç¼©æ ¼å¼      å¯¹åº”çš„ç¼–ç /è§£ç å™¨
DEFLATE     org.apache.hadoop.io.compress.DefaultCodec
gzip        org.apache.hadoop.io.compress.GzipCodec
bzip2       org.apache.hadoop.io.compress.BZip2Codec
LZO         com.hadoop.compression.lzo.LzopCodec
Snappy      org.apache.hadoop.io.compress.SnappyCodec
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Hadoop ä¸­å¯ç”¨å‹ç¼©ï¼Œå¯ä»¥é…ç½®å¦‚ä¸‹å‚æ•°ï¼š</p> <table><thead><tr><th>å‚æ•°</th> <th>é»˜è®¤å€¼</th> <th>é˜¶æ®µ</th> <th>å»ºè®®</th></tr></thead> <tbody><tr><td>io.compression.codecs  ï¼ˆåœ¨ core-site.xml ä¸­é…ç½®ï¼‰</td> <td>æ— ï¼Œè¿™ä¸ªéœ€è¦åœ¨å‘½ä»¤è¡Œè¾“å…¥ hadoop checknative æŸ¥çœ‹</td> <td>è¾“å…¥å‹ç¼©</td> <td>Hadoop ä½¿ç”¨æ–‡ä»¶æ‰©å±• ååˆ¤æ–­æ˜¯å¦æ”¯æŒæŸç§ ç¼–è§£ç å™¨</td></tr> <tr><td>mapreduce.map.output.compr essï¼ˆåœ¨ mapred-site.xml ä¸­ é…ç½®ï¼‰</td> <td>false</td> <td>mapper è¾“å‡º</td> <td>è¿™ä¸ªå‚æ•°è®¾ä¸º true å¯ ç”¨å‹ç¼©</td></tr> <tr><td>mapreduce.map.output.compr ess.codecï¼ˆåœ¨ mapredsite.xml ä¸­é…ç½®ï¼‰</td> <td>org.apache.hadoop.io.com press.DefaultCodec</td> <td>mapper è¾“å‡º</td> <td>ä¼ä¸šå¤šä½¿ç”¨ LZO æˆ– Snappy ç¼–è§£ç å™¨åœ¨æ­¤ é˜¶æ®µå‹ç¼©æ•°æ®</td></tr> <tr><td>mapreduce.output.fileoutpu tformat.compressï¼ˆåœ¨ mapred-site.xml ä¸­é…ç½®ï¼‰</td> <td>false</td> <td>reducer è¾“å‡º</td> <td>å‚æ•°è®¾ä¸º true å¯ ç”¨å‹ç¼©</td></tr> <tr><td>mapreduce.output.fileoutpu tformat.compress.codecï¼ˆåœ¨ mapred-site.xml ä¸­é…ç½®ï¼‰</td> <td>org.apache.hadoop.io.com press.DefaultCodec</td> <td>reducer è¾“å‡º</td> <td>ä½¿ç”¨æ ‡å‡†å·¥å…·æˆ–è€…ç¼– è§£ç å™¨ï¼Œå¦‚ gzip å’Œ bzip2</td></tr></tbody></table> <p><strong>æ¡ˆä¾‹</strong>ï¼š</p> <details class="custom-block details"><summary>ğŸ’¦ğŸ’¦</summary> <p>åœ¨Map è¾“å‡ºç«¯é‡‡ç”¨å‹ç¼©</p> <p>driver</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// å¼€å¯ map ç«¯è¾“å‡ºå‹ç¼©
conf.setBoolean(&quot;mapreduce.map.output.compress&quot;, true);
// è®¾ç½® map ç«¯è¾“å‡ºå‹ç¼©æ–¹å¼
conf.setClass(&quot;mapreduce.map.output.compress.codec&quot;, 
BZip2Codec.class,CompressionCodec.class);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Reduce è¾“å‡ºç«¯é‡‡ç”¨å‹ç¼©</p> <p>dirver</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// è®¾ç½® reduce ç«¯è¾“å‡ºå‹ç¼©å¼€å¯
FileOutputFormat.setCompressOutput(job, true);
// è®¾ç½®å‹ç¼©çš„æ–¹å¼
 FileOutputFormat.setOutputCompressorClass(job, BZip2Codec.class); 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details> <hr> <p>ğŸ¥šğŸ¥šğŸ¥šğŸ¥šğŸ¥šğŸ¥šğŸ¥š<strong>å¸¸è§é”™è¯¯</strong>ï¼š</p> <ul><li>å¯¼åŒ…å®¹æ˜“å‡ºé”™ã€‚</li> <li>Mapper ä¸­ç¬¬ä¸€ä¸ªè¾“å…¥çš„å‚æ•°å¿…é¡»æ˜¯ LongWritable æˆ–è€… NullWritableï¼Œä¸å¯ä»¥æ˜¯ IntWritable.  æŠ¥çš„é”™è¯¯æ˜¯ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚</li> <li>java.lang.Exception: java.io.IOException: Illegal partition for 13926435656 (4)ï¼Œè¯´æ˜ Partition å’Œ ReduceTask ä¸ªæ•°æ²¡å¯¹ä¸Šï¼Œè°ƒæ•´ ReduceTask ä¸ªæ•°ã€‚</li> <li>å¦‚æœåˆ†åŒºæ•°ä¸æ˜¯ 1ï¼Œä½†æ˜¯ reducetask ä¸º 1ï¼Œæ˜¯å¦æ‰§è¡Œåˆ†åŒºè¿‡ç¨‹ã€‚ç­”æ¡ˆæ˜¯ï¼šä¸æ‰§è¡Œåˆ†åŒºè¿‡ç¨‹ã€‚ å› ä¸ºåœ¨ MapTask çš„æºç ä¸­ï¼Œæ‰§è¡Œåˆ†åŒºçš„å‰ææ˜¯å…ˆåˆ¤æ–­ ReduceNum ä¸ªæ•°æ˜¯å¦å¤§äº 1ã€‚ä¸å¤§äº 1 è‚¯å®šä¸æ‰§è¡Œã€‚</li> <li>åœ¨ Windows ç¯å¢ƒç¼–è¯‘çš„ jar åŒ…å¯¼å…¥åˆ° Linux ç¯å¢ƒä¸­è¿è¡Œï¼ˆæŸ¥çœ‹jdkç‰ˆæœ¬ï¼‰</li> <li>ç¼“å­˜ pd.txt å°æ–‡ä»¶æ¡ˆä¾‹ä¸­ï¼ŒæŠ¥æ‰¾ä¸åˆ° pd.txt æ–‡ä»¶ï¼ˆè·¯å¾„é—®é¢˜ï¼‰</li> <li>æŠ¥ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚</li> <li>è‡ªå®šä¹‰ Outputformat æ—¶ï¼Œæ³¨æ„åœ¨ RecordWirter ä¸­çš„ close æ–¹æ³•å¿…é¡»å…³é—­æµèµ„æºã€‚ï¼ˆè¾“å‡ºç©ºæ–‡ä»¶ï¼‰</li></ul></div></div> <div class="page-slot page-slot-bottom"><!-- æ¨ªå‘è‡ªé€‚åº” -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=mapreduce" title="æ ‡ç­¾">#mapreduce</a></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2023/03/22, 21:16:55</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/hdf2shad2o4p3/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Hdfsåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ</div></a> <a href="/pages/a611d4/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">yarn</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/hdf2shad2o4p3/" class="prev">Hdfsåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿ</a></span> <span class="next"><a href="/pages/a611d4/">yarn</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f53939/"><div>Spring6</div></a> <span>06-18</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ba69ad/"><div>è‹¥ä¾äºŒå¼€</div></a> <span>06-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/998714/"><div>MongoDB</div></a> <span>06-16</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=2461475139&amp;site=qq&amp;menu=yes" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/axcmsm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=6757658477" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2021-2023
    <span>axcmsm | è½¬è½½æ³¨æ˜å‡ºå¤„ </span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">Ã—</i> <div><!-- å›ºå®š160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.e7d9515b.js" defer></script><script src="/assets/js/2.125ae6e8.js" defer></script><script src="/assets/js/18.7cbf0ef4.js" defer></script>
  </body>
</html>