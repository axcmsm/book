<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>flinkç¬”è®° | ğŸ¦</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="webå‰ç«¯æŠ€æœ¯åšå®¢,ç®€æ´è‡³ä¸Š,ä¸“æ³¨webå‰ç«¯å­¦ä¹ ä¸æ€»ç»“ã€‚JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,githubç­‰æŠ€æœ¯æ–‡ç« ã€‚">
    <meta name="keywords" content="ä¸ªäººæŠ€æœ¯åšå®¢,åç«¯,å¤§æ•°æ®,æŠ€æœ¯æ–‡æ¡£,å­¦ä¹ ,js,vue,python,css3,java,javaEE,SpringBoot,Spring,Hadoop,html5,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.546f0649.css" as="style"><link rel="preload" href="/assets/js/app.e7d9515b.js" as="script"><link rel="preload" href="/assets/js/2.125ae6e8.js" as="script"><link rel="preload" href="/assets/js/47.1722c1b9.js" as="script"><link rel="prefetch" href="/assets/js/10.95c2d7b0.js"><link rel="prefetch" href="/assets/js/100.b4e10546.js"><link rel="prefetch" href="/assets/js/101.d6d23fe2.js"><link rel="prefetch" href="/assets/js/102.b368fb26.js"><link rel="prefetch" href="/assets/js/103.b87bfabc.js"><link rel="prefetch" href="/assets/js/104.3d0ae07d.js"><link rel="prefetch" href="/assets/js/105.e9f9588c.js"><link rel="prefetch" href="/assets/js/106.76130cbc.js"><link rel="prefetch" href="/assets/js/107.11dd35ba.js"><link rel="prefetch" href="/assets/js/108.de8bb9b7.js"><link rel="prefetch" href="/assets/js/109.e26f138c.js"><link rel="prefetch" href="/assets/js/11.5682c637.js"><link rel="prefetch" href="/assets/js/110.2c9036b9.js"><link rel="prefetch" href="/assets/js/111.d91b7424.js"><link rel="prefetch" href="/assets/js/112.0edf9093.js"><link rel="prefetch" href="/assets/js/113.dbc0bf4d.js"><link rel="prefetch" href="/assets/js/114.439ad4ee.js"><link rel="prefetch" href="/assets/js/115.0cff9cd8.js"><link rel="prefetch" href="/assets/js/116.fd44dc61.js"><link rel="prefetch" href="/assets/js/117.e893d264.js"><link rel="prefetch" href="/assets/js/118.ec4b3d32.js"><link rel="prefetch" href="/assets/js/119.ea5c3eba.js"><link rel="prefetch" href="/assets/js/12.5a51d307.js"><link rel="prefetch" href="/assets/js/120.9aaee23f.js"><link rel="prefetch" href="/assets/js/121.4fc7842c.js"><link rel="prefetch" href="/assets/js/122.2b8f75d1.js"><link rel="prefetch" href="/assets/js/123.78dbfead.js"><link rel="prefetch" href="/assets/js/124.84b6382a.js"><link rel="prefetch" href="/assets/js/125.c2a2a818.js"><link rel="prefetch" href="/assets/js/126.83ea2963.js"><link rel="prefetch" href="/assets/js/127.dffd5eae.js"><link rel="prefetch" href="/assets/js/128.bb0a0738.js"><link rel="prefetch" href="/assets/js/129.45a56702.js"><link rel="prefetch" href="/assets/js/13.d1b5b29f.js"><link rel="prefetch" href="/assets/js/130.7fee331a.js"><link rel="prefetch" href="/assets/js/131.6aaa557b.js"><link rel="prefetch" href="/assets/js/132.9526e280.js"><link rel="prefetch" href="/assets/js/133.610c1c84.js"><link rel="prefetch" href="/assets/js/134.1dcf27f7.js"><link rel="prefetch" href="/assets/js/14.83de980a.js"><link rel="prefetch" href="/assets/js/15.0fa06ae1.js"><link rel="prefetch" href="/assets/js/16.d1d3c9c1.js"><link rel="prefetch" href="/assets/js/17.c9772d78.js"><link rel="prefetch" href="/assets/js/18.7cbf0ef4.js"><link rel="prefetch" href="/assets/js/19.66ee7cfc.js"><link rel="prefetch" href="/assets/js/20.8fbb5432.js"><link rel="prefetch" href="/assets/js/21.74a586bf.js"><link rel="prefetch" href="/assets/js/22.f85a2ced.js"><link rel="prefetch" href="/assets/js/23.a65163b5.js"><link rel="prefetch" href="/assets/js/24.5c2898c6.js"><link rel="prefetch" href="/assets/js/25.929f22ff.js"><link rel="prefetch" href="/assets/js/26.20d74c65.js"><link rel="prefetch" href="/assets/js/27.e790af79.js"><link rel="prefetch" href="/assets/js/28.6b84abe6.js"><link rel="prefetch" href="/assets/js/29.acc0fc34.js"><link rel="prefetch" href="/assets/js/3.dd3750e6.js"><link rel="prefetch" href="/assets/js/30.fadb6cbd.js"><link rel="prefetch" href="/assets/js/31.386f82c2.js"><link rel="prefetch" href="/assets/js/32.e934f71c.js"><link rel="prefetch" href="/assets/js/33.684ac64c.js"><link rel="prefetch" href="/assets/js/34.38f8fd76.js"><link rel="prefetch" href="/assets/js/35.3fe27233.js"><link rel="prefetch" href="/assets/js/36.993695b7.js"><link rel="prefetch" href="/assets/js/37.d735018c.js"><link rel="prefetch" href="/assets/js/38.0d23a384.js"><link rel="prefetch" href="/assets/js/39.808de65c.js"><link rel="prefetch" href="/assets/js/4.4a137b18.js"><link rel="prefetch" href="/assets/js/40.2fc7d5f7.js"><link rel="prefetch" href="/assets/js/41.6647cff7.js"><link rel="prefetch" href="/assets/js/42.f4d93aa6.js"><link rel="prefetch" href="/assets/js/43.a5d40107.js"><link rel="prefetch" href="/assets/js/44.3ae864d3.js"><link rel="prefetch" href="/assets/js/45.c66f1afe.js"><link rel="prefetch" href="/assets/js/46.750f2be2.js"><link rel="prefetch" href="/assets/js/48.7c8df7cc.js"><link rel="prefetch" href="/assets/js/49.f9b58d70.js"><link rel="prefetch" href="/assets/js/5.51ca929a.js"><link rel="prefetch" href="/assets/js/50.fad73ad9.js"><link rel="prefetch" href="/assets/js/51.b88c6213.js"><link rel="prefetch" href="/assets/js/52.21244293.js"><link rel="prefetch" href="/assets/js/53.1c2189f3.js"><link rel="prefetch" href="/assets/js/54.95ba12bc.js"><link rel="prefetch" href="/assets/js/55.d8f79989.js"><link rel="prefetch" href="/assets/js/56.63c36b2d.js"><link rel="prefetch" href="/assets/js/57.270857ec.js"><link rel="prefetch" href="/assets/js/58.156073cc.js"><link rel="prefetch" href="/assets/js/59.5a300643.js"><link rel="prefetch" href="/assets/js/6.2dccf462.js"><link rel="prefetch" href="/assets/js/60.92f4ce87.js"><link rel="prefetch" href="/assets/js/61.0f312cea.js"><link rel="prefetch" href="/assets/js/62.0c55901b.js"><link rel="prefetch" href="/assets/js/63.613b1add.js"><link rel="prefetch" href="/assets/js/64.1e5070b6.js"><link rel="prefetch" href="/assets/js/65.dc215238.js"><link rel="prefetch" href="/assets/js/66.4a1319e4.js"><link rel="prefetch" href="/assets/js/67.841428fe.js"><link rel="prefetch" href="/assets/js/68.7380e054.js"><link rel="prefetch" href="/assets/js/69.0a503182.js"><link rel="prefetch" href="/assets/js/7.1096b6fa.js"><link rel="prefetch" href="/assets/js/70.09f4c416.js"><link rel="prefetch" href="/assets/js/71.a279d635.js"><link rel="prefetch" href="/assets/js/72.057aa49f.js"><link rel="prefetch" href="/assets/js/73.767f542c.js"><link rel="prefetch" href="/assets/js/74.3eb6f7e5.js"><link rel="prefetch" href="/assets/js/75.50ecd31e.js"><link rel="prefetch" href="/assets/js/76.602f67fb.js"><link rel="prefetch" href="/assets/js/77.3b5a8e7d.js"><link rel="prefetch" href="/assets/js/78.40c6990e.js"><link rel="prefetch" href="/assets/js/79.ecb155e0.js"><link rel="prefetch" href="/assets/js/8.4b82b135.js"><link rel="prefetch" href="/assets/js/80.d7279b34.js"><link rel="prefetch" href="/assets/js/81.f58f78af.js"><link rel="prefetch" href="/assets/js/82.8399bcab.js"><link rel="prefetch" href="/assets/js/83.67c3c861.js"><link rel="prefetch" href="/assets/js/84.5a8f7c4b.js"><link rel="prefetch" href="/assets/js/85.c6f0af81.js"><link rel="prefetch" href="/assets/js/86.f9f3d0b8.js"><link rel="prefetch" href="/assets/js/87.fec83ae4.js"><link rel="prefetch" href="/assets/js/88.ca11e236.js"><link rel="prefetch" href="/assets/js/89.ae243724.js"><link rel="prefetch" href="/assets/js/9.b8d3ed93.js"><link rel="prefetch" href="/assets/js/90.c242e238.js"><link rel="prefetch" href="/assets/js/91.ad0080a6.js"><link rel="prefetch" href="/assets/js/92.a435d70c.js"><link rel="prefetch" href="/assets/js/93.3232bfbf.js"><link rel="prefetch" href="/assets/js/94.6101d03c.js"><link rel="prefetch" href="/assets/js/95.8c95af7a.js"><link rel="prefetch" href="/assets/js/96.a582908e.js"><link rel="prefetch" href="/assets/js/97.1b560b4f.js"><link rel="prefetch" href="/assets/js/98.a686266f.js"><link rel="prefetch" href="/assets/js/99.e03a81a9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.546f0649.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="ç›®å½•" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.ico" alt="ğŸ¦" class="logo"> <span class="site-name can-hide">ğŸ¦</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bigæ•°æ®" class="dropdown-title"><a href="/BigData/" class="link-title">Bigæ•°æ®</a> <span class="title" style="display:none;">Bigæ•°æ®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>å¤§æ•°æ®è·¯çº¿</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">å¼€å‘è·¯çº¿</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linuxå¯¼å›¾</a></li></ul></li><li class="dropdown-item"><h4>å­¦ä¹ ç¬”è®°</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">ã€ŠLinuxã€‹</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">ã€ŠHadoopã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">ã€Šç”Ÿæ€åœˆç»„ä»¶ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">ã€Šæ¶ˆæ¯é˜Ÿåˆ—ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">ã€Šsparkã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" aria-current="page" class="nav-link router-link-exact-active router-link-active">ã€Šflinkã€‹</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">æŠ€æœ¯æ ˆğŸˆ</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â›³ğŸ–¥" class="dropdown-title"><a href="/technology/" class="link-title">â›³ğŸ–¥</a> <span class="title" style="display:none;">â›³ğŸ–¥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">è®¡ç®—æœºå¿…å¤‡</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">æ•°å­¦åŸºç¡€</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">å­¦ä¹ </a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">æŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">æŠ€æœ¯æ–‡æ¡£</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHubæŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">æœ¬ç«™å…³è”</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">æ”¶è—</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/zzx.jpg"> <div class="blogger-info"><h3>AxcmsmğŸ¼</h3> <span>çºµæœ‰ç–¾é£èµ·ï¼Œäººç”Ÿä¸è¨€å¼ƒğŸ…</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bigæ•°æ®" class="dropdown-title"><a href="/BigData/" class="link-title">Bigæ•°æ®</a> <span class="title" style="display:none;">Bigæ•°æ®</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>å¤§æ•°æ®è·¯çº¿</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2asd1/" class="nav-link">å¼€å‘è·¯çº¿</a></li><li class="dropdown-subitem"><a href="/pages/5cda13/" class="nav-link">linuxå¯¼å›¾</a></li></ul></li><li class="dropdown-item"><h4>å­¦ä¹ ç¬”è®°</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/l2sdd2ad123/" class="nav-link">ã€ŠLinuxã€‹</a></li><li class="dropdown-subitem"><a href="/pages/hdf2shad2o4p3/" class="nav-link">ã€ŠHadoopã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f2l2im24e/" class="nav-link">ã€Šç”Ÿæ€åœˆç»„ä»¶ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/ka1f3k4a/" class="nav-link">ã€Šæ¶ˆæ¯é˜Ÿåˆ—ã€‹</a></li><li class="dropdown-subitem"><a href="/pages/spa123ra12sd2/" class="nav-link">ã€Šsparkã€‹</a></li><li class="dropdown-subitem"><a href="/pages/f1l2i3n4k5/" aria-current="page" class="nav-link router-link-exact-active router-link-active">ã€Šflinkã€‹</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/TechnologyStack/" class="nav-link">æŠ€æœ¯æ ˆğŸˆ</a></div><div class="nav-item"><a href="/python/" class="nav-link">python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="â›³ğŸ–¥" class="dropdown-title"><a href="/technology/" class="link-title">â›³ğŸ–¥</a> <span class="title" style="display:none;">â›³ğŸ–¥</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b08e81/" class="nav-link">è®¡ç®—æœºå¿…å¤‡</a></li><li class="dropdown-item"><!----> <a href="/pages/fba33e/" class="nav-link">æ•°å­¦åŸºç¡€</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="more" class="dropdown-title"><a href="/more/" class="link-title">more</a> <span class="title" style="display:none;">more</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">å­¦ä¹ </a></li><li class="dropdown-item"><!----> <a href="/pages/vscode123/" class="nav-link">æŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/pages/4c76s2s6d8b3/" class="nav-link">æŠ€æœ¯æ–‡æ¡£</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHubæŠ€å·§</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">æœ¬ç«™å…³è”</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">å…³äº</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">æ”¶è—</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç´¢å¼•" class="dropdown-title"><a href="/archives/" class="link-title">ç´¢å¼•</a> <span class="title" style="display:none;">ç´¢å¼•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">åˆ†ç±»</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">æ ‡ç­¾</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">å½’æ¡£</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/axcmsm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>è·¯çº¿orå¯¼å›¾</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>å­¦ä¹ ç¬”è®°</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šlinuxã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€ŠHadoopã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šzookeeperã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šhiveã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šç”Ÿæ€åœˆç»„ä»¶ã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šæ¶ˆæ¯é˜Ÿåˆ—ã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šsparkã€‹</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>ã€Šflinkã€‹</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f1l2i3n4k5/" aria-current="page" class="active sidebar-link">flinkç¬”è®°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#ç®€ä»‹" class="sidebar-link">ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#å¿«é€Ÿå…¥é—¨" class="sidebar-link">å¿«é€Ÿå…¥é—¨</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#éƒ¨ç½²" class="sidebar-link">éƒ¨ç½²</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#è¿è¡Œæ¶æ„" class="sidebar-link">è¿è¡Œæ¶æ„</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#æµç¨‹å¤„ç†api" class="sidebar-link">æµç¨‹å¤„ç†API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#source-è¯»å–æ•°æ®æº" class="sidebar-link">sourceï¼šè¯»å–æ•°æ®æº</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#transform-è½¬æ¢ç®—å­" class="sidebar-link">Transform  :è½¬æ¢ç®—å­</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#sink-è¾“å‡º" class="sidebar-link">Sinkï¼šè¾“å‡º</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#window-çª—å£" class="sidebar-link">Window çª—å£</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#æ—¶é—´è¯­ä¹‰ğŸ‡wartermark" class="sidebar-link">æ—¶é—´è¯­ä¹‰ğŸ‡Wartermark</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#processfunction-api" class="sidebar-link">ProcessFunction API</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#çŠ¶æ€ç¼–ç¨‹" class="sidebar-link">çŠ¶æ€ç¼–ç¨‹</a></li><li class="sidebar-sub-header"><a href="/pages/f1l2i3n4k5/#å®¹é”™æœºåˆ¶" class="sidebar-link">å®¹é”™æœºåˆ¶</a></li></ul></li><li><a href="/pages/f1table3n4k5/" class="sidebar-link">flink-table-sql</a></li><li><a href="/pages/f1table3n426/" class="sidebar-link">Flink15</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ã€Šæ•°æ®å¯è§†åŒ–ã€‹</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>é¡¹ç›®</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å®‰è£…</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- æ­£æ–¹å½¢ -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="é¦–é¡µ" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/BigData" title="å¤§æ•°æ®-ç›®å½•é¡µ" data-v-1cd794fe>å¤§æ•°æ®</a></li> <li data-v-1cd794fe><a href="/BigData/#å­¦ä¹ ç¬”è®°" title="å¤§æ•°æ®#å­¦ä¹ ç¬”è®°" data-v-1cd794fe>å­¦ä¹ ç¬”è®°</a></li> <li data-v-1cd794fe><a href="/BigData/#ã€Šflinkã€‹" title="å¤§æ•°æ®#ã€Šflinkã€‹" data-v-1cd794fe>ã€Šflinkã€‹</a></li></ul> <div class="info" data-v-1cd794fe><div title="ä½œè€…" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/axcmsm" target="_blank" title="ä½œè€…" class="beLink" data-v-1cd794fe>Wei Ye</a></div> <div title="åˆ›å»ºæ—¶é—´" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-10-6</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="/img/bj3.jpg">
          flinkç¬”è®°
        </h1> <div class="page-slot page-slot-top"><!-- å›ºå®š100% * 90pxå¯æ˜¾ç¤ºï¼Œmax-height:90pxæœªè§æ˜¾ç¤º-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="header-anchor">#</a> ç®€ä»‹</h2> <p>å®˜ç½‘:<a href="https://flink.apache.org/" target="_blank" rel="noopener noreferrer">https://flink.apache.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ä»–æ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼</strong>å¤„ç†å¼•æ“ï¼Œç”¨äºå¯¹<strong>æ— ç•Œå’Œæœ‰ç•Œæ•°æ®æµ</strong>è¿›è¡Œ<strong>çŠ¶æ€</strong>è®¡ç®—çš„æ¡†æ¶ã€‚</p> <p>å›Šæ‹¬äº†ï¼šstormä½å»¶è¿Ÿï¼Œsparké«˜ååï¼Œä»¥åŠlambdaæ¶æ„çš„ä¿©å¥—ç³»ç»Ÿçš„ä¼˜åŒ–(å‡†ç¡®ã€å®æ—¶)ç­‰ç‰¹ç‚¹ã€‚</p> <p><strong>ç‰¹ç‚¹</strong>ï¼š</p> <ul><li><p>äº‹ä»¶é©±åŠ¨</p></li> <li><p>åŸºäºæµçš„ä¸–ç•Œè§‚ï¼šæœ‰ç•Œoræ— ç•Œ</p> <blockquote><p>ä»¥æµä¸ºä¸–ç•Œè§‚çš„æ¶æ„ï¼Œè·å¾—çš„æœ€å¤§å¥½å¤„å°±æ˜¯å…·æœ‰æä½çš„å»¶è¿Ÿ</p></blockquote></li> <li><p>åˆ†å±‚API:</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>Table<span class="token operator">/</span>SQL<span class="token punctuation">(</span>dynamic<span class="token punctuation">,</span>tables<span class="token punctuation">)</span> 
<span class="token operator">-&gt;</span> DataStream API<span class="token punctuation">(</span>stream<span class="token punctuation">,</span>windows<span class="token punctuation">)</span>
	<span class="token operator">-&gt;</span>ProcessFunction<span class="token punctuation">(</span>events<span class="token punctuation">,</span>state<span class="token punctuation">,</span>time<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>å…¶ä»–ç‰¹ç‚¹ï¼š</p> <blockquote><p>äº‹ä»¶æ—¶é—´ã€å¤„ç†æ—¶é—´</p> <p>ç²¾ç¡®ä¸€æ¬¡çš„çŠ¶æ€ä¸€è‡´æ€§</p> <p>ä½å»¶è¿Ÿï¼Œé«˜å¤„ç†</p> <p>å¯æ‰©å±•ã€é«˜å¯ç”¨</p></blockquote></li></ul> <p><strong>æ¨¡å—</strong>ï¼š2021/10/6</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>Flink Table <span class="token operator">&amp;</span> SQL<span class="token punctuation">(</span>è¿˜æ²¡å¼€å‘å®Œ<span class="token punctuation">)</span>
Flink Gelly<span class="token punctuation">(</span>å›¾è®¡ç®—<span class="token punctuation">)</span>
Flink CEP<span class="token punctuation">(</span>å¤æ‚äº‹ä»¶å¤„ç†<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>Flink /sparkStream</strong>:</p> <ul><li><p>æ•°æ®æ¨¡å‹ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>â€“ spark é‡‡ç”¨ RDD æ¨¡å‹ï¼Œspark streaming çš„ DStream å®é™…ä¸Šä¹Ÿå°±æ˜¯ä¸€ç»„ ç»„å°æ‰¹æ•° æ® RDD çš„é›†åˆ 
â€“ flink åŸºæœ¬æ•°æ®æ¨¡å‹æ˜¯æ•°æ®æµï¼Œä»¥åŠäº‹ä»¶ï¼ˆEventï¼‰åºåˆ—
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>è¿è¡Œæ¶æ„ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>â€“ spark æ˜¯æ‰¹è®¡ç®—ï¼Œå°† DAG åˆ’åˆ†ä¸ºä¸åŒçš„ stageï¼Œä¸€ä¸ªå®Œæˆåæ‰å¯ä»¥è®¡ç®—ä¸‹ä¸€ä¸ª 
â€“ flink æ˜¯æ ‡å‡†çš„æµæ‰§è¡Œæ¨¡å¼ï¼Œä¸€ä¸ªäº‹ä»¶åœ¨ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†å®Œåå¯ä»¥ç›´æ¥å‘å¾€ä¸‹ä¸€ä¸ªèŠ‚ ç‚¹è¿›è¡Œå¤„ç†
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="header-anchor">#</a> å¿«é€Ÿå…¥é—¨</h2> <ul><li><p>å¯¼å…¥poxæ–‡ä»¶</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-scala_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span> 
    <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-streaming-scala --&gt;</span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-streaming-scala_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>ç¼–å†™ä»£ç  <code>wordcount</code></p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token number">1.</span> æ‰¹å¤„ç†  #æ³¨æ„å¯¼åŒ…å’Œ å¯¼å…¥éšå¼è½¬æ¢
	<span class="token comment">//åˆ›å»ºæ‰¹å¤„ç†ç¯å¢ƒæ‰§è¡Œç¯å¢ƒ</span>
    <span class="token keyword">val</span> env<span class="token operator">=</span>ExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment
    <span class="token comment">//è¯»å–æ•°æ®</span>
    <span class="token keyword">val</span> inpath<span class="token operator">=</span><span class="token string">&quot;D:\\IDea20.1\\flink\\dome1\\src\\main\\resources\\hello.txt&quot;</span>
    <span class="token keyword">val</span> Dataset <span class="token operator">=</span> env<span class="token punctuation">.</span>readTextFile<span class="token punctuation">(</span>inpath<span class="token punctuation">)</span>
    <span class="token comment">//å¯¹æ•°æ®è¿›è¡Œæ“ä½œ</span>
    <span class="token keyword">val</span> wc <span class="token operator">=</span> Dataset<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ åšä¸ºkeyè¿›è¡Œåˆ†é’Ÿ</span>
    <span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//æ±‚å’Œç»Ÿè®¡ å¯ä»¥ä¸²å­—æ®µæ¯æ¬¡å’Œä¸‹æ ‡ä½ç½®</span>
    wc<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//æ‰“å°</span>
<span class="token number">2.</span> æµå¤„ç†
	#è®¾ç½® å¼€å¯ç«¯å£ nc <span class="token operator">-</span>lp <span class="token number">7777</span> è¾“å…¥æ•°æ®
	<span class="token comment">//åˆ›å»ºæµå¤„ç†ç¯å¢ƒæ‰§è¡Œç¯å¢ƒ</span>
    <span class="token keyword">val</span> env<span class="token operator">=</span>StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment
    env<span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment">//è®¾ç½®cupæ ¸æ•° å¹¶è¡Œåº¦ ä¸è®¾ç½®é»˜è®¤æ˜¯æœºå™¨çš„CPUæ ¸æ•°</span>
    <span class="token comment">//å¤–éƒ¨ä¼ å…¥å‚æ•°</span>
    <span class="token keyword">val</span> tool <span class="token operator">=</span> ParameterTool<span class="token punctuation">.</span>fromArgs<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    <span class="token keyword">val</span> host <span class="token operator">=</span> tool<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;host&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> port <span class="token operator">=</span> tool<span class="token punctuation">.</span>getInt<span class="token punctuation">(</span><span class="token string">&quot;port&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">//è¯»å–æ•°æ®</span>
    <span class="token keyword">val</span> DS <span class="token operator">=</span> env<span class="token punctuation">.</span>socketTextStream<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>
    <span class="token comment">//è¿›è¡Œå¤„ç†æ“ä½œ</span>
    <span class="token keyword">val</span> result <span class="token operator">=</span> DS<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>nonEmpty<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//å¯¹keyè¿›è¡Œåˆ†ç»„   //åŸºäºå“ˆå¸Œå€¼è¿›è¡Œå–æ¨¡åˆ†é…æœºå™¨</span>
      <span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">//æ±‚å’Œ ä¹Ÿå¯ä»¥æŒ‡å®šç®—å­çš„å¹¶è¡Œåº¦</span>
    result<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//ä¹Ÿå¯ä»¥è®¾ç½®å¹¶è¡Œåº¦ ä¸€ä¸ªä¸€ä¸ªè¾“å‡ºåˆ°æ§åˆ¶å°</span>
    <span class="token comment">//å¯åŠ¨ä»»åŠ¡</span>
    env<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;wc&quot;</span><span class="token punctuation">)</span>
	#<span class="token operator">-</span>host <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>port <span class="token number">7777</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></li></ul> <h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="header-anchor">#</a> éƒ¨ç½²</h2> <ul><li><p>Standalone æ¨¡å¼ ç‹¬ç«‹</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token number">1.</span> ä¸Šä¼ è§£å‹åˆ°æŒ‡å®šç›®å½•ï¼Œè¿›å…¥ conf
<span class="token number">2.</span> ä¿®æ”¹é…ç½®æ–‡ä»¶ flink<span class="token operator">/</span>conf<span class="token operator">/</span>flink<span class="token operator">-</span>conf<span class="token punctuation">.</span>yaml  #z
	jobmanager<span class="token punctuation">.</span>rpc<span class="token punctuation">.</span>address hadoop111  #è€å¤§
<span class="token number">3.</span> ä¿®æ”¹é…ç½®æ–‡ä»¶ <span class="token operator">/</span>conf<span class="token operator">/</span>slaves  é…ç½®å°å¼Ÿ
	hadoop112
	hadoop113 
<span class="token number">4.</span> åˆ†å‘ç»™å¦å¤–ä¸¤å°æœºå­
<span class="token number">5</span>ã€ å¯åŠ¨
	bin<span class="token operator">/</span>start<span class="token operator">-</span>cluster<span class="token punctuation">.</span>sh
#http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>hadoop111<span class="token operator">:</span><span class="token number">8081</span>  #è¿›è¡Œç›‘æ§
<span class="token number">5.</span> æ‰§è¡Œä»»åŠ¡
	<span class="token punctuation">.</span>/flink run <span class="token operator">-</span>c ç±»åè·¯å¾„ â€“p <span class="token number">2</span> jaråŒ… â€“port <span class="token number">7777</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p><strong>Yarn æ¨¡å¼</strong>ï¼šä¸¤ç§è¿è¡Œçš„æ¨¡å¼</p> <blockquote><p>Session-cluster æ¨¡å¼ï¼šå…±äº«èµ„æºï¼›é€‚åˆè§„æ¨¡å°æ‰§è¡Œæ—¶é—´çŸ­çš„ä½œä¸š</p> <p><strong>Per-Job-Cluster</strong> <strong>æ¨¡å¼</strong>ï¼šä¸€ä¸ªä½œä¸šè¯»å†™ä¸€ä»½èµ„æºï¼Œé€‚åˆè§„æ¨¡å¤§ é•¿æ—¶é—´è¿è¡Œçš„ä½œä¸šï¼Œä»»åŠ¡ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼Œæ–¹ä¾¿ç®¡ç†</p> <p>é…ç½®åœ¨<code>flink/conf/flink-conf.yaml</code> ä¸­æŸ¥çœ‹orä¿®æ”¹</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. Session Cluster
	å¯åŠ¨ hadoop é›†ç¾¤ï¼ˆç•¥ï¼‰
	å¯åŠ¨ yarn-session
	./yarn-session.sh -n 2 -s 2 -jm 1024 -tm 1024 -nm test -d
	&gt;&gt; -n TaskManager çš„æ•°é‡     -s æ¯ä¸ªTaskManagerçš„slot æ•°é‡  é»˜è®¤ä¸º1
	&gt;&gt; jmï¼šJobManager çš„å†…å­˜  	 -tmï¼šæ¯ä¸ª taskmanager çš„å†…å­˜
	&gt;&gt; -nmï¼šyarn çš„ appName(ç°åœ¨ yarn çš„ ui ä¸Šçš„åå­—)ã€‚   -dï¼šåå°æ‰§è¡Œã€‚
	æ‰§è¡Œä»»åŠ¡ï¼š
	./flink run -c ç±»åè·¯å¾„ â€“p 2 jaråŒ… â€“port 7777
	å–æ¶ˆ yarn-session 
	yarn application --kill application_1577588252906_0001
	
2. Per Job Cluster
	1) å¯åŠ¨ hadoop é›†ç¾¤
	2) ä¸å¯åŠ¨ yarn-sessionï¼Œç›´æ¥æ‰§è¡Œ job
	./flink run â€“m yarn-cluster -c ç±»åè·¯å¾„ jaråŒ… --host lcoalhost â€“port 7777
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>Kubernetes éƒ¨ç½² ç•¥</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1ï¼‰ æ­å»º Kubernetes é›†ç¾¤ï¼ˆç•¥ï¼‰ 
2ï¼‰ é…ç½®å„ç»„ä»¶çš„ yaml æ–‡ä»¶
3ï¼‰å¯åŠ¨ Flink Session Cluster
	// å¯åŠ¨ jobmanager-service æœåŠ¡ 
	kubectl create -f jobmanager-service.yaml 
	// å¯åŠ¨ jobmanager-deployment æœåŠ¡
    kubectl create -f jobmanager-deployment.yaml 
    // å¯åŠ¨ taskmanager-deployment æœåŠ¡ 
    kubectl create -f taskmanager-deployment.yaml
#è®¿é—®http://{JobManagerHost:Port}/api/v1/namespaces/default/services/flink-jobmanage r:ui/proxy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul> <h2 id="è¿è¡Œæ¶æ„"><a href="#è¿è¡Œæ¶æ„" class="header-anchor">#</a> è¿è¡Œæ¶æ„</h2> <p><strong>è¿è¡Œæ—¶çš„ç»„ä»¶</strong>ï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ä½œä¸šç®¡ç†å™¨ï¼ˆJobManagerï¼‰:è§£æã€ç”³è¯·ã€åè°ƒ
	å…ˆæ¥æ”¶æ‰§è¡Œç¨‹åº,åŒ…æ‹¬ä½œä¸šå›¾ã€é€»è¾‘æ•°æ®æµå›¾å’Œæ‰“åŒ…äº†æ‰€æœ‰çš„ç±»ã€åº“å’Œå…¶å®ƒ èµ„æºçš„ JAR åŒ…ã€‚
	ç„¶åæŠŠä½œä¸šå›¾è½¬æ¢æˆç‰©ç†å±‚é¢çš„æµç¨‹å›¾(æ‰§è¡Œå›¾),ç„¶åå‘ResourceManagerï¼Œè¯·æ±‚æ‰§è¡Œä»»åŠ¡çš„èµ„æº(TaskManagerä¸Šçš„æ’æ§½slot)ã€‚
	è¯·æ±‚æˆåŠŸ,æ‰§è¡Œå›¾å‘å¾€,TaskManagerèŠ‚ç‚¹,è¿‡ç¨‹ç”±JobManagerè¿›è¡Œåè°ƒï¼Œå¯è®¾ç½®æ£€æŸ¥ç‚¹ç­‰æ“ä½œã€‚
	
èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰:åˆ†é…ã€è¢«ç”³è¯·orç”³è¯·ã€é‡Šæ”¾èµ„æº
	è´£ç®¡ç†TaskManagerçš„æ’æ§½slot(å¤„ç†èµ„æºå•å…ƒ),ä¸åŒçš„ç¯å¢ƒæœ‰ä¸åŒçš„ç®¡ç†å™¨ï¼Œä¾‹:YARNã€Mesosã€K8s...
	å½“è¢«ç”³è¯·æ’æ§½æ—¶ï¼Œä¼šå°†ç©ºé—²çš„slotçš„TaskManager,åˆ†é…ç»™ä½œä¸šç®¡ç†å™¨ã€‚
	å¦‚æœæ²¡æœ‰ç©ºé—²,å°±å¯¹å‘èµ„æºå¹³å°å‘èµ·ä¼šè¯,ä¾‹ï¼šå‘yarnç”³è¯·å®¹å™¨èµ„æºã€‚
	ä¹Ÿå¯ç»ˆæ­¢ç©ºé—²çš„ä»»åŠ¡ç®¡ç†å™¨ï¼Œé‡Šæ”¾è®¡ç®—æ€§èƒ½
	
ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰: æ‰§è¡Œä»»åŠ¡ã€‚
	é€šå¸¸ä¼šæœ‰å¤šä¸ªä»»åŠ¡ç®¡ç†å™¨åŒæ—¶è¿è¡Œï¼Œæ¯ä¸ªåˆ°åŒ…å«äº†ä¸€å®šæ’æ§½solotï¼Œ
	slotæ˜¯çœŸæ­£ç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„ï¼Œå½“TaskManagerè¢«å¯åŠ¨åï¼Œä¼šåƒèµ„æºç®¡ç†å™¨ï¼Œæ³¨å†Œslotã€‚
	ç„¶åå°†slotæä¾›ç»™jobè°ƒç”¨ã€‚jobå¯å‘slotåˆ†é…æ‰§è¡Œä»»åŠ¡.
	ä»»åŠ¡ç®¡ç†å™¨ä¹‹é—´å¯äº¤æ¢æ•°æ®ã€‚
	
ä»¥åŠåˆ†å‘å™¨ï¼ˆDispatcherï¼‰: web UI ç›‘æ§ 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>ä»»åŠ¡æäº¤æµç¨‹</strong>ï¼š</p> <ul><li><p><strong>flinkå†…éƒ¨</strong></p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211006125238.png" alt=""></p></li> <li><p><strong>yarn</strong></p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211006125328.png" alt=""></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. ä¸Šä¼ flinkçš„jaråŒ…å’Œé…ç½®åˆ°hdfs
2. æäº¤jobåˆ°RMä¸­ RMå‘é€ç»™NM 
3. åœ¨NMä¸­å¯åŠ¨ ApplicationMaster å¼€è¾Ÿç©ºé—´
4. ApplicationMaster é‡Œé¢è®¡ç®—å…ˆå‘Flinkç”³è¯·æ²¡æœ‰ï¼Œå†å‘RMç”³è¯·jobçš„è¿è¡Œèµ„æº
5. å¯åŠ¨TaskManager æ‰§è¡Œä»»åŠ¡
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <p><strong>ä»»åŠ¡è°ƒåº¦åŸç†</strong></p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211006125452.png" alt=""></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. Flinké›†ç¾¤å¯åŠ¨å,å¯åŠ¨ä¸€ä¸ª JobManger å’Œå¤šä¸ªTasKManager
2. å®¢æˆ·ç«¯æäº¤ä»»åŠ¡ç»™JobManagerï¼ŒJobMangerå†åˆ†ç»™å„ä¸ªçš„å’Œå¤šä¸ªTasKManageræ‰§è¡Œ
3. TaskManager å°†å¿ƒè·³å’Œç»Ÿè®¡ä¿¡æ¯æ±‡æŠ¥ç»™ JobManagerã€‚
4. TaskManager ä¹‹é—´ä»¥æµçš„å½¢å¼è¿›è¡Œæ•°æ®çš„ä¼ è¾“
#éƒ½æ˜¯ç‹¬ç«‹çš„ JVM è¿›ç¨‹
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p><strong>TaskManger&amp;Slots</strong></p> <blockquote><p>TaskManger(worker)æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œå¯å¯å¤šä¸ªå­ä»»åŠ¡ï¼Œå¯é€šè¿‡<strong>task slot</strong>æ§åˆ¶æ¥æ”¶çš„task</p> <p>é»˜è®¤å…è®¸å­ä»»åŠ¡å…±äº« slotï¼Œä¸åŒä»»åŠ¡çš„å­ä»»åŠ¡ä¹Ÿå¯ä»¥ï¼Œä¸€ä¸ªslotå¯ä¿å­˜ä½œä¸šçš„æ•´ä¸ªç®¡é“</p> <p>Task Slot æ˜¯<strong>é™æ€çš„æ¦‚å¿µ</strong>ï¼Œæ˜¯æŒ‡ TaskManager å…·æœ‰çš„å¹¶å‘æ‰§è¡Œèƒ½åŠ›</p> <p><img src="D:%5Chuanjin%5Cgit_book%5Cbook%5Cvuepress_vdoing%5Cvidoing%5Cbook%5Cdocs%5C01.%E5%A4%A7%E6%95%B0%E6%8D%AE%5C40.%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%5C45.%E3%80%8Aflink%E3%80%8B%5Cimg%5Cimage-20211006130740098.png" alt="image-20211006130740098"></p></blockquote></li> <li><p><strong>å¹¶è¡Œåº¦</strong>ï¼š<strong>parallelism</strong> åŠ¨æ€æ¦‚å¿µ</p> <blockquote><p>ä¸€ä¸ª stream çš„å¹¶è¡Œåº¦ï¼Œå¯ä»¥è®¤ä¸ºå°±æ˜¯å…¶æ‰€æœ‰ç®—å­ä¸­æœ€å¤§çš„å¹¶è¡Œåº¦</p> <p>ä¸€ä¸ªç‰¹å®šç®—å­çš„ å­ä»»åŠ¡çš„ä¸ªæ•°ï¼šparallelism</p></blockquote></li></ul> <p><strong>ç¨‹åº&amp;æ•°æ®æµ:DataFlow</strong>:<code>Source(è¯»å–) ã€Transformation(è½¬æ¢) å’Œ Sink(è¾“å‡º)ã€‚</code></p> <p><strong>æ‰§è¡Œå›¾</strong>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>StreamGraph :ç¨‹åºçš„æ‹“æ‰‘ç»“æ„
	-&gt; 
		JobGraph :ä¼˜åŒ–JobManagerçš„æ•°æ®ç»“æ„
			-&gt; 
				ExecutionGraph : JobGraphçš„å¹¶è¡ŒåŒ–ç‰ˆæœ¬ï¼Œæ˜¯è°ƒåº¦å±‚æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„
					-&gt;
                    	ç‰©ç†æ‰§è¡Œå›¾ :éƒ¨ç½²Taskåå½¢æˆçš„â€œå›¾â€
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211006131718.png" alt=""></p></blockquote> <p><strong>æ•°æ®ä¼ è¾“å½¢å¼</strong>:<code>ä¸€å¯¹ä¸€ã€çª„ä¾èµ–ã€å®½ä¾èµ–</code></p> <p><strong>ä»»åŠ¡é“¾</strong>:<code>åŸæ¥çš„ç®—å­æˆä¸ºé‡Œé¢çš„ä¸€æ­¥åˆ†ï¼Œå‡å°‘ç¨‹åºä¹‹é—´çš„åˆ‡æ¢å’ŒåŸºäºç¼“å­˜çš„æ•°æ®äº¤æ¢</code></p> <h2 id="æµç¨‹å¤„ç†api"><a href="#æµç¨‹å¤„ç†api" class="header-anchor">#</a> æµç¨‹å¤„ç†API</h2> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211006195905.png" alt=""></p> <ul><li><p><strong>Environmen</strong>ï¼šæ„å»ºç¨‹åºä¸Šä¸‹æ–‡ã€‚</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//æ‰¹å¤„ç†
val env= ExecutionEnvironment.getExecutionEnvironment
//æµå¤„ç†
val env = StreamExecutionEnvironment.getExecutionEnvironment
//è®¾ç½®å¹¶è¡Œåº¦
val env = StreamExecutionEnvironment.createLocalEnvironment(1)
//æäº¤jarç»™é›†ç¾¤æ‰§è¡Œç¯å¢ƒ å¯è®¾ç½®åŠ¨æ€ä¼ å‚è¿›æ¥
val env = ExecutionEnvironment.createRemoteEnvironment(&quot;jobmanage-hostname&quot;, 6123,&quot;YOURPATH//wordcount.jar&quot;)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>æ²¡æœ‰é…ç½®æ–Œæ¶ˆæ¯’ï¼Œé»˜è®¤è¯»å–<code>flink-conf.yaml</code> é»˜è®¤ä¸º1</p></blockquote></li></ul> <h3 id="source-è¯»å–æ•°æ®æº"><a href="#source-è¯»å–æ•°æ®æº" class="header-anchor">#</a> <strong>source</strong>ï¼šè¯»å–æ•°æ®æº</h3> <ol><li><p>ä»é›†åˆä¸­è¯»å–</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">// å®šä¹‰æ ·ä¾‹ç±»ï¼Œä¼ æ„Ÿå™¨ idï¼Œæ—¶é—´æˆ³ï¼Œæ¸©åº¦</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> SensorReading<span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> timestamp<span class="token operator">:</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> temperature<span class="token operator">:</span> <span class="token builtin">Double</span><span class="token punctuation">)</span> 
<span class="token keyword">object</span> Sensor <span class="token punctuation">{</span>
	<span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token keyword">val</span> env <span class="token operator">=</span>StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment 		<span class="token keyword">val</span> stream1 <span class="token operator">=</span> env <span class="token punctuation">.</span>fromCollection<span class="token punctuation">(</span>List<span class="token punctuation">(</span> SensorReading<span class="token punctuation">(</span><span class="token string">&quot;sensor_1&quot;</span><span class="token punctuation">,</span> <span class="token number">1547718199</span><span class="token punctuation">,</span> <span class="token number">35.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SensorReading<span class="token punctuation">(</span><span class="token string">&quot;sensor_6&quot;</span><span class="token punctuation">,</span> <span class="token number">1547718201</span><span class="token punctuation">,</span> <span class="token number">15.4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SensorReading<span class="token punctuation">(</span><span class="token string">&quot;sensor_7&quot;</span><span class="token punctuation">,</span> <span class="token number">1547718202</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SensorReading<span class="token punctuation">(</span><span class="token string">&quot;sensor_10&quot;</span><span class="token punctuation">,</span> <span class="token number">1547718205</span><span class="token punctuation">,</span> <span class="token number">38.1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> 
		stream1<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token string">&quot;stream1:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
		env<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>ä»æ–‡ä»¶ä¸­è¯»å–</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> stream2 <span class="token operator">=</span> env<span class="token punctuation">.</span>readTextFile<span class="token punctuation">(</span><span class="token string">&quot;YOUR_FILE_PATH&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>ä»kafkaä¸­è¯»å–</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//å¯¼å…¥ä¾èµ–</span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span> 
<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>flink<span class="token operator">-</span>connector<span class="token operator">-</span>kafka<span class="token operator">-</span><span class="token number">0.11</span>_2<span class="token punctuation">.</span><span class="token number">12</span><span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span> <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.10</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//å°è£…mapå‚æ•°</span>
<span class="token keyword">val</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> Properties<span class="token punctuation">(</span><span class="token punctuation">)</span> properties<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;bootstrap.servers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">)</span> properties<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;group.id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;consumer-group&quot;</span><span class="token punctuation">)</span> properties<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;key.deserializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="token punctuation">)</span> properties<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;value.deserializer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span><span class="token punctuation">)</span> properties<span class="token punctuation">.</span>setProperty<span class="token punctuation">(</span><span class="token string">&quot;auto.offset.reset&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;latest&quot;</span><span class="token punctuation">)</span> 
<span class="token comment">//addsourceåˆ›å»º</span>
<span class="token keyword">val</span> stream3 <span class="token operator">=</span> env<span class="token punctuation">.</span>addSource<span class="token punctuation">(</span><span class="token keyword">new</span> FlinkKafkaConsumer011<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;sensor&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> SimpleStringSchema<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>è‡ªå®šä¹‰source ï¼šæœ‰æ—¶å¯æ–¹ä¾¿æµ‹è¯•</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token number">1.</span> ä¼ å…¥è‡ªå®šä¹‰æ•°æ®æº
<span class="token keyword">val</span> stream4 <span class="token operator">=</span> env<span class="token punctuation">.</span>addSource<span class="token punctuation">(</span> <span class="token keyword">new</span> MySensorSource<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token number">2.</span> ç¼–å†™è‡ªå®šä¹‰æ•°æ®æº  ç»§æ‰¿SourceFunction
ä¾‹ï¼š
<span class="token keyword">class</span> MySensorSource <span class="token keyword">extends</span> SourceFunction<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">{</span>
<span class="token comment">// flag: è¡¨ç¤ºæ•°æ®æºæ˜¯å¦è¿˜åœ¨æ­£å¸¸è¿è¡Œ </span>
<span class="token keyword">var</span> running<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token keyword">override</span> <span class="token keyword">def</span> cancel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> running <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> run<span class="token punctuation">(</span>ctx<span class="token operator">:</span> SourceFunction<span class="token punctuation">.</span>SourceContext<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token comment">// åˆå§‹åŒ–ä¸€ä¸ªéšæœºæ•°å‘ç”Ÿå™¨ </span>
<span class="token keyword">val</span> rand <span class="token operator">=</span> <span class="token keyword">new</span> Random<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token keyword">var</span> curTemp <span class="token operator">=</span> <span class="token number">1.</span>to<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span> i <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span> <span class="token string">&quot;sensor_&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> <span class="token number">65</span> <span class="token operator">+</span> rand<span class="token punctuation">.</span>nextGaussian<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>running<span class="token punctuation">)</span><span class="token punctuation">{</span> 
<span class="token comment">// æ›´æ–°æ¸©åº¦å€¼ </span>
curTemp <span class="token operator">=</span> curTemp<span class="token punctuation">.</span>map<span class="token punctuation">(</span> t <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> t<span class="token punctuation">.</span>_2 <span class="token operator">+</span> rand<span class="token punctuation">.</span>nextGaussian<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token comment">// è·å–å½“å‰æ—¶é—´æˆ³ </span>
<span class="token keyword">val</span> curTime <span class="token operator">=</span> System<span class="token punctuation">.</span>currentTimeMillis<span class="token punctuation">(</span><span class="token punctuation">)</span>
curTemp<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span> t <span class="token keyword">=&gt;</span> ctx<span class="token punctuation">.</span>collect<span class="token punctuation">(</span>SensorReading<span class="token punctuation">(</span>t<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> curTime<span class="token punctuation">,</span> t<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
Thread<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li></ol> <h3 id="transform-è½¬æ¢ç®—å­"><a href="#transform-è½¬æ¢ç®—å­" class="header-anchor">#</a> <strong>Transform</strong>  :è½¬æ¢ç®—å­</h3> <ul><li><p>mapã€flatmapã€filterã€</p></li> <li><p><strong>KeyByåˆ†ç»„</strong>:(dataStream=&gt;KeyedStream)</p> <blockquote><p>å†…éƒ¨åˆ†åŒºåº•å±‚hashcode</p> <p>åˆ†ç»„åæ”¯æŒï¼šsumã€minã€maxã€minByã€maxBy</p></blockquote></li> <li><p><strong>Reduceèšåˆ</strong>:(keyedStream=&gt;DataStream)</p> <blockquote><p>(å‰/æ–°ä¸€ä¸ªå€¼ï¼Œåä¸€ä¸ªå€¼) ä¿©ä¿©èšåˆ</p></blockquote></li> <li><p><strong>splitå’Œselectæ‹†åˆ†</strong>ï¼š(dataStream=&gt;SplitStream)</p> <blockquote><p>split æ‹†åˆ† åè¿˜åœ¨ä¸€ä¸ªSplitStreamä¸­</p> <p>select åœ¨SplitStreamä¸­é€‰æ‹©æ€§è¾“å‡ºå¯¹åº”çš„æµ DataStream</p> <p>ä¾‹ï¼šæŒ‰ç…§æŸä¸ªæ¸©åº¦ï¼Œæ‹†åˆ†ä¸ºé«˜æ¸©orä½æ¸© é€‰æ‹©æ€§è¾“å‡º</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token punctuation">.</span>split<span class="token punctuation">(</span> sensorData <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sensorData<span class="token punctuation">.</span>temperature <span class="token operator">&gt;</span> <span class="token number">30</span><span class="token punctuation">)</span> Seq<span class="token punctuation">(</span><span class="token string">&quot;high&quot;</span><span class="token punctuation">)</span> <span class="token keyword">else</span> Seq<span class="token punctuation">(</span><span class="token string">&quot;low&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span> 
<span class="token keyword">val</span> high <span class="token operator">=</span> splitStream<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">&quot;high&quot;</span><span class="token punctuation">)</span> 
<span class="token keyword">val</span> low <span class="token operator">=</span> splitStream<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">&quot;low&quot;</span><span class="token punctuation">)</span> 
<span class="token keyword">val</span> all <span class="token operator">=</span> splitStream<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">&quot;high&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;low&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></blockquote></li> <li><p><strong>Connect</strong> <strong>å’Œ</strong> <strong>CoMapåˆå¹¶</strong> ï¼šç±»å‹éœ€è¦å¯ä¸ä¸€æ ·ï¼Œåˆå¹¶ä¿©ä¸ª</p> <blockquote><p>Connect :ä¿©ä¸ªdatastream=&gt;æ”¾å…¥ä¸€ä¸ªconnectedStreamsä¸­ï¼ŒçŠ¶æ€ä¸å˜</p> <p><strong>CoMap,CoFlatMap</strong>ï¼šè½¬æ¢è¾“å‡ºdatastream</p></blockquote></li> <li><p><strong>union</strong>:åˆå¹¶ï¼šç±»å‹éœ€è¦ä¸€æ ·ï¼Œåˆå¹¶å¤šä¸ª</p></li></ul> <blockquote><p><strong>æ”¯æŒçš„æ•°æ®ç±»å‹</strong>ï¼š</p> <p>åŸºç¡€æ•°æ®ç±»å‹ï¼šjavaã€scala</p> <p>å…ƒç»„ã€æ ·ä¾‹ç±»ã€ç®€å•å¯¹è±¡./</p> <p>å…¶ä»–é›†åˆç­‰ç­‰</p></blockquote> <ul><li><p><strong>UDFå‡½æ•°</strong>ï¼šè‡ªå®šä¹‰å‡½æ•°</p> <blockquote><div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//å‡½æ•°ç±»Function Classes</span>
<span class="token comment">//ä¾‹ï¼šMapFunction, FilterFunction, ProcessFunction ç­‰ç­‰ã€‚</span>
å®ç°å‡½æ•°ç±»æ¥å£å¯é‡å†™å†…éƒ¨æ–¹æ³•
ä¾‹<span class="token operator">:</span> è¿‡æ»¤åŒ…å«æœ‰flinkçš„å­—æ®µ  ä¹Ÿå¯ç›´æ¥ç”¨åŒ¿åå¯¹æ¥å£å®ç°æ–¹æ³•
<span class="token keyword">class</span> FilterFilter <span class="token keyword">extends</span> FilterFunction<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> filter<span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">&quot;flink&quot;</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token keyword">val</span> flinkTweets <span class="token operator">=</span> tweets<span class="token punctuation">.</span>filter<span class="token punctuation">(</span><span class="token keyword">new</span> FlinkFilter<span class="token punctuation">)</span>
<span class="token comment">//åŒ¿å</span>
<span class="token keyword">val</span> flinkTweets <span class="token operator">=</span> tweets<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">&quot;flink&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></blockquote></li> <li><p><strong>å¯Œå‡½æ•°</strong>ï¼šå¯è·å–ä¸Šä¸‹æ–‡ç”Ÿå‘½å‘¨æœŸç­‰ å®ç°å¤æ‚åŠŸèƒ½</p> <blockquote><div class="language-scala line-numbers-mode"><pre class="language-scala"><code>Rich Function ï¼šç”Ÿå‘½å‘¨æœŸ
<span class="token comment">//ä¾‹ï¼šRichMapFunctionã€RichFlatMapFunctionã€RichFilterFunction</span>
å¯é‡å†™çš„æ–¹æ³•
openï¼šåœ¨è°ƒç”¨ä¹‹å‰å…³äºè¡¨è°ƒç”¨
closeï¼šæœ€åå…³é—­
getRuntimeContextï¼šè¿è¡Œæ—¶ä¸Šä¸‹æ–‡
<span class="token comment">//ä¾‹ï¼š</span>
<span class="token keyword">class</span> MyFlatMap <span class="token keyword">extends</span> RichFlatMapFunction<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> 	<span class="token keyword">var</span> subTaskIndex <span class="token operator">=</span> <span class="token number">0</span> 
	<span class="token keyword">override</span> <span class="token keyword">def</span> open<span class="token punctuation">(</span>configuration<span class="token operator">:</span> Configuration<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> subTaskIndex <span class="token operator">=</span> getRuntimeContext<span class="token punctuation">.</span>getIndexOfThisSubtask 
 <span class="token comment">// ä»¥ä¸‹å¯ä»¥åšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œä¾‹å¦‚å»ºç«‹ä¸€ä¸ªå’Œ HDFS çš„è¿æ¥ </span>
<span class="token punctuation">}</span>
 <span class="token keyword">override</span> <span class="token keyword">def</span> flatMap<span class="token punctuation">(</span>in<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> 
     <span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> subTaskIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">(</span>subTaskIndex<span class="token punctuation">,</span> in<span class="token punctuation">)</span><span class="token punctuation">)</span> 
     <span class="token punctuation">}</span> <span class="token punctuation">}</span>
                                                              <span class="token keyword">override</span> <span class="token keyword">def</span> close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token comment">// ä»¥ä¸‹åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œä¾‹å¦‚æ–­å¼€å’Œ HDFS çš„è¿æ¥ã€‚ </span>
                                                              <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></blockquote></li></ul> <h3 id="sink-è¾“å‡º"><a href="#sink-è¾“å‡º" class="header-anchor">#</a> <strong>Sink</strong>ï¼šè¾“å‡º</h3> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token number">1</span>ã€ è‡ªå®šä¹‰è¾“å‡ºæ–¹å¼
stream<span class="token punctuation">.</span>addSink<span class="token punctuation">(</span><span class="token keyword">new</span> MySink<span class="token punctuation">(</span>xxxx<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>è¾“å‡ºåˆ°kafka</strong></p> <ol><li><p>å¯¼å…¥ä¾èµ–</p> <div class="language-XML line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-kafka-0.11_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>æ·»åŠ å…¥sink</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> union <span class="token operator">=</span> high<span class="token punctuation">.</span>union<span class="token punctuation">(</span>low<span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>temperature<span class="token punctuation">.</span>toString<span class="token punctuation">)</span> union<span class="token punctuation">.</span>addSink<span class="token punctuation">(</span><span class="token keyword">new</span> FlinkKafkaProducer011<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;localhost:9092&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> SimpleStringSchema<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <p><strong>è¾“å‡ºåˆ°Redis</strong>ï¼š</p> <ol><li><p>å¯¼å…¥ä¾èµ–</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.bahir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-redis_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>ç¼–å†™</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token number">1.</span> å®šä¹‰ç±»
<span class="token keyword">class</span> MyRedisMapper <span class="token keyword">extends</span> RedisMapper<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">{</span> 
    <span class="token keyword">override</span> <span class="token keyword">def</span> getCommandDescription<span class="token operator">:</span> RedisCommandDescription <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">new</span> RedisCommandDescription<span class="token punctuation">(</span>RedisCommand<span class="token punctuation">.</span>HSET<span class="token punctuation">,</span> <span class="token string">&quot;sensor_temperature&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> getValueFromData<span class="token punctuation">(</span>t<span class="token operator">:</span> SensorReading<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> t<span class="token punctuation">.</span>temperature<span class="token punctuation">.</span>toString <span class="token keyword">override</span> <span class="token keyword">def</span> getKeyFromData<span class="token punctuation">(</span>t<span class="token operator">:</span> SensorReading<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> t<span class="token punctuation">.</span>id <span class="token punctuation">}</span>
<span class="token number">2</span>ã€ æ·»åŠ åˆ°sinkä¸­
<span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> FlinkJedisPoolConfig
<span class="token punctuation">.</span>Builder<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>setHost<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>setPort<span class="token punctuation">(</span><span class="token number">6379</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span> 
dataStream<span class="token punctuation">.</span>addSink<span class="token punctuation">(</span> <span class="token keyword">new</span> RedisSink<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">(</span>conf<span class="token punctuation">,</span> <span class="token keyword">new</span> MyRedisMapper<span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ol> <p><strong>è¾“å‡ºElasticsearch</strong></p> <ol><li><p>å¯¼å…¥ä¾èµ–</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-elasticsearch6_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>ç¼–å†™</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//1. åˆ›å»ºlisté…ç½®å‚æ•°</span>
<span class="token keyword">val</span> httpHosts <span class="token operator">=</span> <span class="token keyword">new</span> util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">[</span>HttpHost<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
httpHosts<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token keyword">new</span> HttpHost<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">9200</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment">//æ„å»ºå¯¹è±¡ä¼ å…¥ä¼ è¾“</span>
<span class="token keyword">val</span> esSinkBuilder <span class="token operator">=</span> <span class="token keyword">new</span> ElasticsearchSink<span class="token punctuation">.</span>Builder<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">(</span> httpHosts<span class="token punctuation">,</span> <span class="token keyword">new</span> ElasticsearchSinkFunction<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token punctuation">{</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> process<span class="token punctuation">(</span>t<span class="token operator">:</span> SensorReading<span class="token punctuation">,</span> runtimeContext<span class="token operator">:</span> RuntimeContext<span class="token punctuation">,</span> requestIndexer<span class="token operator">:</span> RequestIndexer<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> 
    
    println<span class="token punctuation">(</span><span class="token string">&quot;saving data: &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">)</span> 
    <span class="token keyword">val</span> json <span class="token operator">=</span> <span class="token keyword">new</span> util<span class="token punctuation">.</span>HashMap<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    json<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>toString<span class="token punctuation">)</span>                                         <span class="token keyword">val</span> indexRequest <span class="token operator">=</span> Requests
    <span class="token punctuation">.</span>indexRequest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">&quot;sensor&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>`<span class="token keyword">type</span>`<span class="token punctuation">(</span><span class="token string">&quot;readingData&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>source<span class="token punctuation">(</span>json<span class="token punctuation">)</span> 
                                                                      requestIndexer<span class="token punctuation">.</span>add<span class="token punctuation">(</span>indexRequest<span class="token punctuation">)</span> 
    println<span class="token punctuation">(</span><span class="token string">&quot;saved successfully&quot;</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span> 
dataStream<span class="token punctuation">.</span>addSink<span class="token punctuation">(</span> esSinkBuilder<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ol> <p><strong>JDBC</strong> <strong>è‡ªå®šä¹‰</strong> <strong>sink</strong>:</p> <ol><li><p>å¯¼å…¥ä¾èµ–</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.44<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>ç¼–å†™</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">// ç¼–å†™è‡ªå®šä¹‰ sink</span>
<span class="token keyword">class</span> MyJdbcSink<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> RichSinkFunction<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">{</span>
<span class="token keyword">var</span> conn<span class="token operator">:</span> Connection <span class="token operator">=</span> _ 
<span class="token keyword">var</span> insertStmt<span class="token operator">:</span> PreparedStatement <span class="token operator">=</span> _ 
<span class="token keyword">var</span> updateStmt<span class="token operator">:</span> PreparedStatement <span class="token operator">=</span> _ 
<span class="token comment">// open ä¸»è¦æ˜¯åˆ›å»ºè¿æ¥ </span>
<span class="token keyword">override</span> <span class="token keyword">def</span> open<span class="token punctuation">(</span>parameters<span class="token operator">:</span> Configuration<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> Â·<span class="token keyword">super</span><span class="token punctuation">.</span>open<span class="token punctuation">(</span>parameters<span class="token punctuation">)</span> conn <span class="token operator">=</span> DriverManager
<span class="token punctuation">.</span>getConnection<span class="token punctuation">(</span><span class="token string">&quot;jdbc:mysql://localhost:3306/test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span> 
insertStmt <span class="token operator">=</span> conn<span class="token punctuation">.</span>prepareStatement<span class="token punctuation">(</span><span class="token string">&quot;INSERT INTO temperatures (sensor, temp) VALUES (?, ?)&quot;</span><span class="token punctuation">)</span> 
updateStmt <span class="token operator">=</span> conn<span class="token punctuation">.</span>prepareStatement<span class="token punctuation">(</span><span class="token string">&quot;UPDATE temperatures SET temp = ? WHERE sensor = ?&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token comment">// è°ƒç”¨è¿æ¥ï¼Œæ‰§è¡Œ sql </span>
<span class="token keyword">override</span> <span class="token keyword">def</span> invoke<span class="token punctuation">(</span>value<span class="token operator">:</span> SensorReading<span class="token punctuation">,</span> context<span class="token operator">:</span> SinkFunction<span class="token punctuation">.</span>Context<span class="token punctuation">[</span>_<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
updateStmt<span class="token punctuation">.</span>setDouble<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> value<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span>
updateStmt<span class="token punctuation">.</span>setString<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> value<span class="token punctuation">.</span>id<span class="token punctuation">)</span> 
updateStmt<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token keyword">if</span> <span class="token punctuation">(</span>updateStmt<span class="token punctuation">.</span>getUpdateCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
insertStmt<span class="token punctuation">.</span>setString<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> value<span class="token punctuation">.</span>id<span class="token punctuation">)</span> 
insertStmt<span class="token punctuation">.</span>setDouble<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> value<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span>
insertStmt<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> 
insertStmt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> 
updateStmt<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token comment">//2 æ·»åŠ sink</span>
dataStream<span class="token punctuation">.</span>addSink<span class="token punctuation">(</span><span class="token keyword">new</span> MyJdbcSink<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li></ol> <h2 id="window-çª—å£"><a href="#window-çª—å£" class="header-anchor">#</a> Window çª—å£</h2> <p>å¯ç”¨äºåˆ‡å‰²æ— é™æ•°æ®æµæˆä¸ºæœ‰é™æ•°æ®æµã€‚</p> <p><strong>ç±»å‹</strong>ï¼š</p> <ul><li><p>CountWindowï¼šè®¡æ•°çª—å£</p></li> <li><p>timeWindowï¼šæ—¶é—´çª—å£</p> <blockquote><p>æ»šåŠ¨çª—å£tumblingï¼š<strong>æ—¶é—´å¯¹é½ï¼Œçª—å£é•¿åº¦å›ºå®šï¼Œæ²¡æœ‰é‡å </strong>ï¼Œé€‚åˆåš BI ç»Ÿè®¡ç­‰ï¼ˆåšæ¯ä¸ªæ—¶é—´æ®µçš„èšåˆè®¡ç®—ï¼‰ã€‚</p> <p>æ»‘åŠ¨çª—å£slidingï¼š<strong>æ—¶é—´å¯¹é½ï¼Œçª—å£é•¿åº¦å›ºå®šï¼Œå¯ä»¥æœ‰é‡å </strong></p> <p>ä¼šè¯çª—å£se'ssionï¼š<strong>æ—¶é—´æ— å¯¹é½</strong></p></blockquote></li></ul> <p><strong>timeWindow</strong></p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//1. æ»šåŠ¨</span>
<span class="token keyword">val</span> minTempPerWindow <span class="token operator">=</span> dataStream <span class="token punctuation">.</span>map<span class="token punctuation">(</span>r <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>id<span class="token punctuation">,</span> r<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_1<span class="token punctuation">)</span> 
<span class="token punctuation">.</span>timeWindow<span class="token punctuation">(</span>Time<span class="token punctuation">.</span>seconds<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>r1<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> r1<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>min<span class="token punctuation">(</span>r2<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//æ—¶é—´é—´éš”å¯ä»¥é€šè¿‡ Time.milliseconds(x)ï¼ŒTime.seconds(x)ï¼ŒTime.minutes(x)ç­‰å…¶ ä¸­çš„ä¸€ä¸ªæ¥æŒ‡å®š</span>

<span class="token comment">//2. æ»‘åŠ¨  æœ‰æ­¥é•¿</span>
<span class="token keyword">val</span> minTempPerWindow<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataStream
<span class="token punctuation">.</span>map<span class="token punctuation">(</span>r <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>id<span class="token punctuation">,</span> r<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_1<span class="token punctuation">)</span>
<span class="token punctuation">.</span>timeWindow<span class="token punctuation">(</span>Time<span class="token punctuation">.</span>seconds<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Time<span class="token punctuation">.</span>seconds<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>r1<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> r1<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>min<span class="token punctuation">(</span>r2<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//or // .window(SlidingEventTimeWindows.of(Time.seconds(15),Time.sec onds(5))</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>CountWindow</strong>ï¼šæ ¹æ®keyè§¦å‘</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//1. æ»šåŠ¨
val minTempPerWindow: DataStream[(String, Double)] = dataStream .map(r =&gt; (r.id, r.temperature)) .keyBy(_._1)
.countWindow(5) .reduce((r1, r2) =&gt; (r1._1, r1._2.max(r2._2)))
//2. æ»‘åŠ¨
val keyedStream: KeyedStream[(String, Int), Tuple] = dataStream.map(r =&gt; (r.id, r.temperature)).keyBy(0) 
//æ¯å½“æŸä¸€ä¸ª key çš„ä¸ªæ•°è¾¾åˆ° 2 çš„æ—¶å€™,è§¦å‘è®¡ç®—ï¼Œè®¡ç®—æœ€è¿‘è¯¥ key æœ€è¿‘ 10 ä¸ªå…ƒç´ çš„å†…å®¹ 
val windowedStream: WindowedStream[(String, Int), Tuple, GlobalWindow] = keyedStream.countWindow(10,2) 
val sumDstream: DataStream[(String, Int)] = windowedStream.sum(1)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>window function</strong>ï¼šå¯å¯¹çª—å£åšè®¡ç®—çš„æ“ä½œ</p> <ul><li>å¢é‡èšåˆï¼šincremental aggregation functions</li> <li>å…¨çª—å£èšåˆï¼šfull window functions</li></ul> <blockquote><p>ProcessWindowFunction å°±æ˜¯ä¸€ä¸ªå…¨çª—å£å‡½æ•°</p></blockquote> <p><strong>windowå…¶å®ƒå¯é€‰</strong> <strong>API</strong></p> <ul><li>.trigger() â€”â€” è§¦å‘å™¨</li> <li>.evitor() â€”â€” ç§»é™¤å™¨</li> <li>.allowedLateness() â€”â€” å…è®¸å¤„ç†è¿Ÿåˆ°çš„æ•°æ®</li> <li>.sideOutputLateData() â€”â€” å°†è¿Ÿåˆ°çš„æ•°æ®æ”¾å…¥ä¾§è¾“å‡ºæµ</li> <li>.getSideOutput() â€”â€” è·å–ä¾§è¾“å‡ºæµ</li></ul> <h2 id="æ—¶é—´è¯­ä¹‰ğŸ‡wartermark"><a href="#æ—¶é—´è¯­ä¹‰ğŸ‡wartermark" class="header-anchor">#</a> æ—¶é—´è¯­ä¹‰ğŸ‡Wartermark</h2> <ul><li><strong>Event Time</strong>ï¼šæ˜¯äº‹ä»¶åˆ›å»ºçš„æ—¶é—´</li> <li><strong>Ingestion Time</strong>ï¼šæ˜¯æ•°æ®è¿›å…¥ Flink çš„æ—¶é—´</li> <li><strong>Processing Time</strong>ï¼šæ˜¯æ¯ä¸€ä¸ªæ‰§è¡ŒåŸºäºæ—¶é—´æ“ä½œçš„ç®—å­çš„æœ¬åœ°ç³»ç»Ÿæ—¶é—´ï¼Œä¸æœºå™¨ ç›¸å…³ï¼Œé»˜è®¤çš„æ—¶é—´å±æ€§å°±æ˜¯ Processing Timeã€‚</li></ul> <p><strong>åœ¨</strong> <strong>Flink</strong> <strong>çš„æµå¼å¤„ç†ä¸­ï¼Œç»å¤§éƒ¨åˆ†çš„ä¸šåŠ¡éƒ½ä¼šä½¿ç”¨</strong> <strong>eventTime</strong>,</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//event Time</span>
<span class="token keyword">val</span> env <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment 
<span class="token comment">// ä»è°ƒç”¨æ—¶åˆ»å¼€å§‹ç»™ env åˆ›å»ºçš„æ¯ä¸€ä¸ª stream è¿½åŠ æ—¶é—´ç‰¹å¾ </span>
env<span class="token punctuation">.</span>setStreamTimeCharacteristic<span class="token punctuation">(</span>TimeCharacteristic<span class="token punctuation">.</span>EventTime<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Watermark</strong>:æ˜¯ä¸€ç§è¡¡é‡ Event Time è¿›å±•çš„æœºåˆ¶.</p> <blockquote><p>ioç­‰ç½‘ç»œä¼ è¾“å¯èƒ½å½±å“çš„ä¹±åºã€‚</p> <p>è€Œ<strong>Watermark</strong> <strong>æ˜¯ç”¨äºå¤„ç†ä¹±åºäº‹ä»¶çš„</strong>ï¼Œè€Œæ­£ç¡®çš„å¤„ç†ä¹±åºäº‹ä»¶ï¼Œé€šå¸¸ç”¨ Watermark æœºåˆ¶ç»“åˆ window æ¥å®ç°</p> <p>Watermark ç±»ä¼¼å»¶è¿Ÿè§¦å‘æœºåˆ¶ï¼Œä»–æ˜¯ä¸æ•°æ®æ—¶é—´æˆ³ç›¸å…³ï¼Œå•è°ƒé€’å¢çš„ç‰¹æ®Šè®°å½•</p></blockquote> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//1. å¼•å…¥</span>
dataStream<span class="token punctuation">.</span>assignTimestampsAndWatermarks<span class="token punctuation">(</span> 
<span class="token keyword">new</span> BoundedOutOfOrdernessTimestampExtractor<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">(</span>Time<span class="token punctuation">.</span>milliseconds<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
<span class="token keyword">override</span> <span class="token keyword">def</span> extractTimestamp<span class="token punctuation">(</span>element<span class="token operator">:</span> SensorReading<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> <span class="token punctuation">{</span> element<span class="token punctuation">.</span>timestamp <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>Event Time çš„ä½¿ç”¨ä¸€å®šè¦<strong>æŒ‡å®šæ•°æ®æºä¸­çš„æ—¶é—´æˆ³</strong></p></blockquote> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> env <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment 
<span class="token comment">// ä»è°ƒç”¨æ—¶åˆ»å¼€å§‹ç»™ env åˆ›å»ºçš„æ¯ä¸€ä¸ª stream è¿½åŠ æ—¶é—´ç‰¹æ€§ </span>
env<span class="token punctuation">.</span>setStreamTimeCharacteristic<span class="token punctuation">(</span>TimeCharacteristic<span class="token punctuation">.</span>EventTime<span class="token punctuation">)</span>
<span class="token keyword">val</span> readings<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> env<span class="token punctuation">.</span>addSource<span class="token punctuation">(</span><span class="token keyword">new</span> SensorSource<span class="token punctuation">)</span>
<span class="token punctuation">.</span>assignTimestampsAndWatermarks<span class="token punctuation">(</span><span class="token keyword">new</span> MyAssigner<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ç±»å‹</strong>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>AssignerWithPeriodicWatermarks  :å‘¨æœŸæ€§ç”Ÿæˆ é»˜è®¤ä¸­æœŸ200 
	ExecutionConfig.setAutoWatermarkInterval()æ–¹æ³•è¿›è¡Œè®¾ç½®
AssignerWithPunctuatedWatermarks ï¼šé—´æ–­æ€§ç”Ÿæˆ
ä»¥ä¸Šä¸¤ä¸ªæ¥å£éƒ½ç»§æ‰¿è‡ª TimestampAssignerã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-scala line-numbers-mode"><pre class="language-scala"><code>ä¾‹ï¼š å‘¨æœŸæ€§æŒ‰æ—¶é—´æˆ³æŠ½å–æœ€å¤§å€¼

<span class="token keyword">class</span> PeriodicAssigner <span class="token keyword">extends</span> AssignerWithPeriodicWatermarks<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token punctuation">{</span> 
<span class="token keyword">val</span> bound<span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span> 
<span class="token comment">// å»¶æ—¶ä¸º 1 åˆ†é’Ÿ </span>
<span class="token keyword">var</span> maxTs<span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> <span class="token builtin">Long</span><span class="token punctuation">.</span>MinValue 
<span class="token comment">// è§‚å¯Ÿåˆ°çš„æœ€å¤§æ—¶é—´æˆ³ </span>
<span class="token keyword">override</span> <span class="token keyword">def</span> getCurrentWatermark<span class="token operator">:</span> Watermark <span class="token operator">=</span> <span class="token punctuation">{</span> 
<span class="token keyword">new</span> Watermark<span class="token punctuation">(</span>maxTs <span class="token operator">-</span> bound<span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> extractTimestamp<span class="token punctuation">(</span>r<span class="token operator">:</span> SensorReading<span class="token punctuation">,</span> previousTS<span class="token operator">:</span> <span class="token builtin">Long</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
maxTs <span class="token operator">=</span> maxTs<span class="token punctuation">.</span>max<span class="token punctuation">(</span>r<span class="token punctuation">.</span>timestamp<span class="token punctuation">)</span> r<span class="token punctuation">.</span>timestamp <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç®€å•æƒ…å†µå¯ç®€å†™</span>
<span class="token keyword">val</span> stream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">val</span> withTimestampsAndWatermarks <span class="token operator">=</span> stream <span class="token punctuation">.</span>assignAscendingTimestamps<span class="token punctuation">(</span>e <span class="token keyword">=&gt;</span> e<span class="token punctuation">.</span>timestamp<span class="token punctuation">)</span>

<span class="token comment">//å¤„ç†ä¹±åº</span>
<span class="token keyword">val</span> stream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">val</span> withTimestampsAndWatermarks <span class="token operator">=</span> stream<span class="token punctuation">.</span>assignTimestampsAndWatermarks<span class="token punctuation">(</span> <span class="token keyword">new</span> SensorTimeAssigner <span class="token punctuation">)</span>
<span class="token keyword">class</span> SensorTimeAssigner <span class="token keyword">extends</span> BoundedOutOfOrdernessTimestampExtractor<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">(</span>Time<span class="token punctuation">.</span>seconds<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// æŠ½å–æ—¶é—´æˆ³</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> extractTimestamp<span class="token punctuation">(</span>r<span class="token operator">:</span> SensorReading<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> r<span class="token punctuation">.</span>timestamp <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><strong>EvnetTime åœ¨ window ä¸­çš„ä½¿ç”¨</strong>ï¼š</p> <ul><li><strong>æ»šåŠ¨çª—å£ï¼šTumblingEventTimeWindows</strong></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> 
	<span class="token comment">// ç¯å¢ƒ </span>
	<span class="token keyword">val</span> env<span class="token operator">:</span> StreamExecutionEnvironment <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment 				env<span class="token punctuation">.</span>setStreamTimeCharacteristic<span class="token punctuation">(</span>TimeCharacteristic<span class="token punctuation">.</span>EventTime<span class="token punctuation">)</span>
    env<span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> dstream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> env<span class="token punctuation">.</span>socketTextStream<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token number">7777</span><span class="token punctuation">)</span> 
    <span class="token keyword">val</span> textWithTsDstream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> dstream<span class="token punctuation">.</span>map<span class="token punctuation">{</span> text <span class="token keyword">=&gt;</span>
        <span class="token keyword">val</span> arr<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">(</span>arr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toLong<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">val</span> textWithEventTimeDstream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> textWithTsDstream<span class="token punctuation">.</span>assignTimestampsAndWatermarks<span class="token punctuation">(</span>
        <span class="token keyword">new</span> BoundedOutOfOrdernessTimestampExtractor<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>Time<span class="token punctuation">.</span>milliseconds<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">override</span> <span class="token keyword">def</span> extractTimestamp<span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> element<span class="token punctuation">.</span>_2 <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> textKeyStream<span class="token operator">:</span> KeyedStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tuple<span class="token punctuation">]</span> <span class="token operator">=</span> textWithEventTimeDstream<span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 			textKeyStream<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token string">&quot;textkey:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> windowStream<span class="token operator">:</span> WindowedStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tuple<span class="token punctuation">,</span> TimeWindow<span class="token punctuation">]</span> <span class="token operator">=</span> textKeyStream
    <span class="token punctuation">.</span>window<span class="token punctuation">(</span>TumblingEventTimeWindows<span class="token punctuation">.</span>of<span class="token punctuation">(</span>Time<span class="token punctuation">.</span>seconds<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> groupDstream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>mutable<span class="token punctuation">.</span>HashSet<span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> windowStream<span class="token punctuation">.</span>fold<span class="token punctuation">(</span><span class="token keyword">new</span> mutable<span class="token punctuation">.</span>HashSet<span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">case</span> <span class="token punctuation">(</span>set<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> ts<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> set <span class="token operator">+=</span> ts <span class="token punctuation">}</span>
    groupDstream<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token string">&quot;window::::&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    env<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> <span class="token punctuation">}</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li><p><strong>æ»‘åŠ¨çª—å£SlidingEventTimeWindows</strong>:</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> 
<span class="token comment">// ç¯å¢ƒ </span>
<span class="token keyword">val</span> env<span class="token operator">:</span> StreamExecutionEnvironment <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment env<span class="token punctuation">.</span>setStreamTimeCharacteristic<span class="token punctuation">(</span>TimeCharacteristic<span class="token punctuation">.</span>EventTime<span class="token punctuation">)</span>
env<span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
<span class="token keyword">val</span> dstream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> env<span class="token punctuation">.</span>socketTextStream<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token number">7777</span><span class="token punctuation">)</span> 
<span class="token keyword">val</span> textWithTsDstream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> dstream<span class="token punctuation">.</span>map <span class="token punctuation">{</span> 
text <span class="token keyword">=&gt;</span> <span class="token keyword">val</span> arr<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>arr<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> arr<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toLong<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">val</span> textWithEventTimeDstream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> textWithTsDstream
<span class="token punctuation">.</span>assignTimestampsAndWatermarks<span class="token punctuation">(</span><span class="token keyword">new</span> BoundedOutOfOrdernessTimestampExtractor<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span>Time<span class="token punctuation">.</span>milliseconds<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
<span class="token keyword">override</span> <span class="token keyword">def</span> extractTimestamp<span class="token punctuation">(</span>element<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> element<span class="token punctuation">.</span>_2 <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> textKeyStream<span class="token operator">:</span> KeyedStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tuple<span class="token punctuation">]</span> <span class="token operator">=</span> textWithEventTimeDstream<span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    textKeyStream<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token string">&quot;textkey:&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> windowStream<span class="token operator">:</span> WindowedStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Tuple<span class="token punctuation">,</span> TimeWindow<span class="token punctuation">]</span> <span class="token operator">=</span> textKeyStream
    <span class="token punctuation">.</span>window<span class="token punctuation">(</span>SlidingEventTimeWindows<span class="token punctuation">.</span>of<span class="token punctuation">(</span>Time<span class="token punctuation">.</span>seconds<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Time<span class="token punctuation">.</span>millis econds<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token keyword">val</span> groupDstream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>mutable<span class="token punctuation">.</span>HashSet<span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> windowStream<span class="token punctuation">.</span>fold<span class="token punctuation">(</span><span class="token keyword">new</span> mutable<span class="token punctuation">.</span>HashSet<span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">case</span> <span class="token punctuation">(</span>set<span class="token punctuation">,</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> ts<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> set <span class="token operator">+=</span> ts <span class="token punctuation">}</span>
    groupDstream<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token string">&quot;window::::&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setParallelism<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    env<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p><strong>ä¼šè¯çª—å£EventTimeSessionWindows</strong></p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>textKeyStream<span class="token punctuation">.</span>window<span class="token punctuation">(</span>EventTimeSessionWindows<span class="token punctuation">.</span>withGap<span class="token punctuation">(</span>Time<span class="token punctuation">.</span>milliseconds<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h2 id="processfunction-api"><a href="#processfunction-api" class="header-anchor">#</a> ProcessFunction API</h2> <p>åº•å±‚apiå’Œè·å–è®¿é—®æ—¶é—´æˆ³æ³¨å†Œå®šæ—¶äº‹ä»¶ï¼Œç‰¹æ®Šäº‹ä»¶ç­‰ã€</p> <p>ä¾‹ï¼šFlink SQL å°±æ˜¯ä½¿ç”¨ Process Function å®ç°çš„</p> <p>flinkæä¾›äº†8ä¸ªï¼š</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ï‚· ProcessFunction
ï‚· KeyedProcessFunction
ï‚· CoProcessFunction
ï‚· ProcessJoinFunction
ï‚· BroadcastProcessFunction
ï‚· KeyedBroadcastProcessFunction
ï‚· ProcessWindowFunction
ï‚· ProcessAllWindowFunction
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p><strong>æ‰€æœ‰çš„ Process Functionéƒ½ç»§æ‰¿è‡ª RichFunctionæ¥å£</strong></p></blockquote> <p><strong>KeyedProcessFunction</strong>ï¼šæ“ä½œkeyedStream</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>processElement(v: IN, ctx: Context, out: Collector[OUT])//æµä¸­æ¯ä¸ªå…ƒç´ éƒ½éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•
outè¾“å‡º inè¾“å…¥ ctx ä¸Šä¸‹æ–‡å¯¹è±¡
onTimer(timestamp: Long, ctx: OnTimerContext, out: Collector[OUT])//å›è°ƒå‡½æ•°
timestamp è®¾ç½®ä¿ƒå‘æ—¶é—´æˆ³ 

TimerService äº‹ä»¶æœåŠ¡å¯¹è±¡ Timerså®šæ—¶å™¨
	currentProcessingTime(): Long è¿”å›å½“å‰å¤„ç†æ—¶é—´ 
    currentWatermark(): Long è¿”å›å½“å‰ watermark çš„æ—¶é—´æˆ³ 
    registerProcessingTimeTimer(timestamp: Long): Unit ä¼šæ³¨å†Œå½“å‰ key çš„ processing time çš„å®šæ—¶å™¨ã€‚
    	å½“ processing time åˆ°è¾¾å®šæ—¶æ—¶é—´æ—¶ï¼Œè§¦å‘ timerã€‚ 
    registerEventTimeTimer(timestamp: Long): Unit ä¼šæ³¨å†Œå½“å‰ key çš„ event time å®šæ—¶å™¨ã€‚
    	å½“æ°´ä½çº¿å¤§äºç­‰äºå®šæ—¶å™¨æ³¨å†Œçš„æ—¶é—´æ—¶ï¼Œè§¦å‘å®šæ—¶å™¨æ‰§è¡Œå›è°ƒå‡½æ•°
    deleteProcessingTimeTimer(timestamp: Long): Unit åˆ é™¤ä¹‹å‰æ³¨å†Œå¤„ç†æ—¶é—´å®š æ—¶å™¨ã€‚å¦‚æœæ²¡æœ‰,åˆ™ä¸æ‰§è¡Œã€‚
    deleteEventTimeTimer(timestamp: Long): Unit åˆ é™¤ä¹‹å‰æ³¨å†Œçš„äº‹ä»¶æ—¶é—´å®šæ—¶ å™¨ï¼Œå¦‚æœæ²¡æœ‰æ­¤æ—¶é—´æˆ³çš„å®šæ—¶å™¨ï¼Œåˆ™ä¸æ‰§è¡Œã€‚ å½“å®šæ—¶å™¨ timer è§¦å‘æ—¶ï¼Œä¼šæ‰§è¡Œå›è°ƒå‡½æ•° onTimer()ã€‚æ³¨æ„å®šæ—¶å™¨ timer åªèƒ½åœ¨ keyed streams ä¸Šé¢ä½¿ç”¨
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>ä¾‹</strong></p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//éœ€æ±‚ï¼šç›‘æ§æ¸©åº¦ä¼ æ„Ÿå™¨çš„æ¸©åº¦å€¼ï¼Œå¦‚æœæ¸©åº¦å€¼åœ¨ä¸€ç§’é’Ÿä¹‹å†…(processing time)è¿ ç»­ä¸Šå‡ï¼Œåˆ™æŠ¥è­¦ã€‚</span>
<span class="token comment">//1. å¯¹è¯»å–çš„æ–‡ä»¶è¿›è¡Œåˆ†ç»„ä¸”è°ƒç”¨processingä¼ å…¥è‡ªå®šä¹‰è§„åˆ™</span>
<span class="token keyword">val</span> warnings <span class="token operator">=</span> readings <span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span>_<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">.</span>process<span class="token punctuation">(</span><span class="token keyword">new</span> TempIncreaseAlertFunction<span class="token punctuation">)</span>
<span class="token comment">//2. å®ç°è‡ªå®šä¹‰è§„åˆ™</span>
<span class="token keyword">class</span> TempIncreaseAlertFunction <span class="token keyword">extends</span> KeyedProcessFunction<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> SensorReading<span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
<span class="token comment">// ä¿å­˜ä¸Šä¸€ä¸ªä¼ æ„Ÿå™¨æ¸©åº¦å€¼ </span>
<span class="token keyword">lazy</span> <span class="token keyword">val</span> lastTemp<span class="token operator">:</span> ValueState<span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span> <span class="token operator">=</span> getRuntimeContext<span class="token punctuation">.</span>getState<span class="token punctuation">(</span> <span class="token keyword">new</span> ValueStateDescriptor<span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;lastTemp&quot;</span><span class="token punctuation">,</span> Types<span class="token punctuation">.</span>of<span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token comment">// ä¿å­˜æ³¨å†Œçš„å®šæ—¶å™¨çš„æ—¶é—´æˆ³ </span>
<span class="token keyword">lazy</span> <span class="token keyword">val</span> currentTimer<span class="token operator">:</span> ValueState<span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span> <span class="token operator">=</span> getRuntimeContext<span class="token punctuation">.</span>getState<span class="token punctuation">(</span> <span class="token keyword">new</span> ValueStateDescriptor<span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;timer&quot;</span><span class="token punctuation">,</span> Types<span class="token punctuation">.</span>of<span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> processElement<span class="token punctuation">(</span>r<span class="token operator">:</span> SensorReading<span class="token punctuation">,</span> ctx<span class="token operator">:</span> KeyedProcessFunction<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> SensorReading<span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span>#Context<span class="token punctuation">,</span> out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token comment">// å–å‡ºä¸Šä¸€æ¬¡çš„æ¸©åº¦ </span>
<span class="token keyword">val</span> prevTemp <span class="token operator">=</span> lastTemp<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// å°†å½“å‰æ¸©åº¦æ›´æ–°åˆ°ä¸Šä¸€æ¬¡çš„æ¸©åº¦è¿™ä¸ªå˜é‡ä¸­ </span>
lastTemp<span class="token punctuation">.</span>update<span class="token punctuation">(</span>r<span class="token punctuation">.</span>temperature<span class="token punctuation">)</span>
<span class="token keyword">val</span> curTimerTimestamp <span class="token operator">=</span> currentTimer<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>prevTemp <span class="token operator">==</span> <span class="token number">0.0</span> <span class="token operator">||</span> r<span class="token punctuation">.</span>temperature <span class="token operator">&lt;</span> prevTemp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// æ¸©åº¦ä¸‹é™æˆ–è€…æ˜¯ç¬¬ä¸€ä¸ªæ¸©åº¦å€¼ï¼Œåˆ é™¤å®šæ—¶å™¨ </span>
ctx<span class="token punctuation">.</span>timerService<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>deleteProcessingTimeTimer<span class="token punctuation">(</span>curTimerTimestamp<span class="token punctuation">)</span>
<span class="token comment">// æ¸…ç©ºçŠ¶æ€å˜é‡ </span>
currentTimer<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>temperature <span class="token operator">&gt;</span> prevTemp <span class="token operator">&amp;&amp;</span> curTimerTimestamp <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// æ¸©åº¦ä¸Šå‡ä¸”æˆ‘ä»¬å¹¶æ²¡æœ‰è®¾ç½®å®šæ—¶å™¨ </span>
<span class="token keyword">val</span> timerTs <span class="token operator">=</span> ctx<span class="token punctuation">.</span>timerService<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>currentProcessingTime<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1000</span> ctx<span class="token punctuation">.</span>timerService<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>registerProcessingTimeTimer<span class="token punctuation">(</span>timerTs<span class="token punctuation">)</span> 
currentTimer<span class="token punctuation">.</span>update<span class="token punctuation">(</span>timerTs<span class="token punctuation">)</span> 
<span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> onTimer<span class="token punctuation">(</span>ts<span class="token operator">:</span> <span class="token builtin">Long</span><span class="token punctuation">,</span> ctx<span class="token operator">:</span> KeyedProcessFunction<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> SensorReading<span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span>#OnTimerContext<span class="token punctuation">,</span> out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> 
out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token string">&quot;ä¼ æ„Ÿå™¨ id ä¸º: &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">.</span>getCurrentKey <span class="token operator">+</span> <span class="token string">&quot;çš„ä¼ æ„Ÿå™¨æ¸©åº¦å€¼å·²ç»è¿ç»­ 1s ä¸Šå‡äº†ã€‚&quot;</span><span class="token punctuation">)</span> 
currentTimer<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>ä¾§è¾“å‡ºæµ:SideOutput</strong>: ä¸€æ¡æµåˆ†æˆå¤šæ¡æµï¼Œ</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token number">1.</span> ä¾‹ ä¼ å…¥ä¸€ä¸ªè¾“å‡ºè§„åˆ™
<span class="token keyword">val</span> monitoredReadings<span class="token operator">:</span> DataStream<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span> <span class="token operator">=</span> readings <span class="token punctuation">.</span>process<span class="token punctuation">(</span><span class="token keyword">new</span> FreezingMonitor<span class="token punctuation">)</span> 
monitoredReadings
<span class="token punctuation">.</span>getSideOutput<span class="token punctuation">(</span><span class="token keyword">new</span> OutputTag<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;freezing-alarms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span> 
readings<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2.</span> è‡ªå®šä¹‰è¾“å‡ºè§„åˆ™
ä¾‹ï¼šå®ç° FreezingMonitor å‡½æ•°ï¼Œç”¨æ¥ç›‘æ§ä¼ æ„Ÿå™¨æ¸©åº¦å€¼ï¼Œå°†æ¸©åº¦å€¼ä½äº <span class="token number">32F</span> çš„æ¸©åº¦è¾“å‡ºåˆ° side output
<span class="token keyword">class</span> FreezingMonitor <span class="token keyword">extends</span> ProcessFunction<span class="token punctuation">[</span>SensorReading<span class="token punctuation">,</span> SensorReading<span class="token punctuation">]</span> <span class="token punctuation">{</span>
<span class="token comment">// å®šä¹‰ä¸€ä¸ªä¾§è¾“å‡ºæ ‡ç­¾ </span>
<span class="token keyword">lazy</span> <span class="token keyword">val</span> freezingAlarmOutput<span class="token operator">:</span> OutputTag<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> OutputTag<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">&quot;freezing-alarms&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">override</span> <span class="token keyword">def</span> processElement<span class="token punctuation">(</span>r<span class="token operator">:</span> SensorReading<span class="token punctuation">,</span> ctx<span class="token operator">:</span> ProcessFunction<span class="token punctuation">[</span>SensorReading<span class="token punctuation">,</span> SensorReading<span class="token punctuation">]</span>
#Context<span class="token punctuation">,</span> out<span class="token operator">:</span> Collector<span class="token punctuation">[</span>SensorReading<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span> 
<span class="token comment">// æ¸©åº¦åœ¨ 32F ä»¥ä¸‹æ—¶ï¼Œè¾“å‡ºè­¦å‘Šä¿¡æ¯ </span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>temperature <span class="token operator">&lt;</span> <span class="token number">32.0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
		ctx<span class="token punctuation">.</span>output<span class="token punctuation">(</span>freezingAlarmOutput<span class="token punctuation">,</span> s<span class="token string">&quot;Freezing Alarm for ${r.id}&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token comment">// æ‰€æœ‰æ•°æ®ç›´æ¥å¸¸è§„è¾“å‡ºåˆ°ä¸»æµ </span>
out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>CoProcessFunction</strong>: åˆå¹¶æˆä¸€æ¡æµ</p> <h2 id="çŠ¶æ€ç¼–ç¨‹"><a href="#çŠ¶æ€ç¼–ç¨‹" class="header-anchor">#</a> çŠ¶æ€ç¼–ç¨‹</h2> <p>æµå¼è®¡ç®—åˆ†ä¸ºæ— çŠ¶æ€å’Œæœ‰çŠ¶æ€ä¸¤ç§æƒ…å†µã€‚</p> <p><strong>æ— çŠ¶æ€</strong>ï¼šæ ¹æ®æœ€åäº‹ä»¶è¾“å‡ºç»“æœ</p> <p><strong>æœ‰çŠ¶æ€</strong>ï¼šæ ¹æ®å¤šä¸ªäº‹ä»¶è¾“å‡ºç»“æœ ï¼šå­˜å‚¨çŠ¶æ€</p> <p><strong>çŠ¶æ€</strong>ï¼š</p> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211006231113.png" alt=""></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. ç”±ä¸€ä¸ªä»»åŠ¡ç»´æŠ¤çš„æŸä¸ªç»“æœæ‰€æœ‰æ•°æ®
2. å¯è¢«ä»»åŠ¡è®¿é—®
3. ä¼šå¯¹çŠ¶æ€è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬çŠ¶æ€ä¸€è‡´æ€§ï¼Œæ•…éšœå¤„ç†ã€é«˜æ•ˆå­˜å‚¨å’Œè®¿é—®
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>ç®—å­çŠ¶æ€ï¼šOperatior State</strong>ï¼š</p> <blockquote><p>ç®—å­ä»»åŠ¡(åŒä¸€å¹¶è¡Œåº¦)ï¼ŒçŠ¶æ€å¯¹åŒä¸€ä¸ªå­ä»»åŠ¡å…±äº«ï¼Œä¸èƒ½ç”±å…¶ä»–ç®—å­çš„å­ä»»åŠ¡è®¿é—®</p> <p><strong>æ•°æ®ç»“æ„</strong>ï¼š</p> <ul><li>list stateï¼šåˆ—è¡¨</li> <li>union list stateï¼šåˆå¹¶</li> <li>Broadcast state ï¼šå¹¿æ’­</li></ul></blockquote> <p>**é”®æ§çŠ¶æ€ï¼šKeyed State 	**</p> <blockquote><p>åªèƒ½ç”¨äº KeyedStreamï¼ˆkeyBy ç®—å­å¤„ç†ä¹‹åï¼‰</p> <p><strong>æ•°æ®ç±»å‹</strong>:</p> <ul><li>value State[T]: get(value) set(update)æ“ä½œ</li> <li>list State[T]:  addã€addallã€getã€update</li> <li>mapstateï¼šgetã€putã€containsã€remove</li> <li>reducingState:</li> <li>AggregatingState</li> <li>State.clear()æ˜¯æ¸…ç©ºæ“ä½œ</li></ul> <p>é€šè¿‡ RuntimeContext æ³¨å†Œ StateDescriptorã€‚StateDescriptor ä»¥çŠ¶æ€ state çš„åå­—</p> <p>å’Œå­˜å‚¨çš„æ•°æ®ç±»å‹ä¸ºå‚æ•°</p></blockquote> <p>**çŠ¶æ€åç«¯ï¼šState Backend **:</p> <ul><li><p>MemoryStateBackend :å†…å­˜çº§çŠ¶æ€åç«¯å°è£…æˆå¯¹è±¡å­˜å‚¨åœ¨jvmä¸­ï¼Œæ£€æŸ¥ç‚¹å­˜å‚¨åœ¨ä½œä¸šç®¡ç†å™¨ä¸­</p></li> <li><p>FsStateBackend: å­˜å‚¨åˆ°è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿ</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> env <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment <span class="token keyword">val</span> checkpointPath<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> 
<span class="token keyword">val</span> backend <span class="token operator">=</span> <span class="token keyword">new</span> RocksDBStateBackend<span class="token punctuation">(</span>checkpointPath<span class="token punctuation">)</span>
env<span class="token punctuation">.</span>setStateBackend<span class="token punctuation">(</span>backend<span class="token punctuation">)</span> env<span class="token punctuation">.</span>setStateBackend<span class="token punctuation">(</span><span class="token keyword">new</span> FsStateBackend<span class="token punctuation">(</span><span class="token string">&quot;file:///tmp/checkpoints&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> env<span class="token punctuation">.</span>enableCheckpointing<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> 
<span class="token comment">// é…ç½®é‡å¯ç­–ç•¥ </span>
env<span class="token punctuation">.</span>setRestartStrategy<span class="token punctuation">(</span>RestartStrategies<span class="token punctuation">.</span>fixedDelayRestart<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> Time<span class="token punctuation">.</span>of<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>RocksDBStateBackend ï¼šåºåˆ—åŒ–å­˜å‚¨åˆ°æœ¬åœ°  è¦å¯¼å…¥ä¾èµ–</p> <blockquote><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-statebackend-rocksdb_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.10.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote></li></ul> <h2 id="å®¹é”™æœºåˆ¶"><a href="#å®¹é”™æœºåˆ¶" class="header-anchor">#</a> å®¹é”™æœºåˆ¶</h2> <p><strong>çŠ¶æ€ä¸€è‡´æ€§</strong>:</p> <ul><li>at-most-once: æ•…éšœè®¡ç®—ç»“æœå¯èƒ½ä¸¢å¤±</li> <li>at-least-onceï¼šä¸ä¼šä¸¢å¤±ï¼Œå¯èƒ½å¤šç®—ï¼Œç»“æœå¤§äºæ­£ç¡®å€¼</li> <li>exactly-onceï¼šæ­£ç¡®å€¼å’Œè®¡ç®—ç»“æœä¸€è‡´</li></ul> <p>å‰é¢è¯´åˆ°flinkæ˜¯lambdaæ¶æ„çš„æ”¹è¿›ï¼ŒæŠŠä¿©å¥—ç³»ç»Ÿåˆåœ¨ä¸€èµ·äº†ï¼Œæä¾›å¿«é€Ÿè®¡ç®—(ä½å»¶è¿Ÿ)+æ­£ç¡®æ€§(åˆå¹¶)</p> <p>Flink çš„ä¸€ä¸ªé‡å¤§ä»·å€¼åœ¨äºï¼Œ<strong>å®ƒæ—¢ä¿è¯äº†</strong> <strong>exactly-once</strong>**ï¼Œ<strong>ä¹Ÿå…·æœ‰ä½å»¶è¿Ÿå’Œé«˜åçš„å¤„ç†èƒ½åŠ›</strong></p> <p>ç«¯åˆ°ç«¯ï¼šend-to -end</p> <blockquote><p>è´¯ç©¿æµå¤„ç†çš„çš„å§‹ç»ˆï¼Œæ¯ä¸ªç»„ä»¶éƒ½ç¡®ä¿äº†ä»–è°ƒåº¦ä¸€è‡´æ€§ï¼š</p> <ul><li>å†…éƒ¨ä¿è¯=&gt;ä¾èµ–checkpoint</li> <li>sourceç«¯=&gt;éœ€è¦è®¾ç½®å¤–æº</li> <li>sinkç«¯=&gt;éœ€è¦ä¿è¯è°¨éµå†™å…¥ å…·ä½“å®ç°ï¼šå¹‚ç­‰æ€§(ä¸€æ¬¡æœ‰æ•ˆï¼‰å’Œäº‹åŠ¡æ€§(é¢„å†™å…¥æ—¥å¿—walï¼Œä¿©é˜¶æ®µæäº¤)</li></ul> <blockquote><p>DataStream API æä¾›äº† GenericWriteAheadSink æ¨¡æ¿ç±»å’Œ</p> <p>TwoPhaseCommitSinkFunction æ¥å£ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°è¿™ä¸¤ç§æ–¹å¼çš„äº‹åŠ¡æ€§å†™å…¥</p></blockquote> <p><img src="https://gitee.com/axcmsm/tmp/raw/master/bigdata/20211006233742.png" alt=""></p></blockquote> <p><strong>æ£€æŸ¥ç‚¹</strong>ï¼šåšæ ‡è®°</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//æ£€æŸ¥ç‚¹ç®—æ³•</span>
<span class="token keyword">val</span> stream<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token keyword">val</span> counts<span class="token operator">:</span> DataStream<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> stream <span class="token punctuation">.</span>keyBy<span class="token punctuation">(</span>record <span class="token keyword">=&gt;</span> record<span class="token punctuation">.</span>_1<span class="token punctuation">)</span> 
<span class="token punctuation">.</span>mapWithState<span class="token punctuation">(</span> <span class="token punctuation">(</span>in<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> state<span class="token operator">:</span> Option<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> state <span class="token keyword">match</span> <span class="token punctuation">{</span> 
<span class="token keyword">case</span> Some<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>in<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> c <span class="token operator">+</span> in<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">,</span> Some<span class="token punctuation">(</span>c <span class="token operator">+</span> in<span class="token punctuation">.</span>_2<span class="token punctuation">)</span> <span class="token punctuation">)</span> 
<span class="token keyword">case</span> None <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>in<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> in<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">,</span> Some<span class="token punctuation">(</span>in<span class="token punctuation">.</span>_2<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>æ£€æŸ¥ç‚¹æ˜¯ Flink æœ€æœ‰ä»·å€¼çš„åˆ›æ–°ä¹‹ä¸€ï¼Œå› ä¸º<strong>å®ƒä½¿</strong> <strong>Flink</strong> <strong>å¯ä»¥ä¿è¯</strong> <strong>exactly-once</strong> <strong>å¹¶ä¸”ä¸éœ€è¦ç‰ºç‰²æ€§èƒ½</strong>ã€‚</p></blockquote> <p><strong>Flink+Kafka</strong> <strong>å¦‚ä½•å®ç°ç«¯åˆ°ç«¯çš„</strong> <strong>exactly-once</strong> <strong>è¯­ä¹‰</strong>: kafkaè¿›+å‡º</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>å…·ä½“çš„ä¸¤é˜¶æ®µæäº¤æ­¥éª¤æ€»ç»“å¦‚ä¸‹ï¼š
ï¬ ç¬¬ä¸€æ¡æ•°æ®æ¥äº†ä¹‹åï¼Œå¼€å¯ä¸€ä¸ª kafka çš„äº‹åŠ¡ï¼ˆtransactionï¼‰ï¼Œæ­£å¸¸å†™å…¥ kafka åˆ†åŒºæ—¥å¿—ä½†æ ‡è®°ä¸ºæœªæäº¤ï¼Œè¿™å°±æ˜¯â€œé¢„æäº¤â€ 
ï¬ jobmanager è§¦å‘ checkpoint æ“ä½œï¼Œbarrier ä» source å¼€å§‹å‘ä¸‹ä¼ é€’ï¼Œé‡åˆ° barrier çš„ç®—å­å°†çŠ¶æ€å­˜å…¥çŠ¶æ€åç«¯ï¼Œå¹¶é€šçŸ¥ jobmanager 
ï¬ sink è¿æ¥å™¨æ”¶åˆ° barrierï¼Œä¿å­˜å½“å‰çŠ¶æ€ï¼Œå­˜å…¥ checkpointï¼Œé€šçŸ¥ jobmanagerï¼Œå¹¶å¼€å¯ä¸‹ä¸€é˜¶æ®µçš„äº‹åŠ¡ï¼Œç”¨äºæäº¤ä¸‹ä¸ªæ£€æŸ¥ç‚¹çš„æ•°æ® ï¬ jobmanager æ”¶åˆ°æ‰€æœ‰ä»»åŠ¡çš„é€šçŸ¥ï¼Œå‘å‡ºç¡®è®¤ä¿¡æ¯ï¼Œè¡¨ç¤º checkpoint å®Œæˆ 
ï¬ sink ä»»åŠ¡æ”¶åˆ° jobmanager çš„ç¡®è®¤ä¿¡æ¯ï¼Œæ­£å¼æäº¤è¿™æ®µæ—¶é—´çš„æ•°æ® 
ï¬ å¤–éƒ¨ kafka å…³é—­äº‹åŠ¡ï¼Œæäº¤çš„æ•°æ®å¯ä»¥æ­£å¸¸æ¶ˆè´¹äº†ã€‚
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></div> <div class="page-slot page-slot-bottom"><!-- æ¨ªå‘è‡ªé€‚åº” -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=flink" title="æ ‡ç­¾">#flink</a></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2023/03/22, 21:16:55</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/spa123ra12sd2/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">æµ…å°sparkâœ¨</div></a> <a href="/pages/f1table3n4k5/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">flink-table-sql</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/pages/spa123ra12sd2/" class="prev">æµ…å°sparkâœ¨</a></span> <span class="next"><a href="/pages/f1table3n4k5/">flink-table-sql</a>â†’
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f53939/"><div>Spring6</div></a> <span>06-18</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/ba69ad/"><div>è‹¥ä¾äºŒå¼€</div></a> <span>06-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/998714/"><div>MongoDB</div></a> <span>06-16</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">æ›´å¤šæ–‡ç« &gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=2461475139&amp;site=qq&amp;menu=yes" title="å‘é‚®ä»¶" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/axcmsm" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=6757658477" title="å¬éŸ³ä¹" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="æœ¬ç«™ä¸»é¢˜">Vdoing</a> 
    | Copyright Â© 2021-2023
    <span>axcmsm | è½¬è½½æ³¨æ˜å‡ºå¤„ </span></div> <div class="buttons"><div title="è¿”å›é¡¶éƒ¨" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="å»è¯„è®º" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="ä¸»é¢˜æ¨¡å¼" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          è·Ÿéšç³»ç»Ÿ
        </li><li class="iconfont icon-rijianmoshi">
          æµ…è‰²æ¨¡å¼
        </li><li class="iconfont icon-yejianmoshi">
          æ·±è‰²æ¨¡å¼
        </li><li class="iconfont icon-yuedu">
          é˜…è¯»æ¨¡å¼
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">Ã—</i> <div><!-- å›ºå®š160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.e7d9515b.js" defer></script><script src="/assets/js/2.125ae6e8.js" defer></script><script src="/assets/js/47.1722c1b9.js" defer></script>
  </body>
</html>